"use strict";(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[2845],{11860:(e,a,t)=>{t.d(a,{AppProvider:()=>p,I:()=>u,U:()=>x});var s=t(95155),i=t(12115),r=t(11929),l=t(54901),n=t(19708),o=t(14585),d=t(15894),c=t(5282),u=function(e){return e[e.WELCOME=0]="WELCOME",e[e.INITIAL_INFO=1]="INITIAL_INFO",e[e.PRODUCT_LIST=2]="PRODUCT_LIST",e[e.PREVIEW=3]="PREVIEW",e[e.SUCCESS=4]="SUCCESS",e[e.INITIAL_DATA=1]="INITIAL_DATA",e[e.SOLICITUD_LIST=2]="SOLICITUD_LIST",e}({});let m=(0,i.createContext)(void 0),p=e=>{let{children:a}=e,[t,u]=(0,i.useState)(null),[p,x]=(0,i.useState)([]),[b,h]=(0,i.useState)(0),[v,g]=(0,i.useState)(null),[N,j]=(0,i.useState)(!1),[f,C]=(0,i.useState)(!1),[A,S]=(0,i.useState)(null),[D,y]=(0,i.useState)(!1),[w,I]=(0,i.useState)([]),[k,E]=(0,i.useState)(null),[O,P]=(0,i.useState)([]),[T,R]=(0,i.useState)(null),[M,L]=(0,i.useState)(!1),[U,_]=(0,i.useState)(null),[q,B]=(0,i.useState)(null),{user:F}=(0,l.A)(),{toast:H}=(0,d.dj)(),[W,$]=(0,i.useState)(F),G=(0,i.useCallback)(()=>{u(null),x([]),h(0),g(null),j(!1),C(!1),S(null),y(!1),I([]),E(null),P([]),R(null),L(!1),_(null),B(null)},[]);(0,i.useEffect)(()=>{((null==F?void 0:F.uid)!==(null==W?void 0:W.uid)||F&&!W||!F&&W)&&(G(),$(F))},[F,W,G]);let V=(0,i.useCallback)(e=>{E(e)},[]),Q=(0,i.useCallback)(e=>{if(!(null==k?void 0:k.ne)){console.error("No se puede generar ID de solicitud: falta el NE en el contexto inicial."),H({title:"Error Interno",description:"No se pudo generar un ID para la solicitud porque falta el NE.",variant:"destructive"});return}let a=new Date,t=(0,c.GP)(a,"ddMMyy-HHmmss"),s="".concat(k.ne,"-").concat(t),i={...e,id:s};P(e=>[...e,i])},[k,H]),X=(0,i.useCallback)(e=>{P(a=>a.map(a=>a.id===e.id?e:a))},[]),Z=(0,i.useCallback)(e=>{P(a=>a.filter(a=>a.id!==e))},[]),J=(0,i.useCallback)(e=>{R(e||null),j(!0)},[]),z=(0,i.useCallback)(async(e,a)=>{if(D&&(null==t?void 0:t.ne)&&(null==F?void 0:F.email))try{let s=(0,n.rJ)(o.db,"examenesRecuperados"),i={examNe:t.ne,action:e,changedBy:F.email,changedAt:n.Dc.fromDate(new Date),details:a};await (0,n.gS)(s,i)}catch(e){console.error("Error writing audit log:",e),H({title:"Error de Auditor\xeda",description:"No se pudo registrar el cambio en la bit\xe1cora de recuperaci\xf3n.",variant:"destructive"})}},[D,null==t?void 0:t.ne,null==F?void 0:F.email,H]),K=(0,i.useCallback)(async(e,a)=>{if(!(null==e?void 0:e.ne)||!(null==F?void 0:F.email))return void console.log("Soft save prerequisites not met.",{ne:null==e?void 0:e.ne,user:null==F?void 0:F.email});let t=(0,n.H9)(o.db,"examenesPrevios",e.ne.toUpperCase()),s={...e,products:a,savedBy:F.email,status:"incomplete",lastUpdated:n.Dc.fromDate(new Date)};try{let i=await (0,n.x7)(t);1!==a.length||i.exists()&&i.data().createdAt||(s.createdAt=n.Dc.fromDate(new Date)),s.savedAt=n.Dc.fromDate(new Date),await (0,n.BN)(t,s,{merge:!0}),console.log("Soft save successful for NE: ".concat(e.ne))}catch(e){console.error("Error during soft save:",e),H({title:"Error de Autoguardado",description:"No se pudo guardar el progreso. Revisa tu conexi\xf3n.",variant:"destructive"})}},[F,H]),Y=(0,i.useCallback)(function(e){let a=arguments.length>1&&void 0!==arguments[1]&&arguments[1];u(e),a&&y(!0)},[]),ee=(0,i.useCallback)(e=>{x(e)},[]),ea=(0,i.useCallback)(e=>{let a={...e,id:(0,r.A)(),productTimestampSaveAt:n.Dc.fromDate(new Date)};x(e=>{let s=[...e,a];return K(t,s),s}),z("product_added",{productId:a.id,newData:a})},[t,K,z]),et=(0,i.useCallback)(e=>{let a;x(s=>{a=s.find(a=>a.id===e.id);let i=s.map(a=>a.id===e.id?e:a);return K(t,i),i}),z("product_updated",{productId:e.id,previousData:a,newData:e}),g(null)},[t,K,z]),es=(0,i.useCallback)(e=>{let a;x(s=>{a=s.find(a=>a.id===e);let i=s.filter(a=>a.id!==e);return K(t,i),i}),a&&z("product_deleted",{productId:e,previousData:a})},[t,K,z]),ei=(0,i.useCallback)(e=>{h(e)},[]),er=(0,i.useCallback)(e=>{g(e)},[]),el=(0,i.useCallback)(e=>{2===b?g(e):2===b&&R(e),j(!0)},[b]),en=(0,i.useCallback)(()=>{j(!1),g(null),R(null)},[]),eo=(0,i.useCallback)(e=>{S(e),C(!0)},[]),ed=(0,i.useCallback)(()=>{C(!1),S(null)},[]),ec=(0,i.useCallback)(e=>{I(a=>a.includes(e)?a.filter(a=>a!==e):[...a,e])},[]),eu=(0,i.useCallback)(()=>{w.length===p.length?I([]):I(p.map(e=>e.id))},[p,w.length]),em=(0,i.useCallback)(()=>{let e=[];x(a=>{let s=a.filter(a=>!w.includes(a.id)||(e.push(a),!1));return K(t,s),s}),e.forEach(e=>{z("product_deleted",{productId:e.id,previousData:e})}),I([]),H({title:"Productos eliminados",description:"".concat(e.length," productos han sido eliminados de la lista.")})},[w,K,t,z,H]);return(0,s.jsx)(m.Provider,{value:{examData:t,products:p,currentStep:b,editingProduct:v,isAddProductModalOpen:N,isProductDetailModalOpen:f,productToView:A,selectedProducts:w,setExamData:Y,setProducts:ee,addProduct:ea,updateProduct:et,deleteProduct:es,setCurrentStep:ei,setEditingProduct:er,openAddProductModal:el,closeAddProductModal:en,openProductDetailModal:eo,closeProductDetailModal:ed,resetApp:G,softSaveExam:K,toggleProductSelection:ec,toggleSelectAllProducts:eu,deleteSelectedProducts:em,initialContextData:k,setInitialContextData:V,solicitudes:O,addSolicitud:Q,updateSolicitud:X,deleteSolicitud:Z,editingSolicitud:T,openSolicitudModal:J,isMemorandumMode:M,setIsMemorandumMode:L,solicitudToViewInline:U,setSolicitudToViewInline:_,caseToAssignAforador:q,setCaseToAssignAforador:B},children:a})},x=()=>{let e=(0,i.useContext)(m);if(void 0===e)throw Error("useAppContext must be used within an AppProvider");return e}},72845:(e,a,t)=>{t.d(a,{A:()=>U});var s=t(95155),i=t(12115),r=t(14585),l=t(19708),n=t(3998),o=t(86948),d=t(11647),c=t(24820),u=t(92678),m=t(92033),p=t(66065),x=t(2165),b=t(94979),h=t(50817),v=t(5225),g=t(27314),N=t(44381),j=t(98039),f=t(6943),C=t(59729),A=t(25128),S=t(50705),D=t(56639),y=t(47974),w=t(27500),I=t(76251),k=t(36204),E=t(5282),O=t(80160),P=t(64269),T=t(15239),R=t(11860);let M=e=>{let a,{label:t,value:i,icon:r,className:l}=e;return a="boolean"==typeof i?i?"S\xed":"No":i instanceof Date?(0,E.GP)(i,"PPP",{locale:O.es}):String(null!=i?i:"N/A"),(0,s.jsxs)("div",{className:(0,P.cn)("py-1 flex items-baseline print:py-0",l),children:[(0,s.jsxs)("p",{className:"text-xs font-medium text-muted-foreground flex items-center shrink-0 print:text-xs",children:[r&&(0,s.jsx)(r,{className:"h-3.5 w-3.5 mr-1.5 text-primary/70 print:h-3 print:w-3"}),t,":\xa0"]}),(0,s.jsx)("p",{className:"text-sm text-foreground break-words print:text-xs print:font-semibold",children:a})]})},L=e=>{let{label:a,checked:t,subLabel:i}=e;return(0,s.jsxs)("div",{className:"flex items-center py-1 print:py-0.5",children:[t?(0,s.jsx)(c.A,{className:"h-4 w-4 text-green-600 mr-2 print:h-3 print:w-3"}):(0,s.jsx)(u.A,{className:"h-4 w-4 text-muted-foreground mr-2 print:h-3 print:w-3"}),(0,s.jsx)("span",{className:"text-sm text-foreground print:text-xs",children:a}),i&&(0,s.jsx)("span",{className:"text-xs text-muted-foreground ml-1 print:text-xs",children:i})]})};function U(e){let{id:a,isInlineView:t,onBackToList:c,children:u,solicitud:E,initialData:O}=e,{initialContextData:P,solicitudes:U}=(0,R.U)(),[_,q]=(0,i.useState)(E||null),[B,F]=(0,i.useState)(O||null),[H,W]=(0,i.useState)(!E&&!a),[$,G]=(0,i.useState)(null);(0,i.useEffect)(()=>{(async()=>{if(E)q(E),F(O||{ne:E.examNe,reference:E.examReference||void 0,manager:E.examManager,date:E.examDate||new Date,recipient:E.examRecipient,isMemorandum:E.isMemorandum}),W(!1);else if(a){W(!0);let e=!1;for(let t of["SolicitudCheques","Memorandum"])try{let s=(0,l.H9)(r.db,t,a),i=await (0,l.x7)(s);if(i.exists()){let a=i.data(),t=a.examDate instanceof l.Dc?a.examDate.toDate():void 0,s=a.savedAt instanceof l.Dc?a.savedAt.toDate():void 0,r={...a,solicitudId:i.id,examDate:t,savedAt:s};q(r),F({ne:r.examNe,reference:r.examReference||void 0,manager:r.examManager,date:r.examDate||new Date,recipient:r.examRecipient,isMemorandum:r.isMemorandum}),e=!0;break}}catch(e){console.error("Error fetching from ".concat(t,": "),e)}e||G("No se pudo encontrar la solicitud."),W(!1)}else if(U){let e=U[U.length-1];q(e||null),F(P),W(!1),e||G("No se pudo encontrar la solicitud en el contexto actual.")}else G("No hay datos de solicitud para mostrar."),W(!1)})()},[a,E,O,U,P]);let V=()=>{window.print()};return(0,s.jsxs)("div",{id:"printable-area",children:[(0,s.jsxs)(o.Zp,{className:"w-full max-w-4xl mx-auto shadow-lg card-print-styles",children:[u,(()=>H?(0,s.jsx)("div",{className:"flex justify-center items-center h-64",children:(0,s.jsx)(m.A,{className:"h-8 w-8 animate-spin text-primary"})}):$?(0,s.jsx)("div",{className:"text-center p-10 text-destructive",children:$}):_&&B?(0,s.jsxs)(o.Wu,{className:"pt-4 print:p-0",children:[(0,s.jsx)("div",{className:"hidden print:block",children:(0,s.jsx)(T.default,{src:"/imagenes/HEADERSEXA.svg",alt:"Header Solicitud Detail",width:800,height:100,className:"w-full h-auto object-contain","data-ai-hint":"company logo banner",priority:!0})}),(0,s.jsx)("div",{className:"no-print",children:(0,s.jsxs)(o.aR,{className:"p-0 mb-4",children:[(0,s.jsx)(o.ZB,{className:"text-xl md:text-2xl font-semibold text-foreground",children:"Detalle de Solicitud de Pago"}),(0,s.jsx)(o.BT,{className:"text-muted-foreground",children:"Mostrando informaci\xf3n de la solicitud seleccionada."})]})}),(0,s.jsx)("div",{className:"mb-3 p-4 border rounded-md bg-secondary/5 print:border print:mb-2",children:(0,s.jsxs)("div",{className:"flex justify-between items-center",children:[(0,s.jsx)(M,{label:"ID de Solicitud",value:_.solicitudId||_.id,icon:p.A}),(0,s.jsxs)("div",{className:"flex items-center gap-2",children:[_.isMemorandum&&(0,s.jsxs)(d.E,{variant:"destructive",className:"text-sm font-semibold px-3 py-1 print:text-xs",children:[(0,s.jsx)(x.A,{className:"h-4 w-4 mr-1.5"})," Memor\xe1ndum"]}),_.soporte&&(0,s.jsx)(d.E,{className:"bg-green-100 text-green-700 text-sm font-semibold px-3 py-1 rounded-md border border-gray-300 print:border-gray-400 hover:bg-green-600 hover:text-white print:text-xs",children:"PAGADA"})]})]})}),(0,s.jsxs)("div",{className:"mb-3 p-4 border rounded-md bg-secondary/30 print:border print:mb-2",children:[(0,s.jsx)("h3",{className:"text-lg font-semibold mb-2 text-primary print:text-base print:mb-1",children:"Solicitud de Cheque"}),(0,s.jsxs)("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-x-4 gap-y-0 print:grid-cols-2 print:gap-x-8",children:[(0,s.jsxs)("div",{className:"space-y-1",children:[(0,s.jsx)(M,{label:"A",value:B.recipient,icon:b.A}),(0,s.jsx)(M,{label:"Fecha de Solicitud",value:B.date,icon:h.A}),(0,s.jsx)(M,{label:"Referencia",value:B.reference||"N/A",icon:v.A})]}),(0,s.jsxs)("div",{className:"space-y-1",children:[(0,s.jsx)(M,{label:"De (Usuario)",value:B.manager,icon:g.A}),(0,s.jsx)(M,{label:"NE (Tracking NX1)",value:B.ne,icon:p.A})]})]})]}),_.isMemorandum&&_.memorandumCollaborators&&_.memorandumCollaborators.length>0&&(0,s.jsxs)("div",{className:"mb-3 p-4 border border-destructive/50 rounded-md bg-destructive/5 print:border print:mb-2",children:[(0,s.jsx)("h3",{className:"text-lg font-semibold mb-2 text-destructive print:text-base print:mb-1",children:"Colaboradores del Memor\xe1ndum"}),(0,s.jsx)("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-x-6 gap-y-1 print:grid-cols-2 print:gap-x-8",children:_.memorandumCollaborators.map(e=>(0,s.jsxs)("div",{className:"p-2 border-b border-destructive/20 print:p-1 print:border-0",children:[(0,s.jsx)(M,{label:"Nombre",value:e.name,icon:g.A}),(0,s.jsx)(M,{label:"N\xfamero Colaborador",value:e.number,icon:N.A})]},e.id))})]}),(0,s.jsxs)("div",{className:"mb-3 p-4 border border-border rounded-md bg-secondary/30 print:border print:mb-2",children:[(0,s.jsx)("p",{className:"text-sm font-medium text-muted-foreground mb-2 print:text-xs",children:"Por este medio me dirijo a usted para solicitarle que elabore cheque por la cantidad de:"}),(0,s.jsxs)("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-x-4 items-start mb-3 print:grid-cols-2 print:gap-x-8 print:mb-2",children:[(0,s.jsxs)("div",{className:"flex items-baseline py-1",children:[(0,s.jsx)(j.A,{className:"h-4 w-4 mr-1.5 text-primary shrink-0 print:h-3 print:w-3"}),(0,s.jsx)("p",{className:"text-sm text-foreground break-words print:text-xs print:font-bold",children:((e,a)=>{if(null==e||""===e)return"N/A";let t=Number(e);if(isNaN(t))return String(e);let s="";return"cordoba"===a?s="C$":"dolar"===a?s="US$":"euro"===a&&(s="â‚¬"),"".concat(s).concat(t.toLocaleString("es-NI",{minimumFractionDigits:2,maximumFractionDigits:2}))})(_.monto,_.montoMoneda)})]}),(0,s.jsxs)("div",{className:"flex items-baseline py-1",children:[(0,s.jsx)(v.A,{className:"h-4 w-4 mr-1.5 text-primary shrink-0 print:h-3 print:w-3"}),(0,s.jsx)("p",{className:"text-sm text-foreground break-words print:text-xs print:font-bold",children:_.cantidadEnLetras||"N/A"})]})]}),(0,s.jsxs)("div",{className:"space-y-3 divide-y divide-border print:space-y-1",children:[(0,s.jsx)("div",{className:"pt-3 print:pt-1",children:(0,s.jsxs)("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-x-4 print:grid-cols-3 print:gap-x-8",children:[(0,s.jsx)(M,{label:"Consignatario",value:_.consignatario,icon:f.A}),(0,s.jsx)(M,{label:"Declaraci\xf3n N\xfamero",value:_.declaracionNumero,icon:N.A}),(0,s.jsx)(M,{label:"Unidad Recaudadora",value:_.unidadRecaudadora,icon:C.A}),(0,s.jsx)(M,{label:"C\xf3digo 1",value:_.codigo1,icon:A.A}),(0,s.jsx)(M,{label:"Codigo MUR",value:_.codigo2,icon:A.A})]})}),(0,s.jsx)("div",{className:"pt-3 print:pt-1",children:(0,s.jsxs)("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-x-4 items-start print:grid-cols-3 print:gap-x-8",children:[(0,s.jsx)(M,{label:"Banco",value:"ACCION POR CHEQUE/NO APLICA BANCO"===_.banco?"Acci\xf3n por Cheque / No Aplica Banco":"Otros"===_.banco?_.bancoOtros||"Otros (No especificado)":_.banco,icon:S.A}),"ACCION POR CHEQUE/NO APLICA BANCO"!==_.banco&&(0,s.jsxs)(s.Fragment,{children:[(0,s.jsx)(M,{label:"N\xfamero de Cuenta",value:_.numeroCuenta,icon:N.A}),(0,s.jsx)(M,{label:"Moneda de la Cuenta",value:"Otros"===_.monedaCuenta?_.monedaCuentaOtros||"Otros (No especificado)":_.monedaCuenta,icon:j.A})]})]})}),(0,s.jsx)("div",{className:"pt-3 print:pt-1",children:(0,s.jsxs)("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-x-4 print:grid-cols-2 print:gap-x-8",children:[(0,s.jsx)(M,{label:"Elaborar Cheque A",value:_.elaborarChequeA,icon:g.A}),(0,s.jsx)(M,{label:"Elaborar Transferencia A",value:_.elaborarTransferenciaA,icon:g.A})]})}),(0,s.jsx)("div",{className:"pt-3 print:pt-1",children:(0,s.jsxs)("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-x-6 print:grid-cols-2 print:gap-x-8",children:[(0,s.jsxs)("div",{className:"space-y-1",children:[(0,s.jsx)(L,{label:"Impuestos pendientes de pago por el cliente",checked:_.impuestosPendientesCliente}),(0,s.jsx)(L,{label:"Soporte",checked:_.soporte}),(0,s.jsx)(L,{label:"Impuestos pagados por el cliente mediante:",checked:_.impuestosPagadosCliente}),_.impuestosPagadosCliente&&(0,s.jsxs)("div",{className:"ml-6 pl-2 border-l border-dashed",children:[(0,s.jsx)(M,{label:"R/C No.",value:_.impuestosPagadosRC}),(0,s.jsx)(M,{label:"T/B No.",value:_.impuestosPagadosTB}),(0,s.jsx)(M,{label:"Cheque No.",value:_.impuestosPagadosCheque})]})]}),(0,s.jsxs)("div",{className:"space-y-1",children:[(0,s.jsx)(L,{label:"Se a\xf1aden documentos adjuntos",checked:_.documentosAdjuntos}),(0,s.jsx)(L,{label:"Constancias de no retenci\xf3n",checked:_.constanciasNoRetencion}),_.constanciasNoRetencion&&(0,s.jsxs)("div",{className:"ml-6 pl-2 border-l border-dashed",children:[(0,s.jsx)(L,{label:"1%",checked:_.constanciasNoRetencion1}),(0,s.jsx)(L,{label:"2%",checked:_.constanciasNoRetencion2})]})]})]})}),_.pagoServicios&&(0,s.jsxs)("div",{className:"pt-3 print:pt-1",children:[(0,s.jsx)("h4",{className:"text-md font-medium text-primary mb-1 print:text-sm",children:"Pago de Servicios"}),(0,s.jsxs)("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-x-4 print:grid-cols-2 print:gap-x-8",children:[(0,s.jsx)(M,{label:"Tipo de Servicio",value:"OTROS"===_.tipoServicio?_.otrosTipoServicio:_.tipoServicio,icon:D.A}),(0,s.jsx)(M,{label:"Factura Servicio",value:_.facturaServicio,icon:v.A}),(0,s.jsx)(M,{label:"Instituci\xf3n Servicio",value:_.institucionServicio,icon:C.A})]})]}),(0,s.jsxs)("div",{className:"pt-3 print:pt-1",children:[(0,s.jsx)(M,{label:"Correos de Notificaci\xf3n",value:_.correo,icon:y.A}),(0,s.jsx)(M,{label:"Observaci\xf3n",value:_.observation,icon:w.A})]})]})]}),(0,s.jsx)("div",{className:"hidden print:block",children:(0,s.jsx)(T.default,{src:"/imagenes/FOOTERSOLICITUDETAIL.svg",alt:"Footer Solicitud Detail",width:800,height:100,className:"w-full h-auto object-contain mt-6","data-ai-hint":"company seal official",priority:!0})}),(0,s.jsx)("div",{className:"no-print mt-4 flex justify-end",children:(0,s.jsxs)(n.$,{onClick:V,children:[(0,s.jsx)(I.A,{className:"mr-2 h-4 w-4"})," Imprimir"]})})]}):(0,s.jsx)("div",{className:"text-center p-10 text-muted-foreground",children:"Datos de la solicitud no encontrados."}))()]}),c&&(0,s.jsx)("div",{className:"no-print mt-4",children:(0,s.jsxs)(n.$,{onClick:c,children:[(0,s.jsx)(k.A,{className:"mr-2 h-4 w-4"})," Volver"]})})]})}}}]);