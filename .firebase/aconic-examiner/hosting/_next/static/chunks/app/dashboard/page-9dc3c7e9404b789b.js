(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[5105],{11186:(e,a,s)=>{"use strict";s.d(a,{bq:()=>h,eb:()=>p,gC:()=>v,l6:()=>c,yv:()=>u});var l=s(95155),t=s(12115),r=s(47887),i=s(59007),o=s(42614),d=s(72251),n=s(64269);let c=r.bL;r.YJ;let u=r.WT,h=t.forwardRef((e,a)=>{let{className:s,children:t,...o}=e;return(0,l.jsxs)(r.l9,{ref:a,className:(0,n.cn)("flex h-10 w-full items-center justify-between rounded-md border border-input bg-background px-3 py-2 text-sm ring-offset-background placeholder:text-muted-foreground focus:outline-none focus:ring-2 focus:ring-ring focus:ring-offset-2 disabled:cursor-not-allowed disabled:opacity-50 [&>span]:line-clamp-1",s),...o,children:[t,(0,l.jsx)(r.In,{asChild:!0,children:(0,l.jsx)(i.A,{className:"h-4 w-4 opacity-50"})})]})});h.displayName=r.l9.displayName;let x=t.forwardRef((e,a)=>{let{className:s,...t}=e;return(0,l.jsx)(r.PP,{ref:a,className:(0,n.cn)("flex cursor-default items-center justify-center py-1",s),...t,children:(0,l.jsx)(o.A,{className:"h-4 w-4"})})});x.displayName=r.PP.displayName;let m=t.forwardRef((e,a)=>{let{className:s,...t}=e;return(0,l.jsx)(r.wn,{ref:a,className:(0,n.cn)("flex cursor-default items-center justify-center py-1",s),...t,children:(0,l.jsx)(i.A,{className:"h-4 w-4"})})});m.displayName=r.wn.displayName;let v=t.forwardRef((e,a)=>{let{className:s,children:t,position:i="popper",...o}=e;return(0,l.jsx)(r.ZL,{children:(0,l.jsxs)(r.UC,{ref:a,className:(0,n.cn)("relative z-50 max-h-96 min-w-[8rem] overflow-hidden rounded-md border bg-popover text-popover-foreground shadow-md data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0 data-[state=closed]:zoom-out-95 data-[state=open]:zoom-in-95 data-[side=bottom]:slide-in-from-top-2 data-[side=left]:slide-in-from-right-2 data-[side=right]:slide-in-from-left-2 data-[side=top]:slide-in-from-bottom-2","popper"===i&&"data-[side=bottom]:translate-y-1 data-[side=left]:-translate-x-1 data-[side=right]:translate-x-1 data-[side=top]:-translate-y-1",s),position:i,...o,children:[(0,l.jsx)(x,{}),(0,l.jsx)(r.LM,{className:(0,n.cn)("p-1","popper"===i&&"h-[var(--radix-select-trigger-height)] w-full min-w-[var(--radix-select-trigger-width)]"),children:t}),(0,l.jsx)(m,{})]})})});v.displayName=r.UC.displayName,t.forwardRef((e,a)=>{let{className:s,...t}=e;return(0,l.jsx)(r.JU,{ref:a,className:(0,n.cn)("py-1.5 pl-8 pr-2 text-sm font-semibold",s),...t})}).displayName=r.JU.displayName;let p=t.forwardRef((e,a)=>{let{className:s,children:t,...i}=e;return(0,l.jsxs)(r.q7,{ref:a,className:(0,n.cn)("relative flex w-full cursor-default select-none items-center rounded-sm py-1.5 pl-8 pr-2 text-sm outline-none focus:bg-accent focus:text-accent-foreground data-[disabled]:pointer-events-none data-[disabled]:opacity-50",s),...i,children:[(0,l.jsx)("span",{className:"absolute left-2 flex h-3.5 w-3.5 items-center justify-center",children:(0,l.jsx)(r.VF,{children:(0,l.jsx)(d.A,{className:"h-4 w-4"})})}),(0,l.jsx)(r.p4,{children:t})]})});p.displayName=r.q7.displayName,t.forwardRef((e,a)=>{let{className:s,...t}=e;return(0,l.jsx)(r.wv,{ref:a,className:(0,n.cn)("-mx-1 my-1 h-px bg-muted",s),...t})}).displayName=r.wv.displayName},13406:(e,a,s)=>{"use strict";s.d(a,{Xi:()=>n,av:()=>c,j7:()=>d,tU:()=>o});var l=s(95155),t=s(12115),r=s(25667),i=s(64269);let o=r.bL,d=t.forwardRef((e,a)=>{let{className:s,...t}=e;return(0,l.jsx)(r.B8,{ref:a,className:(0,i.cn)("inline-flex h-10 items-center justify-center rounded-md bg-muted p-1 text-muted-foreground",s),...t})});d.displayName=r.B8.displayName;let n=t.forwardRef((e,a)=>{let{className:s,...t}=e;return(0,l.jsx)(r.l9,{ref:a,className:(0,i.cn)("inline-flex items-center justify-center whitespace-nowrap rounded-sm px-3 py-1.5 text-sm font-medium ring-offset-background transition-all focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2 disabled:pointer-events-none disabled:opacity-50 data-[state=active]:bg-background data-[state=active]:text-foreground data-[state=active]:shadow-sm",s),...t})});n.displayName=r.l9.displayName;let c=t.forwardRef((e,a)=>{let{className:s,...t}=e;return(0,l.jsx)(r.UC,{ref:a,className:(0,i.cn)("mt-2 ring-offset-background focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2",s),...t})});c.displayName=r.UC.displayName},27044:(e,a,s)=>{"use strict";s.r(a),s.d(a,{default:()=>eE});var l=s(95155),t=s(12115),r=s(20063),i=s(54901),o=s(35434),d=s(86948),n=s(92033),c=s(56397),u=s(14585),h=s(19708),x=s(13406),m=s(26991),v=s(80019),p=s(90806),f=s(47734),j=s(73697),g=s(23508),b=s(7620),y=s(47643),w=s(98128),N=s(16533),D=s(11186),A=s(82206),S=s(7698),C=s(90231),k=s(79894),E=s(17206),T=s(61521),R=s(35945),P=s(5282),M=s(33133),F=s(80160),B=s(27339),O=s(5225),_=s(91719),q=s(29009),Z=s(6943),G=s(53489),U=s(3998),I=s(54264),V=s.n(I),z=s(15239);let W=new Date().getFullYear(),L=Array.from({length:5},(e,a)=>W-a),H=[{value:0,label:"Enero"},{value:1,label:"Febrero"},{value:2,label:"Marzo"},{value:3,label:"Abril"},{value:4,label:"Mayo"},{value:5,label:"Junio"},{value:6,label:"Julio"},{value:7,label:"Agosto"},{value:8,label:"Septiembre"},{value:9,label:"Octubre"},{value:10,label:"Noviembre"},{value:11,label:"Diciembre"}];function J(e){let{allExams:a}=e,[s,r]=(0,t.useState)([]),[i,o]=(0,t.useState)("year"),[n,c]=(0,t.useState)(),[u,h]=(0,t.useState)(),[x,I]=(0,t.useState)((0,S.t)(new Date)),[J,X]=(0,t.useState)(W),K=(0,t.useRef)(null),$=(0,t.useRef)(null),Q=(0,t.useRef)(null),Y=(0,t.useCallback)((e,s)=>a.filter(a=>{for(let l of[a.completedAt,a.createdAt,a.lastUpdated,a.savedAt,a.assignedAt,a.requestedAt])if(l){let a=l.toDate();if(a>=e&&a<=s)return!0}return!1}),[a]),ee=(0,t.useCallback)(()=>{let e=[];if("all"===i)e=a;else if("range"===i&&(null==n?void 0:n.from)){let a=n.from,s=n.to||new Date;s.setHours(23,59,59,999),e=Y(a,s)}else if("month"===i)e=Y((0,C.w)(new Date(J,x)),(0,k.p)(new Date(J,x)));else if("year"===i)e=Y((0,E.D)(new Date(J,0,1)),(0,T.Q)(new Date(J,11,31)));else if("specific"===i&&u){let a=new Date(u);a.setHours(0,0,0,0);let s=new Date(u);s.setHours(23,59,59,999),e=Y(a,s)}r(e)},[a,i,n,x,J,u,Y]);(0,t.useEffect)(()=>{ee()},[i,n,x,J,u,a,ee]);let ea=(0,t.useMemo)(()=>{let e="year"===i||"month"===i?J:W,l=(0,R.i)({start:(0,E.D)(new Date(e,0,1)),end:(0,T.Q)(new Date(e,11,31))}),t={};l.forEach(e=>{t[(0,P.GP)(e,"MMM",{locale:F.es})]=0}),a.forEach(a=>{let s=[a.completedAt,a.createdAt,a.lastUpdated,a.savedAt,a.assignedAt,a.requestedAt],l=new Set;for(let a of s)if(a){let s=a.toDate();if((0,M.C)(s)===e){let e=(0,P.GP)(s,"MMM",{locale:F.es});l.add(e)}}l.forEach(e=>{t.hasOwnProperty(e)&&t[e]++})});let r=Object.keys(t).map(e=>({month:e,total:t[e]})),o=s.length,d=s.reduce((e,a)=>{var s;return e+((null==(s=a.products)?void 0:s.length)||0)},0),n={};s.forEach(e=>{var a;let s=e.manager||"No asignado";n[s]||(n[s]={examCount:0,productCount:0}),n[s].examCount+=1,n[s].productCount+=(null==(a=e.products)?void 0:a.length)||0});let c=Object.entries(n).map(e=>{let[a,s]=e;return{name:a,total:s.examCount}}).sort((e,a)=>a.total-e.total).slice(0,10),u=Object.entries(n).map(e=>{let[a,s]=e;return{name:a,total:s.productCount}}).sort((e,a)=>a.total-e.total).slice(0,10),h=o>0?parseFloat((d/o).toFixed(1)):0,x=Object.keys(n).length,m=x>0?parseFloat((o/x).toFixed(1)):0;return{totalExams:o,totalProducts:d,examsByManager:c,productsByManager:u,examsByMonth:r,avgProductsPerExam:h,avgExamsPerManager:m}},[s,a,i,J]),es=(e,a)=>{if(e.current){let s=e.current,l=s.querySelector(".download-header");l&&(l.style.display="block"),V()(s,{scale:1.5,backgroundColor:null,onclone:e=>{let a=e.querySelector(".download-header");a&&(a.style.display="block")}}).then(e=>{let s=document.createElement("a");s.download="grafico_".concat(a,"_").concat(new Date().toISOString().split("T")[0],".jpg"),s.href=e.toDataURL("image/jpeg",.9),s.click(),l&&(l.style.display="none")})}};return(0,l.jsxs)("div",{className:"space-y-6",children:[(0,l.jsxs)(d.Zp,{children:[(0,l.jsxs)(d.aR,{children:[(0,l.jsx)(d.ZB,{className:"text-2xl",children:"Dashboard de Operaciones (Previos)"}),(0,l.jsx)(d.BT,{children:"Resumen interactivo de la actividad de ex\xe1menes previos."})]}),(0,l.jsxs)(d.Wu,{className:"flex flex-col md:flex-row gap-4",children:[(0,l.jsxs)(D.l6,{value:i,onValueChange:e=>o(e),children:[(0,l.jsx)(D.bq,{className:"w-[200px]",children:(0,l.jsx)(D.yv,{placeholder:"Filtrar por..."})}),(0,l.jsxs)(D.gC,{children:[(0,l.jsx)(D.eb,{value:"year",children:"Por A\xf1o"}),(0,l.jsx)(D.eb,{value:"month",children:"Mes Espec\xedfico"}),(0,l.jsx)(D.eb,{value:"range",children:"Rango de Fechas"}),(0,l.jsx)(D.eb,{value:"specific",children:"Fecha Espec\xedfica"}),(0,l.jsx)(D.eb,{value:"all",children:"Todo el tiempo"})]})]}),("month"===i||"year"===i)&&(0,l.jsxs)("div",{className:"flex gap-2",children:["month"===i&&(0,l.jsxs)(D.l6,{value:String(x),onValueChange:e=>I(Number(e)),children:[(0,l.jsx)(D.bq,{className:"w-[180px]",children:(0,l.jsx)(D.yv,{placeholder:"Mes"})}),(0,l.jsx)(D.gC,{children:H.map(e=>(0,l.jsx)(D.eb,{value:String(e.value),children:e.label},e.value))})]}),(0,l.jsxs)(D.l6,{value:String(J),onValueChange:e=>X(Number(e)),children:[(0,l.jsx)(D.bq,{className:"w-[120px]",children:(0,l.jsx)(D.yv,{placeholder:"A\xf1o"})}),(0,l.jsx)(D.gC,{children:L.map(e=>(0,l.jsx)(D.eb,{value:String(e),children:e},e))})]})]}),"range"===i&&(0,l.jsx)(A.S,{date:n,onDateChange:c}),"specific"===i&&(0,l.jsx)(B.l,{date:u,onDateChange:h})]})]}),(0,l.jsx)("div",{className:"grid gap-4 md:grid-cols-2 lg:grid-cols-4",children:[{title:"Total de Ex\xe1menes",value:ea.totalExams,icon:O.A},{title:"Total de Productos",value:ea.totalProducts,icon:_.A},{title:"Productos / Examen (Prom)",value:ea.avgProductsPerExam,icon:q.A},{title:"Ex\xe1menes / Gestor (Prom)",value:ea.avgExamsPerManager,icon:Z.A}].map((e,a)=>(0,l.jsxs)(d.Zp,{className:"transition-all hover:shadow-lg hover:-translate-y-1",children:[(0,l.jsxs)(d.aR,{className:"flex flex-row items-center justify-between space-y-0 pb-2",children:[(0,l.jsx)(d.ZB,{className:"text-sm font-medium",children:e.title}),(0,l.jsx)(e.icon,{className:"h-4 w-4 text-muted-foreground"})]}),(0,l.jsx)(d.Wu,{children:(0,l.jsx)("div",{className:"text-2xl font-bold",children:e.value})})]},a))}),(0,l.jsxs)(d.Zp,{ref:K,children:[(0,l.jsx)("div",{className:"download-header",style:{display:"none",padding:"1rem",backgroundColor:"white"},children:(0,l.jsx)(z.default,{src:"/AconicExaminer/imagenes/HEADERSEXA.svg",alt:"Examen Header",width:800,height:100,className:"w-full h-auto mb-4",priority:!0})}),(0,l.jsx)(d.aR,{children:(0,l.jsxs)("div",{className:"flex justify-between items-start",children:[(0,l.jsxs)("div",{children:[(0,l.jsx)(d.ZB,{children:"Operaciones Anual"}),(0,l.jsx)(d.BT,{children:"Volumen de ex\xe1menes previos completados a lo largo del tiempo."})]}),(0,l.jsx)(U.$,{onClick:()=>es(K,"operaciones_anual"),variant:"ghost",size:"icon",children:(0,l.jsx)(G.A,{className:"h-4 w-4"})})]})}),(0,l.jsx)(d.Wu,{children:(0,l.jsx)(m.u,{width:"100%",height:300,children:(0,l.jsxs)(v.b,{data:ea.examsByMonth,margin:{top:5,right:20,left:-10,bottom:5},children:[(0,l.jsx)(p.d,{strokeDasharray:"3 3"}),(0,l.jsx)(f.W,{dataKey:"month"}),(0,l.jsx)(j.h,{allowDecimals:!1}),(0,l.jsx)(g.m,{contentStyle:{backgroundColor:"hsl(var(--background))",border:"1px solid hsl(var(--border))"}}),(0,l.jsx)(b.s,{}),(0,l.jsx)(y.N,{type:"monotone",dataKey:"total",stroke:"hsl(var(--chart-1))",strokeWidth:2,name:"Total de Ex\xe1menes",dot:{r:4},activeDot:{r:8}})]})})})]}),(0,l.jsxs)("div",{className:"grid gap-6 md:grid-cols-2",children:[(0,l.jsxs)(d.Zp,{ref:$,children:[(0,l.jsx)("div",{className:"download-header",style:{display:"none",padding:"1rem",backgroundColor:"white"},children:(0,l.jsx)(z.default,{src:"/AconicExaminer/imagenes/HEADERSEXA.svg",alt:"Header",width:800,height:100,priority:!0})}),(0,l.jsx)(d.aR,{children:(0,l.jsxs)("div",{className:"flex justify-between items-start",children:[(0,l.jsxs)("div",{children:[(0,l.jsx)(d.ZB,{children:"Ex\xe1menes por Gestor"}),(0,l.jsx)(d.BT,{children:"Top 10 gestores por volumen de ex\xe1menes."})]}),(0,l.jsx)(U.$,{onClick:()=>es($,"examenes_por_gestor"),variant:"ghost",size:"icon",children:(0,l.jsx)(G.A,{className:"h-4 w-4"})})]})}),(0,l.jsx)(d.Wu,{children:(0,l.jsx)(m.u,{width:"100%",height:350,children:(0,l.jsxs)(w.E,{data:ea.examsByManager,layout:"vertical",margin:{top:5,right:30,left:20,bottom:5},children:[(0,l.jsx)(p.d,{strokeDasharray:"3 3"}),(0,l.jsx)(f.W,{type:"number",allowDecimals:!1}),(0,l.jsx)(j.h,{dataKey:"name",type:"category",width:100,interval:0,tick:{fontSize:12}}),(0,l.jsx)(g.m,{cursor:{fill:"hsl(var(--muted))"},contentStyle:{backgroundColor:"hsl(var(--background))",border:"1px solid hsl(var(--border))"}}),(0,l.jsx)(b.s,{}),(0,l.jsx)(N.y,{dataKey:"total",fill:"hsl(var(--chart-2))",name:"Total Ex\xe1menes",barSize:20})]})})})]}),(0,l.jsxs)(d.Zp,{ref:Q,children:[(0,l.jsx)("div",{className:"download-header",style:{display:"none",padding:"1rem",backgroundColor:"white"},children:(0,l.jsx)(z.default,{src:"/AconicExaminer/imagenes/HEADERSEXA.svg",alt:"Header",width:800,height:100,priority:!0})}),(0,l.jsx)(d.aR,{children:(0,l.jsxs)("div",{className:"flex justify-between items-start",children:[(0,l.jsxs)("div",{children:[(0,l.jsx)(d.ZB,{children:"Productos Inspeccionados por Gestor"}),(0,l.jsx)(d.BT,{children:"Top 10 gestores por volumen de productos."})]}),(0,l.jsx)(U.$,{onClick:()=>es(Q,"productos_por_gestor"),variant:"ghost",size:"icon",children:(0,l.jsx)(G.A,{className:"h-4 w-4"})})]})}),(0,l.jsx)(d.Wu,{children:(0,l.jsx)(m.u,{width:"100%",height:350,children:(0,l.jsxs)(w.E,{data:ea.productsByManager,layout:"vertical",margin:{top:5,right:30,left:20,bottom:5},children:[(0,l.jsx)(p.d,{strokeDasharray:"3 3"}),(0,l.jsx)(f.W,{type:"number"}),(0,l.jsx)(j.h,{dataKey:"name",type:"category",width:100,interval:0,tick:{fontSize:12}}),(0,l.jsx)(g.m,{cursor:{fill:"hsl(var(--muted))"},contentStyle:{backgroundColor:"hsl(var(--background))",border:"1px solid hsl(var(--border))"}}),(0,l.jsx)(b.s,{}),(0,l.jsx)(N.y,{dataKey:"total",fill:"hsl(var(--chart-5))",name:"Total Productos",barSize:20})]})})})]})]})]})}var X=s(33086),K=s(47691),$=s(78765),Q=s(12235),Y=s(69386),ee=s(17037),ea=s(87270);let es=["hsl(var(--chart-1))","hsl(var(--chart-2))","hsl(var(--chart-3))","hsl(var(--chart-4))","hsl(var(--chart-5))","hsl(210 20% 90%)"],el=Math.PI/180,et=e=>{let{cx:a,cy:s,midAngle:t,innerRadius:r,outerRadius:i,percent:o,index:d,name:n}=e,c=r+(i-r)*.5,u=a+c*Math.cos(-t*el),h=s+c*Math.sin(-t*el);return o<.05?null:(0,l.jsx)("text",{x:u,y:h,fill:"white",textAnchor:u>a?"start":"end",dominantBaseline:"central",className:"text-xs font-semibold",children:"(".concat((100*o).toFixed(0),"%)")})},er=e=>{let{title:a,description:s,data:r}=e,i=(0,t.useRef)(null),o=(0,t.useMemo)(()=>r.reduce((e,a)=>e+a.value,0),[r]),n=r.filter(e=>e.value>0).sort((e,a)=>a.value-e.value);return(0,l.jsxs)(d.Zp,{ref:i,className:"flex flex-col",children:[(0,l.jsx)("div",{className:"download-header",style:{display:"none",padding:"1rem",backgroundColor:"white"},children:(0,l.jsx)(z.default,{src:"/AconicExaminer/imagenes/HEADERSEXA.svg",alt:"Examen Header",width:800,height:100,className:"w-full h-auto mb-4",priority:!0})}),(0,l.jsx)(d.aR,{children:(0,l.jsxs)("div",{className:"flex justify-between items-start",children:[(0,l.jsxs)("div",{children:[(0,l.jsx)(d.ZB,{children:a}),(0,l.jsx)(d.BT,{children:s})]}),(0,l.jsx)(U.$,{onClick:()=>{if(i.current){let e=i.current,s=e.querySelector(".download-header");s&&(s.style.display="block"),V()(e,{scale:1.5,onclone:e=>{let a=e.querySelector(".download-header");a&&(a.style.display="block")}}).then(e=>{let l=document.createElement("a"),t=a.replace(/[^a-zA-Z0-9]/g,"_").toLowerCase();l.download="grafico_".concat(t,".jpg"),l.href=e.toDataURL("image/jpeg",.9),l.click(),s&&(s.style.display="none")})}},variant:"ghost",size:"icon",children:(0,l.jsx)(G.A,{className:"h-4 w-4"})})]})}),(0,l.jsx)(d.Wu,{className:"flex-1 flex flex-col",children:0===o?(0,l.jsx)("div",{className:"h-[250px] flex items-center justify-center text-muted-foreground",children:"No hay datos para mostrar."}):(0,l.jsxs)("div",{className:"flex-1 flex flex-col items-center gap-4",children:[(0,l.jsx)("div",{className:"h-[200px] w-full",children:(0,l.jsx)(m.u,{width:"100%",height:"100%",children:(0,l.jsxs)($.r,{children:[(0,l.jsx)(Q.F,{data:n,cx:"50%",cy:"50%",labelLine:!1,label:et,outerRadius:80,fill:"#8884d8",dataKey:"value",nameKey:"name",children:n.map((e,a)=>(0,l.jsx)(Y.f,{fill:es[a%es.length]},"cell-".concat(a)))}),(0,l.jsx)(g.m,{cursor:{fill:"hsl(var(--muted))"},contentStyle:{backgroundColor:"hsl(var(--background))",border:"1px solid hsl(var(--border))"}})]})})}),(0,l.jsxs)("div",{className:"w-full flex-1",children:[(0,l.jsxs)("h4",{className:"font-semibold text-center mb-2",children:["Total: ",o]}),(0,l.jsx)(ee.F,{children:(0,l.jsxs)(ea.XI,{children:[(0,l.jsx)(ea.A0,{className:"sr-only",children:(0,l.jsxs)(ea.Hj,{children:[(0,l.jsx)(ea.nd,{children:"Color"}),(0,l.jsx)(ea.nd,{children:"Nombre"}),(0,l.jsx)(ea.nd,{children:"Total"}),(0,l.jsx)(ea.nd,{children:"Porcentaje"})]})}),(0,l.jsx)(ea.BF,{children:n.map((e,a)=>{let s=o>0?e.value/o*100:0;return(0,l.jsxs)(ea.Hj,{className:"hover:bg-transparent border-none",children:[(0,l.jsx)(ea.nA,{className:"p-1 w-4",children:(0,l.jsx)("span",{className:"h-2.5 w-2.5 rounded-full shrink-0 block",style:{backgroundColor:es[a%es.length]}})}),(0,l.jsx)(ea.nA,{className:"p-1 font-medium text-muted-foreground truncate",children:e.name}),(0,l.jsx)(ea.nA,{className:"p-1 text-right font-semibold w-12",children:e.value}),(0,l.jsx)(ea.nA,{className:"p-1 text-right w-20",children:(0,l.jsxs)("div",{className:"text-foreground text-xs font-semibold",children:["(",s.toFixed(1),"%)"]})})]},a)})})]})})]})]})})]})},ei=new Date().getFullYear(),eo=Array.from({length:5},(e,a)=>ei-a),ed=[{value:0,label:"Enero"},{value:1,label:"Febrero"},{value:2,label:"Marzo"},{value:3,label:"Abril"},{value:4,label:"Mayo"},{value:5,label:"Junio"},{value:6,label:"Julio"},{value:7,label:"Agosto"},{value:8,label:"Septiembre"},{value:9,label:"Octubre"},{value:10,label:"Noviembre"},{value:11,label:"Diciembre"}];function en(e){let{allCases:a}=e,[s,r]=(0,t.useState)("year"),[i,o]=(0,t.useState)(),[n,c]=(0,t.useState)(),[u,h]=(0,t.useState)((0,S.t)(new Date)),[x,m]=(0,t.useState)(ei),v=(0,t.useMemo)(()=>{let e,l,t=new Date;switch(s){case"range":e=(null==i?void 0:i.from)||t,l=(null==i?void 0:i.to)?(0,X.D)(i.to):(0,X.D)(e);break;case"month":e=(0,C.w)(new Date(x,u)),l=(0,k.p)(new Date(x,u));break;case"year":e=(0,E.D)(new Date(x,0,1)),l=(0,T.Q)(new Date(x,11,31));break;case"specific":e=n?(0,K.o)(n):(0,K.o)(t),l=n?(0,X.D)(n):(0,X.D)(t);break;case"today":e=(0,K.o)(t),l=(0,X.D)(t);break;default:return a}return a.filter(a=>{var s;let t=null==(s=a.createdAt)?void 0:s.toDate();return t&&t>=e&&t<=l})},[a,s,i,u,x,n]),p=(0,t.useMemo)(()=>{let e,l,t={},r=a.filter(e=>{var a,s;return(null==(a=e.worksheet)?void 0:a.worksheetType)==="hoja_de_trabajo"||!(null==(s=e.worksheet)?void 0:s.worksheetType)}),o=new Date;switch(s){case"range":e=(null==i?void 0:i.from)||o,l=(null==i?void 0:i.to)?(0,X.D)(i.to):(0,X.D)(e);break;case"month":e=(0,C.w)(new Date(x,u)),l=(0,k.p)(new Date(x,u));break;case"year":e=(0,E.D)(new Date(x,0,1)),l=(0,T.Q)(new Date(x,11,31));break;case"specific":e=n?(0,K.o)(n):(0,K.o)(o),l=n?(0,X.D)(n):(0,X.D)(o);break;case"today":e=(0,K.o)(o),l=(0,X.D)(o);break;default:e=new Date(2e3,0,1),l=new Date(3e3,0,1)}r.filter(a=>{var s,t,r;let i=null==(s=a.worksheet)?void 0:s.aforo,o=null==i||null==(t=i.aforadorAssignedAt)?void 0:t.toDate();return(null==(r=a.consignee)?void 0:r.toUpperCase().trim())!=="PSMT NICARAGUA, SOCIEDAD ANONIMA"&&o&&o>=e&&o<=l}).forEach(e=>{var a;let s=null==(a=e.worksheet)?void 0:a.aforo,l=(null==s?void 0:s.aforador)||"Sin Asignar";t[l]||(t[l]={assigned:0,readyForReview:0,revalidated:0,posiciones:0}),t[l].assigned+=1,t[l].posiciones+=Number(e.totalPosiciones||0)}),v.filter(e=>{var a,s;return(null==(a=e.worksheet)?void 0:a.worksheetType)==="hoja_de_trabajo"||!(null==(s=e.worksheet)?void 0:s.worksheetType)}).forEach(e=>{var a,s;let l=null==(a=e.worksheet)?void 0:a.aforo,r=(null==l?void 0:l.aforador)||"Sin Asignar";(null==(s=e.consignee)?void 0:s.toUpperCase().trim())!=="PSMT NICARAGUA, SOCIEDAD ANONIMA"&&(t[r]||(t[r]={assigned:0,readyForReview:0,revalidated:0,posiciones:0}),(null==l?void 0:l.aforadorStatus)==="En revisi\xf3n"&&(t[r].readyForReview+=1),(null==l?void 0:l.revisorStatus)==="Revalidaci\xf3n Solicitada"&&(t[r].revalidated+=1))});let d=Object.entries(t).map(e=>{let[a,s]=e;return{name:a,value:s.assigned}}),c=Object.entries(t).map(e=>{let[a,s]=e;return{name:a,value:s.readyForReview}});return{assignedData:d,readyForReviewData:c,revalidatedData:Object.entries(t).map(e=>{let[a,s]=e;return{name:a,value:s.revalidated}}),posicionesData:Object.entries(t).map(e=>{let[a,s]=e;return{name:a,value:s.posiciones}})}},[v,a,s,i,u,x,n]),f=(0,t.useMemo)(()=>{let e,l,t=a.filter(e=>{var a;return(null==(a=e.consignee)?void 0:a.toUpperCase().trim())==="PSMT NICARAGUA, SOCIEDAD ANONIMA"}),r={},o=new Date;switch(s){case"range":e=(null==i?void 0:i.from)||o,l=(null==i?void 0:i.to)?(0,X.D)(i.to):(0,X.D)(e);break;case"month":e=(0,C.w)(new Date(x,u)),l=(0,k.p)(new Date(x,u));break;case"year":e=(0,E.D)(new Date(x,0,1)),l=(0,T.Q)(new Date(x,11,31));break;case"specific":e=n?(0,K.o)(n):(0,K.o)(o),l=n?(0,X.D)(n):(0,X.D)(o);break;case"today":e=(0,K.o)(o),l=(0,X.D)(o);break;default:e=new Date(2e3,0,1),l=new Date(3e3,0,1)}return t.filter(a=>{var s,t;let r=null==(s=a.worksheet)?void 0:s.aforo,i=null==r||null==(t=r.aforadorAssignedAt)?void 0:t.toDate();return i&&i>=e&&i<=l}).forEach(e=>{var a;let s=null==(a=e.worksheet)?void 0:a.aforo,l=(null==s?void 0:s.aforador)||"Sin Asignar";r[l]||(r[l]={assigned:0,posiciones:0}),r[l].assigned+=1,r[l].posiciones+=Number(e.totalPosiciones||0)}),{assignedData:Object.entries(r).map(e=>{let[a,s]=e;return{name:a,value:s.assigned}}),posicionesData:Object.entries(r).map(e=>{let[a,s]=e;return{name:a,value:s.posiciones}})}},[a,s,i,u,x,n]),j=(0,t.useMemo)(()=>{let e={};v.filter(e=>{var a,s;return(null==(a=e.worksheet)?void 0:a.worksheetType)==="hoja_de_trabajo"||!(null==(s=e.worksheet)?void 0:s.worksheetType)}).forEach(a=>{var s;let l=null==(s=a.worksheet)?void 0:s.aforo,t=(null==l?void 0:l.digitador)||"Sin Asignar";e[t]||(e[t]={assigned:0,liquidated:0,stored:0}),(null==l?void 0:l.digitador)&&(e[t].assigned+=1),(null==l?void 0:l.declaracionAduanera)&&(e[t].liquidated+=1),(null==l?void 0:l.digitadorStatus)==="Almacenado"&&(e[t].stored+=1)});let a=Object.entries(e).map(e=>{let[a,s]=e;return{name:a,value:s.assigned}});return{assignedData:a,liquidatedData:Object.entries(e).map(e=>{let[a,s]=e;return{name:a,value:s.liquidated}}),storedData:Object.entries(e).map(e=>{let[a,s]=e;return{name:a,value:s.stored}})}},[v]);return(0,l.jsxs)("div",{className:"space-y-6",children:[(0,l.jsxs)(d.Zp,{children:[(0,l.jsxs)(d.aR,{children:[(0,l.jsx)(d.ZB,{className:"text-2xl",children:"Dashboard de Operaciones (Aforo & Digitaci\xf3n)"}),(0,l.jsx)(d.BT,{children:"Resumen interactivo de la actividad de casos."})]}),(0,l.jsxs)(d.Wu,{className:"flex flex-col md:flex-row gap-4",children:[(0,l.jsxs)(D.l6,{value:s,onValueChange:e=>r(e),children:[(0,l.jsx)(D.bq,{className:"w-[200px]",children:(0,l.jsx)(D.yv,{placeholder:"Filtrar por..."})}),(0,l.jsxs)(D.gC,{children:[(0,l.jsx)(D.eb,{value:"year",children:"Por A\xf1o"}),(0,l.jsx)(D.eb,{value:"month",children:"Mes Espec\xedfico"}),(0,l.jsx)(D.eb,{value:"range",children:"Rango de Fechas"}),(0,l.jsx)(D.eb,{value:"specific",children:"Fecha Espec\xedfica"}),(0,l.jsx)(D.eb,{value:"today",children:"Hoy"}),(0,l.jsx)(D.eb,{value:"all",children:"Todo el tiempo"})]})]}),("month"===s||"year"===s)&&(0,l.jsxs)("div",{className:"flex gap-2",children:["month"===s&&(0,l.jsxs)(D.l6,{value:String(u),onValueChange:e=>h(Number(e)),children:[(0,l.jsx)(D.bq,{className:"w-[180px]",children:(0,l.jsx)(D.yv,{placeholder:"Mes"})}),(0,l.jsx)(D.gC,{children:ed.map(e=>(0,l.jsx)(D.eb,{value:String(e.value),children:e.label},e.value))})]}),(0,l.jsxs)(D.l6,{value:String(x),onValueChange:e=>m(Number(e)),children:[(0,l.jsx)(D.bq,{className:"w-[120px]",children:(0,l.jsx)(D.yv,{placeholder:"A\xf1o"})}),(0,l.jsx)(D.gC,{children:eo.map(e=>(0,l.jsx)(D.eb,{value:String(e),children:e},e))})]})]}),"range"===s&&(0,l.jsx)(A.S,{date:i,onDateChange:o}),"specific"===s&&(0,l.jsx)(B.l,{date:n,onDateChange:c})]})]}),(0,l.jsxs)("div",{className:"space-y-2",children:[(0,l.jsx)("h3",{className:"text-xl font-semibold",children:"M\xe9tricas de Aforo (Hojas de Trabajo)"}),(0,l.jsxs)("div",{className:"grid gap-4 md:grid-cols-2 lg:grid-cols-2",children:[(0,l.jsx)(er,{title:"Casos Asignados por Aforador",description:"Total de casos asignados en el per\xedodo (Excluye PSMT).",data:p.assignedData}),(0,l.jsx)(er,{title:"Posiciones Trabajadas por Aforador",description:"Suma de posiciones de los casos asignados (Excluye PSMT).",data:p.posicionesData}),(0,l.jsx)(er,{title:"Casos Listos para Revisi\xf3n",description:'Total de casos marcados como "En revisi\xf3n" en el per\xedodo.',data:p.readyForReviewData}),(0,l.jsx)(er,{title:"Casos con Solicitud de Revalidaci\xf3n",description:"Total de casos devueltos para revalidaci\xf3n.",data:p.revalidatedData})]})]}),(0,l.jsxs)("div",{className:"space-y-2 pt-6",children:[(0,l.jsx)("h3",{className:"text-xl font-semibold",children:"M\xe9tricas de PSMT"}),(0,l.jsxs)("div",{className:"grid gap-4 md:grid-cols-2 lg:grid-cols-2",children:[(0,l.jsx)(er,{title:"Casos PSMT Asignados por Aforador",description:"Total de casos PSMT asignados en el per\xedodo.",data:f.assignedData}),(0,l.jsx)(er,{title:"Posiciones PSMT Trabajadas por Aforador",description:"Suma de posiciones de los casos PSMT asignados.",data:f.posicionesData})]})]}),(0,l.jsxs)("div",{className:"space-y-2 pt-6",children:[(0,l.jsx)("h3",{className:"text-xl font-semibold",children:"M\xe9tricas de Digitaci\xf3n (Hojas de Trabajo)"}),(0,l.jsxs)("div",{className:"grid gap-4 md:grid-cols-1 lg:grid-cols-3",children:[(0,l.jsx)(er,{title:"Casos Asignados por Digitador",description:"Total de casos asignados para digitaci\xf3n.",data:j.assignedData}),(0,l.jsx)(er,{title:"Casos Liquidados por Digitador",description:"Total de casos con declaraci\xf3n aduanera registrada.",data:j.liquidatedData}),(0,l.jsx)(er,{title:"Casos Almacenados por Digitador",description:"Total de casos marcados como 'Almacenado'.",data:j.storedData})]})]})]})}var ec=s(44575),eu=s(80358),eh=s(86313),ex=s(60406),em=s(82710),ev=s(95738);let ep=new Date().getFullYear(),ef=Array.from({length:5},(e,a)=>ep-a),ej=[{value:0,label:"Enero"},{value:1,label:"Febrero"},{value:2,label:"Marzo"},{value:3,label:"Abril"},{value:4,label:"Mayo"},{value:5,label:"Junio"},{value:6,label:"Julio"},{value:7,label:"Agosto"},{value:8,label:"Septiembre"},{value:9,label:"Octubre"},{value:10,label:"Noviembre"},{value:11,label:"Diciembre"}];function eg(e){let{allCases:a,allWorksheets:s,allSolicitudes:r}=e,{user:o}=(0,i.A)(),[n,c]=(0,t.useState)("today"),[u,h]=(0,t.useState)(),[x,m]=(0,t.useState)(),[v,p]=(0,t.useState)((0,S.t)(new Date)),[f,j]=(0,t.useState)(ep),[g,b]=(0,t.useState)("all"),y=(0,t.useMemo)(()=>{let e=new Set;return a.forEach(a=>{a.executive&&e.add(a.executive)}),s.forEach(a=>{a.executive&&e.add(a.executive)}),Array.from(e).sort()},[a,s]),w=(0,t.useCallback)((e,a,s,l)=>e.filter(e=>{var t;let r=null==(t=e[a])?void 0:t.toDate();return r&&r>=s&&r<=l}),[]),N=(0,t.useMemo)(()=>{let e,l,t=new Date;switch(n){case"range":e=(null==u?void 0:u.from)||t,l=(null==u?void 0:u.to)?(0,X.D)(u.to):(0,X.D)(e);break;case"month":e=(0,C.w)(new Date(f,v)),l=(0,k.p)(new Date(f,v));break;case"year":e=(0,E.D)(new Date(f,0,1)),l=(0,T.Q)(new Date(f,11,31));break;case"specific":e=x?(0,K.o)(x):(0,K.o)(t),l=x?(0,X.D)(x):(0,X.D)(t);break;case"today":e=(0,K.o)(t),l=(0,X.D)(t);break;default:e=new Date(2e3,0,1),l=new Date(3e3,0,1)}let i="all"===g?a:a.filter(e=>e.executive===g),d="all"===g?s:s.filter(e=>e.executive===g),c="all"===g?r:r.filter(e=>e.savedBy&&e.savedBy.includes(g)),h=w(i,"createdAt",e,l),m=w(d,"createdAt",e,l),p=w(c,"savedAt",e,l),j=h,b=m,y=p;o&&"ejecutivo"===o.role&&"all"===g&&(j=h.filter(e=>e.executive===o.displayName),b=m.filter(e=>e.executive===o.displayName),y=p.filter(e=>e.savedBy===o.email));let N=j.length,D=j.filter(e=>e.facturado).length,A=j.filter(e=>"Rectificacion"===e.incidentType).length,S=j.filter(e=>e.hasValueDoubt).length,R=0,P=0;b.forEach(e=>{R+=(e.requiredPermits||[]).length,P+=(e.requiredPermits||[]).filter(e=>"Entregado"===e.status).length});let M=y.length,F=(e,a)=>{let s={};return e.forEach(e=>{let l="executive"===a?e.executive:e.savedBy;l&&(s[l]=(s[l]||0)+1)}),Object.entries(s).map(e=>{let[a,s]=e;return{name:a,value:s}})},B=F(j,"executive"),O=F(j.filter(e=>"Rectificacion"===e.incidentType),"executive"),_=F(j.filter(e=>e.hasValueDoubt),"executive"),q=F(j.filter(e=>e.facturado),"executive"),Z=F(y,"savedBy"),G=(e=>{let a={};return e.forEach(e=>{let s=e.executive;if(s){var l;a[s]=(a[s]||0)+((null==(l=e.requiredPermits)?void 0:l.length)||0)}}),Object.entries(a).map(e=>{let[a,s]=e;return{name:a,value:s}})})(b);return{totalOperaciones:N,permisosAsignados:R,permisosEntregados:P,incidenciasRectificacion:A,incidenciasDudaValor:S,casosFacturados:D,solicitudesPago:M,operacionesPorEjecutivo:B,incidenciasRectPorEjecutivo:O,incidenciasDudaPorEjecutivo:_,casosFacturadosPorEjecutivo:q,solicitudesPorEjecutivo:Z,permisosPorEjecutivo:G}},[a,s,r,n,u,v,f,x,w,o,g]),R=[{title:"Total Operaciones",value:N.totalOperaciones,icon:ec.A},{title:"Total Permisos Asignados",value:N.permisosAsignados,icon:eu.A},{title:"Total Permisos Entregados",value:N.permisosEntregados,icon:eh.A},{title:"Total Incidencias (Rectificaci\xf3n)",value:N.incidenciasRectificacion,icon:ex.A},{title:"Total Incidencias (Duda de Valor)",value:N.incidenciasDudaValor,icon:ex.A},{title:"Total Casos Facturados",value:N.casosFacturados,icon:em.A},{title:"Total Solicitudes de Pago",value:N.solicitudesPago,icon:ev.A}],P=(null==o?void 0:o.role)==="admin"||(null==o?void 0:o.role)==="coordinadora";return(0,l.jsxs)("div",{className:"space-y-6",children:[(0,l.jsxs)(d.Zp,{children:[(0,l.jsxs)(d.aR,{children:[(0,l.jsx)(d.ZB,{className:"text-2xl",children:"Dashboard Ejecutivo"}),(0,l.jsx)(d.BT,{children:"Resumen de actividad y rendimiento."})]}),(0,l.jsxs)(d.Wu,{className:"flex flex-wrap items-center gap-4",children:[(0,l.jsxs)(D.l6,{value:n,onValueChange:e=>c(e),children:[(0,l.jsx)(D.bq,{className:"w-[200px]",children:(0,l.jsx)(D.yv,{placeholder:"Filtrar por..."})}),(0,l.jsxs)(D.gC,{children:[(0,l.jsx)(D.eb,{value:"today",children:"Hoy"}),(0,l.jsx)(D.eb,{value:"year",children:"Por A\xf1o"}),(0,l.jsx)(D.eb,{value:"month",children:"Mes Espec\xedfico"}),(0,l.jsx)(D.eb,{value:"range",children:"Rango de Fechas"}),(0,l.jsx)(D.eb,{value:"specific",children:"Fecha Espec\xedfica"}),(0,l.jsx)(D.eb,{value:"all",children:"Todo el tiempo"})]})]}),("month"===n||"year"===n)&&(0,l.jsxs)("div",{className:"flex gap-2",children:["month"===n&&(0,l.jsxs)(D.l6,{value:String(v),onValueChange:e=>p(Number(e)),children:[(0,l.jsx)(D.bq,{className:"w-[180px]",children:(0,l.jsx)(D.yv,{placeholder:"Mes"})}),(0,l.jsx)(D.gC,{children:ej.map(e=>(0,l.jsx)(D.eb,{value:String(e.value),children:e.label},e.value))})]}),(0,l.jsxs)(D.l6,{value:String(f),onValueChange:e=>j(Number(e)),children:[(0,l.jsx)(D.bq,{className:"w-[120px]",children:(0,l.jsx)(D.yv,{placeholder:"A\xf1o"})}),(0,l.jsx)(D.gC,{children:ef.map(e=>(0,l.jsx)(D.eb,{value:String(e),children:e},e))})]})]}),"range"===n&&(0,l.jsx)(A.S,{date:u,onDateChange:h}),"specific"===n&&(0,l.jsx)(B.l,{date:x,onDateChange:m}),P&&(0,l.jsxs)(D.l6,{value:g,onValueChange:b,children:[(0,l.jsx)(D.bq,{className:"w-[220px]",children:(0,l.jsx)(D.yv,{placeholder:"Filtrar por ejecutivo..."})}),(0,l.jsxs)(D.gC,{children:[(0,l.jsx)(D.eb,{value:"all",children:"Todos los Ejecutivos"}),y.map(e=>(0,l.jsx)(D.eb,{value:e,children:e},e))]})]})]})]}),P?(0,l.jsxs)("div",{className:"grid gap-6 md:grid-cols-2 lg:grid-cols-3",children:[(0,l.jsx)(er,{title:"Operaciones por Ejecutivo",description:"Total de casos de aforo registrados.",data:N.operacionesPorEjecutivo}),(0,l.jsx)(er,{title:"Incidencias (Rectificaci\xf3n)",description:"Total de rectificaciones reportadas.",data:N.incidenciasRectPorEjecutivo}),(0,l.jsx)(er,{title:"Incidencias (Duda de Valor)",description:"Total de dudas de valor reportadas.",data:N.incidenciasDudaPorEjecutivo}),(0,l.jsx)(er,{title:"Casos Facturados",description:"Total de casos marcados como facturados.",data:N.casosFacturadosPorEjecutivo}),(0,l.jsx)(er,{title:"Solicitudes de Pago",description:"Total de solicitudes de pago creadas.",data:N.solicitudesPorEjecutivo}),(0,l.jsx)(er,{title:"Permisos Asignados",description:"Total de permisos requeridos en hojas de trabajo.",data:N.permisosPorEjecutivo})]}):(0,l.jsx)("div",{className:"grid gap-4 md:grid-cols-2 lg:grid-cols-4",children:R.map((e,a)=>(0,l.jsxs)(d.Zp,{className:"transition-all hover:shadow-lg hover:-translate-y-1",children:[(0,l.jsxs)(d.aR,{className:"flex flex-row items-center justify-between space-y-0 pb-2",children:[(0,l.jsx)(d.ZB,{className:"text-sm font-medium",children:e.title}),(0,l.jsx)(e.icon,{className:"h-4 w-4 text-muted-foreground"})]}),(0,l.jsx)(d.Wu,{children:(0,l.jsx)("div",{className:"text-2xl font-bold",children:e.value})})]},a))})]})}var eb=s(65142),ey=s(36204),ew=s(91851),eN=s(52619),eD=s.n(eN);let eA=new Date().getFullYear(),eS=Array.from({length:5},(e,a)=>eA-a),eC=[{value:0,label:"Enero"},{value:1,label:"Febrero"},{value:2,label:"Marzo"},{value:3,label:"Abril"},{value:4,label:"Mayo"},{value:5,label:"Junio"},{value:6,label:"Julio"},{value:7,label:"Agosto"},{value:8,label:"Septiembre"},{value:9,label:"Octubre"},{value:10,label:"Noviembre"},{value:11,label:"Diciembre"}];function ek(e){let{allLogs:a}=e,[s,r]=(0,t.useState)("year"),[i,o]=(0,t.useState)(),[n,c]=(0,t.useState)(),[u,h]=(0,t.useState)((0,S.t)(new Date)),[x,v]=(0,t.useState)(eA),b=(0,t.useMemo)(()=>{let e,l;switch(s){case"range":if(!(null==i?void 0:i.from))return a;e=i.from,l=i.to?(0,X.D)(i.to):(0,X.D)(e);break;case"month":e=(0,C.w)(new Date(x,u)),l=(0,k.p)(new Date(x,u));break;case"year":e=(0,E.D)(new Date(x,0,1)),l=(0,T.Q)(new Date(x,11,31));break;case"specific":if(!n)return a;e=(0,K.o)(n),l=(0,X.D)(n);break;default:return a}return a.filter(a=>{let s=a.date;return s>=e&&s<=l})},[a,s,i,u,x,n]),y=(0,t.useMemo)(()=>{let e={},a={},s=new Set;b.forEach(l=>{let t=l.user||"Desconocido";e[t]=(e[t]||0)+1,s.add(t);let r=(e=>{if(!e)return"Desconocido";let a=e.toLowerCase();return a.includes("admin")?"Admin":a.includes("coordinacion")?"Coordinadora":a.includes("harol")||a.includes("cerros")||a.includes("calificador")?"Calificador":a.includes("revisor")?"Revisor":a.includes("agente")?"Agente":a.includes("supervisor")?"Supervisor":a.includes("aforador")?"Aforador":a.includes("aconicsa")?"Ejecutivo":"Gestor"})(t);a[r]=(a[r]||0)+1});let l=Object.entries(e).map(e=>{let[a,s]=e;return{name:a,value:s}}).sort((e,a)=>a.value-e.value).slice(0,10),t=Object.entries(a).map(e=>{let[a,s]=e;return{name:a,value:s}}).sort((e,a)=>a.value-e.value);return{totalUpdates:b.length,activeUserCount:s.size,activityByUser:l,activityByRole:t}},[b]);return(0,l.jsxs)("div",{className:"space-y-6",children:[(0,l.jsxs)(d.Zp,{children:[(0,l.jsx)(d.aR,{children:(0,l.jsxs)("div",{className:"flex justify-between items-start",children:[(0,l.jsxs)("div",{children:[(0,l.jsx)(d.ZB,{className:"text-2xl",children:"Dashboard de Actividad de Usuarios"}),(0,l.jsx)(d.BT,{children:"Estad\xedsticas de uso de la aplicaci\xf3n por usuario y rol."})]}),(0,l.jsx)(U.$,{asChild:!0,variant:"outline",children:(0,l.jsxs)(eD(),{href:"/admin/control",children:[(0,l.jsx)(ey.A,{className:"mr-2 h-4 w-4"})," Volver a Control de Registros"]})})]})}),(0,l.jsxs)(d.Wu,{className:"flex flex-col md:flex-row gap-4",children:[(0,l.jsxs)(D.l6,{value:s,onValueChange:e=>r(e),children:[(0,l.jsx)(D.bq,{className:"w-[200px]",children:(0,l.jsx)(D.yv,{placeholder:"Filtrar por..."})}),(0,l.jsxs)(D.gC,{children:[(0,l.jsx)(D.eb,{value:"year",children:"Por A\xf1o"}),(0,l.jsx)(D.eb,{value:"month",children:"Mes Espec\xedfico"}),(0,l.jsx)(D.eb,{value:"range",children:"Rango de Fechas"}),(0,l.jsx)(D.eb,{value:"specific",children:"Fecha Espec\xedfica"}),(0,l.jsx)(D.eb,{value:"all",children:"Todo el tiempo"})]})]}),("month"===s||"year"===s)&&(0,l.jsxs)("div",{className:"flex gap-2",children:["month"===s&&(0,l.jsxs)(D.l6,{value:String(u),onValueChange:e=>h(Number(e)),children:[(0,l.jsx)(D.bq,{className:"w-[180px]",children:(0,l.jsx)(D.yv,{placeholder:"Mes"})}),(0,l.jsx)(D.gC,{children:eC.map(e=>(0,l.jsx)(D.eb,{value:String(e.value),children:e.label},e.value))})]}),(0,l.jsxs)(D.l6,{value:String(x),onValueChange:e=>v(Number(e)),children:[(0,l.jsx)(D.bq,{className:"w-[120px]",children:(0,l.jsx)(D.yv,{placeholder:"A\xf1o"})}),(0,l.jsx)(D.gC,{children:eS.map(e=>(0,l.jsx)(D.eb,{value:String(e),children:e},e))})]})]}),"range"===s&&(0,l.jsx)(A.S,{date:i,onDateChange:o}),"specific"===s&&(0,l.jsx)(B.l,{date:n,onDateChange:c})]})]}),(0,l.jsxs)("div",{className:"grid gap-4 md:grid-cols-2 lg:grid-cols-4",children:[(0,l.jsxs)(d.Zp,{children:[(0,l.jsxs)(d.aR,{className:"flex flex-row items-center justify-between space-y-0 pb-2",children:[(0,l.jsx)(d.ZB,{className:"text-sm font-medium",children:"Total de Actualizaciones"}),(0,l.jsx)(ew.A,{className:"h-4 w-4 text-muted-foreground"})]}),(0,l.jsx)(d.Wu,{children:(0,l.jsx)("div",{className:"text-2xl font-bold",children:y.totalUpdates})})]}),(0,l.jsxs)(d.Zp,{children:[(0,l.jsxs)(d.aR,{className:"flex flex-row items-center justify-between space-y-0 pb-2",children:[(0,l.jsx)(d.ZB,{className:"text-sm font-medium",children:"Usuarios Activos"}),(0,l.jsx)(Z.A,{className:"h-4 w-4 text-muted-foreground"})]}),(0,l.jsx)(d.Wu,{children:(0,l.jsx)("div",{className:"text-2xl font-bold",children:y.activeUserCount})})]})]}),(0,l.jsxs)("div",{className:"grid gap-6 md:grid-cols-2",children:[(0,l.jsxs)(d.Zp,{children:[(0,l.jsxs)(d.aR,{children:[(0,l.jsx)(d.ZB,{children:"Actividad Total por Usuario (Top 10)"}),(0,l.jsx)(d.BT,{children:"N\xfamero de cambios registrados por cada usuario."})]}),(0,l.jsx)(d.Wu,{children:(0,l.jsx)(m.u,{width:"100%",height:350,children:(0,l.jsxs)(w.E,{data:y.activityByUser,layout:"vertical",margin:{top:5,right:30,left:20,bottom:5},children:[(0,l.jsx)(p.d,{strokeDasharray:"3 3"}),(0,l.jsx)(f.W,{type:"number",allowDecimals:!1}),(0,l.jsx)(j.h,{dataKey:"name",type:"category",width:150,interval:0,tick:{fontSize:10}}),(0,l.jsx)(g.m,{cursor:{fill:"hsl(var(--muted))"},contentStyle:{backgroundColor:"hsl(var(--background))",border:"1px solid hsl(var(--border))"}}),(0,l.jsx)(N.y,{dataKey:"value",name:"Actualizaciones",fill:"hsl(var(--chart-1))",barSize:20})]})})})]}),(0,l.jsx)(er,{title:"Actividad por Rol de Usuario",description:"Distribuci\xf3n de la actividad seg\xfan el rol asignado.",data:y.activityByRole})]})]})}function eE(){let{user:e,loading:a}=(0,i.A)(),s=(0,r.useRouter)(),[m,v]=(0,t.useState)(""),[p,f]=(0,t.useState)(!1),[j,g]=(0,t.useState)(!1),[b,y]=(0,t.useState)([]),[w,N]=(0,t.useState)([]),[D,A]=(0,t.useState)([]),[S,C]=(0,t.useState)([]),[k,E]=(0,t.useState)([]),[T,R]=(0,t.useState)(!0),[P,M]=(0,t.useState)(null),F=["aforador","coordinadora","admin","ejecutivo","supervisor"],B=async()=>{R(!0),M(null);try{let[e,a,s,l,t,r]=await Promise.all([(0,h.GG)((0,h.P)((0,h.rJ)(u.db,"examenesPrevios"),(0,h.My)("ne","desc"))),(0,h.GG)((0,h.P)((0,h.rJ)(u.db,"AforoCases"),(0,h.My)("ne","desc"))),(0,h.GG)((0,h.P)((0,h.rJ)(u.db,"worksheets"),(0,h.My)("createdAt","desc"))),(0,h.GG)((0,h.P)((0,h.rJ)(u.db,"SolicitudCheques"),(0,h.My)("savedAt","desc"))),(0,h.GG)((0,h.P)((0,h.rJ)(u.db,"Memorandum"),(0,h.My)("savedAt","desc"))),(0,h.GG)((0,h.P)((0,h.Cs)(u.db,"actualizaciones")))]),i=e.docs.map(e=>({id:e.id,...e.data()}));y(i.filter(e=>!0!==e.isArchived));let o=new Map(s.docs.map(e=>[e.id,e.data()])),d=a.docs.map(e=>({id:e.id,...e.data(),worksheet:o.get(e.id)||null}));N(d);let n=s.docs.map(e=>({id:e.id,...e.data()}));A(n);let c=[];l.forEach(e=>c.push({solicitudId:e.id,...e.data()})),t.forEach(e=>c.push({solicitudId:e.id,...e.data()})),C(c);let x=[];r.forEach(e=>{let a=e.data();x.push({user:a.updatedBy,date:a.updatedAt.toDate()})}),E(x)}catch(e){console.error("Error fetching dashboard data:",e),M("No se pudieron cargar los datos para el dashboard. Verifique los permisos y los \xedndices de Firestore.")}finally{R(!1)}};return((0,t.useEffect)(()=>{a||e&&F.includes(e.role)||s.push("/")},[e,a,s]),!a&&e&&F.includes(e.role))?p?T?(0,l.jsx)(o.G,{children:(0,l.jsxs)("div",{className:"min-h-screen flex items-center justify-center bg-background",children:[(0,l.jsx)(n.A,{className:"h-12 w-12 animate-spin text-primary"}),(0,l.jsx)("p",{className:"ml-4",children:"Cargando datos de los dashboards..."})]})}):P?(0,l.jsx)(o.G,{children:(0,l.jsx)("div",{className:"min-h-screen flex items-center justify-center bg-red-100 text-red-700 p-4",children:P})}):(0,l.jsx)(o.G,{children:(0,l.jsxs)(x.tU,{defaultValue:"ejecutivo"===e.role||"admin"===e.role||"supervisor"===e.role?"ejecutivo":"coordinadora"===e.role||"aforador"===e.role?"previos":"ejecutivo",className:"space-y-4",children:[(0,l.jsx)("div",{className:"flex items-center justify-between",children:(0,l.jsxs)(x.j7,{children:[("ejecutivo"===e.role||"admin"===e.role||"coordinadora"===e.role||"supervisor"===e.role)&&(0,l.jsx)(x.Xi,{value:"ejecutivo",children:"Dashboard Ejecutivo"}),("coordinadora"===e.role||"aforador"===e.role||"admin"===e.role||"supervisor"===e.role)&&(0,l.jsx)(x.Xi,{value:"previos",children:"Dashboard de Previos"}),("coordinadora"===e.role||"aforador"===e.role||"admin"===e.role||"supervisor"===e.role)&&(0,l.jsx)(x.Xi,{value:"aforo",children:"Dashboard de Aforo"}),"admin"===e.role&&(0,l.jsx)(x.Xi,{value:"activity",children:"Actividad de Usuarios"})]})}),("ejecutivo"===e.role||"admin"===e.role||"coordinadora"===e.role||"supervisor"===e.role)&&(0,l.jsx)(x.av,{value:"ejecutivo",children:(0,l.jsx)(eg,{allCases:w,allWorksheets:D,allSolicitudes:S})}),("coordinadora"===e.role||"aforador"===e.role||"admin"===e.role||"supervisor"===e.role)&&(0,l.jsxs)(l.Fragment,{children:[(0,l.jsx)(x.av,{value:"previos",children:(0,l.jsx)(J,{allExams:b})}),(0,l.jsx)(x.av,{value:"aforo",children:(0,l.jsx)(en,{allCases:w})})]}),"admin"===e.role&&(0,l.jsx)(x.av,{value:"activity",children:(0,l.jsx)(ek,{allLogs:k})})]})}):(0,l.jsx)(o.G,{children:(0,l.jsx)("div",{className:"flex items-center justify-center py-12",children:(0,l.jsxs)(d.Zp,{className:"w-full max-w-sm",children:[(0,l.jsxs)(d.aR,{className:"text-center",children:[(0,l.jsx)(d.ZB,{className:"text-2xl",children:"Acceso Restringido"}),(0,l.jsx)(d.BT,{children:"Por favor, ingrese el PIN para ver el dashboard."})]}),(0,l.jsx)(d.Wu,{children:(0,l.jsxs)("form",{onSubmit:e=>{e.preventDefault(),"1924338"===m?(f(!0),g(!1),B()):g(!0)},className:"space-y-4",children:[(0,l.jsxs)("div",{className:"space-y-2",children:[(0,l.jsxs)("div",{className:"relative",children:[(0,l.jsx)(c.A,{className:"absolute left-3 top-1/2 -translate-y-1/2 h-5 w-5 text-muted-foreground"}),(0,l.jsx)(eb.p,{type:"password",value:m,onChange:e=>v(e.target.value),placeholder:"PIN de Acceso",className:"pl-10"})]}),j&&(0,l.jsx)("p",{className:"text-sm text-destructive text-center",children:"PIN incorrecto."})]}),(0,l.jsx)(U.$,{type:"submit",className:"w-full",children:"Acceder"})]})})]})})}):(0,l.jsx)("div",{className:"min-h-screen flex items-center justify-center bg-background",children:(0,l.jsx)(n.A,{className:"h-12 w-12 animate-spin text-primary"})})}},27339:(e,a,s)=>{"use strict";s.d(a,{l:()=>h});var l=s(95155),t=s(12115),r=s(5282),i=s(80160),o=s(28127),d=s(64269),n=s(3998),c=s(50276),u=s(26333);function h(e){let{className:a,date:s,onDateChange:h,disabled:x=!1}=e,[m,v]=t.useState(!1),[p,f]=t.useState(s);return t.useEffect(()=>{f(s)},[s]),(0,l.jsx)("div",{className:(0,d.cn)("grid gap-2",a),children:(0,l.jsxs)(u.AM,{open:m,onOpenChange:v,children:[(0,l.jsx)(u.Wv,{asChild:!0,children:(0,l.jsxs)(n.$,{variant:"outline",disabled:x,className:(0,d.cn)("w-[180px] justify-start text-left font-normal",!p&&"text-muted-foreground"),children:[(0,l.jsx)(o.A,{className:"mr-2 h-4 w-4"}),p?(0,r.GP)(p,"dd/MM/yy",{locale:i.es}):(0,l.jsx)("span",{children:"Seleccione fecha"})]})}),(0,l.jsx)(u.hl,{className:"w-auto p-0",children:(0,l.jsx)(c.V,{mode:"single",selected:null!=p?p:void 0,onSelect:e=>{f(e),h(e),v(!1)},initialFocus:!0,locale:i.es,disabled:x})})]})})}},44680:(e,a,s)=>{Promise.resolve().then(s.bind(s,27044))},50276:(e,a,s)=>{"use strict";s.d(a,{V:()=>n});var l=s(95155);s(12115);var t=s(51190),r=s(63263),i=s(75196),o=s(64269),d=s(3998);function n(e){let{className:a,classNames:s,showOutsideDays:n=!0,...c}=e;return(0,l.jsx)(i.hv,{showOutsideDays:n,className:(0,o.cn)("p-3",a),classNames:{months:"flex flex-col sm:flex-row space-y-4 sm:space-x-4 sm:space-y-0",month:"space-y-4",caption:"flex justify-center pt-1 relative items-center",caption_label:"text-sm font-medium",nav:"space-x-1 flex items-center",nav_button:(0,o.cn)((0,d.r)({variant:"outline"}),"h-7 w-7 bg-transparent p-0 opacity-50 hover:opacity-100"),nav_button_previous:"absolute left-1",nav_button_next:"absolute right-1",table:"w-full border-collapse space-y-1",head_row:"flex",head_cell:"text-muted-foreground rounded-md w-9 font-normal text-[0.8rem]",row:"flex w-full mt-2",cell:"h-9 w-9 text-center text-sm p-0 relative [&:has([aria-selected].day-range-end)]:rounded-r-md [&:has([aria-selected].day-outside)]:bg-accent/50 [&:has([aria-selected])]:bg-accent first:[&:has([aria-selected])]:rounded-l-md last:[&:has([aria-selected])]:rounded-r-md focus-within:relative focus-within:z-20",day:(0,o.cn)((0,d.r)({variant:"ghost"}),"h-9 w-9 p-0 font-normal aria-selected:opacity-100"),day_range_end:"day-range-end",day_selected:"bg-primary text-primary-foreground hover:bg-primary hover:text-primary-foreground focus:bg-primary focus:text-primary-foreground",day_today:"bg-accent text-accent-foreground",day_outside:"day-outside text-muted-foreground aria-selected:bg-accent/50 aria-selected:text-muted-foreground",day_disabled:"text-muted-foreground opacity-50",day_range_middle:"aria-selected:bg-accent aria-selected:text-accent-foreground",day_hidden:"invisible",...s},components:{IconLeft:e=>{let{className:a,...s}=e;return(0,l.jsx)(t.A,{className:(0,o.cn)("h-4 w-4",a),...s})},IconRight:e=>{let{className:a,...s}=e;return(0,l.jsx)(r.A,{className:(0,o.cn)("h-4 w-4",a),...s})}},...c})}n.displayName="Calendar"},65142:(e,a,s)=>{"use strict";s.d(a,{p:()=>i});var l=s(95155),t=s(12115),r=s(64269);let i=t.forwardRef((e,a)=>{let{className:s,type:t,...i}=e;return(0,l.jsx)("input",{type:t,className:(0,r.cn)("flex h-10 w-full rounded-md border border-input bg-background px-3 py-2 text-base ring-offset-background file:border-0 file:bg-transparent file:text-sm file:font-medium file:text-foreground placeholder:text-muted-foreground focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2 disabled:cursor-not-allowed disabled:opacity-50 md:text-sm","aria-[invalid=true]:border-destructive aria-[invalid=true]:ring-destructive",s),ref:a,...i})});i.displayName="Input"},82206:(e,a,s)=>{"use strict";s.d(a,{S:()=>u});var l=s(95155);s(12115);var t=s(5282),r=s(80160),i=s(28127),o=s(64269),d=s(3998),n=s(50276),c=s(26333);function u(e){let{className:a,date:s,onDateChange:u}=e;return(0,l.jsx)("div",{className:(0,o.cn)("grid gap-2",a),children:(0,l.jsxs)(c.AM,{children:[(0,l.jsx)(c.Wv,{asChild:!0,children:(0,l.jsxs)(d.$,{id:"date",variant:"outline",className:(0,o.cn)("w-[300px] justify-start text-left font-normal",!s&&"text-muted-foreground"),children:[(0,l.jsx)(i.A,{className:"mr-2 h-4 w-4"}),(null==s?void 0:s.from)?s.to?(0,l.jsxs)(l.Fragment,{children:[(0,t.GP)(s.from,"LLL dd, y",{locale:r.es})," -"," ",(0,t.GP)(s.to,"LLL dd, y",{locale:r.es})]}):(0,t.GP)(s.from,"LLL dd, y",{locale:r.es}):(0,l.jsx)("span",{children:"Seleccione un rango"})]})}),(0,l.jsx)(c.hl,{className:"w-auto p-0",align:"start",children:(0,l.jsx)(n.V,{initialFocus:!0,mode:"range",defaultMonth:null==s?void 0:s.from,selected:s,onSelect:u,numberOfMonths:2,locale:r.es})})]})})}},87270:(e,a,s)=>{"use strict";s.d(a,{A0:()=>o,BF:()=>d,Hj:()=>n,XI:()=>i,nA:()=>u,nd:()=>c});var l=s(95155),t=s(12115),r=s(64269);let i=t.forwardRef((e,a)=>{let{className:s,...t}=e;return(0,l.jsx)("div",{className:"relative w-full overflow-auto",children:(0,l.jsx)("table",{ref:a,className:(0,r.cn)("w-full caption-bottom text-sm",s),...t})})});i.displayName="Table";let o=t.forwardRef((e,a)=>{let{className:s,...t}=e;return(0,l.jsx)("thead",{ref:a,className:(0,r.cn)("[&_tr]:border-b",s),...t})});o.displayName="TableHeader";let d=t.forwardRef((e,a)=>{let{className:s,...t}=e;return(0,l.jsx)("tbody",{ref:a,className:(0,r.cn)("[&_tr:last-child]:border-0",s),...t})});d.displayName="TableBody",t.forwardRef((e,a)=>{let{className:s,...t}=e;return(0,l.jsx)("tfoot",{ref:a,className:(0,r.cn)("border-t bg-muted/50 font-medium [&>tr]:last:border-b-0",s),...t})}).displayName="TableFooter";let n=t.forwardRef((e,a)=>{let{className:s,...t}=e;return(0,l.jsx)("tr",{ref:a,className:(0,r.cn)("border-b transition-colors hover:bg-muted/50 data-[state=selected]:bg-muted",s),...t})});n.displayName="TableRow";let c=t.forwardRef((e,a)=>{let{className:s,...t}=e;return(0,l.jsx)("th",{ref:a,className:(0,r.cn)("h-12 px-4 text-left align-middle font-medium text-muted-foreground [&:has([role=checkbox])]:pr-0",s),...t})});c.displayName="TableHead";let u=t.forwardRef((e,a)=>{let{className:s,...t}=e;return(0,l.jsx)("td",{ref:a,className:(0,r.cn)("p-4 align-middle [&:has([role=checkbox])]:pr-0",s),...t})});u.displayName="TableCell",t.forwardRef((e,a)=>{let{className:s,...t}=e;return(0,l.jsx)("caption",{ref:a,className:(0,r.cn)("mt-4 text-sm text-muted-foreground",s),...t})}).displayName="TableCaption"}},e=>{e.O(0,[2992,7138,4316,4865,2130,2619,3326,5282,9351,6505,8348,5479,5171,8441,1255,7358],()=>e(e.s=44680)),_N_E=e.O()}]);