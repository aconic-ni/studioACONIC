(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[3240],{11860:(e,a,s)=>{"use strict";s.d(a,{AppProvider:()=>x,I:()=>u,U:()=>h});var t=s(95155),r=s(12115),l=s(11929),i=s(54901),d=s(19708),n=s(14585),c=s(15894),o=s(5282),u=function(e){return e[e.WELCOME=0]="WELCOME",e[e.INITIAL_INFO=1]="INITIAL_INFO",e[e.PRODUCT_LIST=2]="PRODUCT_LIST",e[e.PREVIEW=3]="PREVIEW",e[e.SUCCESS=4]="SUCCESS",e[e.INITIAL_DATA=1]="INITIAL_DATA",e[e.SOLICITUD_LIST=2]="SOLICITUD_LIST",e}({});let m=(0,r.createContext)(void 0),x=e=>{let{children:a}=e,[s,u]=(0,r.useState)(null),[x,h]=(0,r.useState)([]),[p,f]=(0,r.useState)(0),[j,v]=(0,r.useState)(null),[g,b]=(0,r.useState)(!1),[N,y]=(0,r.useState)(!1),[A,w]=(0,r.useState)(null),[C,E]=(0,r.useState)(!1),[S,D]=(0,r.useState)([]),[k,I]=(0,r.useState)(null),[_,R]=(0,r.useState)([]),[P,T]=(0,r.useState)(null),[z,L]=(0,r.useState)(!1),[F,M]=(0,r.useState)(null),[G,H]=(0,r.useState)(null),{user:O}=(0,i.A)(),{toast:B}=(0,c.dj)(),[V,U]=(0,r.useState)(O),$=(0,r.useCallback)(()=>{u(null),h([]),f(0),v(null),b(!1),y(!1),w(null),E(!1),D([]),I(null),R([]),T(null),L(!1),M(null),H(null)},[]);(0,r.useEffect)(()=>{((null==O?void 0:O.uid)!==(null==V?void 0:V.uid)||O&&!V||!O&&V)&&($(),U(O))},[O,V,$]);let Z=(0,r.useCallback)(e=>{I(e)},[]),J=(0,r.useCallback)(e=>{if(!(null==k?void 0:k.ne)){console.error("No se puede generar ID de solicitud: falta el NE en el contexto inicial."),B({title:"Error Interno",description:"No se pudo generar un ID para la solicitud porque falta el NE.",variant:"destructive"});return}let a=new Date,s=(0,o.GP)(a,"ddMMyy-HHmmss"),t="".concat(k.ne,"-").concat(s),r={...e,id:t};R(e=>[...e,r])},[k,B]),W=(0,r.useCallback)(e=>{R(a=>a.map(a=>a.id===e.id?e:a))},[]),q=(0,r.useCallback)(e=>{R(a=>a.filter(a=>a.id!==e))},[]),X=(0,r.useCallback)(e=>{T(e||null),b(!0)},[]),Y=(0,r.useCallback)(async(e,a)=>{if(C&&(null==s?void 0:s.ne)&&(null==O?void 0:O.email))try{let t=(0,d.rJ)(n.db,"examenesRecuperados"),r={examNe:s.ne,action:e,changedBy:O.email,changedAt:d.Dc.fromDate(new Date),details:a};await (0,d.gS)(t,r)}catch(e){console.error("Error writing audit log:",e),B({title:"Error de Auditor\xeda",description:"No se pudo registrar el cambio en la bit\xe1cora de recuperaci\xf3n.",variant:"destructive"})}},[C,null==s?void 0:s.ne,null==O?void 0:O.email,B]),K=(0,r.useCallback)(async(e,a)=>{if(!(null==e?void 0:e.ne)||!(null==O?void 0:O.email))return void console.log("Soft save prerequisites not met.",{ne:null==e?void 0:e.ne,user:null==O?void 0:O.email});let s=(0,d.H9)(n.db,"examenesPrevios",e.ne.toUpperCase()),t={...e,products:a,savedBy:O.email,status:"incomplete",lastUpdated:d.Dc.fromDate(new Date)};try{let r=await (0,d.x7)(s);1!==a.length||r.exists()&&r.data().createdAt||(t.createdAt=d.Dc.fromDate(new Date)),t.savedAt=d.Dc.fromDate(new Date),await (0,d.BN)(s,t,{merge:!0}),console.log("Soft save successful for NE: ".concat(e.ne))}catch(e){console.error("Error during soft save:",e),B({title:"Error de Autoguardado",description:"No se pudo guardar el progreso. Revisa tu conexi\xf3n.",variant:"destructive"})}},[O,B]),Q=(0,r.useCallback)(function(e){let a=arguments.length>1&&void 0!==arguments[1]&&arguments[1];u(e),a&&E(!0)},[]),ee=(0,r.useCallback)(e=>{h(e)},[]),ea=(0,r.useCallback)(e=>{let a={...e,id:(0,l.A)(),productTimestampSaveAt:d.Dc.fromDate(new Date)};h(e=>{let t=[...e,a];return K(s,t),t}),Y("product_added",{productId:a.id,newData:a})},[s,K,Y]),es=(0,r.useCallback)(e=>{let a;h(t=>{a=t.find(a=>a.id===e.id);let r=t.map(a=>a.id===e.id?e:a);return K(s,r),r}),Y("product_updated",{productId:e.id,previousData:a,newData:e}),v(null)},[s,K,Y]),et=(0,r.useCallback)(e=>{let a;h(t=>{a=t.find(a=>a.id===e);let r=t.filter(a=>a.id!==e);return K(s,r),r}),a&&Y("product_deleted",{productId:e,previousData:a})},[s,K,Y]),er=(0,r.useCallback)(e=>{f(e)},[]),el=(0,r.useCallback)(e=>{v(e)},[]),ei=(0,r.useCallback)(e=>{2===p?v(e):2===p&&T(e),b(!0)},[p]),ed=(0,r.useCallback)(()=>{b(!1),v(null),T(null)},[]),en=(0,r.useCallback)(e=>{w(e),y(!0)},[]),ec=(0,r.useCallback)(()=>{y(!1),w(null)},[]),eo=(0,r.useCallback)(e=>{D(a=>a.includes(e)?a.filter(a=>a!==e):[...a,e])},[]),eu=(0,r.useCallback)(()=>{S.length===x.length?D([]):D(x.map(e=>e.id))},[x,S.length]),em=(0,r.useCallback)(()=>{let e=[];h(a=>{let t=a.filter(a=>!S.includes(a.id)||(e.push(a),!1));return K(s,t),t}),e.forEach(e=>{Y("product_deleted",{productId:e.id,previousData:e})}),D([]),B({title:"Productos eliminados",description:"".concat(e.length," productos han sido eliminados de la lista.")})},[S,K,s,Y,B]);return(0,t.jsx)(m.Provider,{value:{examData:s,products:x,currentStep:p,editingProduct:j,isAddProductModalOpen:g,isProductDetailModalOpen:N,productToView:A,selectedProducts:S,setExamData:Q,setProducts:ee,addProduct:ea,updateProduct:es,deleteProduct:et,setCurrentStep:er,setEditingProduct:el,openAddProductModal:ei,closeAddProductModal:ed,openProductDetailModal:en,closeProductDetailModal:ec,resetApp:$,softSaveExam:K,toggleProductSelection:eo,toggleSelectAllProducts:eu,deleteSelectedProducts:em,initialContextData:k,setInitialContextData:Z,solicitudes:_,addSolicitud:J,updateSolicitud:W,deleteSolicitud:q,editingSolicitud:P,openSolicitudModal:X,isMemorandumMode:z,setIsMemorandumMode:L,solicitudToViewInline:F,setSolicitudToViewInline:M,caseToAssignAforador:G,setCaseToAssignAforador:H},children:a})},h=()=>{let e=(0,r.useContext)(m);if(void 0===e)throw Error("useAppContext must be used within an AppProvider");return e}},26972:(e,a,s)=>{"use strict";s.r(a),s.d(a,{default:()=>eo});var t=s(95155),r=s(12115),l=s(20063),i=s(54901),d=s(35434),n=s(3998),c=s(86948),o=s(87270),u=s(82206),m=s(27339),x=s(92033),h=s(65571),p=s(43633),f=s(90109),j=s(87455),v=s(63037),g=s(36654),b=s(59915),N=s(88964),y=s(1644),A=s(13630),w=s(14585),C=s(19708),E=s(15239),S=s(26615),D=s(76251);let k=e=>e?e.toDate().toLocaleString("es-NI",{dateStyle:"long",timeStyle:"medium"}):"N/A",I=e=>{let a,{label:s,value:r,icon:l}=e;return a="boolean"==typeof r?r?"S\xed":"No":r instanceof C.Dc?k(r):String(null!=r?r:"N/A"),(0,t.jsxs)("div",{children:[(0,t.jsxs)("div",{className:"flex items-center",children:[l&&(0,t.jsx)("span",{className:"mr-2 text-primary",children:l}),(0,t.jsx)("p",{className:"text-xs font-medium text-muted-foreground",children:s})]}),(0,t.jsx)("p",{className:"text-sm text-foreground ml-6",children:a})]})},_=e=>{var a;let{exam:s,onClose:r}=e;return(0,t.jsx)(t.Fragment,{children:(0,t.jsxs)(c.Zp,{className:"mt-6 w-full max-w-5xl mx-auto custom-shadow",id:"printable-area",children:[(0,t.jsx)(E.default,{src:"/imagenes/HEADERSEXA.svg",alt:"Examen Header",width:800,height:100,className:"w-full h-auto mb-4 hidden print:block",priority:!0}),(0,t.jsxs)(c.aR,{children:[(0,t.jsxs)("div",{className:"flex justify-between items-start",children:[(0,t.jsxs)(c.ZB,{className:"text-xl md:text-2xl font-semibold text-foreground",children:["Vista de Documento: ",s.ne]}),(0,t.jsx)("button",{onClick:r,className:"p-1 text-destructive hover:text-destructive/80 no-print",children:(0,t.jsx)(S.A,{className:"h-6 w-6"})})]}),(0,t.jsx)(c.BT,{className:"text-muted-foreground no-print",children:"Vista de solo lectura de los detalles del examen."})]}),(0,t.jsxs)(c.Wu,{className:"space-y-6",children:[(0,t.jsxs)("div",{className:"grid grid-cols-1 sm:grid-cols-2 md:grid-cols-3 gap-x-6 gap-y-4 bg-secondary/30 p-4 rounded-md shadow-sm text-sm",children:[(0,t.jsx)(I,{label:"NE (Tracking NX1)",value:s.ne}),(0,t.jsx)(I,{label:"Referencia",value:s.reference}),(0,t.jsx)(I,{label:"Consignatario",value:s.consignee}),(0,t.jsx)(I,{label:"Gestor del Examen",value:s.manager}),(0,t.jsx)(I,{label:"Ubicaci\xf3n Mercanc\xeda",value:s.location}),(0,t.jsx)(I,{label:"Guardado por",value:s.savedBy}),(0,t.jsx)(I,{label:"Fecha Creaci\xf3n",value:k(s.createdAt)}),(0,t.jsx)(I,{label:"Fecha Guardado",value:k(s.savedAt)}),(0,t.jsx)(I,{label:"Fecha Finalizaci\xf3n",value:k(s.completedAt)}),(0,t.jsx)(I,{label:"Asignado a",value:s.assignedTo}),(0,t.jsx)(I,{label:"Fecha Asignaci\xf3n",value:k(s.assignedAt)})]}),(0,t.jsxs)("div",{children:[(0,t.jsxs)("h4",{className:"text-lg font-medium mb-3 text-foreground",children:["Productos (",(null==(a=s.products)?void 0:a.length)||0,")"]}),s.products&&s.products.length>0?(0,t.jsx)("div",{className:"space-y-6",children:s.products.map((e,a)=>(0,t.jsxs)("div",{className:"p-4 border border-border bg-card rounded-lg shadow print-product-container",children:[(0,t.jsxs)("h5",{className:"text-md font-semibold mb-3 text-primary",children:["Producto ",a+1]}),(0,t.jsxs)("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-x-6 gap-y-4",children:[(0,t.jsx)(I,{label:"N\xfamero de Item",value:e.itemNumber}),(0,t.jsx)(I,{label:"Descripci\xf3n",value:e.description}),(0,t.jsx)(I,{label:"Marca",value:e.brand})]})]},e.id||a))}):(0,t.jsx)("p",{className:"text-muted-foreground",children:"No hay productos registrados en este examen."})]})]}),(0,t.jsx)(c.wL,{className:"justify-end gap-2 no-print border-t pt-4",children:(0,t.jsxs)(n.$,{type:"button",onClick:()=>{window.print()},variant:"outline",children:[(0,t.jsx)(D.A,{className:"mr-2 h-4 w-4"})," Imprimir"]})}),(0,t.jsx)(E.default,{src:"/imagenes/FOOTEREXA.svg",alt:"Examen Footer",width:800,height:50,className:"w-full h-auto mt-6 hidden print:block"})]})})};var R=s(17037),P=s(7710),T=s(44381),z=s(5225),L=s(21255),F=s(27237),M=s(39075),G=s(55666),H=s(92129),O=s(86067),B=s(22823),V=s(91719),U=s(12158),$=s(19201),Z=s(27500),J=s(75004),W=s(28813),q=s(27314),X=s(5282),Y=s(80160);let K=e=>{if(!e)return"N/A";let a=e.toDate();return(0,X.GP)(a,"dd/MM/yy HH:mm",{locale:Y.es})},Q=e=>{let a,{label:s,value:r,icon:l}=e;return a="boolean"==typeof r?r?"S\xed":"No":r instanceof C.Dc?K(r):String(null!=r?r:"N/A"),(0,t.jsxs)("div",{className:"text-xs",children:[(0,t.jsxs)("div",{className:"flex items-center",children:[l&&(0,t.jsx)("span",{className:"mr-2 text-primary",children:l}),(0,t.jsx)("p",{className:"font-medium text-muted-foreground",children:s})]}),(0,t.jsx)("p",{className:"text-foreground ml-6",children:a})]})},ee=e=>{let{product:a,exam:s}=e;if(!a)return(0,t.jsx)("div",{className:"text-muted-foreground text-sm italic",children:"Sin datos"});let r=a.productTimestampSaveAt||s.assignedAt||s.createdAt||s.savedAt;return(0,t.jsxs)("div",{className:"space-y-3",children:[(0,t.jsx)(Q,{label:"Fecha de Ingreso del Producto",value:K(r),icon:(0,t.jsx)(P.A,{size:14})}),(0,t.jsx)(Q,{label:"N\xfamero de Item",value:a.itemNumber,icon:(0,t.jsx)(T.A,{size:14})}),(0,t.jsx)(Q,{label:"Descripci\xf3n",value:a.description,icon:(0,t.jsx)(z.A,{size:14})}),(0,t.jsx)(Q,{label:"Marca",value:a.brand,icon:(0,t.jsx)(L.A,{size:14})}),(0,t.jsx)(Q,{label:"Modelo",value:a.model,icon:(0,t.jsx)(F.A,{size:14})}),(0,t.jsx)(Q,{label:"Serie",value:a.serial,icon:(0,t.jsx)(M.A,{size:14})}),(0,t.jsx)(Q,{label:"Origen",value:a.origin,icon:(0,t.jsx)(G.A,{size:14})}),(0,t.jsx)(Q,{label:"Peso",value:a.weight,icon:(0,t.jsx)(H.A,{size:14})}),(0,t.jsx)(Q,{label:"Unidad de Medida",value:a.unitMeasure,icon:(0,t.jsx)(O.A,{size:14})}),(0,t.jsx)(Q,{label:"Numeraci\xf3n de Bultos",value:a.numberPackages,icon:(0,t.jsx)(B.A,{size:14})}),(0,t.jsx)(Q,{label:"Cantidad de Bultos",value:a.quantityPackages,icon:(0,t.jsx)(V.A,{size:14})}),(0,t.jsx)(Q,{label:"Cantidad de Unidades",value:a.quantityUnits,icon:(0,t.jsx)(U.A,{size:14})}),(0,t.jsx)(Q,{label:"Condici\xf3n Embalaje",value:a.packagingCondition,icon:(0,t.jsx)($.A,{size:14})}),(0,t.jsx)(Q,{label:"Observaci\xf3n",value:a.observation,icon:(0,t.jsx)(Z.A,{size:14})}),(0,t.jsx)(Q,{label:"Estado General",value:(e=>{if(!e)return"N/A";let a=[];return(e.isConform&&a.push("Conforme a factura"),e.isExcess&&a.push("Excedente"),e.isMissing&&a.push("Faltante"),e.isFault&&a.push("Aver\xeda"),0===a.length)?"Sin estado espec\xedfico":a.join(", ")})(a),icon:(0,t.jsx)(J.A,{size:14})})]})},ea=e=>{let{value:a,exam:s}=e;return null==a?(0,t.jsx)("i",{className:"text-muted-foreground",children:"N/A"}):"object"!=typeof a||a instanceof C.Dc?a instanceof C.Dc?(0,t.jsx)("span",{className:"text-blue-600",children:K(a)}):"boolean"==typeof a?(0,t.jsx)("span",{className:"font-mono text-sm",children:a?"Verdadero":"Falso"}):(0,t.jsx)("span",{className:"text-foreground",children:String(a)}):(0,t.jsx)(ee,{product:a,exam:s})},es=e=>{let{logs:a,exam:s}=e;return(0,t.jsxs)(c.Zp,{className:"mt-6 w-full max-w-5xl mx-auto custom-shadow",id:"printable-area",children:[(0,t.jsx)(E.default,{src:"/imagenes/HEADERSEXA.svg",alt:"Examen Header",width:800,height:100,className:"w-full h-auto mb-4 hidden print:block",priority:!0}),(0,t.jsxs)(c.aR,{className:"border-b pb-4",children:[(0,t.jsxs)("div",{className:"flex justify-between items-center no-print",children:[(0,t.jsxs)("div",{className:"flex items-center gap-2",children:[(0,t.jsx)(b.A,{className:"h-6 w-6 text-primary"}),(0,t.jsx)(c.ZB,{children:"Historial de Cambios Unificado"})]}),(0,t.jsxs)(n.$,{variant:"outline",size:"sm",onClick:()=>{window.print()},children:[(0,t.jsx)(D.A,{className:"mr-2 h-4 w-4"})," Imprimir"]})]}),(0,t.jsx)("div",{className:"print:block hidden text-center mb-4",children:(0,t.jsx)(c.ZB,{children:"Historial de Cambios Unificado"})}),(0,t.jsxs)(c.BT,{children:["Mostrando el historial de modificaciones para el examen ",(0,t.jsx)("span",{className:"font-semibold text-foreground",children:s.ne})," del consignatario ",(0,t.jsx)("span",{className:"font-semibold text-foreground",children:s.consignee}),"."]}),(0,t.jsxs)("div",{className:"text-sm text-muted-foreground pt-2",children:["Gestor del Previo Original: ",(0,t.jsx)("span",{className:"font-semibold text-foreground",children:s.manager})]})]}),(0,t.jsxs)(c.Wu,{children:[(0,t.jsx)(R.F,{className:"h-[60vh] no-print",children:(0,t.jsx)("div",{className:"space-y-6 p-1",children:(0,t.jsx)(et,{logs:a,exam:s})})}),(0,t.jsx)("div",{className:"hidden print:block space-y-6",children:(0,t.jsx)(et,{logs:a,exam:s})})]}),(0,t.jsx)(E.default,{src:"/imagenes/FOOTEREXA.svg",alt:"Examen Footer",width:800,height:50,className:"w-full h-auto mt-6 hidden print:block"})]})},et=e=>{let{logs:a,exam:s}=e;return 0===a.length?(0,t.jsx)("div",{className:"text-center text-muted-foreground py-10",children:"No hay registros de cambios para este documento."}):(0,t.jsx)(t.Fragment,{children:a.map(e=>{var a,r;let l="adminEmail"in e,i=l?e.timestamp:e.changedAt,d=l?e.adminEmail:e.changedBy,n=(e=>{switch(e){case"update":return{icon:(0,t.jsx)(v.A,{className:"h-4 w-4"}),text:"Actualizaci\xf3n de Estado"};case"product_added":return{icon:(0,t.jsx)(W.A,{className:"h-4 w-4"}),text:"Producto A\xf1adido"};case"product_updated":return{icon:(0,t.jsx)(W.A,{className:"h-4 w-4"}),text:"Producto Modificado"};case"product_deleted":return{icon:(0,t.jsx)(W.A,{className:"h-4 w-4"}),text:"Producto Eliminado"};default:return{icon:(0,t.jsx)(b.A,{className:"h-4 w-4"}),text:"Cambio Registrado"}}})(e.action);return(0,t.jsxs)("div",{className:"p-4 border rounded-lg bg-card shadow-sm print-product-container",children:[(0,t.jsxs)("div",{className:"flex flex-col sm:flex-row justify-between items-start text-sm mb-3 border-b pb-2",children:[(0,t.jsxs)("div",{className:"flex items-center gap-2 font-semibold",children:[(0,t.jsx)("span",{className:"text-primary",children:n.icon}),(0,t.jsx)("span",{children:n.text})]}),(0,t.jsx)("span",{className:"text-muted-foreground mt-1 sm:mt-0",children:K(i)})]}),(0,t.jsxs)("div",{className:"flex items-center gap-2 mb-3 text-sm",children:[(0,t.jsx)(q.A,{className:"h-4 w-4 text-muted-foreground"}),(0,t.jsx)("span",{className:"font-medium",children:"Realizado por:"}),(0,t.jsx)("span",{children:d})]}),(0,t.jsx)("div",{className:"p-4 bg-secondary/30 rounded-lg",children:l?(0,t.jsx)("div",{className:"space-y-3",children:e.changes.map((e,a)=>(0,t.jsxs)("div",{className:"text-sm",children:[(0,t.jsxs)("p",{className:"font-semibold mb-2",children:["Campo modificado: ",(0,t.jsx)("code",{className:"bg-primary/10 text-primary px-2 py-1 rounded-sm",children:e.field})]}),(0,t.jsxs)("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[(0,t.jsxs)("div",{children:[(0,t.jsx)("h4",{className:"font-medium text-muted-foreground mb-1",children:"Valor Anterior"}),(0,t.jsx)(ea,{value:e.oldValue,exam:s})]}),(0,t.jsxs)("div",{children:[(0,t.jsx)("h4",{className:"font-medium text-foreground mb-1",children:"Valor Nuevo"}),(0,t.jsx)(ea,{value:e.newValue,exam:s})]})]})]},a))}):(0,t.jsxs)("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-x-6 gap-y-4",children:[(0,t.jsxs)("div",{children:[(0,t.jsx)("h4",{className:"font-medium text-muted-foreground mb-2",children:"Datos Anteriores"}),(0,t.jsx)(ea,{value:null==(a=e.details)?void 0:a.previousData,exam:s})]}),(0,t.jsxs)("div",{children:[(0,t.jsx)("h4",{className:"font-medium text-foreground mb-2",children:"Datos Nuevos"}),(0,t.jsx)(ea,{value:null==(r=e.details)?void 0:r.newData,exam:s})]})]})})]},e.id)})})};var er=s(11647),el=s(15894),ei=s(11860),ed=s(98053),en=s(52619),ec=s.n(en);function eo(){let{user:e,loading:a}=(0,i.A)(),s=(0,l.useRouter)(),{toast:E}=(0,el.dj)(),{setExamData:S,setProducts:D,setCurrentStep:k}=(0,ei.U)(),[I,R]=(0,r.useState)(),[P,T]=(0,r.useState)(),[z,L]=(0,r.useState)("range"),[F,M]=(0,r.useState)("activeExamenes"),[G,H]=(0,r.useState)([]),[O,B]=(0,r.useState)([]),[V,U]=(0,r.useState)([]),[$,Z]=(0,r.useState)(!0),[J,W]=(0,r.useState)(null),[q,K]=(0,r.useState)(null),[Q,ee]=(0,r.useState)([]),[ea,et]=(0,r.useState)(!1),en=(0,r.useCallback)(async()=>{Z(!0),W(null);try{let e=(0,C.P)((0,C.rJ)(w.db,"examenesPrevios"),(0,C.My)("createdAt","desc")),a=(0,C.P)((0,C.rJ)(w.db,"AforoCases"),(0,C.My)("createdAt","desc")),[s,t]=await Promise.all([(0,C.GG)(e),(0,C.GG)(a)]),r=s.docs.map(e=>({id:e.id,...e.data()}));H(r);let l=t.docs.map(e=>({id:e.id,...e.data()}));B(l)}catch(e){console.error("Error fetching data:",e),W("No se pudieron cargar los datos. Verifique los \xedndices de Firestore."),E({title:"Error de Carga",description:"No se pudieron cargar los datos iniciales. Verifique los \xedndices de Firestore.",variant:"destructive"})}finally{Z(!1)}},[E]);(0,r.useEffect)(()=>{a||e&&"admin"===e.role?e&&en():s.push("/")},[e,a,s,en]);let eo=(0,r.useCallback)(()=>{let e=[];"activeExamenes"===F?e=G.filter(e=>!e.isArchived):"archivedExamenes"===F?e=G.filter(e=>!0===e.isArchived):"archivedAforo"===F&&(e=O.filter(e=>!0===e.isArchived));let a=e;if("range"===z&&(null==I?void 0:I.from)){let s=I.from,t=new Date(I.to?I.to:I.from);t.setHours(23,59,59,999),a=e.filter(e=>{var a;let r=null==(a=e.createdAt)?void 0:a.toDate();return r&&r>=s&&r<=t})}else if("specific"===z&&P){let s=new Date(P);s.setHours(0,0,0,0);let t=new Date(P);t.setHours(23,59,59,999),a=e.filter(e=>{var a;let r=null==(a=e.createdAt)?void 0:a.toDate();return r&&r>=s&&r<=t})}U(a)},[G,O,I,z,P,F]);(0,r.useEffect)(()=>{eo()},[F,G,O,eo]);let eu=async e=>{K(e),et(!0),ee([]);try{let a=[];if("products"in e){let s=(0,C.P)((0,C.rJ)(w.db,"adminAuditLog"),(0,C._M)("docId","==",e.id)),t=(0,C.P)((0,C.rJ)(w.db,"examenesRecuperados"),(0,C._M)("examNe","==",e.ne)),[r,l]=await Promise.all([(0,C.GG)(s),(0,C.GG)(t)]);r.forEach(e=>a.push({...e.data(),id:e.id,sortDate:e.data().timestamp.toDate()})),l.forEach(e=>a.push({...e.data(),id:e.id,sortDate:e.data().changedAt.toDate()}))}else{let s=(0,C.P)((0,C.rJ)(w.db,"adminAuditLog"),(0,C._M)("docId","==",e.id)),t=(0,C.P)((0,C.rJ)(e.id,"actualizaciones"),(0,C.My)("updatedAt","desc")),[r,l]=await Promise.all([(0,C.GG)(s),(0,C.GG)(t)]);r.forEach(e=>a.push({...e.data(),id:e.id,sortDate:e.data().timestamp.toDate()})),l.forEach(e=>a.push({...e.data(),id:e.id,sortDate:e.data().updatedAt.toDate()}))}a.sort((e,a)=>a.sortDate.getTime()-e.sortDate.getTime()),ee(a)}catch(e){console.error("Error fetching audit logs:",e),E({title:"Error",description:"No se pudieron cargar los registros de cambios.",variant:"destructive"})}},em=async(a,s)=>{if(!e||!e.email)return void E({title:"Error de autenticaci\xf3n",variant:"destructive"});let t="products"in a?"examenesPrevios":"AforoCases",r=(0,C.H9)(w.db,t,a.id),l=writeBatch(w.db);try{var i;let d=null!=(i=a.isArchived)&&i;if(l.update(r,{isArchived:s}),"worksheetId"in a&&a.worksheetId){let e=(0,C.H9)(w.db,"worksheets",a.worksheetId);l.update(e,{isArchived:s})}let n=(0,C.rJ)(w.db,"adminAuditLog");await (0,C.gS)(n,{collection:t,docId:a.id,adminId:e.uid,adminEmail:e.email,timestamp:(0,C.O5)(),action:"update",changes:[{field:"isArchived",oldValue:d,newValue:s}]}),await l.commit(),E({title:"Registro ".concat(s?"archivado":"restaurado"," con \xe9xito.")}),en()}catch(e){console.error("Error archiving document:",e),E({title:"Error",description:"No se pudo ".concat(s?"archivar":"restaurar"," el registro."),variant:"destructive"})}},ex=()=>{K(null),ee([]),et(!1)};return a||!e?(0,t.jsx)("div",{className:"min-h-screen flex items-center justify-center bg-background",children:(0,t.jsx)(x.A,{className:"h-12 w-12 animate-spin text-primary"})}):q&&!ea?(0,t.jsx)(d.G,{children:(0,t.jsx)("div",{className:"py-2 md:py-5",children:"products"in q?(0,t.jsx)(_,{exam:q,onClose:ex}):(0,t.jsx)("p",{children:"Vista de detalle para AforoCase no implementada a\xfan."})})}):q&&ea?(0,t.jsx)(d.G,{children:(0,t.jsx)("div",{className:"py-2 md:py-5 max-w-5xl mx-auto",children:(0,t.jsxs)("div",{className:"bg-card p-4 rounded-lg shadow-md",children:[(0,t.jsx)(n.$,{onClick:ex,variant:"outline",className:"mb-4 no-print",children:"Volver al listado"}),(0,t.jsx)(es,{logs:Q,exam:q})]})})}):(0,t.jsx)(d.G,{children:(0,t.jsx)("div",{className:"py-2 md:py-5",children:(0,t.jsxs)(c.Zp,{className:"w-full max-w-7xl mx-auto custom-shadow",children:[(0,t.jsx)(c.aR,{children:(0,t.jsxs)("div",{className:"flex justify-between items-start",children:[(0,t.jsxs)("div",{children:[(0,t.jsx)(c.ZB,{className:"text-2xl font-semibold text-foreground",children:"Control de Registros"}),(0,t.jsx)(c.BT,{className:"text-muted-foreground",children:"Busque, visualice, edite y archive ex\xe1menes previos y casos de aforo."})]}),(0,t.jsxs)("div",{className:"flex gap-2",children:[(0,t.jsx)(n.$,{asChild:!0,variant:"outline",children:(0,t.jsxs)(ec(),{href:"/admin/control/updates",children:[(0,t.jsx)(h.A,{className:"mr-2 h-4 w-4"})," Estad\xedsticas"]})}),(0,t.jsx)(n.$,{asChild:!0,children:(0,t.jsxs)(ec(),{href:"/admin/control/avisos",children:[(0,t.jsx)(p.A,{className:"mr-2 h-4 w-4"})," Gestionar Avisos"]})})]})]})}),(0,t.jsxs)(c.Wu,{children:[(0,t.jsxs)("div",{className:"flex flex-col md:flex-row gap-4 mb-6 p-4 border rounded-md bg-secondary/30",children:[(0,t.jsxs)("div",{className:"flex flex-wrap items-center gap-2",children:[(0,t.jsx)(n.$,{variant:"range"===z?"default":"ghost",size:"sm",onClick:()=>L("range"),children:"Rango de Fechas"}),(0,t.jsx)(n.$,{variant:"specific"===z?"default":"ghost",size:"sm",onClick:()=>L("specific"),children:"Fecha Espec\xedfica"})]}),(0,t.jsxs)("div",{className:"flex flex-wrap items-center gap-4",children:["range"===z&&(0,t.jsx)(u.S,{date:I,onDateChange:R}),"specific"===z&&(0,t.jsx)(m.l,{date:P,onDateChange:T}),(0,t.jsxs)(n.$,{onClick:()=>{eo()},disabled:$,className:"btn-primary",children:[(0,t.jsx)(f.A,{className:"mr-2 h-4 w-4"}),$?"Buscando...":"Buscar"]})]})]}),(0,t.jsxs)("div",{className:"border-t pt-4",children:[(0,t.jsx)("div",{className:"flex justify-between items-center mb-4",children:(0,t.jsxs)("div",{className:"flex gap-2",children:[(0,t.jsxs)(n.$,{size:"sm",variant:"activeExamenes"===F?"secondary":"ghost",onClick:()=>M("activeExamenes"),children:[(0,t.jsx)(j.A,{className:"mr-2 h-4 w-4"})," Activos (Ex\xe1menes)"]}),(0,t.jsxs)(n.$,{size:"sm",variant:"archivedExamenes"===F?"secondary":"ghost",onClick:()=>M("archivedExamenes"),children:[(0,t.jsx)(v.A,{className:"mr-2 h-4 w-4"})," Archivados (Ex\xe1menes)"]}),(0,t.jsxs)(n.$,{size:"sm",variant:"archivedAforo"===F?"secondary":"ghost",onClick:()=>M("archivedAforo"),children:[(0,t.jsx)(v.A,{className:"mr-2 h-4 w-4"})," Archivados (Aforo)"]})]})}),$&&(0,t.jsxs)("div",{className:"flex justify-center items-center py-6",children:[(0,t.jsx)(x.A,{className:"h-8 w-8 animate-spin text-primary"}),(0,t.jsx)("p",{className:"ml-3 text-muted-foreground",children:"Cargando..."})]}),J&&!$&&(0,t.jsx)("div",{className:"mt-4 p-4 bg-destructive/10 text-destructive border border-destructive/30 rounded-md text-center",children:J}),!$&&V.length>0&&(0,t.jsx)("div",{className:"overflow-x-auto table-container rounded-lg border",children:(0,t.jsxs)(o.XI,{children:[(0,t.jsx)(o.A0,{className:"bg-gray-50",children:(0,t.jsxs)(o.Hj,{children:[(0,t.jsx)(o.nd,{children:"NE"}),(0,t.jsx)(o.nd,{children:"Tipo"}),(0,t.jsx)(o.nd,{children:"Consignatario"}),(0,t.jsx)(o.nd,{children:"Asignado/Ejecutivo"}),(0,t.jsx)(o.nd,{children:"Fecha Creaci\xf3n"}),(0,t.jsx)(o.nd,{children:"Estado"}),(0,t.jsx)(o.nd,{className:"text-right",children:"Acciones"})]})}),(0,t.jsx)(o.BF,{children:V.map(e=>{var a;let r="products"in e;return(0,t.jsxs)(o.Hj,{children:[(0,t.jsx)(o.nA,{className:"font-medium",children:e.ne}),(0,t.jsx)(o.nA,{children:r?"Examen Previo":"Caso Aforo"}),(0,t.jsx)(o.nA,{children:e.consignee}),(0,t.jsx)(o.nA,{children:(0,t.jsx)(er.E,{variant:"secondary",children:r?e.assignedTo||e.manager:e.executive})}),(0,t.jsx)(o.nA,{children:(a=e.createdAt)?(0,X.GP)(a.toDate(),"dd/MM/yy HH:mm",{locale:Y.es}):"N/A"}),(0,t.jsx)(o.nA,{children:e.isArchived?(0,t.jsx)(er.E,{variant:"destructive",children:"Archivado"}):"complete"===e.status?(0,t.jsx)(er.E,{className:"bg-green-500 text-white",children:"Completo"}):(0,t.jsx)(er.E,{variant:"outline",children:r?e.status:e.aforadorStatus})}),(0,t.jsxs)(o.nA,{className:"text-right space-x-1",children:[(0,t.jsxs)(n.$,{variant:"ghost",size:"sm",onClick:()=>{K(e),et(!1),ee([])},children:[(0,t.jsx)(g.A,{className:"h-4 w-4"})," ",(0,t.jsx)("span",{className:"sr-only",children:"Ver"})]}),(0,t.jsxs)(n.$,{variant:"ghost",size:"sm",onClick:()=>eu(e),children:[(0,t.jsx)(b.A,{className:"h-4 w-4"})," ",(0,t.jsx)("span",{className:"sr-only",children:"Modificaciones"})]}),r&&(0,t.jsxs)(n.$,{variant:"ghost",size:"sm",onClick:()=>{S({ne:e.ne,reference:e.reference,consignee:e.consignee,location:e.location,manager:e.manager},!0),D(e.products||[]),k(ei.I.PRODUCT_LIST),s.push("/examiner")},children:[(0,t.jsx)(N.A,{className:"h-4 w-4"})," ",(0,t.jsx)("span",{className:"sr-only",children:"Editar"})]}),(0,t.jsxs)(ed.Lt,{children:[(0,t.jsx)(ed.tv,{asChild:!0,children:(0,t.jsxs)(n.$,{variant:"ghost",size:"sm",className:e.isArchived?"text-green-600":"text-destructive",children:[e.isArchived?(0,t.jsx)(y.A,{className:"h-4 w-4"}):(0,t.jsx)(A.A,{className:"h-4 w-4"}),(0,t.jsx)("span",{className:"sr-only",children:e.isArchived?"Restaurar":"Archivar"})]})}),(0,t.jsxs)(ed.EO,{children:[(0,t.jsxs)(ed.wd,{children:[(0,t.jsx)(ed.r7,{children:"\xbfEst\xe1 seguro?"}),(0,t.jsxs)(ed.$v,{children:["Esta acci\xf3n ",e.isArchived?"restaurar\xe1":"archivar\xe1"," el registro. ",e.isArchived?"Los usuarios podr\xe1n verlo de nuevo.":"No ser\xe1 visible en la lista principal."]})]}),(0,t.jsxs)(ed.ck,{children:[(0,t.jsx)(ed.Zr,{children:"Cancelar"}),(0,t.jsx)(ed.Rx,{onClick:()=>em(e,!e.isArchived),children:"S\xed, continuar"})]})]})]})]})]},e.id)})})]})}),!$&&!J&&0===V.length&&(0,t.jsx)("div",{className:"mt-4 p-4 bg-blue-500/10 text-blue-700 border border-blue-500/30 rounded-md text-center",children:"No se encontraron registros para los criterios de b\xfasqueda actuales."})]})]})]})})})}},27339:(e,a,s)=>{"use strict";s.d(a,{l:()=>m});var t=s(95155),r=s(12115),l=s(5282),i=s(80160),d=s(28127),n=s(64269),c=s(3998),o=s(50276),u=s(26333);function m(e){let{className:a,date:s,onDateChange:m,disabled:x=!1}=e,[h,p]=r.useState(!1),[f,j]=r.useState(s);return r.useEffect(()=>{j(s)},[s]),(0,t.jsx)("div",{className:(0,n.cn)("grid gap-2",a),children:(0,t.jsxs)(u.AM,{open:h,onOpenChange:p,children:[(0,t.jsx)(u.Wv,{asChild:!0,children:(0,t.jsxs)(c.$,{variant:"outline",disabled:x,className:(0,n.cn)("w-[180px] justify-start text-left font-normal",!f&&"text-muted-foreground"),children:[(0,t.jsx)(d.A,{className:"mr-2 h-4 w-4"}),f?(0,l.GP)(f,"dd/MM/yy",{locale:i.es}):(0,t.jsx)("span",{children:"Seleccione fecha"})]})}),(0,t.jsx)(u.hl,{className:"w-auto p-0",children:(0,t.jsx)(o.V,{mode:"single",selected:null!=f?f:void 0,onSelect:e=>{j(e),m(e),p(!1)},initialFocus:!0,locale:i.es,disabled:x})})]})})}},50276:(e,a,s)=>{"use strict";s.d(a,{V:()=>c});var t=s(95155);s(12115);var r=s(51190),l=s(63263),i=s(75196),d=s(64269),n=s(3998);function c(e){let{className:a,classNames:s,showOutsideDays:c=!0,...o}=e;return(0,t.jsx)(i.hv,{showOutsideDays:c,className:(0,d.cn)("p-3",a),classNames:{months:"flex flex-col sm:flex-row space-y-4 sm:space-x-4 sm:space-y-0",month:"space-y-4",caption:"flex justify-center pt-1 relative items-center",caption_label:"text-sm font-medium",nav:"space-x-1 flex items-center",nav_button:(0,d.cn)((0,n.r)({variant:"outline"}),"h-7 w-7 bg-transparent p-0 opacity-50 hover:opacity-100"),nav_button_previous:"absolute left-1",nav_button_next:"absolute right-1",table:"w-full border-collapse space-y-1",head_row:"flex",head_cell:"text-muted-foreground rounded-md w-9 font-normal text-[0.8rem]",row:"flex w-full mt-2",cell:"h-9 w-9 text-center text-sm p-0 relative [&:has([aria-selected].day-range-end)]:rounded-r-md [&:has([aria-selected].day-outside)]:bg-accent/50 [&:has([aria-selected])]:bg-accent first:[&:has([aria-selected])]:rounded-l-md last:[&:has([aria-selected])]:rounded-r-md focus-within:relative focus-within:z-20",day:(0,d.cn)((0,n.r)({variant:"ghost"}),"h-9 w-9 p-0 font-normal aria-selected:opacity-100"),day_range_end:"day-range-end",day_selected:"bg-primary text-primary-foreground hover:bg-primary hover:text-primary-foreground focus:bg-primary focus:text-primary-foreground",day_today:"bg-accent text-accent-foreground",day_outside:"day-outside text-muted-foreground aria-selected:bg-accent/50 aria-selected:text-muted-foreground",day_disabled:"text-muted-foreground opacity-50",day_range_middle:"aria-selected:bg-accent aria-selected:text-accent-foreground",day_hidden:"invisible",...s},components:{IconLeft:e=>{let{className:a,...s}=e;return(0,t.jsx)(r.A,{className:(0,d.cn)("h-4 w-4",a),...s})},IconRight:e=>{let{className:a,...s}=e;return(0,t.jsx)(l.A,{className:(0,d.cn)("h-4 w-4",a),...s})}},...o})}c.displayName="Calendar"},60473:(e,a,s)=>{Promise.resolve().then(s.bind(s,26972))},82206:(e,a,s)=>{"use strict";s.d(a,{S:()=>u});var t=s(95155);s(12115);var r=s(5282),l=s(80160),i=s(28127),d=s(64269),n=s(3998),c=s(50276),o=s(26333);function u(e){let{className:a,date:s,onDateChange:u}=e;return(0,t.jsx)("div",{className:(0,d.cn)("grid gap-2",a),children:(0,t.jsxs)(o.AM,{children:[(0,t.jsx)(o.Wv,{asChild:!0,children:(0,t.jsxs)(n.$,{id:"date",variant:"outline",className:(0,d.cn)("w-[300px] justify-start text-left font-normal",!s&&"text-muted-foreground"),children:[(0,t.jsx)(i.A,{className:"mr-2 h-4 w-4"}),(null==s?void 0:s.from)?s.to?(0,t.jsxs)(t.Fragment,{children:[(0,r.GP)(s.from,"LLL dd, y",{locale:l.es})," -"," ",(0,r.GP)(s.to,"LLL dd, y",{locale:l.es})]}):(0,r.GP)(s.from,"LLL dd, y",{locale:l.es}):(0,t.jsx)("span",{children:"Seleccione un rango"})]})}),(0,t.jsx)(o.hl,{className:"w-auto p-0",align:"start",children:(0,t.jsx)(c.V,{initialFocus:!0,mode:"range",defaultMonth:null==s?void 0:s.from,selected:s,onSelect:u,numberOfMonths:2,locale:l.es})})]})})}},87270:(e,a,s)=>{"use strict";s.d(a,{A0:()=>d,BF:()=>n,Hj:()=>c,XI:()=>i,nA:()=>u,nd:()=>o});var t=s(95155),r=s(12115),l=s(64269);let i=r.forwardRef((e,a)=>{let{className:s,...r}=e;return(0,t.jsx)("div",{className:"relative w-full overflow-auto",children:(0,t.jsx)("table",{ref:a,className:(0,l.cn)("w-full caption-bottom text-sm",s),...r})})});i.displayName="Table";let d=r.forwardRef((e,a)=>{let{className:s,...r}=e;return(0,t.jsx)("thead",{ref:a,className:(0,l.cn)("[&_tr]:border-b",s),...r})});d.displayName="TableHeader";let n=r.forwardRef((e,a)=>{let{className:s,...r}=e;return(0,t.jsx)("tbody",{ref:a,className:(0,l.cn)("[&_tr:last-child]:border-0",s),...r})});n.displayName="TableBody",r.forwardRef((e,a)=>{let{className:s,...r}=e;return(0,t.jsx)("tfoot",{ref:a,className:(0,l.cn)("border-t bg-muted/50 font-medium [&>tr]:last:border-b-0",s),...r})}).displayName="TableFooter";let c=r.forwardRef((e,a)=>{let{className:s,...r}=e;return(0,t.jsx)("tr",{ref:a,className:(0,l.cn)("border-b transition-colors hover:bg-muted/50 data-[state=selected]:bg-muted",s),...r})});c.displayName="TableRow";let o=r.forwardRef((e,a)=>{let{className:s,...r}=e;return(0,t.jsx)("th",{ref:a,className:(0,l.cn)("h-12 px-4 text-left align-middle font-medium text-muted-foreground [&:has([role=checkbox])]:pr-0",s),...r})});o.displayName="TableHead";let u=r.forwardRef((e,a)=>{let{className:s,...r}=e;return(0,t.jsx)("td",{ref:a,className:(0,l.cn)("p-4 align-middle [&:has([role=checkbox])]:pr-0",s),...r})});u.displayName="TableCell",r.forwardRef((e,a)=>{let{className:s,...r}=e;return(0,t.jsx)("caption",{ref:a,className:(0,l.cn)("mt-4 text-sm text-muted-foreground",s),...r})}).displayName="TableCaption"},98053:(e,a,s)=>{"use strict";s.d(a,{$v:()=>f,EO:()=>m,Lt:()=>n,Rx:()=>j,Zr:()=>v,ck:()=>h,r7:()=>p,tv:()=>c,wd:()=>x});var t=s(95155),r=s(12115),l=s(35646),i=s(64269),d=s(3998);let n=l.bL,c=l.l9,o=l.ZL,u=r.forwardRef((e,a)=>{let{className:s,...r}=e;return(0,t.jsx)(l.hJ,{className:(0,i.cn)("fixed inset-0 z-50 bg-black/80  data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0",s),...r,ref:a})});u.displayName=l.hJ.displayName;let m=r.forwardRef((e,a)=>{let{className:s,...r}=e;return(0,t.jsxs)(o,{children:[(0,t.jsx)(u,{}),(0,t.jsx)(l.UC,{ref:a,className:(0,i.cn)("fixed left-[50%] top-[50%] z-50 grid w-full max-w-lg translate-x-[-50%] translate-y-[-50%] gap-4 border bg-background p-6 shadow-lg duration-200 data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0 data-[state=closed]:zoom-out-95 data-[state=open]:zoom-in-95 data-[state=closed]:slide-out-to-left-1/2 data-[state=closed]:slide-out-to-top-[48%] data-[state=open]:slide-in-from-left-1/2 data-[state=open]:slide-in-from-top-[48%] sm:rounded-lg",s),...r})]})});m.displayName=l.UC.displayName;let x=e=>{let{className:a,...s}=e;return(0,t.jsx)("div",{className:(0,i.cn)("flex flex-col space-y-2 text-center sm:text-left",a),...s})};x.displayName="AlertDialogHeader";let h=e=>{let{className:a,...s}=e;return(0,t.jsx)("div",{className:(0,i.cn)("flex flex-col-reverse sm:flex-row sm:justify-end sm:space-x-2",a),...s})};h.displayName="AlertDialogFooter";let p=r.forwardRef((e,a)=>{let{className:s,...r}=e;return(0,t.jsx)(l.hE,{ref:a,className:(0,i.cn)("text-lg font-semibold",s),...r})});p.displayName=l.hE.displayName;let f=r.forwardRef((e,a)=>{let{className:s,...r}=e;return(0,t.jsx)(l.VY,{ref:a,className:(0,i.cn)("text-sm text-muted-foreground",s),...r})});f.displayName=l.VY.displayName;let j=r.forwardRef((e,a)=>{let{className:s,...r}=e;return(0,t.jsx)(l.rc,{ref:a,className:(0,i.cn)((0,d.r)(),s),...r})});j.displayName=l.rc.displayName;let v=r.forwardRef((e,a)=>{let{className:s,...r}=e;return(0,t.jsx)(l.ZD,{ref:a,className:(0,i.cn)((0,d.r)({variant:"outline"}),"mt-2 sm:mt-0",s),...r})});v.displayName=l.ZD.displayName}},e=>{e.O(0,[2992,7138,4865,9255,3744,5282,6505,5679,5479,5171,8441,1255,7358],()=>e(e.s=60473)),_N_E=e.O()}]);