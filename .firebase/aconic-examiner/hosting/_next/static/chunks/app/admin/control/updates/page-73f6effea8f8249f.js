(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[6413],{13406:(e,a,s)=>{"use strict";s.d(a,{Xi:()=>l,av:()=>c,j7:()=>d,tU:()=>n});var t=s(95155),r=s(12115),o=s(25667),i=s(64269);let n=o.bL,d=r.forwardRef((e,a)=>{let{className:s,...r}=e;return(0,t.jsx)(o.B8,{ref:a,className:(0,i.cn)("inline-flex h-10 items-center justify-center rounded-md bg-muted p-1 text-muted-foreground",s),...r})});d.displayName=o.B8.displayName;let l=r.forwardRef((e,a)=>{let{className:s,...r}=e;return(0,t.jsx)(o.l9,{ref:a,className:(0,i.cn)("inline-flex items-center justify-center whitespace-nowrap rounded-sm px-3 py-1.5 text-sm font-medium ring-offset-background transition-all focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2 disabled:pointer-events-none disabled:opacity-50 data-[state=active]:bg-background data-[state=active]:text-foreground data-[state=active]:shadow-sm",s),...r})});l.displayName=o.l9.displayName;let c=r.forwardRef((e,a)=>{let{className:s,...r}=e;return(0,t.jsx)(o.UC,{ref:a,className:(0,i.cn)("mt-2 ring-offset-background focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2",s),...r})});c.displayName=o.UC.displayName},25667:(e,a,s)=>{"use strict";s.d(a,{B8:()=>E,UC:()=>G,bL:()=>S,l9:()=>M});var t=s(12115),r=s(92556),o=s(3468),i=s(72431),n=s(76842),d=s(97602),l=s(66218),c=s(23558),u=s(68946),f=s(95155),h="Tabs",[m,g]=(0,o.A)(h,[i.RG]),p=(0,i.RG)(),[j,x]=m(h),b=t.forwardRef((e,a)=>{let{__scopeTabs:s,value:t,onValueChange:r,defaultValue:o,orientation:i="horizontal",dir:n,activationMode:h="automatic",...m}=e,g=(0,l.jH)(n),[p,x]=(0,c.i)({prop:t,onChange:r,defaultProp:o});return(0,f.jsx)(j,{scope:s,baseId:(0,u.B)(),value:p,onValueChange:x,orientation:i,dir:g,activationMode:h,children:(0,f.jsx)(d.sG.div,{dir:g,"data-orientation":i,...m,ref:a})})});b.displayName=h;var v="TabsList",A=t.forwardRef((e,a)=>{let{__scopeTabs:s,loop:t=!0,...r}=e,o=x(v,s),n=p(s);return(0,f.jsx)(i.bL,{asChild:!0,...n,orientation:o.orientation,dir:o.dir,loop:t,children:(0,f.jsx)(d.sG.div,{role:"tablist","aria-orientation":o.orientation,...r,ref:a})})});A.displayName=v;var w="TabsTrigger",y=t.forwardRef((e,a)=>{let{__scopeTabs:s,value:t,disabled:o=!1,...n}=e,l=x(w,s),c=p(s),u=k(l.baseId,t),h=T(l.baseId,t),m=t===l.value;return(0,f.jsx)(i.q7,{asChild:!0,...c,focusable:!o,active:m,children:(0,f.jsx)(d.sG.button,{type:"button",role:"tab","aria-selected":m,"aria-controls":h,"data-state":m?"active":"inactive","data-disabled":o?"":void 0,disabled:o,id:u,...n,ref:a,onMouseDown:(0,r.m)(e.onMouseDown,e=>{o||0!==e.button||!1!==e.ctrlKey?e.preventDefault():l.onValueChange(t)}),onKeyDown:(0,r.m)(e.onKeyDown,e=>{[" ","Enter"].includes(e.key)&&l.onValueChange(t)}),onFocus:(0,r.m)(e.onFocus,()=>{let e="manual"!==l.activationMode;m||o||!e||l.onValueChange(t)})})})});y.displayName=w;var N="TabsContent",C=t.forwardRef((e,a)=>{let{__scopeTabs:s,value:r,forceMount:o,children:i,...l}=e,c=x(N,s),u=k(c.baseId,r),h=T(c.baseId,r),m=r===c.value,g=t.useRef(m);return t.useEffect(()=>{let e=requestAnimationFrame(()=>g.current=!1);return()=>cancelAnimationFrame(e)},[]),(0,f.jsx)(n.C,{present:o||m,children:s=>{let{present:t}=s;return(0,f.jsx)(d.sG.div,{"data-state":m?"active":"inactive","data-orientation":c.orientation,role:"tabpanel","aria-labelledby":u,hidden:!t,id:h,tabIndex:0,...l,ref:a,style:{...e.style,animationDuration:g.current?"0s":void 0},children:t&&i})}})});function k(e,a){return"".concat(e,"-trigger-").concat(a)}function T(e,a){return"".concat(e,"-content-").concat(a)}C.displayName=N;var S=b,E=A,M=y,G=C},36204:(e,a,s)=>{"use strict";s.d(a,{A:()=>t});let t=(0,s(14294).A)("ArrowLeft",[["path",{d:"m12 19-7-7 7-7",key:"1l729n"}],["path",{d:"M19 12H5",key:"x3x0zl"}]])},59652:(e,a,s)=>{"use strict";s.r(a),s.d(a,{default:()=>A});var t=s(95155),r=s(12115),o=s(54901),i=s(35434),n=s(86948),d=s(92033),l=s(18844),c=s(36204),u=s(14585),f=s(19708),h=s(15894),m=s(3998),g=s(52619),p=s.n(g),j=s(13406);function x(){let{toast:e}=(0,h.dj)(),[a,s]=(0,r.useState)({casesWithDate:0,worksheetsToUpdate:0}),[o,i]=(0,r.useState)(!0),[c,g]=(0,r.useState)(!1),p=(0,r.useCallback)(async()=>{i(!0);try{let e=(0,f.P)((0,f.rJ)(u.db,"AforoCases"),(0,f._M)("entregadoAforoAt","!=",null)),a=(await (0,f.GG)(e)).docs.map(e=>({id:e.id,...e.data()})),t=0;for(let e of a)if(e.worksheetId){let a=(0,f.H9)(u.db,"worksheets",e.worksheetId),s=await (0,f.x7)(a);s.exists()&&!s.data().entregadoAforoAt&&t++}s({casesWithDate:a.length,worksheetsToUpdate:t})}catch(a){console.error("Error fetching entregadoAforoAt stats:",a),e({title:"Error",description:"No se pudieron cargar las estad\xedsticas de migraci\xf3n.",variant:"destructive"})}finally{i(!1)}},[e]);(0,r.useEffect)(()=>{p()},[p]);let j=async()=>{g(!0),e({title:"Migraci\xf3n iniciada",description:'Transfiriendo fechas de "Entregado a Aforo". Esto puede tardar unos minutos...'});try{let a=(0,f.P)((0,f.rJ)(u.db,"AforoCases"),(0,f._M)("entregadoAforoAt","!=",null)),s=(await (0,f.GG)(a)).docs.map(e=>e.data()),t=0,r=(0,f.wP)(u.db);for(let e of s)if(e.worksheetId&&e.entregadoAforoAt){let a=(0,f.H9)(u.db,"worksheets",e.worksheetId),s=await (0,f.x7)(a);s.exists()&&!s.data().entregadoAforoAt&&(r.update(a,{entregadoAforoAt:e.entregadoAforoAt}),t++)}t>0?(await r.commit(),e({title:"Migraci\xf3n Completa",description:"".concat(t,' fechas de "Entregado a Aforo" han sido transferidas.')})):e({title:"Sin cambios necesarios",description:"Todos los datos de fecha de entrega ya est\xe1n sincronizados."})}catch(a){console.error("Error during entregadoAforoAt migration:",a),e({title:"Error en Migraci\xf3n",description:"Ocurri\xf3 un error al migrar las fechas.",variant:"destructive"})}finally{g(!1),p()}};return(0,t.jsxs)(n.Zp,{children:[(0,t.jsxs)(n.aR,{children:[(0,t.jsx)(n.ZB,{children:'Migrador de Fechas "Entregado a Aforo"'}),(0,t.jsx)(n.BT,{children:"Esta herramienta transfiere la fecha `entregadoAforoAt` desde `AforoCases` a los documentos `Worksheet` correspondientes."})]}),(0,t.jsxs)(n.Wu,{className:"space-y-4",children:[o?(0,t.jsxs)("div",{className:"flex items-center gap-2 text-muted-foreground",children:[(0,t.jsx)(d.A,{className:"h-4 w-4 animate-spin"}),"Cargando estad\xedsticas..."]}):(0,t.jsxs)("div",{className:"p-4 bg-muted/50 rounded-lg border",children:[(0,t.jsxs)("p",{children:["Casos con fecha de entrega: ",(0,t.jsx)("span",{className:"font-bold",children:a.casesWithDate})]}),(0,t.jsxs)("p",{children:["Hojas de trabajo a actualizar: ",(0,t.jsx)("span",{className:"font-bold text-amber-600",children:a.worksheetsToUpdate})]})]}),(0,t.jsxs)(m.$,{onClick:j,disabled:o||c||0===a.worksheetsToUpdate,children:[c?(0,t.jsx)(d.A,{className:"mr-2 h-4 w-4 animate-spin"}):(0,t.jsx)(l.A,{className:"mr-2 h-4 w-4"}),c?"Migrando Fechas...":"Ejecutar Migraci\xf3n de Fechas"]})]})]})}function b(){let{toast:e}=(0,h.dj)(),[a,s]=(0,r.useState)({total:0,missingType:0}),[o,i]=(0,r.useState)(!0),[c,g]=(0,r.useState)(!1),p=(0,r.useCallback)(async()=>{i(!0);try{let e=(0,f.P)((0,f.rJ)(u.db,"AforoCases")),a=(await (0,f.GG)(e)).docs.map(e=>e.data()),t=a.filter(e=>!e.worksheetType).length;s({total:a.length,missingType:t})}catch(a){e({title:"Error",description:"No se pudieron cargar las estad\xedsticas de casos.",variant:"destructive"})}finally{i(!1)}},[e]);(0,r.useEffect)(()=>{p()},[p]);let j=async()=>{g(!0),e({title:"Sincronizaci\xf3n iniciada",description:"Buscando y actualizando casos. Esto puede tardar unos minutos..."});try{let a=(await (0,f.GG)((0,f.rJ)(u.db,"AforoCases"))).docs.filter(e=>!e.data().worksheetType);if(0===a.length){e({title:"Todo al d\xeda",description:"No se encontraron casos para actualizar."}),g(!1),p();return}let s=0,t=(0,f.wP)(u.db);for(let e of a){let a=e.data();if(a.worksheetId){let r=(0,f.H9)(u.db,"worksheets",a.worksheetId),o=await (0,f.x7)(r);o.exists()&&o.data().worksheetType&&(t.update(e.ref,{worksheetType:o.data().worksheetType}),s++)}}s>0?(await t.commit(),e({title:"Sincronizaci\xf3n Completa",description:"".concat(s," casos han sido actualizados con su tipo de hoja de trabajo.")})):e({title:"Sin cambios necesarios",description:"Aunque se encontraron casos sin tipo, no se pudieron asociar a una hoja de trabajo para actualizar."})}catch(a){console.error("Error during sync:",a),e({title:"Error en Sincronizaci\xf3n",description:"Ocurri\xf3 un error al actualizar los casos.",variant:"destructive"})}finally{g(!1),p()}};return(0,t.jsxs)(n.Zp,{children:[(0,t.jsxs)(n.aR,{children:[(0,t.jsx)(n.ZB,{children:"Sincronizador de Tipos de Hoja de Trabajo"}),(0,t.jsx)(n.BT,{children:"Esta herramienta asegura que todos los Casos de Aforo tengan el tipo de hoja de trabajo correcto (Ej: Hoja de Trabajo, Anexo 5)."})]}),(0,t.jsxs)(n.Wu,{className:"space-y-4",children:[o?(0,t.jsxs)("div",{className:"flex items-center gap-2 text-muted-foreground",children:[(0,t.jsx)(d.A,{className:"h-4 w-4 animate-spin"}),"Cargando estad\xedsticas..."]}):(0,t.jsxs)("div",{className:"p-4 bg-muted/50 rounded-lg border",children:[(0,t.jsxs)("p",{children:["Total de Casos de Aforo: ",(0,t.jsx)("span",{className:"font-bold",children:a.total})]}),(0,t.jsxs)("p",{children:["Casos sin tipo de hoja de trabajo: ",(0,t.jsx)("span",{className:"font-bold text-destructive",children:a.missingType})]})]}),(0,t.jsxs)(m.$,{onClick:j,disabled:o||c||0===a.missingType,children:[c?(0,t.jsx)(d.A,{className:"mr-2 h-4 w-4 animate-spin"}):(0,t.jsx)(l.A,{className:"mr-2 h-4 w-4"}),c?"Sincronizando...":"Sincronizar Datos Ahora"]})]})]})}function v(){let{toast:e}=(0,h.dj)(),[a,s]=(0,r.useState)({totalCases:0,casesToMigrate:0}),[o,i]=(0,r.useState)(!0),[c,g]=(0,r.useState)(!1),p=(0,r.useCallback)(async()=>{i(!0);try{let e=(await (0,f.GG)((0,f.P)((0,f.rJ)(u.db,"AforoCases")))).docs.map(e=>({id:e.id,...e.data()})).filter(e=>e.worksheetId),a=0,t=e.map(e=>e.worksheetId).filter(Boolean);if(t.length>0){let e=[];for(let a=0;a<t.length;a+=30){let s=t.slice(a,a+30),r=(0,f.P)((0,f.rJ)(u.db,"worksheets"),(0,f._M)((0,f.Fs)(),"in",s));e.push((0,f.GG)(r))}let s=await Promise.all(e),r=new Set;for(let e of s)for(let a of e.docs)(await (0,f.GG)((0,f.rJ)(u.db,"worksheets/".concat(a.id,"/aforo")))).empty||r.add(a.id);a=t.filter(e=>!r.has(e)).length}s({totalCases:e.length,casesToMigrate:a})}catch(a){console.error("Error fetching migration stats:",a),e({title:"Error",description:"No se pudieron cargar las estad\xedsticas de migraci\xf3n.",variant:"destructive"})}finally{i(!1)}},[e]);(0,r.useEffect)(()=>{p()},[p]);let j=async()=>{g(!0),e({title:"Migraci\xf3n iniciada",description:"Transfiriendo datos de aforo. Esto puede tardar unos minutos..."});try{let r=(0,f.P)((0,f.rJ)(u.db,"AforoCases"),(0,f._M)("worksheetId","!=",null)),o=(await (0,f.GG)(r)).docs.map(e=>({id:e.id,...e.data()})).filter(e=>e.worksheetId),i=0,n=(0,f.wP)(u.db);for(let e of o)if(e.worksheetId){let r=(0,f.H9)(u.db,"worksheets/".concat(e.worksheetId,"/aforo/metadata"));if(!(await (0,f.x7)(r)).exists()){var a,s,t;let o={aforador:e.aforador||null,aforadorAssignedAt:e.assignmentDate||null,aforadorAssignedBy:"Migrado del Sistema",aforadorStatus:e.aforadorStatus||null,aforadorStatusLastUpdate:e.aforadorStatusLastUpdate||null,aforadorComment:e.aforadorComment||null,revisor:e.revisorAsignado||null,revisorAssignedAt:(null==(a=e.revisorAsignadoLastUpdate)?void 0:a.at)||null,revisorAssignedBy:(null==(s=e.revisorAsignadoLastUpdate)?void 0:s.by)||"Migrado del Sistema",revisorStatus:e.revisorStatus||null,revisorStatusLastUpdate:e.revisorStatusLastUpdate||null,digitador:e.digitadorAsignado||null,digitadorAssignedAt:e.digitadorAsignadoAt||null,digitadorAssignedBy:(null==(t=e.digitadorAsignadoLastUpdate)?void 0:t.by)||"Migrado del Sistema",digitadorStatus:e.digitacionStatus||null,digitadorStatusLastUpdate:e.digitacionStatusLastUpdate||null,declaracionAduanera:e.declaracionAduanera||null,entregadoAforoAt:e.entregadoAforoAt||null};n.set(r,o,{merge:!0}),i++}}i>0?(await n.commit(),e({title:"Migraci\xf3n Completa",description:"".concat(i," registros de aforo han sido migrados a sus hojas de trabajo.")})):e({title:"Sin cambios necesarios",description:"Todos los datos de aforo aplicables ya est\xe1n migrados."})}catch(a){console.error("Error during migration:",a),e({title:"Error en Migraci\xf3n",description:"Ocurri\xf3 un error al migrar los datos.",variant:"destructive"})}finally{g(!1),p()}};return(0,t.jsxs)(n.Zp,{children:[(0,t.jsxs)(n.aR,{children:[(0,t.jsx)(n.ZB,{children:"Migrador de Datos de Aforo"}),(0,t.jsx)(n.BT,{children:"Esta herramienta transfiere los datos de asignaci\xf3n (aforador, revisor, digitador), estados y declaraci\xf3n desde los 'Casos de Aforo' a la subcolecci\xf3n correspondiente en 'Hojas de Trabajo'."})]}),(0,t.jsxs)(n.Wu,{className:"space-y-4",children:[o?(0,t.jsxs)("div",{className:"flex items-center gap-2 text-muted-foreground",children:[(0,t.jsx)(d.A,{className:"h-4 w-4 animate-spin"}),"Cargando estad\xedsticas..."]}):(0,t.jsxs)("div",{className:"p-4 bg-muted/50 rounded-lg border",children:[(0,t.jsxs)("p",{children:["Total de Casos de Aforo relevantes: ",(0,t.jsx)("span",{className:"font-bold",children:a.totalCases})]}),(0,t.jsxs)("p",{children:["Casos pendientes de migraci\xf3n: ",(0,t.jsx)("span",{className:"font-bold text-amber-600",children:a.casesToMigrate})]})]}),(0,t.jsxs)(m.$,{onClick:j,disabled:o||c||0===a.casesToMigrate,children:[c?(0,t.jsx)(d.A,{className:"mr-2 h-4 w-4 animate-spin"}):(0,t.jsx)(l.A,{className:"mr-2 h-4 w-4"}),c?"Migrando Datos...":"Ejecutar Migraci\xf3n"]})]})]})}function A(){let{user:e,loading:a}=(0,o.A)();return a||!e||"admin"!==e.role?(0,t.jsx)("div",{className:"min-h-screen flex items-center justify-center",children:(0,t.jsx)(d.A,{className:"h-12 w-12 animate-spin text-primary"})}):(0,t.jsx)(i.G,{children:(0,t.jsxs)("div",{className:"py-2 md:py-5",children:[(0,t.jsx)("div",{className:"mb-4",children:(0,t.jsx)(m.$,{asChild:!0,variant:"outline",children:(0,t.jsxs)(p(),{href:"/admin/control",children:[(0,t.jsx)(c.A,{className:"mr-2 h-4 w-4"})," Volver a Control de Registros"]})})}),(0,t.jsxs)(j.tU,{defaultValue:"sync",children:[(0,t.jsxs)(j.j7,{children:[(0,t.jsx)(j.Xi,{value:"sync",children:"Herramientas de Datos"}),(0,t.jsx)(j.Xi,{value:"stats",disabled:!0,children:"Estad\xedsticas de Actividad (Pr\xf3ximamente)"})]}),(0,t.jsxs)(j.av,{value:"sync",className:"mt-4 grid gap-6",children:[(0,t.jsx)(b,{}),(0,t.jsx)(v,{}),(0,t.jsx)(x,{})]}),(0,t.jsx)(j.av,{value:"stats",className:"mt-4",children:(0,t.jsx)("p",{children:"M\xf3dulo de estad\xedsticas en desarrollo."})})]})]})})}},98564:(e,a,s)=>{Promise.resolve().then(s.bind(s,59652))}},e=>{e.O(0,[2992,7138,4865,9255,3744,5479,5171,8441,1255,7358],()=>e(e.s=98564)),_N_E=e.O()}]);