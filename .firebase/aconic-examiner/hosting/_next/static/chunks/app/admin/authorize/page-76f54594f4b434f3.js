(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[9850],{11186:(e,s,a)=>{"use strict";a.d(s,{bq:()=>m,eb:()=>h,gC:()=>f,l6:()=>c,yv:()=>u});var r=a(95155),t=a(12115),i=a(47887),l=a(59007),d=a(42614),n=a(72251),o=a(64269);let c=i.bL;i.YJ;let u=i.WT,m=t.forwardRef((e,s)=>{let{className:a,children:t,...d}=e;return(0,r.jsxs)(i.l9,{ref:s,className:(0,o.cn)("flex h-10 w-full items-center justify-between rounded-md border border-input bg-background px-3 py-2 text-sm ring-offset-background placeholder:text-muted-foreground focus:outline-none focus:ring-2 focus:ring-ring focus:ring-offset-2 disabled:cursor-not-allowed disabled:opacity-50 [&>span]:line-clamp-1",a),...d,children:[t,(0,r.jsx)(i.In,{asChild:!0,children:(0,r.jsx)(l.A,{className:"h-4 w-4 opacity-50"})})]})});m.displayName=i.l9.displayName;let p=t.forwardRef((e,s)=>{let{className:a,...t}=e;return(0,r.jsx)(i.PP,{ref:s,className:(0,o.cn)("flex cursor-default items-center justify-center py-1",a),...t,children:(0,r.jsx)(d.A,{className:"h-4 w-4"})})});p.displayName=i.PP.displayName;let x=t.forwardRef((e,s)=>{let{className:a,...t}=e;return(0,r.jsx)(i.wn,{ref:s,className:(0,o.cn)("flex cursor-default items-center justify-center py-1",a),...t,children:(0,r.jsx)(l.A,{className:"h-4 w-4"})})});x.displayName=i.wn.displayName;let f=t.forwardRef((e,s)=>{let{className:a,children:t,position:l="popper",...d}=e;return(0,r.jsx)(i.ZL,{children:(0,r.jsxs)(i.UC,{ref:s,className:(0,o.cn)("relative z-50 max-h-96 min-w-[8rem] overflow-hidden rounded-md border bg-popover text-popover-foreground shadow-md data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0 data-[state=closed]:zoom-out-95 data-[state=open]:zoom-in-95 data-[side=bottom]:slide-in-from-top-2 data-[side=left]:slide-in-from-right-2 data-[side=right]:slide-in-from-left-2 data-[side=top]:slide-in-from-bottom-2","popper"===l&&"data-[side=bottom]:translate-y-1 data-[side=left]:-translate-x-1 data-[side=right]:translate-x-1 data-[side=top]:-translate-y-1",a),position:l,...d,children:[(0,r.jsx)(p,{}),(0,r.jsx)(i.LM,{className:(0,o.cn)("p-1","popper"===l&&"h-[var(--radix-select-trigger-height)] w-full min-w-[var(--radix-select-trigger-width)]"),children:t}),(0,r.jsx)(x,{})]})})});f.displayName=i.UC.displayName,t.forwardRef((e,s)=>{let{className:a,...t}=e;return(0,r.jsx)(i.JU,{ref:s,className:(0,o.cn)("py-1.5 pl-8 pr-2 text-sm font-semibold",a),...t})}).displayName=i.JU.displayName;let h=t.forwardRef((e,s)=>{let{className:a,children:t,...l}=e;return(0,r.jsxs)(i.q7,{ref:s,className:(0,o.cn)("relative flex w-full cursor-default select-none items-center rounded-sm py-1.5 pl-8 pr-2 text-sm outline-none focus:bg-accent focus:text-accent-foreground data-[disabled]:pointer-events-none data-[disabled]:opacity-50",a),...l,children:[(0,r.jsx)("span",{className:"absolute left-2 flex h-3.5 w-3.5 items-center justify-center",children:(0,r.jsx)(i.VF,{children:(0,r.jsx)(n.A,{className:"h-4 w-4"})})}),(0,r.jsx)(i.p4,{children:t})]})});h.displayName=i.q7.displayName,t.forwardRef((e,s)=>{let{className:a,...t}=e;return(0,r.jsx)(i.wv,{ref:s,className:(0,o.cn)("-mx-1 my-1 h-px bg-muted",a),...t})}).displayName=i.wv.displayName},33331:(e,s,a)=>{Promise.resolve().then(a.bind(a,92901))},41052:(e,s,a)=>{"use strict";a.d(s,{C5:()=>j,MJ:()=>h,eI:()=>x,lR:()=>f,lV:()=>o,zB:()=>u});var r=a(95155),t=a(12115),i=a(32467),l=a(22544),d=a(64269),n=a(76444);let o=l.Op,c=t.createContext({}),u=e=>{let{...s}=e;return(0,r.jsx)(c.Provider,{value:{name:s.name},children:(0,r.jsx)(l.xI,{...s})})},m=()=>{let e=t.useContext(c),s=t.useContext(p),{getFieldState:a,formState:r}=(0,l.xW)(),i=a(e.name,r);if(!e)throw Error("useFormField should be used within <FormField>");let{id:d}=s;return{id:d,name:e.name,formItemId:"".concat(d,"-form-item"),formDescriptionId:"".concat(d,"-form-item-description"),formMessageId:"".concat(d,"-form-item-message"),...i}},p=t.createContext({}),x=t.forwardRef((e,s)=>{let{className:a,...i}=e,l=t.useId();return(0,r.jsx)(p.Provider,{value:{id:l},children:(0,r.jsx)("div",{ref:s,className:(0,d.cn)("space-y-2",a),...i})})});x.displayName="FormItem";let f=t.forwardRef((e,s)=>{let{className:a,...t}=e,{error:i,formItemId:l}=m();return(0,r.jsx)(n.J,{ref:s,className:(0,d.cn)(i&&"text-destructive",a),htmlFor:l,...t})});f.displayName="FormLabel";let h=t.forwardRef((e,s)=>{let{...a}=e,{error:t,formItemId:l,formDescriptionId:d,formMessageId:n}=m();return(0,r.jsx)(i.DX,{ref:s,id:l,"aria-describedby":t?"".concat(d," ").concat(n):"".concat(d),"aria-invalid":!!t,...a})});h.displayName="FormControl",t.forwardRef((e,s)=>{let{className:a,...t}=e,{formDescriptionId:i}=m();return(0,r.jsx)("p",{ref:s,id:i,className:(0,d.cn)("text-sm text-muted-foreground",a),...t})}).displayName="FormDescription";let j=t.forwardRef((e,s)=>{var a;let{className:t,children:i,...l}=e,{error:n,formMessageId:o}=m(),c=n?String(null!=(a=null==n?void 0:n.message)?a:""):i;return c?(0,r.jsx)("p",{ref:s,id:o,className:(0,d.cn)("text-sm font-medium text-destructive",t),...l,children:c}):null});j.displayName="FormMessage"},44846:(e,s,a)=>{"use strict";a.d(s,{d:()=>d});var r=a(95155),t=a(12115),i=a(27599),l=a(64269);let d=t.forwardRef((e,s)=>{let{className:a,...t}=e;return(0,r.jsx)(i.bL,{className:(0,l.cn)("peer inline-flex h-6 w-11 shrink-0 cursor-pointer items-center rounded-full border-2 border-transparent transition-colors focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2 focus-visible:ring-offset-background disabled:cursor-not-allowed disabled:opacity-50 data-[state=checked]:bg-primary data-[state=unchecked]:bg-input",a),...t,ref:s,children:(0,r.jsx)(i.zi,{className:(0,l.cn)("pointer-events-none block h-5 w-5 rounded-full bg-background shadow-lg ring-0 transition-transform data-[state=checked]:translate-x-5 data-[state=unchecked]:translate-x-0")})})});d.displayName=i.bL.displayName},51834:(e,s,a)=>{"use strict";a.d(s,{Cf:()=>u,Es:()=>p,HM:()=>o,L3:()=>x,c7:()=>m,lG:()=>d,rr:()=>f});var r=a(95155),t=a(12115),i=a(89511),l=a(64269);let d=i.bL;i.l9;let n=i.ZL,o=i.bm,c=t.forwardRef((e,s)=>{let{className:a,...t}=e;return(0,r.jsx)(i.hJ,{ref:s,className:(0,l.cn)("fixed inset-0 z-50 bg-black/80 data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0",a),...t})});c.displayName=i.hJ.displayName;let u=t.forwardRef((e,s)=>{let{className:a,children:t,...d}=e;return(0,r.jsxs)(n,{children:[(0,r.jsx)(c,{}),(0,r.jsxs)(i.UC,{ref:s,className:(0,l.cn)("fixed left-[50%] top-[50%] z-50 grid w-full max-w-lg translate-x-[-50%] translate-y-[-50%] gap-4 border bg-background p-6 shadow-lg duration-200 data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0 data-[state=closed]:zoom-out-95 data-[state=open]:zoom-in-95 data-[state=closed]:slide-out-to-left-1/2 data-[state=closed]:slide-out-to-top-[48%] data-[state=open]:slide-in-from-left-1/2 data-[state=open]:slide-in-from-top-[48%] sm:rounded-lg",a),...d,children:[t,(0,r.jsx)(i.bm,{className:"absolute right-4 top-4 rounded-sm opacity-70 ring-offset-background transition-opacity hover:opacity-100 focus:outline-none focus:ring-2 focus:ring-ring focus:ring-offset-2 disabled:pointer-events-none data-[state=open]:bg-accent data-[state=open]:text-muted-foreground",children:(0,r.jsx)("span",{className:"sr-only",children:"Close"})})]})]})});u.displayName=i.UC.displayName;let m=e=>{let{className:s,...a}=e;return(0,r.jsx)("div",{className:(0,l.cn)("flex flex-col space-y-1.5 text-center sm:text-left",s),...a})};m.displayName="DialogHeader";let p=e=>{let{className:s,...a}=e;return(0,r.jsx)("div",{className:(0,l.cn)("flex flex-col-reverse sm:flex-row sm:justify-end sm:space-x-2",s),...a})};p.displayName="DialogFooter";let x=t.forwardRef((e,s)=>{let{className:a,...t}=e;return(0,r.jsx)(i.hE,{ref:s,className:(0,l.cn)("text-lg font-semibold leading-none tracking-tight",a),...t})});x.displayName=i.hE.displayName;let f=t.forwardRef((e,s)=>{let{className:a,...t}=e;return(0,r.jsx)(i.VY,{ref:s,className:(0,l.cn)("text-sm text-muted-foreground",a),...t})});f.displayName=i.VY.displayName},63817:(e,s,a)=>{"use strict";a.d(s,{G7:()=>o,L$:()=>m,h_:()=>p,oI:()=>c,uB:()=>n,xL:()=>u});var r=a(95155),t=a(12115),i=a(41808),l=a(90109),d=a(64269);a(51834);let n=t.forwardRef((e,s)=>{let{className:a,...t}=e;return(0,r.jsx)(i.uB,{ref:s,className:(0,d.cn)("flex h-full w-full flex-col overflow-hidden rounded-md bg-popover text-popover-foreground",a),...t})});n.displayName=i.uB.displayName;let o=t.forwardRef((e,s)=>{let{className:a,...t}=e;return(0,r.jsxs)("div",{className:"flex items-center border-b px-3","cmdk-input-wrapper":"",children:[(0,r.jsx)(l.A,{className:"mr-2 h-4 w-4 shrink-0 opacity-50"}),(0,r.jsx)(i.uB.Input,{ref:s,className:(0,d.cn)("flex h-11 w-full rounded-md bg-transparent py-3 text-sm outline-none placeholder:text-muted-foreground disabled:cursor-not-allowed disabled:opacity-50",a),...t})]})});o.displayName=i.uB.Input.displayName;let c=t.forwardRef((e,s)=>{let{className:a,...t}=e;return(0,r.jsx)(i.uB.List,{ref:s,className:(0,d.cn)("max-h-[300px] overflow-y-auto overflow-x-hidden",a),...t})});c.displayName=i.uB.List.displayName;let u=t.forwardRef((e,s)=>(0,r.jsx)(i.uB.Empty,{ref:s,className:"py-6 text-center text-sm",...e}));u.displayName=i.uB.Empty.displayName;let m=t.forwardRef((e,s)=>{let{className:a,...t}=e;return(0,r.jsx)(i.uB.Group,{ref:s,className:(0,d.cn)("overflow-hidden p-1 text-foreground [&_[cmdk-group-heading]]:px-2 [&_[cmdk-group-heading]]:py-1.5 [&_[cmdk-group-heading]]:text-xs [&_[cmdk-group-heading]]:font-medium [&_[cmdk-group-heading]]:text-muted-foreground",a),...t})});m.displayName=i.uB.Group.displayName,t.forwardRef((e,s)=>{let{className:a,...t}=e;return(0,r.jsx)(i.uB.Separator,{ref:s,className:(0,d.cn)("-mx-1 h-px bg-border",a),...t})}).displayName=i.uB.Separator.displayName;let p=t.forwardRef((e,s)=>{let{className:a,...t}=e;return(0,r.jsx)(i.uB.Item,{ref:s,className:(0,d.cn)("relative flex cursor-default select-none items-center rounded-sm px-2 py-1.5 text-sm outline-none aria-selected:bg-accent aria-selected:text-accent-foreground data-[disabled='true']:pointer-events-none data-[disabled='true']:opacity-50",a),...t})});p.displayName=i.uB.Item.displayName},65142:(e,s,a)=>{"use strict";a.d(s,{p:()=>l});var r=a(95155),t=a(12115),i=a(64269);let l=t.forwardRef((e,s)=>{let{className:a,type:t,...l}=e;return(0,r.jsx)("input",{type:t,className:(0,i.cn)("flex h-10 w-full rounded-md border border-input bg-background px-3 py-2 text-base ring-offset-background file:border-0 file:bg-transparent file:text-sm file:font-medium file:text-foreground placeholder:text-muted-foreground focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2 disabled:cursor-not-allowed disabled:opacity-50 md:text-sm","aria-[invalid=true]:border-destructive aria-[invalid=true]:ring-destructive",a),ref:s,...l})});l.displayName="Input"},76444:(e,s,a)=>{"use strict";a.d(s,{J:()=>o});var r=a(95155),t=a(12115),i=a(10489),l=a(83101),d=a(64269);let n=(0,l.F)("text-sm font-medium leading-none peer-disabled:cursor-not-allowed peer-disabled:opacity-70"),o=t.forwardRef((e,s)=>{let{className:a,...t}=e;return(0,r.jsx)(i.b,{ref:s,className:(0,d.cn)(n(),a),...t})});o.displayName=i.b.displayName},87270:(e,s,a)=>{"use strict";a.d(s,{A0:()=>d,BF:()=>n,Hj:()=>o,XI:()=>l,nA:()=>u,nd:()=>c});var r=a(95155),t=a(12115),i=a(64269);let l=t.forwardRef((e,s)=>{let{className:a,...t}=e;return(0,r.jsx)("div",{className:"relative w-full overflow-auto",children:(0,r.jsx)("table",{ref:s,className:(0,i.cn)("w-full caption-bottom text-sm",a),...t})})});l.displayName="Table";let d=t.forwardRef((e,s)=>{let{className:a,...t}=e;return(0,r.jsx)("thead",{ref:s,className:(0,i.cn)("[&_tr]:border-b",a),...t})});d.displayName="TableHeader";let n=t.forwardRef((e,s)=>{let{className:a,...t}=e;return(0,r.jsx)("tbody",{ref:s,className:(0,i.cn)("[&_tr:last-child]:border-0",a),...t})});n.displayName="TableBody",t.forwardRef((e,s)=>{let{className:a,...t}=e;return(0,r.jsx)("tfoot",{ref:s,className:(0,i.cn)("border-t bg-muted/50 font-medium [&>tr]:last:border-b-0",a),...t})}).displayName="TableFooter";let o=t.forwardRef((e,s)=>{let{className:a,...t}=e;return(0,r.jsx)("tr",{ref:s,className:(0,i.cn)("border-b transition-colors hover:bg-muted/50 data-[state=selected]:bg-muted",a),...t})});o.displayName="TableRow";let c=t.forwardRef((e,s)=>{let{className:a,...t}=e;return(0,r.jsx)("th",{ref:s,className:(0,i.cn)("h-12 px-4 text-left align-middle font-medium text-muted-foreground [&:has([role=checkbox])]:pr-0",a),...t})});c.displayName="TableHead";let u=t.forwardRef((e,s)=>{let{className:a,...t}=e;return(0,r.jsx)("td",{ref:s,className:(0,i.cn)("p-4 align-middle [&:has([role=checkbox])]:pr-0",a),...t})});u.displayName="TableCell",t.forwardRef((e,s)=>{let{className:a,...t}=e;return(0,r.jsx)("caption",{ref:s,className:(0,i.cn)("mt-4 text-sm text-muted-foreground",a),...t})}).displayName="TableCaption"},92901:(e,s,a)=>{"use strict";a.r(s),a.d(s,{default:()=>Q});var r=a(95155),t=a(12115),i=a(20063),l=a(54901),d=a(35434),n=a(3998),o=a(86948),c=a(87270),u=a(92033),m=a(19201),p=a(62593),x=a(18527),f=a(6943),h=a(42997),j=a(28068),N=a(14585),g=a(19708),b=a(15894),y=a(11647),v=a(5282),w=a(80160),A=a(65142),C=a(11186),R=a(44846),k=a(54299),E=a(88964),G=a(51834),S=a(63817),z=a(27314),U=a(13630),L=a(17037);function B(e){let{isOpen:s,onClose:a,allUsers:i,onGroupUpdated:d,currentUser:o}=e,{user:c}=(0,l.A)(),{toast:m}=(0,b.dj)(),[p,x]=(0,t.useState)(!1),[h,j]=(0,t.useState)([]);(0,t.useEffect)(()=>{if(s&&o){var e;let s=(null==(e=o.visibilityGroup)?void 0:e.map(e=>e.uid))||[],a=Array.from(new Set([o.uid,...s]));j(i.filter(e=>a.includes(e.uid)))}else j([])},[s,o,i]);let v=(0,t.useMemo)(()=>{let e=new Set(h.map(e=>e.uid));return i.filter(s=>("ejecutivo"===s.role||"coordinadora"===s.role)&&!e.has(s.uid))},[i,h]),w=async()=>{var e;if(!c||!o)return;x(!0);let s=(0,g.wP)(N.db),r=h.map(e=>e.uid);Array.from(new Set([...r,...(null==(e=o.visibilityGroup)?void 0:e.map(e=>e.uid))||[o.uid]])).forEach(e=>{let a=(0,g.H9)(N.db,"users",e),t=r.includes(e)?r:[];s.update(a,{visibilityGroup:t})});try{await s.commit(),m({title:"Grupo Actualizado",description:"Los cambios en el grupo de ejecutivos han sido guardados."}),d(),a()}catch(e){console.error("Error updating executive group:",e),m({title:"Error",description:"No se pudieron guardar los cambios en el grupo.",variant:"destructive"})}finally{x(!1)}};return s&&o?(0,r.jsx)(G.lG,{open:s,onOpenChange:a,children:(0,r.jsxs)(G.Cf,{className:"max-w-2xl",children:[(0,r.jsxs)(G.c7,{children:[(0,r.jsx)(G.L3,{children:"Gestionar Grupo Ejecutivo"}),(0,r.jsxs)(G.rr,{children:["A\xf1ada o elimine miembros del grupo de visibilidad para ",(0,r.jsx)("span",{className:"font-bold text-foreground",children:o.displayName||o.email}),"."]})]}),(0,r.jsxs)("div",{className:"grid grid-cols-2 gap-6 py-4",children:[(0,r.jsxs)("div",{className:"space-y-2",children:[(0,r.jsx)("h4",{className:"font-medium text-sm",children:"Usuarios Disponibles"}),(0,r.jsxs)(S.uB,{className:"rounded-lg border shadow-sm",children:[(0,r.jsx)(S.G7,{placeholder:"Buscar usuario..."}),(0,r.jsx)(L.F,{className:"h-[250px]",children:(0,r.jsxs)(S.oI,{children:[(0,r.jsx)(S.xL,{children:"No hay m\xe1s usuarios disponibles."}),(0,r.jsx)(S.L$,{children:v.map(e=>(0,r.jsxs)(S.h_,{value:e.displayName||e.email||"",onSelect:()=>{j(s=>[...s,e])},className:"cursor-pointer",children:[(0,r.jsx)(z.A,{className:"mr-2 h-4 w-4"}),(0,r.jsxs)("div",{className:"flex flex-col",children:[(0,r.jsx)("span",{children:e.displayName||e.email}),(0,r.jsx)("span",{className:"text-xs text-muted-foreground",children:e.role})]})]},e.uid))})]})})]})]}),(0,r.jsxs)("div",{className:"space-y-2",children:[(0,r.jsx)("h4",{className:"font-medium text-sm",children:"Miembros del Grupo Actual"}),(0,r.jsx)(L.F,{className:"h-[290px]",children:(0,r.jsx)("div",{className:"rounded-lg border min-h-[280px] p-2 space-y-1",children:h.length>0?h.map(e=>(0,r.jsxs)("div",{className:"flex items-center justify-between p-2 rounded-md hover:bg-accent/50",children:[(0,r.jsxs)("div",{className:"flex items-center gap-2",children:[(0,r.jsx)(f.A,{className:"h-4 w-4 text-muted-foreground"}),(0,r.jsx)("span",{className:"text-sm",children:e.displayName||e.email}),e.uid===o.uid&&(0,r.jsx)(y.E,{variant:"secondary",children:"Principal"})]}),(0,r.jsx)(n.$,{variant:"ghost",size:"icon",className:"h-7 w-7",onClick:()=>(e=>{if(o&&e===o.uid)return void m({title:"Acci\xf3n no permitida",description:"No puede eliminar al usuario principal del grupo.",variant:"destructive"});j(s=>s.filter(s=>s.uid!==e))})(e.uid),disabled:e.uid===o.uid,children:(0,r.jsx)(U.A,{className:"h-4 w-4 text-destructive"})})]},e.uid)):(0,r.jsx)("p",{className:"text-sm text-muted-foreground text-center p-8",children:"A\xf1ada usuarios de la lista de la izquierda."})})})]})]}),(0,r.jsxs)(G.Es,{children:[(0,r.jsx)(n.$,{variant:"outline",onClick:a,children:"Cancelar"}),(0,r.jsxs)(n.$,{onClick:w,disabled:p,children:[p&&(0,r.jsx)(u.A,{className:"mr-2 h-4 w-4 animate-spin"}),"Guardar Cambios"]})]})]})}):null}var I=a(59729),F=a(72251),M=a(64269);function P(e){let{isOpen:s,onClose:a,guestUser:i}=e,{toast:l}=(0,b.dj)(),[d,o]=(0,t.useState)(!1),[c,m]=(0,t.useState)([]),[p,x]=(0,t.useState)([]),[f,h]=(0,t.useState)(new Map),[j,y]=(0,t.useState)(!0),v=(0,t.useCallback)(async()=>{let e=new Set;for(let s of(await (0,g.GG)((0,g.rJ)(N.db,"users"))).docs)(await (0,g.GG)((0,g.rJ)(N.db,"users/".concat(s.id,"/consigneeDirectory")))).forEach(s=>e.add(s.data().name));return Array.from(e).sort()},[]),w=(0,t.useCallback)(()=>{let e=(0,g.rJ)(N.db,"users/".concat(i.uid,"/consigneeDirectory")),s=(0,g.P)(e);return(0,g.aQ)(s,e=>{let s=[],a=new Map;e.forEach(e=>{let r=e.data().name;s.push(r),a.set(r,e.id)}),x(s),h(a)})},[i.uid]);(0,t.useEffect)(()=>{if(s){let e;return y(!0),(async()=>{m(await v());let e=w();return y(!1),e})().then(s=>{e=s}),()=>{e&&e()}}},[s,v,w]);let A=async e=>{o(!0);let s=(0,g.rJ)(N.db,"users/".concat(i.uid,"/consigneeDirectory"));try{if(p.includes(e)){let a=f.get(e);a&&(await (0,g.kd)((0,g.H9)(s,a)),l({title:"Removido",description:"".concat(e," fue removido del directorio.")}))}else await (0,g.gS)(s,{name:e}),l({title:"A\xf1adido",description:"".concat(e," fue a\xf1adido al directorio.")})}catch(e){console.error("Error toggling consignee:",e),l({title:"Error",description:"No se pudo actualizar el directorio.",variant:"destructive"})}finally{o(!1)}};return s?(0,r.jsx)(G.lG,{open:s,onOpenChange:a,children:(0,r.jsxs)(G.Cf,{className:"max-w-md",children:[(0,r.jsxs)(G.c7,{children:[(0,r.jsx)(G.L3,{children:"Gestionar Directorio de Invitado"}),(0,r.jsxs)(G.rr,{children:["Seleccione los consignatarios que ",(0,r.jsx)("span",{className:"font-bold text-foreground",children:i.displayName||i.email})," podr\xe1 ver en la secci\xf3n de permisos."]})]}),(0,r.jsxs)(S.uB,{className:"rounded-lg border shadow-md mt-4",children:[(0,r.jsx)(S.G7,{placeholder:"Buscar consignatario..."}),(0,r.jsx)(L.F,{className:"h-72",children:(0,r.jsx)(S.oI,{children:j?(0,r.jsx)("div",{className:"flex justify-center items-center p-4",children:(0,r.jsx)(u.A,{className:"h-6 w-6 animate-spin"})}):(0,r.jsxs)(r.Fragment,{children:[(0,r.jsx)(S.xL,{children:"No se encontraron consignatarios."}),(0,r.jsx)(S.L$,{children:c.map(e=>{let s=p.includes(e);return(0,r.jsxs)(S.h_,{value:e,onSelect:()=>A(e),className:"flex items-center justify-between cursor-pointer",children:[(0,r.jsxs)("div",{className:"flex items-center gap-2",children:[(0,r.jsx)(I.A,{className:"h-4 w-4 text-muted-foreground"}),(0,r.jsx)("span",{children:e})]}),(0,r.jsx)(F.A,{className:(0,M.cn)("h-4 w-4",s?"opacity-100":"opacity-0")})]},e)})})]})})})]}),(0,r.jsx)(G.Es,{className:"pt-4",children:(0,r.jsx)(n.$,{variant:"outline",onClick:a,children:"Cerrar"})})]})}):null}var J=a(22544),$=a(66942),_=a(15653),D=a(41052),H=a(18274),T=a(39075);let q=_.z.object({displayName:_.z.string().min(1,"El nombre es requerido."),roleTitle:_.z.string().optional(),agentLicense:_.z.string().optional(),cedula:_.z.string().optional()});function O(e){let{isOpen:s,onClose:a,user:i,onUserUpdated:d}=e,{user:o}=(0,l.A)(),{toast:c}=(0,b.dj)(),[m,p]=(0,t.useState)(!1),x=(0,J.mN)({resolver:(0,$.u)(q),defaultValues:{displayName:i.displayName||"",roleTitle:i.roleTitle||"",agentLicense:i.agentLicense||"",cedula:i.cedula||""}}),f=async e=>{if(!o||!i)return;p(!0);let s=(0,g.H9)(N.db,"users",i.uid);try{await (0,g.mZ)(s,{displayName:e.displayName,roleTitle:e.roleTitle,agentLicense:e.agentLicense,cedula:e.cedula}),c({title:"Agente Actualizado",description:"La informaci\xf3n del agente ha sido guardada."}),d(),a()}catch(e){console.error("Error updating agent:",e),c({title:"Error",description:"No se pudo actualizar la informaci\xf3n del agente.",variant:"destructive"})}finally{p(!1)}};return s?(0,r.jsx)(G.lG,{open:s,onOpenChange:a,children:(0,r.jsxs)(G.Cf,{className:"sm:max-w-md",children:[(0,r.jsxs)(G.c7,{children:[(0,r.jsx)(G.L3,{children:"Editar Detalles del Agente"}),(0,r.jsxs)(G.rr,{children:["Modifique la informaci\xf3n para ",i.email,"."]})]}),(0,r.jsx)(D.lV,{...x,children:(0,r.jsxs)("form",{onSubmit:x.handleSubmit(f),className:"space-y-4 py-4",children:[(0,r.jsx)(D.zB,{control:x.control,name:"displayName",render:e=>{let{field:s}=e;return(0,r.jsxs)(D.eI,{children:[(0,r.jsxs)(D.lR,{className:"flex items-center gap-2",children:[(0,r.jsx)(z.A,{})," Nombre Completo"]}),(0,r.jsx)(D.MJ,{children:(0,r.jsx)(A.p,{...s,disabled:m,placeholder:"Nombre y Apellido"})}),(0,r.jsx)(D.C5,{})]})}}),(0,r.jsx)(D.zB,{control:x.control,name:"roleTitle",render:e=>{let{field:s}=e;return(0,r.jsxs)(D.eI,{children:[(0,r.jsxs)(D.lR,{className:"flex items-center gap-2",children:[(0,r.jsx)(H.A,{})," T\xedtulo de Rol"]}),(0,r.jsx)(D.MJ,{children:(0,r.jsx)(A.p,{...s,disabled:m,placeholder:"Ej: Agente Aduanero"})}),(0,r.jsx)(D.C5,{})]})}}),(0,r.jsx)(D.zB,{control:x.control,name:"agentLicense",render:e=>{let{field:s}=e;return(0,r.jsxs)(D.eI,{children:[(0,r.jsxs)(D.lR,{className:"flex items-center gap-2",children:[(0,r.jsx)(H.A,{})," Licencia de Agente"]}),(0,r.jsx)(D.MJ,{children:(0,r.jsx)(A.p,{...s,disabled:m,placeholder:"N\xfamero de licencia"})}),(0,r.jsx)(D.C5,{})]})}}),(0,r.jsx)(D.zB,{control:x.control,name:"cedula",render:e=>{let{field:s}=e;return(0,r.jsxs)(D.eI,{children:[(0,r.jsxs)(D.lR,{className:"flex items-center gap-2",children:[(0,r.jsx)(T.A,{})," C\xe9dula"]}),(0,r.jsx)(D.MJ,{children:(0,r.jsx)(A.p,{...s,disabled:m,placeholder:"N\xfamero de c\xe9dula"})}),(0,r.jsx)(D.C5,{})]})}}),(0,r.jsxs)(G.Es,{className:"pt-4",children:[(0,r.jsx)(n.$,{type:"button",variant:"outline",onClick:a,children:"Cancelar"}),(0,r.jsxs)(n.$,{type:"submit",disabled:m,children:[m&&(0,r.jsx)(u.A,{className:"mr-2 h-4 w-4 animate-spin"}),"Guardar Cambios"]})]})]})})]})}):null}let V=["admin","coordinadora","ejecutivo","gestor","aforador","agente","supervisor","digitador","revisor","calificador","autorevisor","autorevisor_plus","invitado","facturador"];function Z(e){let{initialUsers:s}=e,{user:a}=(0,l.A)(),{toast:i}=(0,b.dj)(),[d,o]=(0,t.useState)(s),[m,p]=(0,t.useState)({}),[x,h]=(0,t.useState)(""),[j,y]=(0,t.useState)(null),[v,w]=(0,t.useState)(null),[G,S]=(0,t.useState)(null),z=(0,t.useCallback)(async(e,s,r)=>{if(!a||"admin"!==a.role)return void i({title:"Acci\xf3n no permitida",variant:"destructive"});if(e===a.uid&&("role"===s||"hasReportsAccess"===s||"hasPaymentAccess"===s))return void i({title:"Acci\xf3n no permitida",description:"No puede modificar sus propios permisos.",variant:"destructive"});p(s=>({...s,[e]:!0}));let t=(0,g.H9)(N.db,"users",e);try{await (0,g.mZ)(t,{[s]:r}),o(a=>a.map(a=>a.uid===e?{...a,[s]:r}:a)),i({title:"Usuario Actualizado",description:"El campo ".concat(String(s)," ha sido modificado.")})}catch(e){console.error("Error updating user:",e),i({title:"Error",description:"No se pudo actualizar el usuario.",variant:"destructive"})}finally{p(s=>({...s,[e]:!1}))}},[a,i]),U=async()=>{let e=(0,g.P)((0,g.rJ)(N.db,"users"));o((await (0,g.GG)(e)).docs.map(e=>({uid:e.id,...e.data()})))},L=d.filter(e=>{var s,a;return(null==(s=e.email)?void 0:s.toLowerCase().includes(x.toLowerCase()))||(null==(a=e.displayName)?void 0:a.toLowerCase().includes(x.toLowerCase()))}).sort((e,s)=>(e.displayName||e.email||"").localeCompare(s.displayName||s.email||""));return(0,r.jsxs)("div",{className:"space-y-4",children:[(0,r.jsx)(A.p,{placeholder:"Filtrar por nombre o email...",value:x,onChange:e=>h(e.target.value),className:"max-w-sm"}),(0,r.jsx)("div",{className:"overflow-x-auto table-container rounded-lg border",children:(0,r.jsxs)(c.XI,{children:[(0,r.jsx)(c.A0,{children:(0,r.jsxs)(c.Hj,{children:[(0,r.jsx)(c.nd,{children:"Email"}),(0,r.jsx)(c.nd,{children:"Nombre"}),(0,r.jsx)(c.nd,{children:"Rol"}),(0,r.jsx)(c.nd,{children:"Acceso Reportes"}),(0,r.jsx)(c.nd,{children:"Acceso Pagos"}),(0,r.jsx)(c.nd,{children:"Acciones de Rol"})]})}),(0,r.jsx)(c.BF,{children:L.map(e=>(0,r.jsxs)(c.Hj,{className:m[e.uid]?"bg-amber-100":"",children:[(0,r.jsx)(c.nA,{className:"font-medium",children:e.email}),(0,r.jsx)(c.nA,{children:e.displayName||"N/A"}),(0,r.jsx)(c.nA,{children:(0,r.jsxs)(C.l6,{value:e.role||"",onValueChange:s=>z(e.uid,"role",s),disabled:m[e.uid],children:[(0,r.jsx)(C.bq,{className:"w-[180px]",children:(0,r.jsx)(C.yv,{placeholder:"Seleccionar rol..."})}),(0,r.jsx)(C.gC,{children:V.map(e=>(0,r.jsx)(C.eb,{value:e,children:e},e))})]})}),(0,r.jsx)(c.nA,{children:(0,r.jsxs)("div",{className:"flex items-center gap-2",children:[(0,r.jsx)(R.d,{checked:e.hasReportsAccess||!1,onCheckedChange:s=>z(e.uid,"hasReportsAccess",s),disabled:m[e.uid]}),m[e.uid]&&(0,r.jsx)(u.A,{className:"h-4 w-4 animate-spin"})]})}),(0,r.jsx)(c.nA,{children:(0,r.jsxs)("div",{className:"flex items-center gap-2",children:[(0,r.jsx)(R.d,{checked:e.hasPaymentAccess||!1,onCheckedChange:s=>z(e.uid,"hasPaymentAccess",s),disabled:m[e.uid]}),m[e.uid]&&(0,r.jsx)(u.A,{className:"h-4 w-4 animate-spin"})]})}),(0,r.jsxs)(c.nA,{children:["ejecutivo"===e.role&&(0,r.jsxs)(n.$,{variant:"outline",size:"sm",onClick:()=>y(e),children:[(0,r.jsx)(f.A,{className:"mr-2 h-4 w-4"})," Grupo"]}),"invitado"===e.role&&(0,r.jsxs)(n.$,{variant:"outline",size:"sm",onClick:()=>w(e),children:[(0,r.jsx)(k.A,{className:"mr-2 h-4 w-4"})," Directorio"]}),(0,r.jsxs)(n.$,{variant:"outline",size:"sm",onClick:()=>S(e),className:"ml-2",children:[(0,r.jsx)(E.A,{className:"mr-2 h-4 w-4"})," Editar"]})]})]},e.uid))})]})}),j&&(0,r.jsx)(B,{isOpen:!!j,onClose:()=>y(null),allUsers:d,onGroupUpdated:U,currentUser:j}),v&&(0,r.jsx)(P,{isOpen:!!v,onClose:()=>w(null),guestUser:v}),G&&(0,r.jsx)(O,{isOpen:!!G,onClose:()=>S(null),user:G,onUserUpdated:U})]})}var X=a(47974);let W=_.z.object({uid:_.z.string().min(1,"El UID es requerido."),email:_.z.string().email("Debe ser un correo electr\xf3nico v\xe1lido.")});function Y(e){let{isOpen:s,onClose:a,onUserAdded:i}=e,{user:d}=(0,l.A)(),{toast:o}=(0,b.dj)(),[c,m]=(0,t.useState)(!1),p=(0,J.mN)({resolver:(0,$.u)(W),defaultValues:{uid:"",email:""}}),x=async e=>{if(!d)return;m(!0);let s=(0,g.H9)(N.db,"users",e.uid);try{if((await (0,g.x7)(s)).exists()){o({title:"Usuario ya existe",description:"Un usuario con este UID ya est\xe1 en la base de datos.",variant:"destructive"}),m(!1);return}await (0,g.BN)(s,{email:e.email,role:"gestor",hasReportsAccess:!1,hasPaymentAccess:!1,createdAt:(0,g.O5)()}),o({title:"Usuario A\xf1adido",description:"El usuario ".concat(e.email," ha sido a\xf1adido al sistema.")}),i(),a(),p.reset()}catch(e){console.error("Error adding user:",e),o({title:"Error",description:"No se pudo a\xf1adir el usuario a la base de datos.",variant:"destructive"})}finally{m(!1)}};return s?(0,r.jsx)(G.lG,{open:s,onOpenChange:a,children:(0,r.jsxs)(G.Cf,{className:"sm:max-w-md",children:[(0,r.jsxs)(G.c7,{children:[(0,r.jsx)(G.L3,{children:"A\xf1adir Nuevo Usuario"}),(0,r.jsx)(G.rr,{children:"A\xf1ada un usuario previamente creado en Firebase Authentication a la base de datos de la aplicaci\xf3n."})]}),(0,r.jsx)(D.lV,{...p,children:(0,r.jsxs)("form",{onSubmit:p.handleSubmit(x),className:"space-y-4 py-4",children:[(0,r.jsx)(D.zB,{control:p.control,name:"uid",render:e=>{let{field:s}=e;return(0,r.jsxs)(D.eI,{children:[(0,r.jsxs)(D.lR,{className:"flex items-center gap-2",children:[(0,r.jsx)(T.A,{})," UID del Usuario"]}),(0,r.jsx)(D.MJ,{children:(0,r.jsx)(A.p,{...s,disabled:c,placeholder:"UID de Firebase Auth"})}),(0,r.jsx)(D.C5,{})]})}}),(0,r.jsx)(D.zB,{control:p.control,name:"email",render:e=>{let{field:s}=e;return(0,r.jsxs)(D.eI,{children:[(0,r.jsxs)(D.lR,{className:"flex items-center gap-2",children:[(0,r.jsx)(X.A,{})," Correo Electr\xf3nico"]}),(0,r.jsx)(D.MJ,{children:(0,r.jsx)(A.p,{...s,disabled:c,placeholder:"usuario@ejemplo.com"})}),(0,r.jsx)(D.C5,{})]})}}),(0,r.jsxs)(G.Es,{className:"pt-4",children:[(0,r.jsx)(n.$,{type:"button",variant:"outline",onClick:a,children:"Cancelar"}),(0,r.jsxs)(n.$,{type:"submit",disabled:c,children:[c&&(0,r.jsx)(u.A,{className:"mr-2 h-4 w-4 animate-spin"}),"A\xf1adir Usuario"]})]})]})})]})}):null}function Q(){let{user:e,loading:s}=(0,l.A)(),a=(0,i.useRouter)(),{toast:A}=(0,b.dj)(),[C,R]=(0,t.useState)([]),[k,E]=(0,t.useState)([]),[G,S]=(0,t.useState)(!0),[z,U]=(0,t.useState)("pending"),[L,B]=(0,t.useState)(!1),[I,F]=(0,t.useState)(!1),M=async e=>{let s=[...e];if(0===s.filter(e=>e.visibilityGroup&&e.visibilityGroup.length>0).map(e=>e.uid).length)return e;let a=new Set;s.forEach(e=>{var s;null==(s=e.visibilityGroup)||s.forEach(e=>a.add(e))});let r=(0,g.P)((0,g.rJ)(N.db,"users"),(0,g._M)((0,g.Fs)(),"in",Array.from(a))),t=new Map((await (0,g.GG)(r)).docs.map(e=>[e.id,e.data()]));return s.map(e=>e.visibilityGroup&&e.visibilityGroup.length>0?{...e,visibilityGroup:e.visibilityGroup.map(e=>{let s=t.get(e);return s?{uid:e,displayName:s.displayName,email:s.email}:null}).filter(e=>null!==e)}:e)},P=(0,t.useCallback)(async function(){let e=arguments.length>0&&void 0!==arguments[0]&&arguments[0];S(!0);try{if("allUsers"===z||e){let e=(0,g.P)((0,g.rJ)(N.db,"users")),s=(await (0,g.GG)(e)).docs.map(e=>({uid:e.id,...e.data()})),a=await M(s);E(a)}if("allUsers"!==z){let e="pending"===z?(0,g._M)("status","==","pending"):(0,g._M)("status","in",["approved","denied"]),s=(0,g.P)((0,g.rJ)(N.db,"reportAccessRequests"),e),a=(await (0,g.GG)(s)).docs.map(e=>({id:e.id,...e.data()}));a.sort((e,s)=>{var a,r,t,i;return(null!=(t=null==(a=s.requestedAt)?void 0:a.toMillis())?t:0)-(null!=(i=null==(r=e.requestedAt)?void 0:r.toMillis())?i:0)}),R(a)}}catch(e){console.error("Error fetching data:",e),A({title:"Error",description:"No se pudieron cargar los datos.",variant:"destructive"})}finally{S(!1)}},[A,z]);(0,t.useEffect)(()=>{s||(e&&"admin"===e.role?P():a.push("/"))},[e,s,a,P]);let J=async(e,s)=>{try{if("approved"===s){let s=(0,g.H9)(N.db,"users",e);await (0,g.mZ)(s,{hasReportsAccess:!0})}let a=(0,g.H9)(N.db,"reportAccessRequests",e);await (0,g.mZ)(a,{status:s,processedAt:(0,g.O5)()}),A({title:"Solicitud Procesada",description:"El acceso ha sido ".concat("approved"===s?"aprobado":"denegado",".")}),P()}catch(e){console.error("Error processing request:",e),A({title:"Error",description:"No se pudo procesar la solicitud.",variant:"destructive"})}},$=e=>e?(0,v.GP)(e.toDate(),"dd/MM/yy HH:mm",{locale:w.es}):"N/A";return s||!e?(0,r.jsx)("div",{className:"min-h-screen flex items-center justify-center bg-background",children:(0,r.jsx)(u.A,{className:"h-12 w-12 animate-spin text-primary"})}):(0,r.jsxs)(r.Fragment,{children:[(0,r.jsx)(d.G,{children:(0,r.jsx)("div",{className:"py-2 md:py-5",children:(0,r.jsxs)(o.Zp,{className:"w-full max-w-6xl mx-auto custom-shadow",children:[(0,r.jsxs)(o.aR,{children:[(0,r.jsxs)(o.ZB,{className:"text-2xl font-semibold text-foreground flex items-center gap-2",children:[(0,r.jsx)(m.A,{})," Autorizaciones y Usuarios"]}),(0,r.jsx)(o.BT,{className:"text-muted-foreground",children:"Gestione las solicitudes de acceso y los roles de los usuarios del sistema."})]}),(0,r.jsxs)(o.Wu,{children:[(0,r.jsxs)("div",{className:"flex flex-wrap gap-2 mb-4",children:[(0,r.jsxs)(n.$,{variant:"pending"===z?"secondary":"ghost",onClick:()=>U("pending"),children:[(0,r.jsx)(p.A,{className:"mr-2 h-4 w-4"})," Solicitudes Pendientes"]}),(0,r.jsxs)(n.$,{variant:"processed"===z?"secondary":"ghost",onClick:()=>U("processed"),children:[(0,r.jsx)(x.A,{className:"mr-2 h-4 w-4"})," Solicitudes Procesadas"]}),(0,r.jsxs)(n.$,{variant:"allUsers"===z?"secondary":"ghost",onClick:()=>U("allUsers"),children:[(0,r.jsx)(f.A,{className:"mr-2 h-4 w-4"})," Gestionar Usuarios"]}),(0,r.jsxs)(n.$,{variant:"outline",onClick:()=>F(!0),children:[(0,r.jsx)(h.A,{className:"mr-2 h-4 w-4"})," A\xf1adir Usuario"]})]}),G?(0,r.jsx)("div",{className:"flex justify-center items-center py-10",children:(0,r.jsx)(u.A,{className:"h-8 w-8 animate-spin text-primary"})}):"allUsers"===z?(0,r.jsx)(Z,{initialUsers:k}):0===C.length?(0,r.jsxs)("div",{className:"text-center text-muted-foreground py-10",children:["No hay solicitudes ","pending"===z?"pendientes":"procesadas","."]}):(0,r.jsx)("div",{className:"overflow-x-auto table-container rounded-lg border",children:(0,r.jsxs)(c.XI,{children:[(0,r.jsx)(c.A0,{children:(0,r.jsxs)(c.Hj,{children:[(0,r.jsx)(c.nd,{children:"Email del Usuario"}),(0,r.jsx)(c.nd,{children:"Fecha de Solicitud"}),(0,r.jsx)(c.nd,{children:"Estado"}),(0,r.jsx)(c.nd,{className:"text-right",children:"Acciones"})]})}),(0,r.jsx)(c.BF,{children:C.map(e=>(0,r.jsxs)(c.Hj,{children:[(0,r.jsx)(c.nA,{className:"font-medium",children:e.userEmail}),(0,r.jsx)(c.nA,{children:$(e.requestedAt)}),(0,r.jsx)(c.nA,{children:(0,r.jsx)(y.E,{variant:"approved"===e.status?"default":"denied"===e.status?"destructive":"secondary",children:e.status})}),(0,r.jsx)(c.nA,{className:"text-right space-x-2",children:"pending"===e.status?(0,r.jsxs)(r.Fragment,{children:[(0,r.jsxs)(n.$,{size:"sm",variant:"outline",className:"text-destructive hover:text-destructive",onClick:()=>J(e.userId,"denied"),children:[(0,r.jsx)(j.A,{className:"mr-2 h-4 w-4"})," Rechazar"]}),(0,r.jsxs)(n.$,{size:"sm",onClick:()=>J(e.userId,"approved"),children:[(0,r.jsx)(x.A,{className:"mr-2 h-4 w-4"})," Aprobar"]})]}):(0,r.jsxs)("span",{className:"text-xs text-muted-foreground",children:["Procesado el ",$(e.processedAt)]})})]},e.id))})]})})]})]})})}),(0,r.jsx)(Y,{isOpen:I,onClose:()=>F(!1),onUserAdded:()=>{U("allUsers"),P(!0)}})]})}}},e=>{e.O(0,[2992,7138,4865,2130,2619,3326,5282,9351,3504,3640,5479,5171,8441,1255,7358],()=>e(e.s=33331)),_N_E=e.O()}]);