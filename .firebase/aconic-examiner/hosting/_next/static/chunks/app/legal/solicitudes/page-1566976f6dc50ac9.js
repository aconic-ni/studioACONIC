(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[8013],{9888:(e,s,t)=>{"use strict";t.r(s),t.d(s,{default:()=>R});var a=t(95155),r=t(12115),l=t(20063),d=t(52619),i=t.n(d),n=t(54901),o=t(35434),c=t(92033),u=t(95738),m=t(60406),f=t(36654),x=t(86948),p=t(87270),h=t(11186),j=t(3998),g=t(15894),b=t(14585),N=t(19708),y=t(11647),v=t(5282),w=t(80160),A=t(65142),C=t(51834);function R(){let{user:e,loading:s}=(0,n.A)(),t=(0,l.useRouter)(),{toast:d}=(0,g.dj)(),[R,k]=(0,r.useState)([]),[E,z]=(0,r.useState)(!0),[L,q]=(0,r.useState)(null),[S,P]=(0,r.useState)(""),[M,T]=(0,r.useState)(null);(0,r.useEffect)(()=>{s||e||t.push("/")},[e,s,t]),(0,r.useEffect)(()=>{if(!e)return;z(!0);let s=(0,N.P)((0,N.rJ)(b.db,"solicitudesLegales"),(0,N.My)("requestedAt","desc")),t=(0,N.aQ)(s,e=>{k(e.docs.map(e=>({id:e.id,...e.data()}))),z(!1)},e=>{console.error("Error fetching legal requests:",e),q("No se pudieron cargar las solicitudes. Verifique los permisos de Firestore."),z(!1)});return()=>t()},[e]);let H=async(s,t)=>{if(!e)return;let a=(0,N.H9)(b.db,"solicitudesLegales",s);try{let s={status:t};"completado"===t&&(s.completedAt=N.Dc.now(),s.completedBy=e.displayName||e.email),await (0,N.mZ)(a,s),d({title:"Estado Actualizado",description:"El estado de la solicitud ha sido cambiado."})}catch(e){console.error("Error updating status:",e),d({title:"Error",description:"No se pudo actualizar el estado.",variant:"destructive"})}},_=(0,r.useMemo)(()=>R.filter(e=>e.ne.toLowerCase().includes(S.toLowerCase())||e.consignee.toLowerCase().includes(S.toLowerCase())||e.id.toLowerCase().includes(S.toLowerCase())),[R,S]),B=(null==e?void 0:e.role)==="legal"||(null==e?void 0:e.role)==="admin";return s||E?(0,a.jsx)("div",{className:"min-h-screen flex items-center justify-center bg-background",children:(0,a.jsx)(c.A,{className:"h-12 w-12 animate-spin text-primary"})}):(0,a.jsxs)(o.G,{children:[(0,a.jsx)("div",{className:"py-2 md:py-5",children:(0,a.jsxs)(x.Zp,{className:"w-full max-w-7xl mx-auto custom-shadow",children:[(0,a.jsxs)(x.aR,{children:[(0,a.jsxs)("div",{className:"flex justify-between items-start",children:[(0,a.jsxs)("div",{children:[(0,a.jsx)(x.ZB,{className:"text-2xl font-semibold",children:"Panel de Solicitudes Legales"}),(0,a.jsx)(x.BT,{children:"Gestione las solicitudes de servicios legales pendientes."})]}),(0,a.jsx)(j.$,{asChild:!0,children:(0,a.jsxs)(i(),{href:"/legal/request",children:[(0,a.jsx)(u.A,{className:"mr-2 h-4 w-4"}),"Nueva Solicitud"]})})]}),(0,a.jsx)("div",{className:"pt-4 mt-4 border-t",children:(0,a.jsx)(A.p,{placeholder:"Buscar por NE, Consignatario o ID...",value:S,onChange:e=>P(e.target.value),className:"max-w-sm"})})]}),(0,a.jsxs)(x.Wu,{children:[L&&(0,a.jsxs)("div",{className:"mt-4 p-4 bg-destructive/10 text-destructive border border-destructive/30 rounded-md text-center flex items-center justify-center gap-2",children:[(0,a.jsx)(m.A,{className:"h-5 w-5"})," ",L]}),!E&&0===_.length&&!L&&(0,a.jsx)("div",{className:"text-center py-10 px-6 bg-secondary/30 rounded-lg",children:(0,a.jsx)("p",{className:"mt-1 text-muted-foreground",children:"No hay solicitudes que coincidan con su b\xfasqueda."})}),!E&&_.length>0&&(0,a.jsx)("div",{className:"overflow-x-auto table-container rounded-lg border mt-4",children:(0,a.jsxs)(p.XI,{children:[(0,a.jsx)(p.A0,{className:"bg-gray-50",children:(0,a.jsxs)(p.Hj,{children:[(0,a.jsx)(p.nd,{children:"NE"}),(0,a.jsx)(p.nd,{children:"Consignatario"}),(0,a.jsx)(p.nd,{children:"Fecha Solicitud"}),(0,a.jsx)(p.nd,{children:"Solicitado Por"}),(0,a.jsx)(p.nd,{children:"Servicios"}),(0,a.jsx)(p.nd,{children:"Estado"}),(0,a.jsx)(p.nd,{className:"text-right",children:"Acciones"})]})}),(0,a.jsx)(p.BF,{children:_.map(e=>{let s;return(0,a.jsxs)(p.Hj,{children:[(0,a.jsx)(p.nA,{className:"font-medium",children:e.ne}),(0,a.jsx)(p.nA,{children:e.consignee}),(0,a.jsx)(p.nA,{children:(s=e.requestedAt,(0,v.GP)(s.toDate(),"dd/MM/yy HH:mm",{locale:w.es}))}),(0,a.jsx)(p.nA,{children:(0,a.jsx)(y.E,{variant:"outline",children:e.requestedBy})}),(0,a.jsx)(p.nA,{children:e.services.map(e=>e.serviceType).join(", ")}),(0,a.jsx)(p.nA,{children:B?(0,a.jsxs)(h.l6,{value:e.status,onValueChange:s=>H(e.id,s),children:[(0,a.jsx)(h.bq,{className:"w-[150px]",children:(0,a.jsx)(h.yv,{})}),(0,a.jsxs)(h.gC,{children:[(0,a.jsx)(h.eb,{value:"pendiente",children:"Pendiente"}),(0,a.jsx)(h.eb,{value:"en_proceso",children:"En Proceso"}),(0,a.jsx)(h.eb,{value:"completado",children:"Completado"}),(0,a.jsx)(h.eb,{value:"rechazado",children:"Rechazado"})]})]}):(0,a.jsx)(y.E,{variant:(e=>{switch(e){case"completado":return"default";case"rechazado":return"destructive";case"en_proceso":return"secondary";default:return"outline"}})(e.status),children:e.status})}),(0,a.jsx)(p.nA,{className:"text-right",children:(0,a.jsx)(j.$,{size:"sm",variant:"ghost",onClick:()=>T(e),children:(0,a.jsx)(f.A,{className:"h-4 w-4"})})})]},e.id)})})]})})]})]})}),M&&(0,a.jsx)(C.lG,{open:!!M,onOpenChange:()=>T(null),children:(0,a.jsxs)(C.Cf,{className:"max-w-lg",children:[(0,a.jsxs)(C.c7,{children:[(0,a.jsx)(C.L3,{children:"Detalles de Solicitud Legal"}),(0,a.jsxs)(C.rr,{children:["ID: ",M.id]})]}),(0,a.jsxs)("div",{className:"space-y-4 py-4",children:[(0,a.jsxs)("div",{children:[(0,a.jsx)("h4",{className:"font-semibold text-sm",children:"Servicios:"}),(0,a.jsx)("ul",{className:"list-disc list-inside pl-2 text-sm text-muted-foreground",children:M.services.map((e,s)=>(0,a.jsxs)("li",{children:[e.serviceType," (x",e.quantity,")"]},s))})]}),M.observations&&(0,a.jsxs)("div",{children:[(0,a.jsx)("h4",{className:"font-semibold text-sm",children:"Observaciones:"}),(0,a.jsx)("p",{className:"text-sm p-2 bg-muted rounded-md",children:M.observations})]}),(0,a.jsxs)("div",{children:[(0,a.jsx)("h4",{className:"font-semibold text-sm",children:"Autorizado por Cliente:"}),(0,a.jsx)("p",{className:"text-sm",children:M.authorizedByClient?"S\xed":"No"})]})]}),(0,a.jsx)(C.Es,{children:(0,a.jsx)(j.$,{variant:"outline",onClick:()=>T(null),children:"Cerrar"})})]})})]})}},11186:(e,s,t)=>{"use strict";t.d(s,{bq:()=>m,eb:()=>h,gC:()=>p,l6:()=>c,yv:()=>u});var a=t(95155),r=t(12115),l=t(47887),d=t(59007),i=t(42614),n=t(72251),o=t(64269);let c=l.bL;l.YJ;let u=l.WT,m=r.forwardRef((e,s)=>{let{className:t,children:r,...i}=e;return(0,a.jsxs)(l.l9,{ref:s,className:(0,o.cn)("flex h-10 w-full items-center justify-between rounded-md border border-input bg-background px-3 py-2 text-sm ring-offset-background placeholder:text-muted-foreground focus:outline-none focus:ring-2 focus:ring-ring focus:ring-offset-2 disabled:cursor-not-allowed disabled:opacity-50 [&>span]:line-clamp-1",t),...i,children:[r,(0,a.jsx)(l.In,{asChild:!0,children:(0,a.jsx)(d.A,{className:"h-4 w-4 opacity-50"})})]})});m.displayName=l.l9.displayName;let f=r.forwardRef((e,s)=>{let{className:t,...r}=e;return(0,a.jsx)(l.PP,{ref:s,className:(0,o.cn)("flex cursor-default items-center justify-center py-1",t),...r,children:(0,a.jsx)(i.A,{className:"h-4 w-4"})})});f.displayName=l.PP.displayName;let x=r.forwardRef((e,s)=>{let{className:t,...r}=e;return(0,a.jsx)(l.wn,{ref:s,className:(0,o.cn)("flex cursor-default items-center justify-center py-1",t),...r,children:(0,a.jsx)(d.A,{className:"h-4 w-4"})})});x.displayName=l.wn.displayName;let p=r.forwardRef((e,s)=>{let{className:t,children:r,position:d="popper",...i}=e;return(0,a.jsx)(l.ZL,{children:(0,a.jsxs)(l.UC,{ref:s,className:(0,o.cn)("relative z-50 max-h-96 min-w-[8rem] overflow-hidden rounded-md border bg-popover text-popover-foreground shadow-md data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0 data-[state=closed]:zoom-out-95 data-[state=open]:zoom-in-95 data-[side=bottom]:slide-in-from-top-2 data-[side=left]:slide-in-from-right-2 data-[side=right]:slide-in-from-left-2 data-[side=top]:slide-in-from-bottom-2","popper"===d&&"data-[side=bottom]:translate-y-1 data-[side=left]:-translate-x-1 data-[side=right]:translate-x-1 data-[side=top]:-translate-y-1",t),position:d,...i,children:[(0,a.jsx)(f,{}),(0,a.jsx)(l.LM,{className:(0,o.cn)("p-1","popper"===d&&"h-[var(--radix-select-trigger-height)] w-full min-w-[var(--radix-select-trigger-width)]"),children:r}),(0,a.jsx)(x,{})]})})});p.displayName=l.UC.displayName,r.forwardRef((e,s)=>{let{className:t,...r}=e;return(0,a.jsx)(l.JU,{ref:s,className:(0,o.cn)("py-1.5 pl-8 pr-2 text-sm font-semibold",t),...r})}).displayName=l.JU.displayName;let h=r.forwardRef((e,s)=>{let{className:t,children:r,...d}=e;return(0,a.jsxs)(l.q7,{ref:s,className:(0,o.cn)("relative flex w-full cursor-default select-none items-center rounded-sm py-1.5 pl-8 pr-2 text-sm outline-none focus:bg-accent focus:text-accent-foreground data-[disabled]:pointer-events-none data-[disabled]:opacity-50",t),...d,children:[(0,a.jsx)("span",{className:"absolute left-2 flex h-3.5 w-3.5 items-center justify-center",children:(0,a.jsx)(l.VF,{children:(0,a.jsx)(n.A,{className:"h-4 w-4"})})}),(0,a.jsx)(l.p4,{children:r})]})});h.displayName=l.q7.displayName,r.forwardRef((e,s)=>{let{className:t,...r}=e;return(0,a.jsx)(l.wv,{ref:s,className:(0,o.cn)("-mx-1 my-1 h-px bg-muted",t),...r})}).displayName=l.wv.displayName},20063:(e,s,t)=>{"use strict";var a=t(47260);t.o(a,"useRouter")&&t.d(s,{useRouter:function(){return a.useRouter}}),t.o(a,"useSearchParams")&&t.d(s,{useSearchParams:function(){return a.useSearchParams}})},22510:(e,s,t)=>{Promise.resolve().then(t.bind(t,9888))},36654:(e,s,t)=>{"use strict";t.d(s,{A:()=>a});let a=(0,t(14294).A)("Eye",[["path",{d:"M2.062 12.348a1 1 0 0 1 0-.696 10.75 10.75 0 0 1 19.876 0 1 1 0 0 1 0 .696 10.75 10.75 0 0 1-19.876 0",key:"1nclc0"}],["circle",{cx:"12",cy:"12",r:"3",key:"1v7zrd"}]])},51834:(e,s,t)=>{"use strict";t.d(s,{Cf:()=>u,Es:()=>f,HM:()=>o,L3:()=>x,c7:()=>m,lG:()=>i,rr:()=>p});var a=t(95155),r=t(12115),l=t(89511),d=t(64269);let i=l.bL;l.l9;let n=l.ZL,o=l.bm,c=r.forwardRef((e,s)=>{let{className:t,...r}=e;return(0,a.jsx)(l.hJ,{ref:s,className:(0,d.cn)("fixed inset-0 z-50 bg-black/80 data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0",t),...r})});c.displayName=l.hJ.displayName;let u=r.forwardRef((e,s)=>{let{className:t,children:r,...i}=e;return(0,a.jsxs)(n,{children:[(0,a.jsx)(c,{}),(0,a.jsxs)(l.UC,{ref:s,className:(0,d.cn)("fixed left-[50%] top-[50%] z-50 grid w-full max-w-lg translate-x-[-50%] translate-y-[-50%] gap-4 border bg-background p-6 shadow-lg duration-200 data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0 data-[state=closed]:zoom-out-95 data-[state=open]:zoom-in-95 data-[state=closed]:slide-out-to-left-1/2 data-[state=closed]:slide-out-to-top-[48%] data-[state=open]:slide-in-from-left-1/2 data-[state=open]:slide-in-from-top-[48%] sm:rounded-lg",t),...i,children:[r,(0,a.jsx)(l.bm,{className:"absolute right-4 top-4 rounded-sm opacity-70 ring-offset-background transition-opacity hover:opacity-100 focus:outline-none focus:ring-2 focus:ring-ring focus:ring-offset-2 disabled:pointer-events-none data-[state=open]:bg-accent data-[state=open]:text-muted-foreground",children:(0,a.jsx)("span",{className:"sr-only",children:"Close"})})]})]})});u.displayName=l.UC.displayName;let m=e=>{let{className:s,...t}=e;return(0,a.jsx)("div",{className:(0,d.cn)("flex flex-col space-y-1.5 text-center sm:text-left",s),...t})};m.displayName="DialogHeader";let f=e=>{let{className:s,...t}=e;return(0,a.jsx)("div",{className:(0,d.cn)("flex flex-col-reverse sm:flex-row sm:justify-end sm:space-x-2",s),...t})};f.displayName="DialogFooter";let x=r.forwardRef((e,s)=>{let{className:t,...r}=e;return(0,a.jsx)(l.hE,{ref:s,className:(0,d.cn)("text-lg font-semibold leading-none tracking-tight",t),...r})});x.displayName=l.hE.displayName;let p=r.forwardRef((e,s)=>{let{className:t,...r}=e;return(0,a.jsx)(l.VY,{ref:s,className:(0,d.cn)("text-sm text-muted-foreground",t),...r})});p.displayName=l.VY.displayName},60406:(e,s,t)=>{"use strict";t.d(s,{A:()=>a});let a=(0,t(14294).A)("TriangleAlert",[["path",{d:"m21.73 18-8-14a2 2 0 0 0-3.48 0l-8 14A2 2 0 0 0 4 21h16a2 2 0 0 0 1.73-3",key:"wmoenq"}],["path",{d:"M12 9v4",key:"juzpu7"}],["path",{d:"M12 17h.01",key:"p32p05"}]])},65142:(e,s,t)=>{"use strict";t.d(s,{p:()=>d});var a=t(95155),r=t(12115),l=t(64269);let d=r.forwardRef((e,s)=>{let{className:t,type:r,...d}=e;return(0,a.jsx)("input",{type:r,className:(0,l.cn)("flex h-10 w-full rounded-md border border-input bg-background px-3 py-2 text-base ring-offset-background file:border-0 file:bg-transparent file:text-sm file:font-medium file:text-foreground placeholder:text-muted-foreground focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2 disabled:cursor-not-allowed disabled:opacity-50 md:text-sm","aria-[invalid=true]:border-destructive aria-[invalid=true]:ring-destructive",t),ref:s,...d})});d.displayName="Input"},87270:(e,s,t)=>{"use strict";t.d(s,{A0:()=>i,BF:()=>n,Hj:()=>o,XI:()=>d,nA:()=>u,nd:()=>c});var a=t(95155),r=t(12115),l=t(64269);let d=r.forwardRef((e,s)=>{let{className:t,...r}=e;return(0,a.jsx)("div",{className:"relative w-full overflow-auto",children:(0,a.jsx)("table",{ref:s,className:(0,l.cn)("w-full caption-bottom text-sm",t),...r})})});d.displayName="Table";let i=r.forwardRef((e,s)=>{let{className:t,...r}=e;return(0,a.jsx)("thead",{ref:s,className:(0,l.cn)("[&_tr]:border-b",t),...r})});i.displayName="TableHeader";let n=r.forwardRef((e,s)=>{let{className:t,...r}=e;return(0,a.jsx)("tbody",{ref:s,className:(0,l.cn)("[&_tr:last-child]:border-0",t),...r})});n.displayName="TableBody",r.forwardRef((e,s)=>{let{className:t,...r}=e;return(0,a.jsx)("tfoot",{ref:s,className:(0,l.cn)("border-t bg-muted/50 font-medium [&>tr]:last:border-b-0",t),...r})}).displayName="TableFooter";let o=r.forwardRef((e,s)=>{let{className:t,...r}=e;return(0,a.jsx)("tr",{ref:s,className:(0,l.cn)("border-b transition-colors hover:bg-muted/50 data-[state=selected]:bg-muted",t),...r})});o.displayName="TableRow";let c=r.forwardRef((e,s)=>{let{className:t,...r}=e;return(0,a.jsx)("th",{ref:s,className:(0,l.cn)("h-12 px-4 text-left align-middle font-medium text-muted-foreground [&:has([role=checkbox])]:pr-0",t),...r})});c.displayName="TableHead";let u=r.forwardRef((e,s)=>{let{className:t,...r}=e;return(0,a.jsx)("td",{ref:s,className:(0,l.cn)("p-4 align-middle [&:has([role=checkbox])]:pr-0",t),...r})});u.displayName="TableCell",r.forwardRef((e,s)=>{let{className:t,...r}=e;return(0,a.jsx)("caption",{ref:s,className:(0,l.cn)("mt-4 text-sm text-muted-foreground",t),...r})}).displayName="TableCaption"},95738:(e,s,t)=>{"use strict";t.d(s,{A:()=>a});let a=(0,t(14294).A)("FilePlus",[["path",{d:"M15 2H6a2 2 0 0 0-2 2v16a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V7Z",key:"1rqfz7"}],["path",{d:"M14 2v4a2 2 0 0 0 2 2h4",key:"tnqrlb"}],["path",{d:"M9 15h6",key:"cctwl0"}],["path",{d:"M12 18v-6",key:"17g6i2"}]])}},e=>{e.O(0,[2992,7138,4865,2130,2619,3326,5282,9351,5479,5171,8441,1255,7358],()=>e(e.s=22510)),_N_E=e.O()}]);