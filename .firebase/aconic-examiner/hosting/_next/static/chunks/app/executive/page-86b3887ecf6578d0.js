(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[1863],{6865:(e,a,t)=>{"use strict";t.r(a),t.d(a,{default:()=>ah});var s=t(95155),r=t(12115),n=t(20063),i=t(52619),l=t.n(i),o=t(54901),c=t(35434),d=t(3998),u=t(86948),h=t(92033),m=t(87455),x=t(98039),p=t(88964),j=t(95738),v=t(44575),f=t(2165),N=t(90109),A=t(18527),g=t(30848),b=t(13381),C=t(56397),w=t(53489),y=t(21799),S=t(28127),D=t(50817),E=t(14585),R=t(19708),k=t(47691),I=t(33086),P=t(5282),O=t(65142),M=t(49205),L=t(98460),T=t(67421),_=t(22544),F=t(66942),V=t(15653),z=t(51834),G=t(41052),q=t(15894),H=t(27339),U=t(83012),B=t(73457),$=t(11186),J=t(76444);let W=V.z.object({valueDoubtNotificationDate:V.z.date({required_error:"La fecha de notificaci\xf3n es requerida."}),valueDoubtAmount:V.z.coerce.number().optional(),valueDoubtStatus:V.z.custom().optional(),valueDoubtExtensionRequested:V.z.boolean().optional(),valueDoubtLevanteRequested:V.z.boolean().optional(),valueDoubtAssignedToLegal:V.z.boolean().optional()});function Z(e){var a,t;let{isOpen:n,onClose:i,caseData:l}=e,{user:c}=(0,o.A)(),{toast:u}=(0,q.dj)(),[m,x]=(0,r.useState)(!1),[p,j]=(0,r.useState)(null),v=(0,_.mN)({resolver:(0,F.u)(W),defaultValues:{valueDoubtNotificationDate:null==(a=l.valueDoubtNotificationDate)?void 0:a.toDate(),valueDoubtAmount:null!=(t=l.valueDoubtAmount)?t:void 0,valueDoubtStatus:l.valueDoubtStatus||void 0,valueDoubtExtensionRequested:l.valueDoubtExtensionRequested||!1,valueDoubtLevanteRequested:l.valueDoubtLevanteRequested||!1,valueDoubtAssignedToLegal:l.valueDoubtAssignedToLegal||!1}}),f=v.watch("valueDoubtNotificationDate"),N=v.watch("valueDoubtExtensionRequested");(0,r.useEffect)(()=>{f?j((0,U.f)(f,N?30:10)):j(null)},[f,N]);let A=!l.hasValueDoubt,g=async e=>{if(!c||!c.displayName)return void u({title:"Error",description:"Debe estar autenticado.",variant:"destructive"});x(!0);let a=(0,R.H9)(E.db,"AforoCases",l.id),t=(0,R.rJ)(a,"actualizaciones"),s=(0,R.wP)(E.db);try{let r=e.valueDoubtExtensionRequested?30:10,n=(0,U.f)(e.valueDoubtNotificationDate,r);if(!n){u({title:"Error",description:"No se pudo calcular la fecha de vencimiento.",variant:"destructive"}),x(!1);return}let o={valueDoubtNotificationDate:R.Dc.fromDate(e.valueDoubtNotificationDate),valueDoubtAmount:e.valueDoubtAmount||null,valueDoubtDueDate:R.Dc.fromDate(n),valueDoubtStatus:e.valueDoubtStatus||null,valueDoubtExtensionRequested:e.valueDoubtExtensionRequested||!1,valueDoubtLevanteRequested:e.valueDoubtLevanteRequested||!1,valueDoubtAssignedToLegal:e.valueDoubtAssignedToLegal||!1},d="";A?(o.hasValueDoubt=!0,o.incidentType="Duda de Valor",d="Reporte inicial de Duda de Valor con monto ".concat(e.valueDoubtAmount?"$".concat(e.valueDoubtAmount):"pendiente")):d="Actualizaci\xf3n de estado de Duda de Valor.",s.update(a,o);let h={updatedAt:R.Dc.now(),updatedBy:c.displayName,field:"value_doubt_report",oldValue:A?null:{status:l.valueDoubtStatus},newValue:o,comment:d};s.set((0,R.H9)(t),h),await s.commit(),u({title:"Duda de Valor ".concat(A?"Reportada":"Actualizada"),description:"El caso NE ".concat(l.ne," ha sido actualizado.")}),i()}catch(e){console.error("Error reporting/updating value doubt:",e),u({title:"Error",description:"No se pudo procesar la solicitud.",variant:"destructive"})}finally{x(!1)}};return n?(0,s.jsx)(z.lG,{open:n,onOpenChange:i,children:(0,s.jsxs)(z.Cf,{className:"sm:max-w-md",children:[(0,s.jsxs)(z.c7,{children:[(0,s.jsx)(z.L3,{children:"Duda de Valor"}),(0,s.jsxs)(z.rr,{children:["Gesti\xf3n del proceso para el caso NE: ",(0,s.jsx)("span",{className:"font-bold text-foreground",children:l.ne}),"."]})]}),(0,s.jsx)(G.lV,{...v,children:(0,s.jsxs)("form",{onSubmit:v.handleSubmit(g),className:"space-y-4 py-4",children:[(0,s.jsx)(G.zB,{control:v.control,name:"valueDoubtNotificationDate",render:e=>{let{field:a}=e;return(0,s.jsxs)(G.eI,{className:"flex flex-col",children:[(0,s.jsx)(G.lR,{children:"Fecha de Notificaci\xf3n"}),(0,s.jsx)(G.MJ,{children:(0,s.jsx)(H.l,{date:a.value,onDateChange:a.onChange})}),(0,s.jsx)(G.C5,{})]})}}),(0,s.jsx)(G.zB,{control:v.control,name:"valueDoubtAmount",render:e=>{var a;let{field:t}=e;return(0,s.jsxs)(G.eI,{children:[(0,s.jsx)(G.lR,{children:"Monto de la Preliquidaci\xf3n por Pagar (USD)"}),(0,s.jsx)(G.MJ,{children:(0,s.jsx)(O.p,{type:"number",step:"0.01",...t,value:null!=(a=t.value)?a:""})}),(0,s.jsx)(G.C5,{})]})}}),(0,s.jsxs)("div",{children:[(0,s.jsx)(J.J,{children:"Fecha de Vencimiento (calculada)"}),(0,s.jsx)(O.p,{readOnly:!0,value:p?p.toLocaleDateString("es-NI",{weekday:"long",year:"numeric",month:"long",day:"numeric"}):"Seleccione fecha de notificaci\xf3n",className:"bg-muted/50 cursor-not-allowed"})]}),!A&&(0,s.jsxs)("div",{className:"pt-4 mt-4 border-t space-y-4",children:[(0,s.jsx)(G.zB,{control:v.control,name:"valueDoubtStatus",render:e=>{let{field:a}=e;return(0,s.jsxs)(G.eI,{children:[(0,s.jsx)(G.lR,{children:"Estado del Proceso"}),(0,s.jsxs)($.l6,{onValueChange:a.onChange,defaultValue:a.value,children:[(0,s.jsx)(G.MJ,{children:(0,s.jsx)($.bq,{children:(0,s.jsx)($.yv,{placeholder:"Seleccionar estado..."})})}),(0,s.jsxs)($.gC,{children:[(0,s.jsx)($.eb,{value:"Proceso Administrativo",children:"Proceso Administrativo"}),(0,s.jsx)($.eb,{value:"Allanamiento",children:"Allanamiento"})]})]}),(0,s.jsx)(G.C5,{})]})}}),"Proceso Administrativo"===v.watch("valueDoubtStatus")&&(0,s.jsx)(G.zB,{control:v.control,name:"valueDoubtExtensionRequested",render:e=>{let{field:a}=e;return(0,s.jsxs)(G.eI,{className:"flex flex-row items-center justify-between rounded-lg border p-3 shadow-sm",children:[(0,s.jsx)("div",{className:"space-y-0.5",children:(0,s.jsx)(G.lR,{children:"\xbfSe solicit\xf3 ampliaci\xf3n de plazo?"})}),(0,s.jsx)(G.MJ,{children:(0,s.jsx)(B.S,{checked:a.value,onCheckedChange:a.onChange})})]})}}),(0,s.jsx)(G.zB,{control:v.control,name:"valueDoubtLevanteRequested",render:e=>{let{field:a}=e;return(0,s.jsxs)(G.eI,{className:"flex flex-row items-center justify-between rounded-lg border p-3 shadow-sm",children:[(0,s.jsx)("div",{className:"space-y-0.5",children:(0,s.jsx)(G.lR,{children:"\xbfSe solicit\xf3 levante?"})}),(0,s.jsx)(G.MJ,{children:(0,s.jsx)(B.S,{checked:a.value,onCheckedChange:a.onChange})})]})}}),(0,s.jsx)(G.zB,{control:v.control,name:"valueDoubtAssignedToLegal",render:e=>{let{field:a}=e;return(0,s.jsxs)(G.eI,{className:"flex flex-row items-center justify-between rounded-lg border p-3 shadow-sm",children:[(0,s.jsx)("div",{className:"space-y-0.5",children:(0,s.jsx)(G.lR,{children:"\xbfCaso asignado a Legal?"})}),(0,s.jsx)(G.MJ,{children:(0,s.jsx)(B.S,{checked:a.value,onCheckedChange:a.onChange})})]})}})]}),(0,s.jsxs)(z.Es,{className:"pt-4",children:[(0,s.jsx)(d.$,{type:"button",variant:"outline",onClick:i,children:"Cancelar"}),(0,s.jsxs)(d.$,{type:"submit",disabled:m,children:[m&&(0,s.jsx)(h.A,{className:"mr-2 h-4 w-4 animate-spin"}),A?"Guardar Reporte":"Actualizar Proceso"]})]})]})})]})}):null}var X=t(77059),Q=t(4246),Y=t(80160);let K=async e=>{let a=new Date,t=(0,P.GP)(a,"dd/MM/yy HH:mm",{locale:Y.es}),s=function(e){let a=arguments.length>1&&void 0!==arguments[1]&&arguments[1];if(!e)return"N/A";let t=e.toDate?e.toDate():new Date(e);return!(t instanceof Date)||isNaN(t.getTime())?"Fecha Inv\xe1lida":(0,P.GP)(t,a?"dd/MM/yy HH:mm":"dd/MM/yy",{locale:Y.es})},r=["NE","REFERENCIA","ADUANA INGRESO","ADUANA DESPACHO","CONSIGNATARIO","PROVEEDOR","FACTURA","No. ADMI","FECHA ENVIO A CLIENTE","PERMISO REQUERIDO","ESTADO PERMISO","FECHA SOMETIDO","FECHA AUTORIZADO","PROVEEDOR TRANSPORTE","DECLARACION","FECHA NACIONALIZACION","SELECTIVIDAD","FECHA DESPACHO","OBSERVACIONES"],n=[];for(let a of e)if(a.documents&&a.documents.filter(e=>"FACTURA"===e.type).length>0)for(let e of a.documents.filter(e=>"FACTURA"===e.type)){var i;let t=null==(i=a.requiredPermits)?void 0:i.find(a=>a.facturaNumber===e.number);n.push([a.ne,a.reference||"N/A",a.entryCustoms,a.dispatchCustoms,a.consignee,a.proveedor||"N/A",e.number,e.noADMI||"N/A",s(a.fechaEnvioCliente,!1),(null==t?void 0:t.name)||"N/A",(null==t?void 0:t.status)||"N/A",s(null==t?void 0:t.tramiteDate,!1),s((null==t?void 0:t.status)==="Entregado"?t.estimatedDeliveryDate:null,!1),a.proveedorTransporte||"N/A",a.declaracionNumero||"N/A",s(a.fechaNacionalizacion,!1),a.selectividad||"N/A",s(a.fechaDespacho,!1),a.observations||""])}else n.push([a.ne,a.reference||"N/A",a.entryCustoms,a.dispatchCustoms,a.consignee,a.proveedor||"N/A","N/A","N/A",s(a.fechaEnvioCliente,!1),"N/A","N/A","N/A","N/A",a.proveedorTransporte||"N/A",a.declaracionNumero||"N/A",s(a.fechaNacionalizacion,!1),a.selectividad||"N/A",s(a.fechaDespacho,!1),a.observations||""]);let l=[["Reporte de Consignatarios Empresariales"],["Generado el: ".concat(t)],[],r,...n],o=Q.Wp.aoa_to_sheet(l),c=r.map((e,a)=>({wch:Math.max(e.length,...n.map(e=>String(e[a]||"").length))+2}));o["!cols"]=c;let d=Q.Wp.book_new();Q.Wp.book_append_sheet(d,o,"Reporte Corporativo"),Q._h(d,"Reporte_Corporativo_".concat(a.toISOString().split("T")[0],".xlsx"))};var ee=t(26333),ea=t(6259),et=t(82206),es=t(59321),er=t(31120),en=t(11929),ei=t(17037);let el=V.z.object({comment:V.z.string().min(1,"El comentario no puede estar vac\xedo.")});function eo(e){let{isOpen:a,onClose:t,caseData:n}=e,{user:i}=(0,o.A)(),{toast:l}=(0,q.dj)(),[c,u]=(0,r.useState)(!1),[m,x]=(0,r.useState)([]);(0,r.useEffect)(()=>{a&&n.executiveComments&&x([...n.executiveComments].reverse())},[a,n.executiveComments]);let p=(0,_.mN)({resolver:(0,F.u)(el),defaultValues:{comment:""}}),j=(null==i?void 0:i.role)==="ejecutivo"||(null==i?void 0:i.role)==="coordinadora"||(null==i?void 0:i.role)==="admin",v=async e=>{if(!i||!i.displayName)return void l({title:"Error",description:"Debe estar autenticado.",variant:"destructive"});if(!j)return void l({title:"Permiso Denegado",description:"No tiene permisos para a\xf1adir un comentario.",variant:"destructive"});u(!0);let a=(0,R.H9)(E.db,"AforoCases",n.id),t=(0,R.rJ)(a,"actualizaciones"),s=(0,R.wP)(E.db),r={id:(0,en.A)(),author:i.displayName,text:e.comment,createdAt:R.Dc.now()};try{x(e=>[r,...e]),s.update(a,{executiveComments:(0,R.hq)(r)});let o={updatedAt:R.Dc.now(),updatedBy:i.displayName,field:"executiveComments",oldValue:"N/A",newValue:e.comment,comment:'Comentario ejecutivo a\xf1adido: "'.concat(e.comment,'"')};s.set((0,R.H9)(t),o),await s.commit(),l({title:"Comentario A\xf1adido",description:"Se ha guardado un nuevo comentario en el caso NE ".concat(n.ne,".")}),p.reset()}catch(e){console.error("Error adding executive comment:",e),x(e=>e.filter(e=>e.id!==r.id)),l({title:"Error",description:"No se pudo guardar el comentario.",variant:"destructive"})}finally{u(!1)}};return a?(0,s.jsx)(z.lG,{open:a,onOpenChange:t,children:(0,s.jsxs)(z.Cf,{className:"max-w-lg",children:[(0,s.jsxs)(z.c7,{children:[(0,s.jsx)(z.L3,{children:"Comentarios del Caso"}),(0,s.jsxs)(z.rr,{children:["Historial de comentarios y notas para el caso NE: ",(0,s.jsx)("span",{className:"font-bold text-foreground",children:n.ne}),"."]})]}),(0,s.jsx)(ei.F,{className:"max-h-[40vh] my-4",children:(0,s.jsx)("div",{className:"space-y-4 pr-6",children:m.length>0?m.map(e=>{let a;return(0,s.jsxs)("div",{className:"p-3 border rounded-lg bg-secondary/50",children:[(0,s.jsx)("p",{className:"text-sm text-foreground",children:e.text}),(0,s.jsxs)("div",{className:"text-xs text-muted-foreground mt-2 text-right",children:[(0,s.jsxs)("span",{children:["- ",e.author]}),(0,s.jsxs)("span",{className:"ml-2",children:["(",(a=e.createdAt,(0,P.GP)(a.toDate(),"dd/MM/yy hh:mm a",{locale:Y.es})),")"]})]})]},e.id)}):(0,s.jsx)("p",{className:"text-sm text-muted-foreground text-center py-8",children:"No hay comentarios para este caso."})})}),(0,s.jsx)(G.lV,{...p,children:(0,s.jsxs)("form",{onSubmit:p.handleSubmit(v),className:"space-y-4 pt-4 border-t",children:[(0,s.jsx)(G.zB,{control:p.control,name:"comment",render:e=>{let{field:a}=e;return(0,s.jsxs)(G.eI,{children:[(0,s.jsx)(G.lR,{children:"Nuevo Comentario"}),(0,s.jsx)(G.MJ,{children:(0,s.jsx)(er.T,{...a,rows:3,disabled:!j||c,placeholder:j?"Escriba su comentario aqu\xed...":"No tiene permisos para comentar."})}),(0,s.jsx)(G.C5,{})]})}}),(0,s.jsxs)(z.Es,{className:"pt-4",children:[(0,s.jsx)(d.$,{type:"button",variant:"outline",onClick:t,children:"Cerrar"}),j&&(0,s.jsxs)(d.$,{type:"submit",disabled:c,children:[c&&(0,s.jsx)(h.A,{className:"mr-2 h-4 w-4 animate-spin"}),"Guardar Comentario"]})]})]})})]})}):null}var ec=t(60406),ed=t(9891),eu=t(86501),eh=t(44846);let em=V.z.object({reference:V.z.string().optional(),location:V.z.string().min(1,"La ubicaci\xf3n es requerida.")});function ex(e){let{isOpen:a,onClose:t,caseWithWorksheet:i}=e,{user:l}=(0,o.A)(),{toast:c}=(0,q.dj)(),u=(0,n.useRouter)(),[m,x]=(0,r.useState)(!1),[p,j]=(0,r.useState)(!1),[v,f]=(0,r.useState)(!1),[N,A]=(0,r.useState)(!0),g=(0,_.mN)({resolver:(0,F.u)(em),defaultValues:{reference:"",location:""}});(0,r.useEffect)(()=>{let e=async()=>{if(!a)return;A(!0);let e=i.ne.toUpperCase().trim(),t=(0,R.H9)(E.db,"examenesPrevios",e),s=(0,R.H9)(E.db,"solicitudesExamen",e);try{let[e,a]=await Promise.all([(0,R.x7)(t),(0,R.x7)(s)]),r=e.exists()||a.exists();j(r),r?f(!0):f(!1)}catch(e){console.error("Error checking for existing case:",e),j(!1)}finally{A(!1)}};if(a){var t;g.reset({reference:"",location:(null==(t=i.worksheet)?void 0:t.location)||""}),e()}},[a,i,g]);let b=(null==l?void 0:l.role)==="coordinadora"?"/assignments":"/executive",C=async(e,a)=>{if(!l||!l.email)return;let s=(0,R.H9)(E.db,"solicitudesExamen",e),r={ne:i.ne.toUpperCase().trim(),id:e,reference:a.reference||"",consignee:i.consignee,location:a.location,status:"pendiente",requestedBy:l.email,requestedAt:R.Dc.fromDate(new Date)};try{await (0,R.BN)(s,r),c({title:"Solicitud Enviada",description:"La solicitud para el examen NE: ".concat(e," ha sido creada.")}),u.push(b),t()}catch(a){let e=new eu.$({path:s.path,operation:"create",requestResourceData:r},a);ed.d.emit("permission-error",e)}};async function w(e){if(!l||!l.email)return void c({title:"Error de autenticaci\xf3n",variant:"destructive"});if(!i.worksheet)return void c({title:"Error",description:"No se encontr\xf3 la hoja de trabajo asociada.",variant:"destructive"});x(!0);let a=i.ne.toUpperCase().trim();if(v){let t=(0,R.P)((0,R.rJ)(E.db,"solicitudesExamen"),(0,R._M)("ne","==",a)),s=(0,R.P)((0,R.rJ)(E.db,"examenesPrevios"),(0,R._M)("ne","==",a));try{let[r,n]=await Promise.all([(0,R.d_)(t),(0,R.d_)(s)]),i=r.data().count,l=n.data().count,o="".concat(a,"-EXT").concat(i+l+1);await C(o,e)}catch(e){console.error("Error counting existing cases",e),c({title:"Error",description:"No se pudo contar los casos existentes para crear ID extraordinario.",variant:"destructive"})}finally{x(!1)}}else await C(a,e),x(!1)}return a?(0,s.jsx)(z.lG,{open:a,onOpenChange:t,children:(0,s.jsxs)(z.Cf,{className:"sm:max-w-md",children:[(0,s.jsxs)(z.c7,{children:[(0,s.jsx)(z.L3,{children:"Solicitud R\xe1pida de Previo"}),(0,s.jsxs)(z.rr,{children:["Creando una solicitud para el NE: ",(0,s.jsx)("span",{className:"font-bold text-foreground",children:i.ne}),"."]})]}),(0,s.jsx)("div",{className:"text-sm space-y-1 text-muted-foreground",children:(0,s.jsxs)("p",{children:[(0,s.jsx)("strong",{children:"Consignatario:"})," ",i.consignee]})}),(0,s.jsx)(G.lV,{...g,children:(0,s.jsxs)("form",{onSubmit:g.handleSubmit(w),className:"space-y-4 py-4",children:[(0,s.jsx)(G.zB,{control:g.control,name:"location",render:e=>{let{field:a}=e;return(0,s.jsxs)(G.eI,{children:[(0,s.jsx)(G.lR,{children:"Ubicaci\xf3n de la Mercanc\xeda"}),(0,s.jsx)(G.MJ,{children:(0,s.jsx)(O.p,{...a,disabled:m,placeholder:"Especifique la ubicaci\xf3n"})}),(0,s.jsx)(G.C5,{})]})}}),(0,s.jsx)(G.zB,{control:g.control,name:"reference",render:e=>{let{field:a}=e;return(0,s.jsxs)(G.eI,{children:[(0,s.jsx)(G.lR,{children:"Referencia (Contenedor, Gu\xeda, BL...)"}),(0,s.jsx)(G.MJ,{children:(0,s.jsx)(O.p,{...a,disabled:m,placeholder:"Ingrese la nueva referencia"})}),(0,s.jsx)(G.C5,{})]})}}),N?(0,s.jsxs)("div",{className:"flex items-center justify-center p-4",children:[(0,s.jsx)(h.A,{className:"mr-2 h-4 w-4 animate-spin"}),(0,s.jsx)("span",{className:"text-sm text-muted-foreground",children:"Verificando..."})]}):p&&(0,s.jsxs)("div",{className:"p-4 bg-amber-100 dark:bg-amber-900/30 border border-amber-300 dark:border-amber-700 rounded-lg",children:[(0,s.jsxs)("div",{className:"flex items-center gap-3",children:[(0,s.jsx)(ec.A,{className:"h-5 w-5 text-amber-600 dark:text-amber-400"}),(0,s.jsx)("p",{className:"text-sm font-semibold text-amber-800 dark:text-amber-300",children:"Ya existe un caso para este NE."})]}),(0,s.jsxs)("div",{className:"flex items-center space-x-2 mt-3 pl-2",children:[(0,s.jsx)(eh.d,{id:"extra-case-mode",checked:v,onCheckedChange:f}),(0,s.jsx)(J.J,{htmlFor:"extra-case-mode",className:"text-sm font-medium",children:"Crear como Caso Extraordinario"})]})]}),(0,s.jsxs)(z.Es,{className:"pt-4",children:[(0,s.jsx)(d.$,{type:"button",variant:"outline",onClick:t,children:"Cancelar"}),(0,s.jsxs)(d.$,{type:"submit",disabled:m||N,children:[(m||N)&&(0,s.jsx)(h.A,{className:"mr-2 h-4 w-4 animate-spin"}),m?"Enviando...":"Enviar Solicitud"]})]})]})})]})}):null}var ep=t(11860);let ej=V.z.object({ne:V.z.string().optional(),reference:V.z.string().optional(),recipient:V.z.string().min(1,"Destinatario es requerido.")});function ev(e){let{isOpen:a,onClose:t,caseData:r}=e,{user:i}=(0,o.A)(),{toast:l}=(0,q.dj)(),{setInitialContextData:c,openAddProductModal:u,setIsMemorandumMode:h,initialContextData:m}=(0,ep.U)(),x=(0,n.useRouter)(),p=(0,_.mN)({resolver:(0,F.u)(ej),defaultValues:{ne:(null==r?void 0:r.ne)||(null==m?void 0:m.ne)||"",reference:"",recipient:"Contabilidad"}}),j=e=>{p.setValue("recipient",e,{shouldValidate:!0}),h("memorandum"===e.toLowerCase())},v=async e=>{if(!i||!i.email||!i.displayName)return void l({title:"Error",description:"Debe estar autenticado.",variant:"destructive"});c({ne:e.ne||"SOL-".concat((0,P.GP)(new Date,"ddMMyy-HHmmss")),reference:e.reference,manager:i.displayName,date:new Date,recipient:e.recipient,isMemorandum:"memorandum"===e.recipient.toLowerCase(),consignee:(null==r?void 0:r.consignee)||"",declaracionAduanera:(null==r?void 0:r.declaracionAduanera)||"",caseId:(null==r?void 0:r.id)||""}),x.push("/examinerPay"),t(),setTimeout(()=>{u()},100)};if(!a)return null;let N=!r;return(0,s.jsx)(z.lG,{open:a,onOpenChange:t,children:(0,s.jsxs)(z.Cf,{className:"sm:max-w-md",children:[(0,s.jsxs)(z.c7,{children:[(0,s.jsx)(z.L3,{children:"Iniciar Solicitud de Pago"}),(0,s.jsx)(z.rr,{children:N?"Creando una solicitud de pago general.":"Creando una solicitud para el NE: ".concat(r.ne,".")})]}),(0,s.jsx)(G.lV,{...p,children:(0,s.jsxs)("form",{onSubmit:p.handleSubmit(v),className:"space-y-4 py-4",children:[(0,s.jsx)(G.zB,{control:p.control,name:"ne",render:e=>{let{field:a}=e;return(0,s.jsxs)(G.eI,{children:[(0,s.jsx)(G.lR,{children:"N\xfamero de Entrada (NE)"}),(0,s.jsx)(G.MJ,{children:(0,s.jsx)(O.p,{...a,disabled:N,placeholder:N?"ID \xfanico autogenerado":""})}),(0,s.jsx)(G.C5,{})]})}}),(0,s.jsx)(G.zB,{control:p.control,name:"recipient",render:e=>{let{field:a}=e;return(0,s.jsxs)(G.eI,{children:[(0,s.jsx)(G.lR,{children:"A:"}),(0,s.jsx)(G.MJ,{children:(0,s.jsx)(O.p,{placeholder:"Destinatario o Departamento",...a})}),(0,s.jsxs)("div",{className:"flex flex-wrap gap-2 mt-1",children:[(0,s.jsx)(d.$,{type:"button",variant:"outline",size:"sm",onClick:()=>j("Contabilidad"),className:"text-xs",children:"Contabilidad"}),(0,s.jsx)(d.$,{type:"button",variant:"outline",size:"sm",onClick:()=>j("Harol Ampie - Contabilidad"),className:"text-xs",children:"Harol Ampie"}),(0,s.jsx)(d.$,{type:"button",variant:"outline",size:"sm",onClick:()=>j("Jose Daniel Cerros - Contabilidad"),className:"text-xs",children:"Jose Daniel Cerros"}),(0,s.jsxs)(d.$,{type:"button",variant:"destructive",size:"sm",onClick:()=>j("Memorandum"),className:"text-xs",children:[(0,s.jsx)(f.A,{className:"mr-2 h-4 w-4"}),"Memorandum"]})]}),(0,s.jsx)(G.C5,{})]})}}),(0,s.jsx)(G.zB,{control:p.control,name:"reference",render:e=>{let{field:a}=e;return(0,s.jsxs)(G.eI,{children:[(0,s.jsx)(G.lR,{children:"Referencia (Contenedor, Gu\xeda, BL...)"}),(0,s.jsx)(G.MJ,{children:(0,s.jsx)(O.p,{...a,placeholder:"Ingrese la referencia"})}),(0,s.jsx)(G.C5,{})]})}}),(0,s.jsxs)(z.Es,{className:"pt-4",children:[(0,s.jsx)(d.$,{type:"button",variant:"outline",onClick:t,children:"Cancelar"}),(0,s.jsx)(d.$,{type:"submit",children:"Siguiente"})]})]})})]})})}var ef=t(50984),eN=t(78770),eA=t(26615),eg=t(36654),eb=t(72845),eC=t(11647);function ew(e){let{isOpen:a,onClose:t,caseData:n}=e,[i,l]=(0,r.useState)([]),[o,c]=(0,r.useState)(!0),[u,m]=(0,r.useState)(null);(0,r.useEffect)(()=>{if(!a)return;c(!0),l([]);let e=["SolicitudCheques","Memorandum"].map(e=>{let a=(0,R.P)((0,R.rJ)(E.db,e),(0,R._M)("examNe","==",n.ne),(0,R.My)("savedAt","desc"));return(0,R.aQ)(a,e=>{let a=e.docs.map(e=>{let a=e.data(),t=a.examDate instanceof R.Dc?a.examDate.toDate():void 0,s=a.savedAt instanceof R.Dc?a.savedAt.toDate():void 0;return{...a,solicitudId:e.id,examDate:t,savedAt:s}});l(e=>{let t=new Set(e.map(e=>e.solicitudId)),s=[...e,...a.filter(e=>!t.has(e.solicitudId))];return s.sort((e,a)=>{var t,s;return((null==(t=a.savedAt)?void 0:t.getTime())||0)-((null==(s=e.savedAt)?void 0:s.getTime())||0)}),s}),c(!1)},a=>{console.error("Error fetching payments from ".concat(e,":"),a),c(!1)})});return()=>e.forEach(e=>e())},[a,n.ne]);let x=()=>m(null);if(!a)return null;if(u){let e={ne:u.examNe,reference:u.examReference||void 0,manager:u.examManager,date:u.examDate||new Date,recipient:u.examRecipient,isMemorandum:u.isMemorandum};return(0,s.jsx)(z.lG,{open:!!u,onOpenChange:e=>!e&&x(),children:(0,s.jsx)(z.Cf,{className:"max-w-4xl p-0 h-[90vh] flex flex-col",children:(0,s.jsx)(ei.F,{className:"flex-grow",children:(0,s.jsx)("div",{className:"p-6",children:(0,s.jsx)(eb.A,{solicitud:u,initialData:e,onBackToList:x,children:(0,s.jsx)(z.HM,{asChild:!0,children:(0,s.jsx)(d.$,{variant:"ghost",size:"icon",className:"absolute top-4 right-4",children:(0,s.jsx)(eA.A,{className:"h-4 w-4"})})})})})})})})}return(0,s.jsx)(z.lG,{open:a,onOpenChange:t,children:(0,s.jsxs)(z.Cf,{className:"max-w-2xl",children:[(0,s.jsxs)(z.c7,{children:[(0,s.jsx)(z.L3,{children:"Solicitudes de Pago para el Caso"}),(0,s.jsxs)(z.rr,{children:["Visualizando pagos para el NE: ",n.ne]})]}),(0,s.jsx)("div",{className:"mt-4 max-h-[60vh] overflow-y-auto",children:o?(0,s.jsx)("div",{className:"flex items-center justify-center p-8",children:(0,s.jsx)(h.A,{className:"h-8 w-8 animate-spin text-primary"})}):0===i.length?(0,s.jsx)("div",{className:"text-center text-muted-foreground p-8",children:"No se encontraron solicitudes de pago para este caso."}):(0,s.jsx)("div",{className:"space-y-3",children:i.map(e=>{var a;return(0,s.jsxs)("div",{className:"flex justify-between items-center p-3 border rounded-md hover:bg-muted/50",children:[(0,s.jsxs)("div",{children:[(0,s.jsx)("p",{className:"font-semibold",children:e.solicitudId}),(0,s.jsx)("p",{className:"text-sm text-muted-foreground",children:e.examDate?(0,P.GP)(e.examDate,"PPP",{locale:Y.es}):"Fecha no disponible"})]}),(0,s.jsxs)("div",{className:"flex items-center gap-4",children:["Pagado"===e.paymentStatus?(0,s.jsxs)(eC.E,{className:"bg-green-100 text-green-700 hover:bg-green-200",children:[(0,s.jsx)(ef.A,{className:"mr-2 h-4 w-4"})," Pagado"]}):(null==(a=e.paymentStatus)?void 0:a.startsWith("Error:"))?(0,s.jsxs)(eC.E,{variant:"destructive",children:[(0,s.jsx)(eN.A,{className:"mr-2 h-4 w-4"})," Error"]}):(0,s.jsx)(eC.E,{variant:"outline",children:"Pendiente"}),(0,s.jsxs)(d.$,{variant:"outline",size:"sm",onClick:()=>m(e),children:[(0,s.jsx)(eg.A,{className:"mr-2 h-4 w-4"})," Ver Detalle"]})]})]},e.solicitudId)})})}),(0,s.jsx)(z.Es,{children:(0,s.jsx)(d.$,{variant:"outline",onClick:t,children:"Cerrar"})})]})})}var ey=t(53764),eS=t(36204),eD=t(33173),eE=t(64269);let eR=r.createContext(null);function ek(){let e=r.useContext(eR);if(!e)throw Error("useCarousel must be used within a <Carousel />");return e}let eI=r.forwardRef((e,a)=>{let{orientation:t="horizontal",opts:n,setApi:i,plugins:l,className:o,children:c,...d}=e,[u,h]=(0,ey.A)({...n,axis:"horizontal"===t?"x":"y"},l),[m,x]=r.useState(!1),[p,j]=r.useState(!1),v=r.useCallback(e=>{e&&(x(e.canScrollPrev()),j(e.canScrollNext()))},[]),f=r.useCallback(()=>{null==h||h.scrollPrev()},[h]),N=r.useCallback(()=>{null==h||h.scrollNext()},[h]),A=r.useCallback(e=>{"ArrowLeft"===e.key?(e.preventDefault(),f()):"ArrowRight"===e.key&&(e.preventDefault(),N())},[f,N]);return r.useEffect(()=>{h&&i&&i(h)},[h,i]),r.useEffect(()=>{if(h)return v(h),h.on("reInit",v),h.on("select",v),()=>{null==h||h.off("select",v)}},[h,v]),(0,s.jsx)(eR.Provider,{value:{carouselRef:u,api:h,opts:n,orientation:t||((null==n?void 0:n.axis)==="y"?"vertical":"horizontal"),scrollPrev:f,scrollNext:N,canScrollPrev:m,canScrollNext:p},children:(0,s.jsx)("div",{ref:a,onKeyDownCapture:A,className:(0,eE.cn)("relative",o),role:"region","aria-roledescription":"carousel",...d,children:c})})});eI.displayName="Carousel";let eP=r.forwardRef((e,a)=>{let{className:t,...r}=e,{carouselRef:n,orientation:i}=ek();return(0,s.jsx)("div",{ref:n,className:"overflow-hidden",children:(0,s.jsx)("div",{ref:a,className:(0,eE.cn)("flex","horizontal"===i?"-ml-4":"-mt-4 flex-col",t),...r})})});eP.displayName="CarouselContent";let eO=r.forwardRef((e,a)=>{let{className:t,...r}=e,{orientation:n}=ek();return(0,s.jsx)("div",{ref:a,role:"group","aria-roledescription":"slide",className:(0,eE.cn)("min-w-0 shrink-0 grow-0 basis-full","horizontal"===n?"pl-4":"pt-4",t),...r})});eO.displayName="CarouselItem";let eM=r.forwardRef((e,a)=>{let{className:t,variant:r="outline",size:n="icon",...i}=e,{orientation:l,scrollPrev:o,canScrollPrev:c}=ek();return(0,s.jsxs)(d.$,{ref:a,variant:r,size:n,className:(0,eE.cn)("absolute h-8 w-8 rounded-full","horizontal"===l?"-left-12 top-1/2 -translate-y-1/2":"-top-12 left-1/2 -translate-x-1/2 rotate-90",t),disabled:!c,onClick:o,...i,children:[(0,s.jsx)(eS.A,{className:"h-4 w-4"}),(0,s.jsx)("span",{className:"sr-only",children:"Previous slide"})]})});eM.displayName="CarouselPrevious";let eL=r.forwardRef((e,a)=>{let{className:t,variant:r="outline",size:n="icon",...i}=e,{orientation:l,scrollNext:o,canScrollNext:c}=ek();return(0,s.jsxs)(d.$,{ref:a,variant:r,size:n,className:(0,eE.cn)("absolute h-8 w-8 rounded-full","horizontal"===l?"-right-12 top-1/2 -translate-y-1/2":"-bottom-12 left-1/2 -translate-x-1/2 rotate-90",t),disabled:!c,onClick:o,...i,children:[(0,s.jsx)(eD.A,{className:"h-4 w-4"}),(0,s.jsx)("span",{className:"sr-only",children:"Next slide"})]})});eL.displayName="CarouselNext";var eT=t(71700);function e_(){let[e,a]=(0,r.useState)([]),[t,n]=(0,r.useState)(!0),[i,l]=(0,r.useState)(),o=(0,r.useRef)((0,eT.A)({delay:4e3,stopOnInteraction:!1,stopOnMouseEnter:!0}));if((0,r.useEffect)(()=>{let e=(0,R.P)((0,R.rJ)(E.db,"avisos"),(0,R.My)("createdAt","desc")),t=(0,R.aQ)(e,e=>{a(e.docs.map(e=>({id:e.id,...e.data()}))),n(!1)},e=>{console.error("Error fetching announcements:",e),n(!1)});return()=>t()},[]),t)return(0,s.jsx)(u.Zp,{className:"w-full mx-auto custom-shadow",children:(0,s.jsx)(u.Wu,{className:"pt-6",children:(0,s.jsx)("div",{className:"animate-pulse flex space-x-4",children:(0,s.jsxs)("div",{className:"flex-1 space-y-3 py-1",children:[(0,s.jsx)("div",{className:"h-4 bg-muted rounded w-3/4"}),(0,s.jsxs)("div",{className:"space-y-2",children:[(0,s.jsx)("div",{className:"h-3 bg-muted rounded"}),(0,s.jsx)("div",{className:"h-3 bg-muted rounded w-5/6"})]})]})})})});if(0===e.length)return null;let c=e=>{let{ann:a}=e;return(0,s.jsxs)(u.Zp,{className:"h-full custom-shadow bg-card flex flex-col",children:[(0,s.jsx)(u.aR,{className:"pb-2 pt-4",children:(0,s.jsx)(u.ZB,{className:"text-base font-semibold",children:a.title})}),(0,s.jsx)(u.Wu,{className:"flex-grow py-2",children:(0,s.jsx)("p",{className:"text-sm text-card-foreground/80",children:a.content})}),a.linkUrl&&a.linkText&&(0,s.jsx)(u.wL,{className:"pt-2 pb-4",children:(0,s.jsx)(d.$,{asChild:!0,variant:"link",className:"p-0 h-auto text-sm",children:(0,s.jsx)("a",{href:a.linkUrl,target:"_blank",rel:"noopener noreferrer",children:a.linkText})})})]})};return e.length>0&&e.length<=3?(0,s.jsx)("div",{className:"grid grid-cols-1 md:grid-cols-".concat(e.length," gap-4"),children:e.map(e=>(0,s.jsx)(c,{ann:e},e.id))}):(0,s.jsxs)(eI,{setApi:l,plugins:[o.current],className:"w-full group/carousel",opts:{align:"start",loop:!0},children:[(0,s.jsx)(eP,{children:e.map(e=>(0,s.jsx)(eO,{className:"md:basis-1/2 lg:basis-1/3",children:(0,s.jsx)("div",{className:"p-1 h-full",children:(0,s.jsx)(c,{ann:e})})},e.id))}),(0,s.jsx)(eM,{className:"absolute left-2 top-1/2 -translate-y-1/2 z-10 h-8 w-8 rounded-full bg-background/50 text-foreground border-border/50 backdrop-blur-sm opacity-0 group-hover/carousel:opacity-100 transition-opacity hover:bg-background/75"}),(0,s.jsx)(eL,{className:"absolute right-2 top-1/2 -translate-y-1/2 z-10 h-8 w-8 rounded-full bg-background/50 text-foreground border-border/50 backdrop-blur-sm opacity-0 group-hover/carousel:opacity-100 transition-opacity hover:bg-background/75"})]})}var eF=t(43854);let eV=V.z.object({resaNumber:V.z.string().min(1,"El n\xfamero de RESA es requerido."),resaNotificationDate:V.z.date({required_error:"La fecha de notificaci\xf3n es requerida."})});function ez(e){let{isOpen:a,onClose:t,caseData:n}=e,{user:i}=(0,o.A)(),{toast:l}=(0,q.dj)(),[c,u]=(0,r.useState)(!1),[m,x]=(0,r.useState)(null),p=(0,_.mN)({resolver:(0,F.u)(eV),defaultValues:{resaNumber:"",resaNotificationDate:void 0}});(0,r.useEffect)(()=>{let e=async()=>{var e,a;let t=null;if(n.worksheetId){let e=await (0,R.x7)((0,R.H9)(E.db,"worksheets",n.worksheetId));e.exists()&&(t=e.data())}p.reset({resaNumber:n.resaNumber||(null==t?void 0:t.resa)||"",resaNotificationDate:(null==(e=n.resaNotificationDate)?void 0:e.toDate())||(null==t||null==(a=t.resaNotificationDate)?void 0:a.toDate())||void 0})};a&&e()},[a,n,p]);let j=p.watch("resaNotificationDate");(0,r.useEffect)(()=>{j?x((0,U.f)(j,20)):x(null)},[j]);let v=async e=>{if(!i||!i.displayName)return void l({title:"Error",description:"Debe estar autenticado.",variant:"destructive"});if(!m)return void l({title:"Error",description:"No se pudo calcular la fecha de vencimiento.",variant:"destructive"});u(!0);let a=(0,R.H9)(E.db,"AforoCases",n.id),s=(0,R.rJ)(a,"actualizaciones"),r=(0,R.wP)(E.db);try{let o={resaNumber:e.resaNumber,resaNotificationDate:R.Dc.fromDate(e.resaNotificationDate),resaDueDate:R.Dc.fromDate(m)};if(n.worksheetId){let e=(0,R.H9)(E.db,"worksheets",n.worksheetId);r.update(e,o)}r.update(a,o);let c={updatedAt:R.Dc.now(),updatedBy:i.displayName,field:"resa_notification",oldValue:{number:n.resaNumber||null,date:n.resaNotificationDate||null},newValue:{number:e.resaNumber,date:e.resaNotificationDate},comment:"RESA ".concat(e.resaNumber," notificada. Vence el ").concat(m.toLocaleDateString(),".")};r.set((0,R.H9)(s),c),await r.commit(),l({title:"RESA Notificada",description:"El caso NE ".concat(n.ne," ha sido actualizado con la informaci\xf3n de la RESA.")}),t()}catch(e){console.error("Error updating RESA notification:",e),l({title:"Error",description:"No se pudo procesar la notificaci\xf3n.",variant:"destructive"})}finally{u(!1)}};return a?(0,s.jsx)(z.lG,{open:a,onOpenChange:t,children:(0,s.jsxs)(z.Cf,{className:"sm:max-w-md",children:[(0,s.jsxs)(z.c7,{children:[(0,s.jsx)(z.L3,{children:"Notificar RESA"}),(0,s.jsxs)(z.rr,{children:["Ingrese los detalles de la RESA para el caso NE: ",(0,s.jsx)("span",{className:"font-bold text-foreground",children:n.ne}),"."]})]}),(0,s.jsx)(G.lV,{...p,children:(0,s.jsxs)("form",{onSubmit:p.handleSubmit(v),className:"space-y-4 py-4",children:[(0,s.jsx)(G.zB,{control:p.control,name:"resaNumber",render:e=>{let{field:a}=e;return(0,s.jsxs)(G.eI,{children:[(0,s.jsx)(G.lR,{children:"N\xfamero de RESA"}),(0,s.jsx)(G.MJ,{children:(0,s.jsx)(O.p,{...a,placeholder:"Ingrese el n\xfamero..."})}),(0,s.jsx)(G.C5,{})]})}}),(0,s.jsx)(G.zB,{control:p.control,name:"resaNotificationDate",render:e=>{let{field:a}=e;return(0,s.jsxs)(G.eI,{className:"flex flex-col",children:[(0,s.jsx)(G.lR,{children:"Fecha de Notificaci\xf3n"}),(0,s.jsx)(G.MJ,{children:(0,s.jsx)(H.l,{date:a.value,onDateChange:a.onChange})}),(0,s.jsx)(G.C5,{})]})}}),(0,s.jsxs)("div",{children:[(0,s.jsx)(J.J,{children:"Fecha de Vencimiento (calculada)"}),(0,s.jsx)(O.p,{readOnly:!0,value:m?m.toLocaleDateString("es-NI",{weekday:"long",year:"numeric",month:"long",day:"numeric"}):"Seleccione fecha de notificaci\xf3n",className:"bg-muted/50 cursor-not-allowed"})]}),(0,s.jsxs)(z.Es,{className:"pt-4",children:[(0,s.jsx)(d.$,{type:"button",variant:"outline",onClick:t,children:"Cancelar"}),(0,s.jsxs)(d.$,{type:"submit",disabled:c,children:[c&&(0,s.jsx)(h.A,{className:"mr-2 h-4 w-4 animate-spin"}),"Guardar Notificaci\xf3n"]})]})]})})]})}):null}var eG=t(44385),eq=t(13496),eH=t(68425),eU=t(77187),eB=t(90576),e$=t(15039),eJ=t(59915),eW=t(27500),eZ=t(63260),eX=t(89522);let eQ=e=>{let{label:a,children:t}=e;return(0,s.jsxs)("div",{className:"flex justify-between items-center py-2 border-b border-border/50",children:[(0,s.jsx)("p",{className:"text-sm font-medium text-muted-foreground",children:a}),(0,s.jsx)("div",{className:"text-sm text-right text-foreground",children:t})]})},eY=e=>{var a;let{caseData:t,savingState:r,caseActions:n,onAutoSave:i,approvePreliquidation:l}=e,o=(t.facturaNumber?t.facturaNumber.split(";").map(e=>e.trim()):[])[0]||"N/A";return(0,s.jsxs)(u.Zp,{className:"w-full",children:[(0,s.jsx)(u.aR,{children:(0,s.jsxs)("div",{className:"flex justify-between items-start",children:[(0,s.jsxs)("div",{children:[(0,s.jsx)(u.ZB,{className:"font-bold text-lg text-primary",children:t.ne}),(0,s.jsx)("p",{className:"text-sm text-muted-foreground truncate max-w-[200px]",children:t.consignee})]}),(0,s.jsxs)(ea.rI,{children:[(0,s.jsx)(ea.ty,{asChild:!0,children:(0,s.jsxs)(d.$,{variant:"ghost",className:"h-8 w-8 p-0",children:[(0,s.jsx)("span",{className:"sr-only",children:"Abrir"}),(0,s.jsx)(eH.A,{className:"h-5 w-5"})]})}),(0,s.jsxs)(ea.SQ,{align:"end",children:[(0,s.jsxs)(ea._2,{onSelect:()=>n.handleViewWorksheet(t),disabled:!t.worksheetId,children:[(0,s.jsx)(eU.A,{className:"mr-2 h-4 w-4"})," Ver Hoja de Trabajo"]}),(0,s.jsxs)(ea._2,{onSelect:()=>n.handleSearchPrevio(t.ne),children:[(0,s.jsx)(N.A,{className:"mr-2 h-4 w-4"})," Buscar Previo"]}),(0,s.jsxs)(ea._2,{onSelect:()=>n.setSelectedCaseForDocs(t),disabled:!t,children:[(0,s.jsx)(j.A,{className:"mr-2 h-4 w-4"})," Docs y Permisos"]}),(0,s.jsxs)(ea._2,{onSelect:()=>n.setSelectedCaseForQuickRequest(t),disabled:!t.worksheet,children:[(0,s.jsx)(j.A,{className:"mr-2 h-4 w-4"})," Solicitar Previo"]}),(0,s.jsxs)(ea._2,{onSelect:()=>n.setSelectedCaseForPayment(t),disabled:!t,children:[(0,s.jsx)(x.A,{className:"mr-2 h-4 w-4"})," Solicitud de Pago"]}),(0,s.jsxs)(ea._2,{onSelect:()=>n.setSelectedCaseForPaymentList(t),disabled:!t,children:[(0,s.jsx)(x.A,{className:"mr-2 h-4 w-4 text-blue-500"})," Ver Pagos"]}),(0,s.jsxs)(ea._2,{onSelect:()=>n.setSelectedCaseForResa(t),disabled:!t,children:[(0,s.jsx)(eB.A,{className:"mr-2 h-4 w-4 text-orange-500"})," Notificar RESA"]}),(0,s.jsx)(ea.mB,{}),(0,s.jsxs)(ea._2,{onSelect:()=>n.setSelectedCaseForIncident(t),disabled:!t,children:[(0,s.jsx)(ec.A,{className:"mr-2 h-4 w-4 text-amber-600"})," Reportar Incidencia"]}),(0,s.jsxs)(ea._2,{onSelect:()=>n.setSelectedCaseForValueDoubt(t),disabled:!t,children:[(0,s.jsx)(e$.A,{className:"mr-2 h-4 w-4 text-rose-600"})," Reportar Duda de Valor"]}),(0,s.jsx)(ea.mB,{}),(0,s.jsxs)(ea._2,{onSelect:()=>n.setSelectedCaseForHistory(t),disabled:!t,children:[(0,s.jsx)(eJ.A,{className:"mr-2 h-4 w-4"})," Ver Bit\xe1cora"]}),t.incidentReported&&(0,s.jsxs)(ea._2,{onSelect:()=>n.setSelectedIncidentForDetails(t),children:[(0,s.jsx)(eg.A,{className:"mr-2 h-4 w-4"})," Ver Incidencia"]}),(0,s.jsxs)(ea._2,{onSelect:()=>n.setSelectedCaseForComment(t),children:[(0,s.jsx)(eW.A,{className:"mr-2 h-4 w-4"})," A\xf1adir/Ver Comentarios"]})]})]})]})}),(0,s.jsxs)(u.Wu,{children:[(0,s.jsx)("div",{className:"flex justify-center items-center mb-4",children:(0,s.jsx)(eX.V,{caseData:t})}),(0,s.jsx)(eq.nD,{type:"single",collapsible:!0,className:"w-full",children:(0,s.jsxs)(eq.As,{value:"item-1",children:[(0,s.jsx)(eq.$m,{children:"Ver Detalles Completos"}),(0,s.jsx)(eq.ub,{children:(0,s.jsxs)("div",{className:"space-y-2 pt-2",children:[(0,s.jsx)(eQ,{label:"Ejecutivo",children:t.executive}),(0,s.jsx)(eQ,{label:"Factura",children:o}),(0,s.jsx)(eQ,{label:"Estado Aforador",children:(0,s.jsx)(eC.E,{variant:(e=>{switch(e){case"En revisi\xf3n":return"default";case"Incompleto":case"Pendiente":return"destructive";case"En proceso":return"secondary";default:return"outline"}})(t.aforadorStatus),children:t.aforadorStatus||"Pendiente"})}),(0,s.jsx)(eQ,{label:"Estado Revisor",children:(0,s.jsx)(eC.E,{variant:(e=>{switch(e){case"Aprobado":return"default";case"Rechazado":return"destructive";case"Revalidaci\xf3n Solicitada":return"secondary";default:return"outline"}})(t.revisorStatus),children:t.revisorStatus||"Pendiente"})}),(0,s.jsx)(eQ,{label:"Preliquidaci\xf3n",children:"Aprobado"===t.revisorStatus&&"Aprobada"!==t.preliquidationStatus?(0,s.jsxs)(d.$,{size:"sm",onClick:()=>l(t.id),disabled:r[t.id],children:[(0,s.jsx)(A.A,{className:"mr-2 h-4 w-4"})," Aprobar"]}):"Aprobada"===t.preliquidationStatus?(0,s.jsx)(eC.E,{variant:"default",className:"bg-green-600",children:"Aprobada"}):(0,s.jsx)(eC.E,{variant:"outline",children:"Pendiente"})}),(0,s.jsx)(eQ,{label:"Estado Digitaci\xf3n",children:((e,a)=>"Tr\xe1mite Completo"===e?(0,s.jsx)(eC.E,{variant:"default",className:"bg-green-600",children:a||"Finalizado"}):e?(0,s.jsx)(eC.E,{variant:"En Proceso"===e?"secondary":"outline",children:e}):(0,s.jsx)(eC.E,{variant:"outline",children:"Pendiente"}))(t.digitacionStatus,t.declaracionAduanera)}),(0,s.jsx)(eQ,{label:"Tipo Incidencia",children:(e=>{let a=[];return"Rectificacion"===e.incidentType&&a.push("Rectificaci\xf3n"),e.hasValueDoubt&&a.push("Duda de Valor"),a.length>0?a.join(" / "):"N/A"})(t)}),(0,s.jsx)(eQ,{label:"Facturado",children:t.facturado?(0,s.jsx)(eC.E,{variant:"default",className:"bg-green-600",children:"Facturado"}):"No"}),(0,s.jsxs)("div",{className:"py-2",children:[(0,s.jsx)("p",{className:"text-sm font-medium text-muted-foreground mb-1",children:"Selectividad"}),(0,s.jsxs)($.l6,{value:t.selectividad||"",onValueChange:e=>i(t.id,"selectividad",e),disabled:r[t.id]||!t.declaracionAduanera,children:[(0,s.jsx)($.bq,{children:(0,s.jsx)($.yv,{placeholder:"Seleccionar..."})}),(0,s.jsxs)($.gC,{children:[(0,s.jsx)($.eb,{value:"VERDE",children:"VERDE"}),(0,s.jsx)($.eb,{value:"AMARILLO",children:"AMARILLO"}),(0,s.jsx)($.eb,{value:"ROJO",children:"ROJO"})]})]})]}),(0,s.jsxs)("div",{className:"py-2",children:[(0,s.jsx)("p",{className:"text-sm font-medium text-muted-foreground mb-1",children:"Fecha Despacho"}),(0,s.jsx)(eZ.I,{date:null==(a=t.fechaDespacho)?void 0:a.toDate(),onDateChange:e=>i(t.id,"fechaDespacho",e?R.Dc.fromDate(e):null),disabled:r[t.id]||"VERDE"!==t.selectividad&&"ROJO"!==t.selectividad})]})]})})]})})]})]},t.id)};function eK(e){let{cases:a,savingState:t,onAutoSave:r,approvePreliquidation:n,caseActions:i}=e;return(0,s.jsx)("div",{className:"space-y-4",children:a.map(e=>(0,s.jsx)(eY,{caseData:e,savingState:t,caseActions:i,onAutoSave:r,approvePreliquidation:n},e.id))})}var e0=t(98053);function e1(e){let{isOpen:a,onClose:t,onSelectRectificacion:r,onSelectDudaValor:n}=e;return a?(0,s.jsx)(z.lG,{open:a,onOpenChange:t,children:(0,s.jsxs)(z.Cf,{className:"sm:max-w-md",children:[(0,s.jsxs)(z.c7,{children:[(0,s.jsx)(z.L3,{children:"Seleccionar Incidencia"}),(0,s.jsx)(z.rr,{children:"Este caso tiene m\xfaltiples incidencias reportadas. Por favor, seleccione cu\xe1l desea visualizar o editar."})]}),(0,s.jsxs)("div",{className:"flex flex-col gap-4 py-4",children:[(0,s.jsxs)(d.$,{onClick:r,variant:"secondary",size:"lg",className:"justify-start gap-3",children:[(0,s.jsx)(ec.A,{className:"h-5 w-5 text-amber-600"}),(0,s.jsx)("span",{children:"Ver/Editar Reporte de Rectificaci\xf3n"})]}),(0,s.jsxs)(d.$,{onClick:n,variant:"secondary",size:"lg",className:"justify-start gap-3",children:[(0,s.jsx)(e$.A,{className:"h-5 w-5 text-rose-600"}),(0,s.jsx)("span",{children:"Ver/Editar Reporte de Duda de Valor"})]})]}),(0,s.jsx)(z.Es,{children:(0,s.jsx)(d.$,{type:"button",variant:"outline",onClick:t,children:"Cancelar"})})]})}):null}var e4=t(13406),e2=t(46767),e5=t(62593),e3=t(29653),e8=t(28068),e6=t(43371);let e9=e=>{if(!e)return"N/A";let a=(null==e?void 0:e.toDate)?e.toDate():(0,e6.a)(e);return(0,P.GP)(a,"dd/MM/yy HH:mm",{locale:Y.es})},e7=e=>{let{title:a,status:t,lastUpdate:r,icon:n}=e;return(0,s.jsxs)("div",{className:"flex items-start gap-4",children:[(0,s.jsxs)("div",{className:"flex flex-col items-center",children:[(0,s.jsx)("div",{className:"rounded-full bg-primary/10 text-primary p-2",children:n}),(0,s.jsx)("div",{className:"w-px h-12 bg-border mt-2"})]}),(0,s.jsxs)("div",{className:"flex-1 pb-12",children:[(0,s.jsx)("p",{className:"font-semibold text-foreground",children:a}),(0,s.jsxs)("div",{className:"flex items-center gap-2 mt-1",children:[(0,s.jsx)(eC.E,{variant:(e=>{let a=e.toLowerCase();return a.includes("aprobado")||a.includes("completo")?"default":a.includes("rechazado")||a.includes("incompleto")?"destructive":a.includes("proceso")||a.includes("revisi\xf3n")?"secondary":"outline"})(t),children:t}),r&&r.by&&(0,s.jsx)(e2.Bc,{children:(0,s.jsxs)(e2.m_,{children:[(0,s.jsx)(e2.k$,{asChild:!0,children:(0,s.jsxs)("p",{className:"text-xs text-muted-foreground cursor-help",children:["por ",r.by]})}),(0,s.jsx)(e2.ZI,{children:(0,s.jsxs)("p",{children:["Fecha: ",e9(r.at)]})})]})})]})]})]})};function ae(e){let{isOpen:a,onClose:t,caseData:r}=e;if(!a)return null;let n=(e,a,t)=>{let s=e||a,r=t[s]||e5.A;return{status:s,Icon:r}},i=n(r.aforadorStatus,"Pendiente ",{"En revisi\xf3n":e3.A,"Pendiente ":e5.A,Incompleto:e8.A,"En proceso":e3.A}),l=n(r.revisorStatus,"Pendiente",{Aprobado:A.A,Rechazado:e8.A,Pendiente:e5.A}),o=n(r.preliquidationStatus,"Pendiente",{Aprobada:A.A,Pendiente:e5.A}),c=n(r.digitacionStatus,"Pendiente",{"Tr\xe1mite Completo":A.A,"Pendiente de Digitaci\xf3n":e5.A,"En Proceso":e3.A,Almacenado:A.A});return(0,s.jsx)(z.lG,{open:a,onOpenChange:t,children:(0,s.jsxs)(z.Cf,{className:"max-w-md",children:[(0,s.jsxs)(z.c7,{children:[(0,s.jsx)(z.L3,{children:"L\xednea de Proceso del Caso"}),(0,s.jsxs)(z.rr,{children:["Seguimiento del estado para el NE: ",(0,s.jsx)("span",{className:"font-bold text-foreground",children:r.ne})]})]}),(0,s.jsxs)("div",{className:"py-4 -mb-12",children:[(0,s.jsx)(e7,{title:"1. Proceso de Aforo",status:i.status,lastUpdate:r.aforadorStatusLastUpdate,icon:(0,s.jsx)(i.Icon,{className:"h-5 w-5"})}),(0,s.jsx)(e7,{title:"2. Revisi\xf3n de Agente",status:l.status,lastUpdate:r.revisorStatusLastUpdate,icon:(0,s.jsx)(l.Icon,{className:"h-5 w-5"})}),(0,s.jsx)(e7,{title:"3. Preliquidaci\xf3n",status:o.status,lastUpdate:r.preliquidationStatusLastUpdate,icon:(0,s.jsx)(o.Icon,{className:"h-5 w-5"})}),(0,s.jsxs)("div",{className:"flex items-start gap-4",children:[(0,s.jsx)("div",{className:"flex flex-col items-center",children:(0,s.jsx)("div",{className:"rounded-full bg-primary/10 text-primary p-2",children:(0,s.jsx)(c.Icon,{className:"h-5 w-5"})})}),(0,s.jsxs)("div",{className:"flex-1",children:[(0,s.jsx)("p",{className:"font-semibold text-foreground",children:"4. Digitaci\xf3n"}),(0,s.jsxs)("div",{className:"flex items-center gap-2 mt-1",children:[(0,s.jsx)(eC.E,{variant:function(e){let a=e.toLowerCase();return a.includes("aprobado")||a.includes("completo")||a.includes("almacenado")?"default":a.includes("rechazado")||a.includes("incompleto")?"destructive":a.includes("proceso")||a.includes("revisi\xf3n")?"secondary":"outline"}(c.status),children:c.status}),r.digitacionStatusLastUpdate&&r.digitacionStatusLastUpdate.by&&(0,s.jsx)(e2.Bc,{children:(0,s.jsxs)(e2.m_,{children:[(0,s.jsx)(e2.k$,{asChild:!0,children:(0,s.jsxs)("p",{className:"text-xs text-muted-foreground cursor-help",children:["por ",r.digitacionStatusLastUpdate.by]})}),(0,s.jsx)(e2.ZI,{children:(0,s.jsxs)("p",{children:["Fecha: ",e9(r.digitacionStatusLastUpdate.at)]})})]})})]})]})]})]}),(0,s.jsx)(z.Es,{children:(0,s.jsx)(d.$,{variant:"outline",onClick:t,children:"Cerrar"})})]})})}var aa=t(87270),at=t(48109),as=t(63037),ar=t(81288),an=t(66065),ai=t(94979);function al(e){let{cases:a,savingState:t,onAutoSave:r,approvePreliquidation:n,caseActions:i,selectedRows:c,onSelectRow:u,onSelectAllRows:h,neFilter:m,setNeFilter:p,ejecutivoFilter:v,setEjecutivoFilter:f,consignatarioFilter:g,setConsignatarioFilter:b,facturaFilter:C,setFacturaFilter:w,selectividadFilter:y,setSelectividadFilter:S,incidentTypeFilter:D,setIncidentTypeFilter:E,handleSendToFacturacion:k}=e,{user:I}=(0,o.A)();return(0,s.jsx)("div",{className:"overflow-x-auto table-container rounded-lg border",children:(0,s.jsx)(e2.Bc,{children:(0,s.jsxs)(aa.XI,{children:[(0,s.jsx)(aa.A0,{children:(0,s.jsxs)(aa.Hj,{children:[(0,s.jsx)(aa.nd,{className:"w-12",children:(0,s.jsx)(B.S,{checked:c.length>0&&c.length===a.filter(e=>"Aprobado"===e.revisorStatus&&"Aprobada"!==e.preliquidationStatus).length,onCheckedChange:h,"aria-label":"Seleccionar todo para preliquidaci\xf3n"})}),(0,s.jsx)(aa.nd,{children:"Acciones"}),(0,s.jsx)(aa.nd,{children:(0,s.jsx)(O.p,{placeholder:"NE...",className:"h-8 text-xs",value:m,onChange:e=>p(e.target.value)})}),(0,s.jsx)(aa.nd,{children:"Insignias"}),(0,s.jsx)(aa.nd,{children:(0,s.jsx)(O.p,{placeholder:"Ejecutivo...",className:"h-8 text-xs",value:v,onChange:e=>f(e.target.value)})}),(0,s.jsx)(aa.nd,{children:(0,s.jsx)(O.p,{placeholder:"Consignatario...",className:"h-8 text-xs",value:g,onChange:e=>b(e.target.value)})}),(0,s.jsx)(aa.nd,{children:(0,s.jsx)(O.p,{placeholder:"Factura...",className:"h-8 text-xs",value:C,onChange:e=>w(e.target.value)})}),(0,s.jsx)(aa.nd,{children:"Preliquidaci\xf3n"}),(0,s.jsx)(aa.nd,{children:"Estado General"}),(0,s.jsx)(aa.nd,{children:(0,s.jsx)(O.p,{placeholder:"Selectividad...",className:"h-8 text-xs",value:y,onChange:e=>S(e.target.value)})}),(0,s.jsx)(aa.nd,{children:"Fecha Despacho"}),(0,s.jsx)(aa.nd,{children:(0,s.jsx)(O.p,{placeholder:"Incidencia...",className:"h-8 text-xs",value:D,onChange:e=>E(e.target.value)})}),(0,s.jsx)(aa.nd,{children:"Facturado"})]})}),(0,s.jsx)(aa.BF,{children:a.map(e=>{var a,o,h,m,p,v;let f=(null==(a=e.worksheet)?void 0:a.worksheetType)==="corporate_report"?(null==(o=e.worksheet.documents)?void 0:o.filter(e=>"FACTURA"===e.type).map(e=>e.number))||[]:e.facturaNumber?e.facturaNumber.split(";").map(e=>e.trim()):[],g=f[0]||"",b=f.length>1?f.length-1:0,C="PSMT NICARAGUA, SOCIEDAD ANONIMA"===e.consignee.toUpperCase().trim(),w=e.resaDueDate?(0,at.c)(e.resaDueDate.toDate(),new Date):null;return(0,s.jsxs)(aa.Hj,{className:t[e.id]?"bg-amber-100":null!==w&&w<-15?"bg-red-200 hover:bg-red-200/80":"","data-state":c.includes(e.id)?"selected":void 0,children:[(0,s.jsx)(aa.nA,{children:(0,s.jsx)(B.S,{checked:c.includes(e.id),onCheckedChange:()=>u(a=>a.includes(e.id)?a.filter(a=>a!==e.id):[...a,e.id]),"aria-label":"Seleccionar caso ".concat(e.ne)})}),(0,s.jsx)(aa.nA,{children:(0,s.jsxs)("div",{className:"flex items-center gap-0.5",children:[(0,s.jsxs)(ea.rI,{children:[(0,s.jsx)(ea.ty,{asChild:!0,children:(0,s.jsx)(d.$,{variant:"ghost",size:"sm",children:"Ver"})}),(0,s.jsxs)(ea.SQ,{children:[(0,s.jsxs)(ea._2,{onSelect:()=>i.handleViewWorksheet(e),disabled:!e.worksheetId,children:[(0,s.jsx)(eU.A,{className:"mr-2 h-4 w-4"})," Ver Hoja de Trabajo"]}),(0,s.jsxs)(ea._2,{onSelect:()=>i.handleSearchPrevio(e.ne),children:[(0,s.jsx)(N.A,{className:"mr-2 h-4 w-4"})," Buscar Previo"]}),(0,s.jsx)(ea._2,{asChild:!0,children:(0,s.jsxs)(l(),{href:"/managerpermisos?id=".concat(e.id),children:[(0,s.jsx)(j.A,{className:"mr-2 h-4 w-4"})," Docs y Permisos"]})}),(0,s.jsxs)(ea._2,{onSelect:()=>i.setSelectedCaseForQuickRequest(e),disabled:!e.worksheet,children:[(0,s.jsx)(j.A,{className:"mr-2 h-4 w-4"})," Solicitar Previo"]}),(0,s.jsxs)(ea._2,{onSelect:()=>i.setSelectedCaseForPayment(e),disabled:!e,children:[(0,s.jsx)(x.A,{className:"mr-2 h-4 w-4"})," Solicitud de Pago"]}),(0,s.jsxs)(ea._2,{onSelect:()=>i.setSelectedCaseForPaymentList(e),disabled:!e,children:[(0,s.jsx)(x.A,{className:"mr-2 h-4 w-4 text-blue-500"})," Ver Pagos"]}),(0,s.jsxs)(ea._2,{onSelect:()=>i.setSelectedCaseForResa(e),disabled:!e,children:[(0,s.jsx)(eB.A,{className:"mr-2 h-4 w-4 text-orange-500"})," Notificar RESA"]}),(0,s.jsx)(ea.mB,{}),(0,s.jsxs)(ea._2,{onSelect:()=>i.setSelectedCaseForIncident(e),disabled:!e,children:[(0,s.jsx)(ec.A,{className:"mr-2 h-4 w-4 text-amber-600"})," Reportar Incidencia"]}),(0,s.jsxs)(ea._2,{onSelect:()=>i.setSelectedCaseForValueDoubt(e),disabled:!e,children:[(0,s.jsx)(e$.A,{className:"mr-2 h-4 w-4 text-rose-600"})," Reportar Duda de Valor"]}),(0,s.jsx)(ea.mB,{}),(0,s.jsxs)(ea._2,{onSelect:()=>i.setSelectedCaseForHistory(e),disabled:!e,children:[(0,s.jsx)(eJ.A,{className:"mr-2 h-4 w-4"})," Ver Bit\xe1cora"]}),e.incidentReported&&(0,s.jsxs)(ea._2,{onSelect:()=>i.handleViewIncidents(e),children:[(0,s.jsx)(eg.A,{className:"mr-2 h-4 w-4"})," Ver Incidencia"]}),(null==I?void 0:I.role)==="admin"&&(0,s.jsxs)(ea._2,{onClick:()=>i.setCaseToArchive(e),className:"text-destructive",children:[(0,s.jsx)(as.A,{className:"mr-2 h-4 w-4"})," Archivar"]}),((null==I?void 0:I.role)==="admin"||(null==I?void 0:I.role)==="coordinadora")&&(null==(h=e.worksheet)?void 0:h.worksheetType)==="hoja_de_trabajo"&&(0,s.jsxs)(ea._2,{onClick:()=>{i.setCaseToDuplicate(e),i.setDuplicateAndRetireModalOpen(!0)},className:"text-destructive",children:[(0,s.jsx)(ar.A,{className:"mr-2 h-4 w-4"})," Duplicar y Retirar"]})]})]}),(0,s.jsxs)(e2.m_,{children:[(0,s.jsx)(e2.k$,{asChild:!0,children:(0,s.jsx)(d.$,{variant:"ghost",size:"icon",className:"h-8 w-8",onClick:()=>i.setSelectedCaseForComment(e),children:(0,s.jsx)(eW.A,{className:"h-4 w-4"})})}),(0,s.jsx)(e2.ZI,{children:(0,s.jsx)("p",{children:"A\xf1adir/Ver Comentarios"})})]})]})}),(0,s.jsx)(aa.nA,{className:"font-medium",children:e.ne}),(0,s.jsx)(aa.nA,{children:(0,s.jsx)(eX.V,{caseData:e})}),(0,s.jsx)(aa.nA,{children:e.executive}),(0,s.jsx)(aa.nA,{children:e.consignee.length>13?(0,s.jsxs)(e2.m_,{children:[(0,s.jsx)(e2.k$,{asChild:!0,children:(0,s.jsxs)("span",{className:"flex items-center gap-1 cursor-help",children:["".concat(e.consignee.substring(0,13),"..."),(0,s.jsx)(an.A,{className:"h-4 w-4 text-muted-foreground"})]})}),(0,s.jsx)(e2.ZI,{children:(0,s.jsx)("p",{children:e.consignee})})]}):e.consignee}),(0,s.jsx)(aa.nA,{children:(0,s.jsxs)("div",{className:"flex items-center gap-2",children:[(0,s.jsx)("span",{children:g}),b>0&&(0,s.jsxs)(e2.m_,{children:[(0,s.jsx)(e2.k$,{asChild:!0,children:(0,s.jsxs)(eC.E,{variant:"secondary",className:"cursor-pointer",children:["+",b]})}),(0,s.jsx)(e2.ZI,{children:(0,s.jsx)("ul",{className:"list-disc list-inside",children:f.slice(1).map((e,a)=>(0,s.jsx)("li",{children:e},a))})})]})]})}),(0,s.jsx)(aa.nA,{children:(0,s.jsx)("div",{className:"flex items-center",children:"Aprobado"===e.revisorStatus&&"Aprobada"!==e.preliquidationStatus?(0,s.jsxs)(d.$,{size:"sm",onClick:()=>n(e.id),disabled:t[e.id],children:[(0,s.jsx)(A.A,{className:"mr-2 h-4 w-4"})," Aprobar"]}):"Aprobada"===e.preliquidationStatus?(0,s.jsx)(eC.E,{variant:"default",className:"bg-green-600",children:"Aprobada"}):(0,s.jsx)(eC.E,{variant:"outline",children:"Pendiente"})})}),(0,s.jsx)(aa.nA,{children:(0,s.jsxs)("div",{className:"flex items-center group relative",children:[(p=e.digitacionStatus,v=e.declaracionAduanera,"Tr\xe1mite Completo"===p?(0,s.jsx)(eC.E,{variant:"default",className:"bg-green-600",children:v||"Finalizado"}):p?(0,s.jsx)(eC.E,{variant:"En Proceso"===p?"secondary":"outline",children:p}):(0,s.jsx)(eC.E,{variant:"outline",children:"Pendiente"})),(0,s.jsx)(d.$,{variant:"ghost",size:"icon",className:"h-6 w-6 opacity-0 group-hover:opacity-100 transition-opacity",onClick:()=>i.setSelectedCaseForProcess(e),children:(0,s.jsx)(eg.A,{className:"h-4 w-4"})})]})}),(0,s.jsx)(aa.nA,{children:(0,s.jsxs)("div",{className:"flex items-center gap-2",children:[(0,s.jsxs)($.l6,{value:e.selectividad||"",onValueChange:a=>r(e.id,"selectividad",a),disabled:t[e.id]||!e.declaracionAduanera,children:[(0,s.jsx)($.bq,{className:"w-[120px]",children:(0,s.jsx)($.yv,{placeholder:"Seleccionar..."})}),(0,s.jsxs)($.gC,{children:[(0,s.jsx)($.eb,{value:"VERDE",children:"VERDE"}),(0,s.jsx)($.eb,{value:"AMARILLO",children:"AMARILLO"}),(0,s.jsx)($.eb,{value:"ROJO",children:"ROJO"})]})]}),"AMARILLO"===e.selectividad&&(0,s.jsxs)(e2.m_,{children:[(0,s.jsx)(e2.k$,{asChild:!0,children:(0,s.jsx)(eC.E,{variant:"secondary",className:"cursor-help",children:(0,s.jsx)(an.A,{className:"h-4 w-4"})})}),(0,s.jsx)(e2.ZI,{children:(0,s.jsx)("p",{children:"CONSULTA DE VALORES"})})]})]})}),(0,s.jsx)(aa.nA,{children:(0,s.jsx)(e2.Bc,{children:(0,s.jsxs)(e2.m_,{children:[(0,s.jsx)(e2.k$,{asChild:!0,children:(0,s.jsx)("div",{children:(0,s.jsx)(eZ.I,{date:null==(m=e.fechaDespacho)?void 0:m.toDate(),onDateChange:a=>r(e.id,"fechaDespacho",a?R.Dc.fromDate(a):null),disabled:t[e.id]||"VERDE"!==e.selectividad&&"ROJO"!==e.selectividad})})}),"VERDE"!==e.selectividad&&"ROJO"!==e.selectividad&&(0,s.jsx)(e2.ZI,{children:(0,s.jsx)("p",{children:"Debe seleccionar un estado de selectividad (Verde o Rojo) antes de registrar el despacho."})})]})})}),(0,s.jsx)(aa.nA,{children:(e=>{let a=[];return"Rectificacion"===e.incidentType&&a.push("Rectificaci\xf3n"),e.hasValueDoubt&&a.push("Duda de Valor"),a.length>0?a.join(" / "):"N/A"})(e)}),(0,s.jsx)(aa.nA,{children:(0,s.jsx)("div",{className:"flex items-center justify-center",children:C?(0,s.jsxs)(d.$,{size:"sm",variant:"outline",onClick:()=>k(e.id),disabled:t[e.id]||!e.fechaDespacho||"Facturado"===e.facturacionStatus,children:[(0,s.jsx)(ai.A,{className:"mr-2 h-4 w-4"}),"Enviado a Facturacion"===e.facturacionStatus?"Re-enviar":"Enviar"]}):(0,s.jsx)(eh.d,{checked:!!e.facturado,onCheckedChange:a=>r(e.id,"facturado",a),disabled:t[e.id]})})})]},e.id)})})]})})})}let ao=[{value:0,label:"Enero"},{value:1,label:"Febrero"},{value:2,label:"Marzo"},{value:3,label:"Abril"},{value:4,label:"Mayo"},{value:5,label:"Junio"},{value:6,label:"Julio"},{value:7,label:"Agosto"},{value:8,label:"Septiembre"},{value:9,label:"Octubre"},{value:10,label:"Noviembre"},{value:11,label:"Diciembre"}],ac=new Date().getFullYear(),ad=Array.from({length:5},(e,a)=>ac-a);function au(){let{user:e,loading:a}=(0,o.A)(),t=(0,n.useRouter)(),i=(0,n.useSearchParams)(),{toast:_}=(0,q.dj)(),F=(0,eG.a)(),{openAddProductModal:V,setInitialContextData:G,setIsMemorandumMode:H,caseToAssignAforador:U,setCaseToAssignAforador:W}=(0,ep.U)(),[Q,Y]=(0,r.useState)([]),[ei,el]=(0,r.useState)(!0),[ec,ed]=(0,r.useState)(!1),[eu,eh]=(0,r.useState)([]),[em,ej]=(0,r.useState)(null),[ef,eN]=(0,r.useState)(null),[eA,eg]=(0,r.useState)(null),[eb,eC]=(0,r.useState)(null),[ey,eS]=(0,r.useState)(null),[eD,eE]=(0,r.useState)(null),[eR,ek]=(0,r.useState)(null),[eI,eP]=(0,r.useState)(null),[eO,eM]=(0,r.useState)(null),[eL,eT]=(0,r.useState)(null),[eV,eq]=(0,r.useState)(!1),[eH,eU]=(0,r.useState)(null),[eB,e$]=(0,r.useState)(null),[eJ,eW]=(0,r.useState)(null),[eZ,eX]=(0,r.useState)(!1),[eQ,eY]=(0,r.useState)(""),[e2,e5]=(0,r.useState)(!1),[e3,e8]=(0,r.useState)(null),[e6,e9]=(0,r.useState)(""),[e7,aa]=(0,r.useState)(""),[at,as]=(0,r.useState)(""),[ar,an]=(0,r.useState)({}),[ai,au]=(0,r.useState)({facturado:!1,noFacturado:!0}),[ah,am]=(0,r.useState)({conAcuse:!1,sinAcuse:!0}),[ax,ap]=(0,r.useState)("range"),[aj,av]=(0,r.useState)(),[af,aN]=(0,r.useState)(new Date().getMonth()),[aA,ag]=(0,r.useState)(ac),ab=i.get("tab")||"worksheets",[aC,aw]=(0,r.useState)(null),ay=e=>{t.push("/executive?tab=".concat(e),{scroll:!1}),aG(1),aw(null)},[aS,aD]=(0,r.useState)({searchTerm:"",facturado:!1,noFacturado:!0,conAcuse:!1,sinAcuse:!0,dateFilterType:"range",dateRange:void 0,isSearchActive:!1}),[aE,aR]=(0,r.useState)(""),[ak,aI]=(0,r.useState)(""),[aP,aO]=(0,r.useState)(""),[aM,aL]=(0,r.useState)(""),[aT,a_]=(0,r.useState)(""),[aF,aV]=(0,r.useState)(""),[az,aG]=(0,r.useState)(1),[aq]=(0,r.useState)(15),[aH,aU]=(0,r.useState)([]);(0,r.useEffect)(()=>{a||e||t.push("/")},[e,a,t]);let aB=(0,r.useCallback)(async()=>{let a;if(!e)return()=>{};if(el(!0),e.role&&["admin","supervisor","coordinadora"].includes(e.role))a=(0,R.P)((0,R.rJ)(E.db,"AforoCases"));else if(e.role&&["ejecutivo"].includes(e.role)&&e.visibilityGroup&&e.visibilityGroup.length>0){var t;let s=Array.from(new Set([e.displayName,...(null==(t=e.visibilityGroup)?void 0:t.map(e=>e.displayName))||[]])).filter(Boolean);a=(0,R.P)((0,R.rJ)(E.db,"AforoCases"),(0,R._M)("executive","in",s))}else{if(!e.displayName)return Y([]),el(!1),()=>{};a=(0,R.P)((0,R.rJ)(E.db,"AforoCases"),(0,R._M)("executive","==",e.displayName))}let s=(0,R.aQ)(a,async e=>{let a=e.docs.map(e=>({id:e.id,...e.data()})),[t,s,r,n]=await Promise.all([(0,R.GG)((0,R.rJ)(E.db,"worksheets")),(0,R.GG)((0,R.rJ)(E.db,"examenesPrevios")),(0,R.GG)((0,R.P)((0,R.rJ)(E.db,"SolicitudCheques"),(0,R.My)("savedAt","desc"))),(0,R.GG)((0,R.P)((0,R.rJ)(E.db,"Memorandum"),(0,R.My)("savedAt","desc")))]),i=new Map(t.docs.map(e=>[e.id,{id:e.id,...e.data()}])),l=new Map(s.docs.map(e=>[e.id,e.data()])),o=new Map;[...r.docs,...n.docs].forEach(e=>{let a=e.data();if(a.examNe){let t=a.examNe;o.has(t)||o.set(t,[]),o.get(t).push({solicitudId:e.id,...a})}});let c=a.map(async e=>{let a=(0,R.rJ)(E.db,"AforoCases",e.id,"actualizaciones"),t=(0,R.P)(a,(0,R._M)("newValue","==","worksheet_received"),(0,R.My)("updatedAt","desc")),s=await (0,R.GG)(t),r=s.empty?null:s.docs[0].data();return{...e,worksheet:i.get(e.worksheetId||"")||null,examenPrevio:l.get(e.id)||null,pagos:o.get(e.ne)||[],acuseLog:r}});Y(await Promise.all(c)),el(!1)},e=>{console.error("Error fetching aforo cases:",e),_({title:"Error de Carga",description:"No se pudieron cargar los datos de los casos.",variant:"destructive"}),el(!1)});return()=>s()},[e,_]);(0,r.useEffect)(()=>{let e;return aB().then(a=>{a&&(e=a)}),(async()=>{let e=(0,R.P)((0,R.rJ)(E.db,"users"),(0,R._M)("role","in",["aforador","coordinadora"]));eh((await (0,R.GG)(e)).docs.map(e=>({uid:e.id,...e.data()})))})(),()=>{e&&e()}},[aB]);let a$=async(a,t)=>{if(!e||!e.displayName)return void _({title:"Error",description:"Debe estar autenticado.",variant:"destructive"});let s=(0,R.H9)(E.db,"AforoCases",a);try{await (0,R.mZ)(s,{aforador:t,assignmentDate:R.Dc.now(),aforadorStatusLastUpdate:{by:e.displayName,at:R.Dc.now()}}),_({title:"Aforador Asignado",description:"".concat(t," ha sido asignado al caso.")}),W(null)}catch(e){console.error("Error assigning aforador:",e),_({title:"Error",description:"No se pudo asignar el aforador.",variant:"destructive"})}},aJ=(0,r.useCallback)(async function(a,t,s){let r=arguments.length>3&&void 0!==arguments[3]&&arguments[3];if(!e||!e.displayName)return void _({title:"No autenticado",variant:"destructive"});let n=Q.find(e=>e.id===a);if(!n)return;let i=n[t];an(e=>({...e,[a]:!0}));let l=(0,R.H9)(E.db,"AforoCases",a),o=(0,R.rJ)(l,"actualizaciones"),c=(0,R.wP)(E.db);try{let a={[t]:s};"facturado"===t&&!0===s&&(a.facturadoAt=R.Dc.now()),t.toLowerCase().includes("status")&&(a["".concat(t,"LastUpdate")]={by:e.displayName,at:R.Dc.now()}),c.update(l,a);let n={updatedAt:R.Dc.now(),updatedBy:e.displayName,field:t,oldValue:null!=i?i:null,newValue:s};c.set((0,R.H9)(o),n),await c.commit(),r||_({title:"Guardado Autom\xe1tico",description:"El campo se ha actualizado."})}catch(e){console.error("Error updating case:",e),_({title:"Error",description:"No se pudo guardar el cambio.",variant:"destructive"})}finally{an(e=>({...e,[a]:!1}))}},[e,Q,_]),aW=async()=>{if(0===aQ.length)return void _({title:"No hay datos",description:"No hay casos en la tabla para exportar.",variant:"secondary"});ed(!0);try{if("corporate"===ab)await K(aQ.map(e=>e.worksheet).filter(e=>null!==e));else{let e=[];for(let a of aK){let t=(0,R.P)((0,R.rJ)(E.db,"AforoCases",a.id,"actualizaciones"),(0,R.My)("updatedAt","asc"));(await (0,R.GG)(t)).forEach(t=>{e.push({...t.data(),caseNe:a.ne})})}await (0,X.qf)(aK,e)}}catch(e){console.error("Error exporting data: ",e),_({title:"Error de Exportaci\xf3n",description:"No se pudieron obtener todos los detalles para el reporte.",variant:"destructive"})}finally{ed(!1)}},aZ=async e=>{if(!e.worksheetId)return void _({title:"Error",description:"Este caso no tiene una hoja de trabajo asociada.",variant:"destructive"});let a=(0,R.H9)(E.db,"worksheets",e.worksheetId),t=await (0,R.x7)(a);t.exists()?eS({id:t.id,...t.data()}):_({title:"Error",description:"No se pudo encontrar la hoja de trabajo.",variant:"destructive"})},aX=async a=>{if(!e||!e.displayName)return;an(e=>({...e,[a]:!0}));let t=(0,R.H9)(E.db,"AforoCases",a);try{await (0,R.mZ)(t,{facturacionStatus:"Enviado a Facturacion",enviadoAFacturacionAt:R.Dc.now(),facturadorAsignado:"Alvaro Gonzalez",facturadorAsignadoAt:R.Dc.now()}),_({title:"Enviado a Facturaci\xf3n",description:"El caso ha sido remitido al m\xf3dulo de facturaci\xf3n y asignado a Alvaro Gonzalez."})}catch(e){_({title:"Error",description:"No se pudo enviar el caso a facturaci\xf3n.",variant:"destructive"})}finally{an(e=>({...e,[a]:!1}))}},aQ=(0,r.useMemo)(()=>{let e,a=Q.slice().sort((e,a)=>{var t,s,r,n;return(null!=(r=null==(t=a.createdAt)?void 0:t.toMillis())?r:0)-(null!=(n=null==(s=e.createdAt)?void 0:s.toMillis())?n:0)}).filter(e=>!e.isArchived);if(e="worksheets"===ab?a.filter(e=>{var a,t;return(null==(a=e.worksheet)?void 0:a.worksheetType)==="hoja_de_trabajo"||(null==(t=e.worksheet)?void 0:t.worksheetType)===void 0}):"anexos"===ab?a.filter(e=>{var a,t;return(null==(a=e.worksheet)?void 0:a.worksheetType)==="anexo_5"||(null==(t=e.worksheet)?void 0:t.worksheetType)==="anexo_7"}):a.filter(e=>{var a;return(null==(a=e.worksheet)?void 0:a.worksheetType)==="corporate_report"}),!aS.isSearchActive)return aw(null),e.slice(0,15);{var t;let s=e;if(aS.searchTerm&&(s=s.filter(e=>e.ne.toLowerCase().includes(aS.searchTerm.toLowerCase())||e.consignee.toLowerCase().includes(aS.searchTerm.toLowerCase()))),aS.noFacturado&&!aS.facturado?s=s.filter(e=>!e.facturado):aS.facturado&&!aS.noFacturado&&(s=s.filter(e=>!0===e.facturado)),aS.conAcuse&&!aS.sinAcuse?s=s.filter(e=>e.entregadoAforoAt):aS.sinAcuse&&!aS.conAcuse&&(s=s.filter(e=>!e.entregadoAforoAt)),null==(t=aS.dateRange)?void 0:t.from){let e=(0,k.o)(aS.dateRange.from),a=aS.dateRange.to?(0,I.D)(aS.dateRange.to):(0,I.D)(aS.dateRange.from);s=s.filter(t=>{var s;let r=null==(s=t.createdAt)?void 0:s.toDate();return r&&r>=e&&r<=a})}if(aE&&(s=s.filter(e=>e.ne.toLowerCase().includes(aE.toLowerCase()))),ak&&(s=s.filter(e=>e.executive.toLowerCase().includes(ak.toLowerCase()))),aP&&(s=s.filter(e=>e.consignee.toLowerCase().includes(aP.toLowerCase()))),aM){let e=aM.toLowerCase();s=s.filter(a=>{var t,s;return((null==(t=a.worksheet)?void 0:t.worksheetType)==="corporate_report"?(null==(s=a.worksheet.documents)?void 0:s.filter(e=>"FACTURA"===e.type).map(e=>e.number))||[]:a.facturaNumber?a.facturaNumber.split(";").map(e=>e.trim()):[]).some(a=>a.toLowerCase().includes(e))})}if(aT&&(s=s.filter(e=>(e.selectividad||"N/A").toLowerCase().includes(aT.toLowerCase()))),aF&&(s=s.filter(e=>(e=>{let a=[];return"Rectificacion"===e.incidentType&&a.push("Rectificaci\xf3n"),e.hasValueDoubt&&a.push("Duda de Valor"),a.length>0?a.join(" / "):"N/A"})(e).toLowerCase().includes(aF.toLowerCase()))),0===s.length&&aS.searchTerm){let e=aS.searchTerm.toLowerCase();for(let t of["worksheets","anexos","corporate"].filter(e=>e!==ab)){if(("worksheets"===t?a.filter(a=>{var t,s;return((null==(t=a.worksheet)?void 0:t.worksheetType)==="hoja_de_trabajo"||(null==(s=a.worksheet)?void 0:s.worksheetType)===void 0)&&(a.ne.toLowerCase().includes(e)||a.consignee.toLowerCase().includes(e))}):"anexos"===t?a.filter(a=>{var t,s;return((null==(t=a.worksheet)?void 0:t.worksheetType)==="anexo_5"||(null==(s=a.worksheet)?void 0:s.worksheetType)==="anexo_7")&&(a.ne.toLowerCase().includes(e)||a.consignee.toLowerCase().includes(e))}):a.filter(a=>{var t;return(null==(t=a.worksheet)?void 0:t.worksheetType)==="corporate_report"&&(a.ne.toLowerCase().includes(e)||a.consignee.toLowerCase().includes(e))})).length>0){aw({foundIn:t,label:"worksheets"===t?"Hojas de Trabajo":"anexos"===t?"Anexos":"Reportes Corporativos"});break}aw(null)}}else aw(null);return s}},[Q,aS,ab,aE,ak,aP,aM,aT,aF,ah]),aY=Math.ceil(aQ.length/aq),aK=aS.isSearchActive?aQ.slice((az-1)*aq,az*aq):aQ,a0=e=>{aJ(e,"preliquidationStatus","Aprobada")},a1=async()=>{if(!e||0===aH.length)return;let a=(0,R.wP)(E.db);aH.forEach(t=>{let s=(0,R.H9)(E.db,"AforoCases",t);a.update(s,{preliquidationStatus:"Aprobada",preliquidationStatusLastUpdate:{by:e.displayName,at:R.Dc.now()}});let r=(0,R.H9)((0,R.rJ)(s,"actualizaciones")),n={updatedAt:R.Dc.now(),updatedBy:e.displayName||"sistema",field:"preliquidationStatus",oldValue:"Pendiente",newValue:"Aprobada",comment:"Aprobaci\xf3n masiva de preliquidaci\xf3n"};a.set(r,n)}),await a.commit(),_({title:"\xc9xito",description:"".concat(aH.length," preliquidaciones aprobadas.")}),aU([])},a4=()=>{let e=aQ.filter(e=>"Aprobado"===e.revisorStatus&&"Aprobada"!==e.preliquidationStatus).map(e=>e.id);aH.length===e.length?aU([]):aU(e)},a2=async()=>{if("192438"!==eQ)return void _({title:"PIN Incorrecto",variant:"destructive"});if(0===aH.length)return;el(!0);let a=(0,R.wP)(E.db);for(let t of aH){let s=aQ.find(e=>e.id===t);if(s&&s.worksheetId){let r=(0,R.H9)(E.db,"worksheets",s.worksheetId);a.update(r,{worksheetType:"hoja_de_trabajo"});let n=(0,R.H9)(E.db,"AforoCases",t),i=(0,R.rJ)(n,"actualizaciones"),l={updatedAt:R.Dc.now(),updatedBy:(null==e?void 0:e.displayName)||"Sistema",field:"worksheetType",oldValue:"corporate_report",newValue:"hoja_de_trabajo",comment:"Caso reclasificado a Hoja de Trabajo via Deathkey."};a.set((0,R.H9)(i),l)}}try{await a.commit(),_({title:"\xc9xito",description:"".concat(aH.length," casos han sido reclasificados.")}),aU([]),eX(!1),eY("")}catch(e){console.error("Error with Deathkey action:",e),_({title:"Error",description:"No se pudieron reclasificar los casos.",variant:"destructive"})}finally{el(!1)}},a5=async()=>{if(!e||!e.displayName||!e3||!e3.worksheet)return void _({title:"Error",description:"No se puede procesar la solicitud. Faltan datos.",variant:"destructive"});let a=e6.trim().toUpperCase();if(!a)return void _({title:"Error",description:"El nuevo NE no puede estar vac\xedo.",variant:"destructive"});an(e=>({...e,[e3.id]:!0}));let t=(0,R.H9)(E.db,"AforoCases",e3.id),s=(0,R.H9)(E.db,"AforoCases",a),r=(0,R.H9)(E.db,"worksheets",a),n=(0,R.wP)(E.db);try{let[i,l]=await Promise.all([(0,R.x7)(s),(0,R.x7)(r)]);if(i.exists()||l.exists()){_({title:"Duplicado",description:"Ya existe un registro con el NE ".concat(a,"."),variant:"destructive"}),an(e=>({...e,[e3.id]:!1}));return}let o=R.Dc.now(),c={by:e.displayName,at:o},{id:d,ne:u,createdAt:h,lastUpdatedAt:m,...x}=e3.worksheet,p={...x,id:a,ne:a,createdAt:o,createdBy:e.email,lastUpdatedAt:o};n.set(r,p);let j={ne:a,executive:e3.executive,consignee:e3.consignee,facturaNumber:e3.facturaNumber,declarationPattern:e3.declarationPattern,merchandise:e3.merchandise,createdBy:e.uid,createdAt:o,aforador:"",assignmentDate:null,aforadorStatus:"Pendiente ",aforadorStatusLastUpdate:c,revisorStatus:"Pendiente",revisorStatusLastUpdate:c,preliquidationStatus:"Pendiente",preliquidationStatusLastUpdate:c,digitacionStatus:"Pendiente",digitacionStatusLastUpdate:c,incidentStatus:"Pendiente",incidentStatusLastUpdate:c,revisorAsignado:"",revisorAsignadoLastUpdate:c,digitadorAsignado:"",digitadorAsignadoLastUpdate:c,worksheetId:a,entregadoAforoAt:null,isArchived:!1,executiveComments:[{id:(0,en.A)(),author:e.displayName,text:"Duplicado del NE: ".concat(e3.ne,". Motivo: ").concat(e7),createdAt:o}]};n.set(s,j),n.update(t,{digitacionStatus:"TRASLADADO",isArchived:!0});let v=(0,R.H9)((0,R.rJ)(t,"actualizaciones")),f={updatedAt:R.Dc.now(),updatedBy:e.displayName,field:"digitacionStatus",oldValue:e3.digitacionStatus,newValue:"TRASLADADO",comment:"Caso trasladado al nuevo NE: ".concat(a,". Motivo: ").concat(e7)};n.set(v,f);let N=(0,R.H9)((0,R.rJ)(s,"actualizaciones")),A={updatedAt:o,updatedBy:e.displayName,field:"creation",oldValue:null,newValue:"duplicated_from_".concat(e3.ne),comment:"Caso duplicado desde ".concat(e3.ne,". Motivo: ").concat(e7)};n.set(N,A),await n.commit(),_({title:"Operaci\xf3n Exitosa",description:"El caso ".concat(e3.ne," ha sido duplicado a ").concat(a," y retirado.")}),e5(!1)}catch(e){console.error("Error duplicating and retiring",e),_({title:"Error",description:"No se pudo completar la operaci\xf3n.",variant:"destructive"})}finally{an(e=>({...e,[e3.id]:!1}))}};if((null==e?void 0:e.displayName)&&e.displayName.split(" ")[0],a||!e)return(0,s.jsx)("div",{className:"min-h-screen flex items-center justify-center bg-background",children:(0,s.jsx)(h.A,{className:"h-12 w-12 animate-spin text-primary"})});if(eb)return(0,s.jsx)(c.G,{children:(0,s.jsx)("div",{className:"py-2 md:py-5",children:(0,s.jsx)(T.h,{caseData:eb,onClose:()=>eC(null)})})});if(ey)return(0,s.jsx)(c.G,{children:(0,s.jsx)("div",{className:"py-2 md:py-5",children:(0,s.jsx)(es.v,{worksheet:ey,aforoCase:Q.find(e=>e.worksheetId===ey.id),onClose:()=>eS(null)})})});let a3={handleViewWorksheet:aZ,setSelectedCaseForQuickRequest:ek,setSelectedCaseForPayment:eP,setSelectedCaseForPaymentList:eM,setSelectedCaseForResa:eT,setSelectedCaseForIncident:eN,setSelectedCaseForValueDoubt:eg,setSelectedCaseForHistory:ej,setSelectedIncidentForDetails:eC,setSelectedCaseForComment:eE,handleSearchPrevio:e=>{t.push("/database?ne=".concat(e))},setCaseToArchive:e$,setCaseToDuplicate:e8,setDuplicateAndRetireModalOpen:e5},a8=()=>ei?(0,s.jsx)("div",{className:"flex justify-center items-center py-10",children:(0,s.jsx)(h.A,{className:"h-8 w-8 animate-spin text-primary"})}):0===aQ.length&&aS.isSearchActive?(0,s.jsxs)("div",{className:"text-center py-10",children:[(0,s.jsx)("p",{className:"text-muted-foreground",children:"No se encontraron casos con los filtros actuales."}),aC&&(0,s.jsxs)("div",{className:"mt-4 p-4 bg-blue-100 dark:bg-blue-900/30 border border-blue-300 dark:border-blue-700 rounded-md",children:[(0,s.jsxs)("p",{className:"text-sm text-blue-800 dark:text-blue-200",children:["Se encontr\xf3 una coincidencia en la pesta\xf1a de ",(0,s.jsx)("span",{className:"font-semibold",children:aC.label}),"."]}),(0,s.jsxs)(d.$,{onClick:()=>ay(aC.foundIn),className:"mt-2",size:"sm",children:["Ir a ",aC.label]})]})]}):0!==aQ.length||aS.isSearchActive?F?(0,s.jsx)(eK,{cases:aK,savingState:ar,onAutoSave:aJ,approvePreliquidation:a0,caseActions:a3}):(0,s.jsx)(al,{cases:aK,savingState:ar,onAutoSave:aJ,approvePreliquidation:a0,caseActions:a3,selectedRows:aH,onSelectRow:aU,onSelectAllRows:a4,neFilter:aE,setNeFilter:aR,ejecutivoFilter:ak,setEjecutivoFilter:aI,consignatarioFilter:aP,setConsignatarioFilter:aO,facturaFilter:aM,setFacturaFilter:aL,selectividadFilter:aT,setSelectividadFilter:a_,incidentTypeFilter:aF,setIncidentTypeFilter:aV,handleSendToFacturacion:aX}):(0,s.jsx)("p",{className:"text-muted-foreground text-center py-10",children:"No hay casos recientes para mostrar. Use la b\xfasqueda para encontrar casos m\xe1s antiguos."});return(0,s.jsxs)(s.Fragment,{children:[(0,s.jsx)(c.G,{children:(0,s.jsxs)("div",{className:"py-2 md:py-5 space-y-6",children:[(0,s.jsx)(e_,{}),(0,s.jsx)(e4.tU,{defaultValue:"worksheets",className:"w-full",value:ab,onValueChange:ay,children:(0,s.jsxs)(u.Zp,{children:[(0,s.jsxs)(u.aR,{children:[(0,s.jsxs)("div",{className:"flex flex-col sm:flex-row justify-between sm:items-center gap-4",children:[(0,s.jsxs)("div",{children:[(0,s.jsxs)(u.ZB,{className:"flex items-center gap-2 text-2xl",children:[(0,s.jsx)(m.A,{})," Panel Ejecutivo"]}),(0,s.jsx)(u.BT,{children:"Seguimiento de operaciones, desde la hoja de trabajo hasta la facturaci\xf3n."})]}),(0,s.jsxs)("div",{className:"flex flex-col sm:flex-row items-center gap-3",children:[(0,s.jsxs)(e0.Lt,{children:[(0,s.jsx)(e0.tv,{asChild:!0,children:(0,s.jsxs)(d.$,{size:"lg",variant:"secondary",className:"h-12 text-md",children:[(0,s.jsx)(x.A,{className:"mr-2 h-5 w-5"})," Solicitud de Pago General"]})}),(0,s.jsxs)(e0.EO,{children:[(0,s.jsxs)(e0.wd,{children:[(0,s.jsx)(e0.r7,{children:"\xbfEst\xe1 seguro?"}),(0,s.jsx)(e0.$v,{children:"Esta acci\xf3n iniciar\xe1 una solicitud de pago no vinculada a un N\xfamero de Entrada (NE) espec\xedfico. Se generar\xe1 un ID \xfanico en su lugar."})]}),(0,s.jsxs)(e0.ck,{children:[(0,s.jsx)(e0.Zr,{children:"Cancelar"}),(0,s.jsx)(e0.Rx,{onClick:()=>{G({ne:"SOL-".concat((0,P.GP)(new Date,"ddMMyy-HHmmss")),manager:(null==e?void 0:e.displayName)||"Usuario Desconocido",date:new Date,recipient:"",isMemorandum:!1}),eq(!0)},children:"S\xed, continuar"})]})]})]}),(0,s.jsxs)(ea.rI,{children:[(0,s.jsx)(ea.ty,{asChild:!0,children:(0,s.jsxs)(d.$,{size:"lg",variant:"default",className:"h-12 text-md",children:[(0,s.jsx)(p.A,{className:"mr-2 h-5 w-5"}),"Crear Registro"]})}),(0,s.jsxs)(ea.SQ,{children:[(0,s.jsx)(ea.lp,{children:"Tipo de Documento"}),(0,s.jsx)(ea.mB,{}),(0,s.jsx)(ea._2,{asChild:!0,children:(0,s.jsxs)(l(),{href:"/executive/worksheet",children:[(0,s.jsx)(j.A,{className:"mr-2 h-4 w-4"})," Hoja de Trabajo"]})}),(0,s.jsx)(ea._2,{asChild:!0,children:(0,s.jsxs)(l(),{href:"/executive/corporate-report",children:[(0,s.jsx)(v.A,{className:"mr-2 h-4 w-4"})," Reporte Consignatario"]})}),(0,s.jsx)(ea._2,{asChild:!0,children:(0,s.jsxs)(l(),{href:"/executive/anexos?type=anexo_5",children:[(0,s.jsx)(f.A,{className:"mr-2 h-4 w-4"})," Anexo 5"]})}),(0,s.jsx)(ea._2,{asChild:!0,children:(0,s.jsxs)(l(),{href:"/executive/anexos?type=anexo_7",children:[(0,s.jsx)(f.A,{className:"mr-2 h-4 w-4"})," Anexo 7"]})})]})]})]})]}),(0,s.jsx)("div",{className:"border-t pt-4 mt-2",children:(0,s.jsxs)(e4.j7,{children:[(0,s.jsx)(e4.Xi,{value:"worksheets",children:"Hojas de Trabajo"}),(0,s.jsx)(e4.Xi,{value:"anexos",children:"Anexos"}),(0,s.jsx)(e4.Xi,{value:"corporate",children:"Reportes Corporativos"})]})})]}),(0,s.jsxs)(u.Wu,{children:[(0,s.jsxs)("div",{className:"flex flex-col gap-4",children:[(0,s.jsxs)("div",{className:"flex flex-wrap items-center justify-between gap-4",children:[(0,s.jsxs)("div",{className:"relative w-full sm:max-w-xs",children:[(0,s.jsx)(N.A,{className:"absolute left-3 top-1/2 -translate-y-1/2 h-5 w-5 text-muted-foreground"}),(0,s.jsx)(O.p,{placeholder:"Buscar por NE o Consignatario...",className:"pl-10",value:at,onChange:e=>as(e.target.value)})]}),(0,s.jsxs)("div",{className:"flex items-center flex-wrap gap-4",children:[(0,s.jsxs)(d.$,{onClick:a1,disabled:0===aH.length,variant:"outline",children:[(0,s.jsx)(A.A,{className:"mr-2 h-4 w-4"})," Aprobar Preliquidaci\xf3n (",aH.length,")"]}),(0,s.jsxs)(ee.AM,{children:[(0,s.jsx)(ee.Wv,{asChild:!0,children:(0,s.jsxs)(d.$,{variant:"outline",className:"w-[200px] justify-start",children:[(0,s.jsx)(g.A,{className:"mr-2 h-4 w-4"})," Filtrar Visibilidad"]})}),(0,s.jsxs)(ee.hl,{className:"w-56 p-2",align:"end",children:[(0,s.jsxs)("div",{className:"grid gap-2",children:[(0,s.jsxs)("label",{className:"flex items-center gap-2 text-sm font-normal",children:[(0,s.jsx)(B.S,{checked:ai.noFacturado,onCheckedChange:e=>au(a=>({...a,noFacturado:!!e}))}),"No Facturados"]}),(0,s.jsxs)("label",{className:"flex items-center gap-2 text-sm font-normal",children:[(0,s.jsx)(B.S,{checked:ai.facturado,onCheckedChange:e=>au(a=>({...a,facturado:!!e}))}),"Facturados"]})]}),(0,s.jsxs)("div",{className:"grid gap-2 mt-2 pt-2 border-t",children:[(0,s.jsxs)("label",{className:"flex items-center gap-2 text-sm font-normal",children:[(0,s.jsx)(B.S,{checked:ah.sinAcuse,onCheckedChange:e=>am(a=>({...a,sinAcuse:!!e}))}),"Sin Acuse"]}),(0,s.jsxs)("label",{className:"flex items-center gap-2 text-sm font-normal",children:[(0,s.jsx)(B.S,{checked:ah.conAcuse,onCheckedChange:e=>am(a=>({...a,conAcuse:!!e}))}),"Con Acuse"]})]})]})]}),(0,s.jsxs)(d.$,{onClick:()=>{let e;if("range"===ax)e=aj;else if("month"===ax)e={from:new Date(aA,af,1),to:new Date(aA,af+1,0)};else if("today"===ax){let a=new Date;e={from:a,to:a}}aD({searchTerm:at,...ai,...ah,dateFilterType:ax,dateRange:e,isSearchActive:!0}),aG(1)},children:[(0,s.jsx)(N.A,{className:"mr-2 h-4 w-4"})," Buscar"]}),(0,s.jsx)(d.$,{variant:"outline",onClick:()=>{as(""),au({facturado:!1,noFacturado:!0}),am({conAcuse:!1,sinAcuse:!0}),av(void 0),aR(""),aI(""),aO(""),aL(""),a_(""),aV(""),aD({searchTerm:"",facturado:!1,noFacturado:!0,conAcuse:!1,sinAcuse:!0,dateFilterType:"range",dateRange:void 0,isSearchActive:!1}),aG(1),aw(null)},children:"Limpiar Filtros"}),(0,s.jsxs)(d.$,{variant:"outline",onClick:aB,children:[(0,s.jsx)(b.A,{className:"mr-2 h-4 w-4"})," Actualizar"]}),"corporate"===ab&&(0,s.jsxs)(d.$,{variant:"destructive",size:"sm",onClick:()=>eX(!0),disabled:0===aH.length,children:[(0,s.jsx)(C.A,{className:"mr-2 h-4 w-4"})," Reclasificar (",aH.length,")"]}),(0,s.jsxs)(d.$,{onClick:aW,disabled:0===aK.length||ec,children:[ec?(0,s.jsx)(h.A,{className:"mr-2 h-4 w-4 animate-spin"}):(0,s.jsx)(w.A,{className:"mr-2 h-4 w-4"}),ec?"Exportando...":"Exportar Vista Actual"]})]})]}),(0,s.jsxs)("div",{className:"flex flex-wrap items-center gap-4",children:[(0,s.jsxs)("div",{className:"flex flex-wrap items-center gap-2",children:[(0,s.jsxs)(d.$,{variant:"range"===ax?"default":"ghost",size:"sm",onClick:()=>ap("range"),children:[(0,s.jsx)(y.A,{className:"mr-2 h-4 w-4"})," Rango"]}),(0,s.jsxs)(d.$,{variant:"month"===ax?"default":"ghost",size:"sm",onClick:()=>ap("month"),children:[(0,s.jsx)(S.A,{className:"mr-2 h-4 w-4"})," Mes"]}),(0,s.jsxs)(d.$,{variant:"today"===ax?"default":"ghost",size:"sm",onClick:()=>ap("today"),children:[(0,s.jsx)(D.A,{className:"mr-2 h-4 w-4"})," Hoy"]})]}),"range"===ax&&(0,s.jsx)(et.S,{date:aj,onDateChange:av}),"month"===ax&&(0,s.jsxs)("div",{className:"flex gap-2",children:[(0,s.jsxs)($.l6,{value:String(af),onValueChange:e=>aN(Number(e)),children:[(0,s.jsx)($.bq,{className:"w-[180px]",children:(0,s.jsx)($.yv,{})}),(0,s.jsx)($.gC,{children:ao.map(e=>(0,s.jsx)($.eb,{value:String(e.value),children:e.label},e.value))})]}),(0,s.jsxs)($.l6,{value:String(aA),onValueChange:e=>ag(Number(e)),children:[(0,s.jsx)($.bq,{className:"w-[120px]",children:(0,s.jsx)($.yv,{})}),(0,s.jsx)($.gC,{children:ad.map(e=>(0,s.jsx)($.eb,{value:String(e),children:e},e))})]})]})]})]}),(0,s.jsx)(e4.av,{value:"worksheets",className:"mt-6",children:a8()}),(0,s.jsx)(e4.av,{value:"anexos",className:"mt-6",children:a8()}),(0,s.jsx)(e4.av,{value:"corporate",className:"mt-6",children:a8()}),aS.isSearchActive&&aY>1&&(0,s.jsxs)("div",{className:"flex items-center justify-end space-x-2 py-4",children:[(0,s.jsx)(d.$,{variant:"outline",size:"sm",onClick:()=>aG(e=>Math.max(e-1,1)),disabled:1===az,children:"Anterior"}),(0,s.jsxs)("span",{className:"text-sm",children:["P\xe1gina ",az," de ",aY]}),(0,s.jsx)(d.$,{variant:"outline",size:"sm",onClick:()=>aG(e=>Math.min(e+1,aY)),disabled:az===aY,children:"Siguiente"})]})]})]})})]})}),em&&(0,s.jsx)(M.p,{isOpen:!!em,onClose:()=>ej(null),caseData:em}),ef&&(0,s.jsx)(L.u,{isOpen:!!ef,onClose:()=>eN(null),caseData:ef}),eA&&(0,s.jsx)(Z,{isOpen:!!eA,onClose:()=>eg(null),caseData:eA}),eD&&(0,s.jsx)(eo,{isOpen:!!eD,onClose:()=>eE(null),caseData:eD}),eR&&(0,s.jsx)(ex,{isOpen:!!eR,onClose:()=>ek(null),caseWithWorksheet:eR}),eI&&(0,s.jsx)(ev,{isOpen:!!eI,onClose:()=>eP(null),caseData:eI}),eV&&(0,s.jsx)(ev,{isOpen:eV,onClose:()=>eq(!1),caseData:null}),eO&&(0,s.jsx)(ew,{isOpen:!!eO,onClose:()=>eM(null),caseData:eO}),eL&&(0,s.jsx)(ez,{isOpen:!!eL,onClose:()=>eT(null),caseData:eL}),U&&(0,s.jsx)(eF.a,{isOpen:!!U,onClose:()=>W(null),caseData:U,assignableUsers:eu,onAssign:a$,title:"Asignar Aforador (PSMT)",description:"Como el consignatario es PSMT, debe asignar un aforador para el caso NE: ".concat(U.ne,".")}),eH&&(0,s.jsx)(e1,{isOpen:!!eH,onClose:()=>eU(null),onSelectRectificacion:()=>{eC(eH),eU(null)},onSelectDudaValor:()=>{eg(eH),eU(null)}}),eJ&&(0,s.jsx)(ae,{isOpen:!!eJ,onClose:()=>eW(null),caseData:eJ}),(0,s.jsx)(z.lG,{open:eZ,onOpenChange:eX,children:(0,s.jsxs)(z.Cf,{children:[(0,s.jsxs)(z.c7,{children:[(0,s.jsx)(z.L3,{children:'Confirmar Acci\xf3n "Deathkey"'}),(0,s.jsxs)(z.rr,{children:["Esta acci\xf3n reclasificar\xe1 ",aH.length,' caso(s) a "Hoja de Trabajo", excluy\xe9ndolos de la l\xf3gica de Reporte Corporativo. Esta acci\xf3n es irreversible. Por favor ingrese el PIN para confirmar.']})]}),(0,s.jsxs)("div",{className:"py-4 space-y-2",children:[(0,s.jsxs)(J.J,{htmlFor:"pin-input",className:"flex items-center gap-2",children:[(0,s.jsx)(C.A,{}),"PIN de Seguridad"]}),(0,s.jsx)(O.p,{id:"pin-input",type:"password",value:eQ,onChange:e=>eY(e.target.value),placeholder:"Ingrese el PIN de 6 d\xedgitos"})]}),(0,s.jsxs)(z.Es,{children:[(0,s.jsx)(d.$,{variant:"outline",onClick:()=>eX(!1),children:"Cancelar"}),(0,s.jsxs)(d.$,{variant:"destructive",onClick:a2,disabled:ei,children:[ei&&(0,s.jsx)(h.A,{className:"mr-2 h-4 w-4 animate-spin"}),"Confirmar y Ejecutar"]})]})]})}),(0,s.jsx)(z.lG,{open:e2,onOpenChange:e5,children:(0,s.jsxs)(z.Cf,{children:[(0,s.jsxs)(z.c7,{children:[(0,s.jsx)(z.L3,{children:"Duplicar y Retirar Hoja de Trabajo"}),(0,s.jsxs)(z.rr,{children:["Est\xe1 a punto de duplicar el caso ",(0,s.jsx)("span",{className:"font-bold",children:null==e3?void 0:e3.ne}),". La hoja de trabajo original ser\xe1 marcada como trasladada."]})]}),(0,s.jsxs)("div",{className:"py-4 space-y-4",children:[(0,s.jsxs)("div",{className:"space-y-2",children:[(0,s.jsx)(J.J,{htmlFor:"new-ne-input",children:"Nuevo NE para el caso duplicado"}),(0,s.jsx)(O.p,{id:"new-ne-input",value:e6,onChange:e=>e9(e.target.value),placeholder:"Ingrese el nuevo NE"})]}),(0,s.jsxs)("div",{className:"space-y-2",children:[(0,s.jsx)(J.J,{htmlFor:"reason-input",children:"Motivo (Opcional)"}),(0,s.jsx)(er.T,{id:"reason-input",value:e7,onChange:e=>aa(e.target.value),placeholder:"Explique por qu\xe9 se est\xe1 duplicando este caso."})]})]}),(0,s.jsxs)(z.Es,{children:[(0,s.jsx)(d.$,{variant:"outline",onClick:()=>e5(!1),children:"Cancelar"}),(0,s.jsxs)(d.$,{onClick:a5,disabled:ar[(null==e3?void 0:e3.id)||""]||!e6,children:[ar[(null==e3?void 0:e3.id)||""]&&(0,s.jsx)(h.A,{className:"mr-2 h-4 w-4 animate-spin"}),"Confirmar Duplicaci\xf3n"]})]})]})})]})}function ah(){return(0,s.jsx)(r.Suspense,{fallback:(0,s.jsx)("div",{className:"flex items-center justify-center p-8",children:(0,s.jsx)(h.A,{className:"h-12 w-12 animate-spin text-primary"})}),children:(0,s.jsx)(au,{})})}},9891:(e,a,t)=>{"use strict";t.d(a,{d:()=>s});let s=new(t(65240)).EventEmitter},14774:(e,a,t)=>{Promise.resolve().then(t.bind(t,6865))},27339:(e,a,t)=>{"use strict";t.d(a,{l:()=>h});var s=t(95155),r=t(12115),n=t(5282),i=t(80160),l=t(28127),o=t(64269),c=t(3998),d=t(50276),u=t(26333);function h(e){let{className:a,date:t,onDateChange:h,disabled:m=!1}=e,[x,p]=r.useState(!1),[j,v]=r.useState(t);return r.useEffect(()=>{v(t)},[t]),(0,s.jsx)("div",{className:(0,o.cn)("grid gap-2",a),children:(0,s.jsxs)(u.AM,{open:x,onOpenChange:p,children:[(0,s.jsx)(u.Wv,{asChild:!0,children:(0,s.jsxs)(c.$,{variant:"outline",disabled:m,className:(0,o.cn)("w-[180px] justify-start text-left font-normal",!j&&"text-muted-foreground"),children:[(0,s.jsx)(l.A,{className:"mr-2 h-4 w-4"}),j?(0,n.GP)(j,"dd/MM/yy",{locale:i.es}):(0,s.jsx)("span",{children:"Seleccione fecha"})]})}),(0,s.jsx)(u.hl,{className:"w-auto p-0",children:(0,s.jsx)(d.V,{mode:"single",selected:null!=j?j:void 0,onSelect:e=>{v(e),h(e),p(!1)},initialFocus:!0,locale:i.es,disabled:m})})]})})}},77059:(e,a,t)=>{"use strict";t.d(a,{j5:()=>l,qb:()=>o,qf:()=>h});var s=t(19708),r=t(4246),n=t(5282),i=t(80160);function l(e,a){let t="EXAMEN PREVIO AGENCIA ACONIC - CustomsEX-p\n";t+="===========================================\n\n",t+="INFORMACI\xd3N GENERAL DEL EXAMEN:\n",t+="NE: ".concat(e.ne,"\n"),t+="Referencia: ".concat(e.reference||"N/A","\n"),t+="Consignatario: ".concat(e.consignee,"\n"),t+="Gestor: ".concat(e.manager,"\n"),t+="Ubicaci\xf3n: ".concat(e.location,"\n\n"),t+="PRODUCTOS:\n",(Array.isArray(a)?a:[]).forEach((e,a)=>{t+="\n--- Producto ".concat(a+1," ---\n"),t+="N\xfamero de Item: ".concat(e.itemNumber||"N/A","\n"),t+="Numeraci\xf3n de Bultos: ".concat(e.numberPackages||"N/A","\n"),t+="Cantidad de Bultos: ".concat(e.quantityPackages||0,"\n"),t+="Cantidad de Unidades: ".concat(e.quantityUnits||0,"\n"),t+="Descripci\xf3n: ".concat(e.description||"N/A","\n"),t+="Marca: ".concat(e.brand||"N/A","\n"),t+="Modelo: ".concat(e.model||"N/A","\n"),t+="Serie: ".concat(e.serial||"N/A","\n"),t+="Origen: ".concat(e.origin||"N/A","\n"),t+="Estado de Mercanc\xeda: ".concat(e.packagingCondition||"N/A","\n"),t+="Unidad de Medida: ".concat(e.unitMeasure||"N/A","\n"),t+="Peso: ".concat(e.weight||"N/A","\n"),t+="Observaci\xf3n: ".concat(e.observation||"N/A","\n");let s=[];e.isConform&&s.push("Conforme a factura"),e.isExcess&&s.push("Excedente"),e.isMissing&&s.push("Faltante"),e.isFault&&s.push("Aver\xeda"),t+="Estado: ".concat(s.length>0?s.join(", "):"Sin estado espec\xedfico","\n")});let s=new Blob([t],{type:"text/plain;charset=utf-8"}),r=URL.createObjectURL(s),n=document.createElement("a");n.href=r,n.download="CustomsEX-p_".concat(e.ne,"_").concat(new Date().toISOString().split("T")[0],".txt"),document.body.appendChild(n),n.click(),document.body.removeChild(n),URL.revokeObjectURL(r)}function o(e){var a,t;let s=new Date,l=(0,n.GP)(s,"dd/MM/yy HH:mm",{locale:i.es}),o=[["EXAMEN PREVIO AGENCIA ACONIC - CustomsEX-p"],[],["INFORMACI\xd3N GENERAL DEL EXAMEN:"],["NE:",e.ne],["Referencia:",e.reference||"N/A"],["Consignatario:",e.consignee],["Gestor del Examen:",e.manager],["Ubicaci\xf3n Mercanc\xeda:",e.location],["Fotos:",{v:"Abrir Carpeta de Fotos",t:"s",l:{Target:"https://aconisani-my.sharepoint.com/:f:/g/personal/asuntos_juridicos_aconic_com_ni/Emrpj4Ss8bhDifpuYc8U_bwBj9r29FGcXxzfxu4PSh2tEQ?e=FhIPTt",Tooltip:"Ir a la carpeta de fotos en SharePoint"}}],[],["PRODUCTOS:"]],c=["N\xfamero de Item","Numeraci\xf3n de Bultos","Cantidad de Bultos","Cantidad de Unidades","Descripci\xf3n","Marca","Modelo","Origen","Estado de Mercanc\xeda","Peso","Unidad de Medida","Serie","Observaci\xf3n","Estado"],d=[...o,c,...(Array.isArray(e.products)?e.products:[]).map(e=>{let a="",t=[];return e.isConform&&t.push("Conforme"),e.isExcess&&t.push("Excedente"),e.isMissing&&t.push("Faltante"),e.isFault&&t.push("Aver\xeda"),a=t.length>0?t.join("/"):"S/E",[e.itemNumber||"N/A",e.numberPackages||"N/A",e.quantityPackages||0,e.quantityUnits||0,e.description||"N/A",e.brand||"N/A",e.model||"N/A",e.origin||"N/A",e.packagingCondition||"N/A",e.weight||"N/A",e.unitMeasure||"N/A",e.serial||"N/A",e.observation||"N/A",a]})],u=r.Wp.aoa_to_sheet(d),h=c.map((e,a)=>({wch:Math.max(e.length,...d.slice(o.length).map(e=>e[a]?String(e[a]).length:0))+2})),m=o.slice(0,o.length-2).map(e=>String(e[0]||"")),x=o.slice(0,o.length-2).map(e=>{let a=e[1];return"object"==typeof a&&null!==a&&"v"in a?String(a.v||""):String(a||"")});h.length>0&&(h[0].wch=Math.max((null==(a=h[0])?void 0:a.wch)||0,...m.map(e=>e.length+2))),h.length>1&&(h[1].wch=Math.max((null==(t=h[1])?void 0:t.wch)||0,...x.map(e=>e.length+5))),u["!cols"]=h;let p=[["DETALLES DE SISTEMA DEL EXAMEN:"]];e.savedBy?p.push(["Guardado por (correo):",e.savedBy]):p.push(["Guardado por (correo):","N/A (No guardado en BD a\xfan o dato no disponible)"]);let j=e=>{if(!e)return"N/A";let a=(null==e?void 0:e.toDate)?e.toDate():e;return a instanceof Date&&!isNaN(a.getTime())?(0,n.GP)(a,"dd/MM/yy HH:mm",{locale:i.es}):"Fecha inv\xe1lida"};p.push(["Fecha y Hora de Inicio:",j(e.createdAt)]),p.push(["Fecha y Hora de \xdaltimo Guardado:",j(e.savedAt)]),p.push(["Fecha y Hora de Finalizaci\xf3n:",e.completedAt?j(e.completedAt):"Examen no finalizado"]),p.push(["Fecha y Hora de Exportaci\xf3n:",l]);let v=r.Wp.aoa_to_sheet(p),f=[{wch:Math.max(...p.map(e=>String(e[0]).length))+2},{wch:Math.max(...p.map(e=>String(e[1]).length))+5}];v["!cols"]=f;let N=r.Wp.book_new();r.Wp.book_append_sheet(N,u,"Examen ".concat(e.ne)),r.Wp.book_append_sheet(N,v,"Detalle de Sistema"),r._h(N,"CustomsEX-p_".concat(e.ne,"_").concat(new Date().toISOString().split("T")[0],".xlsx"))}let c=function(e){let a=!(arguments.length>1)||void 0===arguments[1]||arguments[1];if(!e)return"N/A";let t=e.toDate?e.toDate():new Date(e);return t instanceof Date&&!isNaN(t.getTime())?(0,n.GP)(t,a?"dd/MM/yy HH:mm":"dd/MM/yy",{locale:i.es}):"Fecha Inv\xe1lida"},d=e=>e instanceof s.Dc?c(e):"boolean"==typeof e?e?"S\xed":"No":null==e||""===e?"vac\xedo":"object"==typeof e?JSON.stringify(e):String(e),u=(e,a,t,s)=>{let n=[[t],[s],[],e,...a],i=r.Wp.aoa_to_sheet(n),l=e.map((e,t)=>({wch:Math.max(e.length,...a.map(e=>String(e[t]||"").length))+2}));return i["!cols"]=l,i};async function h(e,a){let t=new Date,s=(0,n.GP)(t,"dd/MM/yy HH:mm",{locale:i.es}),l=u(["NE","INICIO DE OPERACION","RESA","VENCIMIENTO DE RESA","CONSIGNATARIO","FACTURA","ASIGNACION DE AFORO","ESTATUS DE REVISOR","ESTATUS DIGITACION","SELECTIVO","FECHA DE DESPACHO","TIPO INCIDENCIA","FACTURADO","FECHA DE FACTURACION","CUENTA DE REGISTRO","ESTATUS EJECUTIVO (AMPLIADO)"],e.map(e=>{var a;let t=["Aforador: ".concat(e.aforadorStatus||"N/A"),"Revisor: ".concat(e.revisorStatus||"N/A"),"Preliquidaci\xf3n: ".concat(e.preliquidationStatus||"N/A"),"Digitaci\xf3n: ".concat(e.digitacionStatus||"N/A")].join(" | ");return[e.ne,c(e.createdAt),(null==(a=e.worksheet)?void 0:a.resa)||"N/A",c(e.resaDueDate,!1),e.consignee,e.facturaNumber||"N/A",c(e.assignmentDate),e.revisorStatus||"N/A",e.digitacionStatus||"N/A",e.selectividad||"N/A",c(e.fechaDespacho,!1),e.incidentType||"N/A",e.facturado?"S\xed":"No",c(e.facturadoAt),e.cuentaDeRegistro||"N/A",t]}),"Reporte Ejecutivo - Customs Reports","Generado el: ".concat(s)),o=u(["NE","Consignatario","Declaraci\xf3n","Aduana Despacho","Monto de Preliquidaci\xf3n (USD)","Proceso","Levante Solicitado","Ampliaci\xf3n de Plazo","Vencimiento de Caso","Asignado a Legal"],e.filter(e=>e.hasValueDoubt).map(e=>{var a,t;return[e.ne,e.consignee,e.declaracionAduanera||"N/A",(null==(a=e.worksheet)?void 0:a.dispatchCustoms)||"N/A",null!=(t=e.valueDoubtAmount)?t:"N/A",e.valueDoubtStatus||"N/A",e.valueDoubtLevanteRequested?"S\xed":"No",e.valueDoubtExtensionRequested?"S\xed":"No",c(e.valueDoubtDueDate,!1),e.valueDoubtAssignedToLegal?"S\xed":"No"]}),"Casos con Duda de Valor","Generado el: ".concat(s)),h=u(["NE","CONSIGNATARIO","DECLARACION ADUANERA","PAGO INICIAL (SI/NO)","RECIBO DE CAJA PAGO INICIAL","MONTO DE DECLARACION INICIAL","ADUANA DE DESPACHO","MOTIVO DE LA RECTIFICACION","OBSERVACIONES","ESTADO INCIDENCIA","REVISADO POR","FECHA REVISI\xd3N"],e.filter(e=>"Rectificacion"===e.incidentType).map(e=>{var a,t;return[e.ne,e.consignee,e.declaracionAduanera||"N/A",e.pagoInicialRealizado?"S\xed":"No",e.reciboDeCajaPagoInicial||"N/A",null!=(t=e.montoPagoInicial)?t:"N/A",(null==(a=e.worksheet)?void 0:a.dispatchCustoms)||"N/A",e.motivoRectificacion||"",e.observaciones||"",e.incidentStatus||"N/A",e.incidentReviewedBy||"N/A",c(e.incidentReviewedAt,!1)]}),"Casos con Complementaria (Rectificaci\xf3n)","Generado el: ".concat(s));a.sort((e,a)=>e.caseNe<a.caseNe?-1:e.caseNe>a.caseNe?1:(e.updatedAt instanceof Date?e.updatedAt.getTime():e.updatedAt.toMillis())-(a.updatedAt instanceof Date?a.updatedAt.getTime():a.updatedAt.toMillis()));let m=u(["NE del Caso","Fecha de Actualizaci\xf3n","Actualizado Por","Campo Modificado","Valor Anterior","Valor Nuevo","Comentario"],a.map(e=>[e.caseNe,c(e.updatedAt),e.updatedBy,e.field,d(e.oldValue),d(e.newValue),e.comment||""]),"Bit\xe1cora de Cambios - Customs Reports","Generado el: ".concat(s)),x=r.Wp.book_new();r.Wp.book_append_sheet(x,l,"Reporte Ejecutivo"),r.Wp.book_append_sheet(x,o,"Duda de Valor"),r.Wp.book_append_sheet(x,h,"Rectificaciones"),r.Wp.book_append_sheet(x,m,"Bit\xe1cora de Cambios"),r._h(x,"Reporte_Ejecutivo_".concat(t.toISOString().split("T")[0],".xlsx"))}},83012:(e,a,t)=>{"use strict";function s(e,a){let t=new Date(e),s=0;for(;s<a;)t.setDate(t.getDate()+1),0!==t.getDay()&&s++;return t}t.d(a,{f:()=>s})},86501:(e,a,t)=>{"use strict";t.d(a,{$:()=>s});class s extends Error{constructor(e,a){super("Firestore Permission Denied: You do not have permission to perform the '".concat(e.operation,"' operation on the path '").concat(e.path,"'.")),this.name="FirestorePermissionError",this.context=e,this.originalError=a,Object.setPrototypeOf(this,new.target.prototype)}}}},e=>{e.O(0,[2992,7138,3524,4865,9255,3744,5282,9351,3504,6505,4221,5330,9965,5479,5171,2228,7913,6190,2845,3152,8441,1255,7358],()=>e(e.s=14774)),_N_E=e.O()}]);