(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[2540],{4155:(e,r,n)=>{"use strict";n.r(r),n.d(r,{corporateReportSchema:()=>F,default:()=>V});var a=n(95155),s=n(12115),l=n(22544),i=n(66942),t=n(15653),c=n(54901),o=n(14585),d=n(19708),h=n(15894),x=n(3998),u=n(65142),j=n(31120),m=n(41052),p=n(36204),v=n(92033),g=n(9891),f=n(86501),C=n(34238),N=n(79505),b=n(35434),z=n(20063),A=n(86948),D=n(52619),y=n.n(D),E=n(51834),w=n(87270),R=n(22452),I=n(13630),S=n(11929);let M=t.z.object({number:t.z.string().min(1,"N\xfamero de factura requerido."),noADMI:t.z.string().min(1,"No. ADMI es requerido.")});function P(e){let{isOpen:r,onClose:n,control:s}=e,{fields:t,append:c,remove:o}=(0,l.jz)({control:s,name:"documents"}),d=(0,l.mN)({resolver:(0,i.u)(M),defaultValues:{number:"",noADMI:""}});return(0,a.jsx)(E.lG,{open:r,onOpenChange:n,children:(0,a.jsxs)(E.Cf,{className:"max-w-2xl",children:[(0,a.jsx)(E.c7,{children:(0,a.jsx)(E.L3,{children:"Administrar Facturas y No. ADMI"})}),(0,a.jsx)(m.lV,{...d,children:(0,a.jsxs)("form",{onSubmit:d.handleSubmit(e=>{c({id:(0,S.A)(),type:"FACTURA",...e}),d.reset()}),className:"flex items-end gap-2 p-4 border rounded-md",children:[(0,a.jsx)(m.zB,{control:d.control,name:"number",render:e=>{let{field:r}=e;return(0,a.jsxs)(m.eI,{className:"flex-1",children:[(0,a.jsx)(m.lR,{children:"No. Factura"}),(0,a.jsx)(m.MJ,{children:(0,a.jsx)(u.p,{...r})}),(0,a.jsx)(m.C5,{})]})}}),(0,a.jsx)(m.zB,{control:d.control,name:"noADMI",render:e=>{let{field:r}=e;return(0,a.jsxs)(m.eI,{className:"flex-1",children:[(0,a.jsx)(m.lR,{children:"No. ADMI"}),(0,a.jsx)(m.MJ,{children:(0,a.jsx)(u.p,{...r})}),(0,a.jsx)(m.C5,{})]})}}),(0,a.jsx)(x.$,{type:"submit",size:"icon",className:"shrink-0",children:(0,a.jsx)(R.A,{className:"h-5 w-5"})})]})}),(0,a.jsx)("div",{className:"mt-4 max-h-60 overflow-y-auto border rounded-md",children:(0,a.jsxs)(w.XI,{children:[(0,a.jsx)(w.A0,{children:(0,a.jsxs)(w.Hj,{children:[(0,a.jsx)(w.nd,{children:"No. Factura"}),(0,a.jsx)(w.nd,{children:"No. ADMI"}),(0,a.jsx)(w.nd,{className:"text-right",children:"Acci\xf3n"})]})}),(0,a.jsx)(w.BF,{children:t.map((e,r)=>(0,a.jsxs)(w.Hj,{children:[(0,a.jsx)(w.nA,{children:e.number}),(0,a.jsx)(w.nA,{children:e.noADMI}),(0,a.jsx)(w.nA,{className:"text-right",children:(0,a.jsx)(x.$,{variant:"ghost",size:"icon",onClick:()=>o(r),children:(0,a.jsx)(I.A,{className:"h-4 w-4 text-destructive"})})})]},e.id))})]})}),(0,a.jsx)(E.Es,{children:(0,a.jsx)(x.$,{variant:"outline",onClick:n,children:"Cerrar"})})]})})}var B=n(76444),k=n(11186);function q(e){let{control:r}=e,{fields:n,append:i,remove:t}=(0,l.jz)({control:r,name:"requiredPermits"}),[c,o]=(0,s.useState)(""),[d,h]=(0,s.useState)(""),[j,m]=(0,s.useState)("Pendiente"),[p,v]=(0,s.useState)(""),g=(0,l.FH)({control:r,name:"documents"}),f=(null==g?void 0:g.filter(e=>"FACTURA"===e.type))||[];return(0,a.jsxs)("div",{className:"space-y-4 pt-4 border-t",children:[(0,a.jsx)("h3",{className:"text-lg font-medium",children:"Permisos Requeridos"}),(0,a.jsxs)("div",{className:"space-y-4 p-3 border rounded-md bg-secondary/30",children:[(0,a.jsxs)("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-3 items-end",children:[(0,a.jsxs)("div",{className:"grid gap-2",children:[(0,a.jsx)(B.J,{children:"Nombre del Permiso"}),(0,a.jsxs)(k.l6,{value:c,onValueChange:o,children:[(0,a.jsx)(k.bq,{children:(0,a.jsx)(k.yv,{placeholder:"Seleccionar permiso..."})}),(0,a.jsx)(k.gC,{children:C.QL.map(e=>(0,a.jsx)(k.eb,{value:e,children:e},e))})]}),"OTROS"===c&&(0,a.jsx)(u.p,{value:d,onChange:e=>h(e.target.value),placeholder:"Indique cu\xe1l"})]}),(0,a.jsxs)("div",{children:[(0,a.jsx)(B.J,{children:"Factura Relacionada"}),(0,a.jsxs)(k.l6,{value:p,onValueChange:v,disabled:0===f.length,children:[(0,a.jsx)(k.bq,{children:(0,a.jsx)(k.yv,{placeholder:0===f.length?"A\xf1ada una factura primero":"Seleccionar factura..."})}),(0,a.jsx)(k.gC,{children:f.map(e=>(0,a.jsx)(k.eb,{value:e.number,children:e.number},e.id))})]})]}),(0,a.jsxs)("div",{children:[(0,a.jsx)(B.J,{children:"Estado"}),(0,a.jsxs)(k.l6,{value:j,onValueChange:e=>m(e),children:[(0,a.jsx)(k.bq,{children:(0,a.jsx)(k.yv,{placeholder:"Estado..."})}),(0,a.jsxs)(k.gC,{children:[(0,a.jsx)(k.eb,{value:"Pendiente",children:"Pendiente"}),(0,a.jsx)(k.eb,{value:"En Tr\xe1mite",children:"En Tr\xe1mite"}),(0,a.jsx)(k.eb,{value:"Entregado",children:"Entregado"})]})]})]})]}),(0,a.jsxs)(x.$,{type:"button",onClick:()=>{let e="OTROS"===c?d.trim():c.trim();e&&(i({id:(0,S.A)(),name:e,status:j,facturaNumber:p}),o(""),h(""),m("Pendiente"),v(""))},className:"w-full md:w-auto",children:[(0,a.jsx)(R.A,{className:"mr-2 h-4 w-4"})," A\xf1adir Permiso"]})]}),n.length>0&&(0,a.jsx)("div",{className:"rounded-md border mt-4",children:(0,a.jsxs)(w.XI,{children:[(0,a.jsx)(w.A0,{children:(0,a.jsxs)(w.Hj,{children:[(0,a.jsx)(w.nd,{children:"Permiso"}),(0,a.jsx)(w.nd,{children:"Factura"}),(0,a.jsx)(w.nd,{children:"Estado"}),(0,a.jsx)(w.nd,{className:"text-right",children:"Acci\xf3n"})]})}),(0,a.jsx)(w.BF,{children:n.map((e,r)=>(0,a.jsxs)(w.Hj,{children:[(0,a.jsx)(w.nA,{children:e.name}),(0,a.jsx)(w.nA,{children:e.facturaNumber||"N/A"}),(0,a.jsx)(w.nA,{children:e.status}),(0,a.jsx)(w.nA,{className:"text-right",children:(0,a.jsx)(x.$,{type:"button",variant:"ghost",size:"icon",onClick:()=>t(r),children:(0,a.jsx)(I.A,{className:"h-4 w-4 text-destructive"})})})]},e.id))})]})})]})}var J=n(27339);let F=t.z.object({worksheetType:t.z.literal("corporate_report").default("corporate_report"),ne:t.z.string().min(1,"El campo NE es requerido."),reference:t.z.string().optional(),entryCustoms:t.z.string().min(1,"Aduana de ingreso es requerida."),dispatchCustoms:t.z.string().min(1,"Aduana de despacho es requerida."),consignee:t.z.string().min(1,"Consignatario es requerido."),proveedor:t.z.string().optional(),documents:t.z.array(t.z.object({id:t.z.string(),type:t.z.literal("FACTURA"),number:t.z.string(),noADMI:t.z.string()})).optional(),fechaEnvioCliente:t.z.date().optional().nullable(),requiredPermits:t.z.array(t.z.any()).optional(),proveedorTransporte:t.z.string().optional(),declaracionNumero:t.z.string().optional(),fechaNacionalizacion:t.z.date().optional().nullable(),selectividad:t.z.enum(["verde","amarillo","rojo"]).optional().nullable(),fechaDespacho:t.z.date().optional().nullable(),observations:t.z.string().optional()});function T(){let{user:e}=(0,c.A)(),{toast:r}=(0,h.dj)(),n=(0,z.useRouter)(),t=(0,z.useSearchParams)(),[b,D]=(0,s.useState)(!1),[E,w]=(0,s.useState)(!1),[R,I]=(0,s.useState)(null),S=(0,l.mN)({resolver:(0,i.u)(F),defaultValues:{worksheetType:"corporate_report",ne:"",reference:"",entryCustoms:"",dispatchCustoms:"",consignee:"",proveedor:"",documents:[],fechaEnvioCliente:null,requiredPermits:[],proveedorTransporte:"",declaracionNumero:"",fechaNacionalizacion:null,selectividad:null,fechaDespacho:null,observations:""}});(0,s.useEffect)(()=>{let e=t.get("id");e&&(I(e),(async()=>{let n=(0,d.H9)(o.db,"worksheets",e),a=await (0,d.x7)(n);if(a.exists()){var s,l,i;let e=a.data(),r={...e,fechaEnvioCliente:null==(s=e.fechaEnvioCliente)?void 0:s.toDate(),fechaNacionalizacion:null==(l=e.fechaNacionalizacion)?void 0:l.toDate(),fechaDespacho:null==(i=e.fechaDespacho)?void 0:i.toDate()};S.reset(r)}else r({title:"Error",description:"No se encontr\xf3 el reporte para editar.",variant:"destructive"})})())},[t,S,r]);let M=async a=>{if(!e||!e.displayName||!e.email)return void r({title:"Error",description:"Debe estar autenticado.",variant:"destructive"});if(D(!0),R){let e=(0,d.H9)(o.db,"worksheets",R),s={...a,lastUpdatedAt:d.Dc.now(),fechaEnvioCliente:a.fechaEnvioCliente?d.Dc.fromDate(a.fechaEnvioCliente):null,fechaNacionalizacion:a.fechaNacionalizacion?d.Dc.fromDate(a.fechaNacionalizacion):null,fechaDespacho:a.fechaDespacho?d.Dc.fromDate(a.fechaDespacho):null};try{await (0,d.mZ)(e,s),r({title:"Reporte Actualizado",description:"El reporte para el NE ".concat(R," ha sido guardado.")}),n.push("/executive")}catch(e){console.error("Error updating corporate report:",e),r({title:"Error",description:"No se pudo actualizar el reporte.",variant:"destructive"})}finally{D(!1)}}else{let s=a.ne.trim().toUpperCase(),l=(0,d.H9)(o.db,"worksheets",s),i=(0,d.H9)(o.db,"AforoCases",s);try{let[t,c]=await Promise.all([(0,d.x7)(l),(0,d.x7)(i)]);if(t.exists()||c.exists()){r({title:"Registro Duplicado",description:"Ya existe un registro con el NE ".concat(s,"."),variant:"destructive"}),D(!1);return}let h=(0,d.wP)(o.db),x=d.Dc.now(),u={...a,id:s,ne:s,createdAt:x,createdBy:e.email,executive:e.displayName,lastUpdatedAt:x,fechaEnvioCliente:a.fechaEnvioCliente?d.Dc.fromDate(a.fechaEnvioCliente):null,fechaNacionalizacion:a.fechaNacionalizacion?d.Dc.fromDate(a.fechaNacionalizacion):null,fechaDespacho:a.fechaDespacho?d.Dc.fromDate(a.fechaDespacho):null};h.set(l,u);let j={ne:s,executive:e.displayName,consignee:a.consignee,declarationPattern:"corporate_report",merchandise:a.observations,createdBy:e.uid,createdAt:x,aforadorStatus:"En revisi\xf3n",revisorStatus:"Pendiente",preliquidationStatus:"Pendiente",digitacionStatus:"Pendiente de Digitaci\xf3n",incidentStatus:"Pendiente",worksheetId:s};h.set(i,j),await h.commit(),r({title:"Registro Creado",description:"El reporte para el NE ".concat(s," ha sido guardado.")}),n.push("/executive"),S.reset()}catch(r){console.error("Error creating record:",r);let e=new f.$({path:"batch write to worksheets/".concat(s," and AforoCases/").concat(s),operation:"create",requestResourceData:{worksheetData:a,aforoCaseData:{ne:s}}},r);g.d.emit("permission-error",e)}finally{D(!1)}}};return(0,a.jsxs)(a.Fragment,{children:[(0,a.jsxs)(A.Zp,{className:"w-full max-w-4xl mx-auto custom-shadow",children:[(0,a.jsxs)(A.aR,{children:[(0,a.jsxs)(A.ZB,{className:"text-2xl",children:[R?"Editar":"Nuevo"," Reporte Consignatario Empresarial"]}),(0,a.jsx)(A.BT,{children:R?"Modificando reporte para el NE ".concat(R):"Complete la informaci\xf3n para generar el nuevo reporte."})]}),(0,a.jsx)(A.Wu,{children:(0,a.jsx)(m.lV,{...S,children:(0,a.jsxs)("form",{onSubmit:S.handleSubmit(M),className:"space-y-6 mt-4",children:[(0,a.jsxs)("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-4",children:[(0,a.jsx)(m.zB,{control:S.control,name:"ne",render:e=>{let{field:r}=e;return(0,a.jsxs)(m.eI,{children:[(0,a.jsx)(m.lR,{children:"NE"}),(0,a.jsx)(m.MJ,{children:(0,a.jsx)(u.p,{...r,disabled:!!R})}),(0,a.jsx)(m.C5,{})]})}}),(0,a.jsx)(m.zB,{control:S.control,name:"reference",render:e=>{let{field:r}=e;return(0,a.jsxs)(m.eI,{children:[(0,a.jsx)(m.lR,{children:"Referencia"}),(0,a.jsx)(m.MJ,{children:(0,a.jsx)(u.p,{...r})}),(0,a.jsx)(m.C5,{})]})}}),(0,a.jsx)(m.zB,{control:S.control,name:"consignee",render:e=>{let{field:r}=e;return(0,a.jsxs)(m.eI,{children:[(0,a.jsx)(m.lR,{children:"Consignatario"}),(0,a.jsx)(m.MJ,{children:(0,a.jsx)(N.d,{value:r.value,onChange:r.onChange})}),(0,a.jsx)(m.C5,{})]})}}),(0,a.jsx)(m.zB,{control:S.control,name:"proveedor",render:e=>{let{field:r}=e;return(0,a.jsxs)(m.eI,{children:[(0,a.jsx)(m.lR,{children:"Proveedor"}),(0,a.jsx)(m.MJ,{children:(0,a.jsx)(u.p,{...r})}),(0,a.jsx)(m.C5,{})]})}}),(0,a.jsx)(m.zB,{control:S.control,name:"entryCustoms",render:e=>{let{field:r}=e;return(0,a.jsxs)(m.eI,{children:[(0,a.jsx)(m.lR,{children:"Aduana Ingreso"}),(0,a.jsxs)(k.l6,{onValueChange:r.onChange,value:r.value,children:[(0,a.jsx)(m.MJ,{children:(0,a.jsx)(k.bq,{children:(0,a.jsx)(k.yv,{placeholder:"Seleccionar..."})})}),(0,a.jsx)(k.gC,{children:C.gb.map(e=>(0,a.jsx)(k.eb,{value:e.value,children:e.label},e.value))})]}),(0,a.jsx)(m.C5,{})]})}}),(0,a.jsx)(m.zB,{control:S.control,name:"dispatchCustoms",render:e=>{let{field:r}=e;return(0,a.jsxs)(m.eI,{children:[(0,a.jsx)(m.lR,{children:"Aduana Despacho"}),(0,a.jsxs)(k.l6,{onValueChange:r.onChange,value:r.value,children:[(0,a.jsx)(m.MJ,{children:(0,a.jsx)(k.bq,{children:(0,a.jsx)(k.yv,{placeholder:"Seleccionar..."})})}),(0,a.jsx)(k.gC,{children:C.gb.map(e=>(0,a.jsx)(k.eb,{value:e.value,children:e.label},e.value))})]}),(0,a.jsx)(m.C5,{})]})}})]}),(0,a.jsx)(x.$,{type:"button",onClick:()=>w(!0),children:"Administrar Facturas"}),(0,a.jsx)(q,{control:S.control}),(0,a.jsxs)("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-4 pt-4 border-t",children:[(0,a.jsx)(m.zB,{control:S.control,name:"proveedorTransporte",render:e=>{let{field:r}=e;return(0,a.jsxs)(m.eI,{children:[(0,a.jsx)(m.lR,{children:"Proveedor de Transporte"}),(0,a.jsx)(m.MJ,{children:(0,a.jsx)(u.p,{...r})}),(0,a.jsx)(m.C5,{})]})}}),(0,a.jsx)(m.zB,{control:S.control,name:"declaracionNumero",render:e=>{let{field:r}=e;return(0,a.jsxs)(m.eI,{children:[(0,a.jsx)(m.lR,{children:"Declaraci\xf3n"}),(0,a.jsx)(m.MJ,{children:(0,a.jsx)(u.p,{...r})}),(0,a.jsx)(m.C5,{})]})}}),(0,a.jsx)(m.zB,{control:S.control,name:"fechaNacionalizacion",render:e=>{let{field:r}=e;return(0,a.jsxs)(m.eI,{className:"flex flex-col",children:[(0,a.jsx)(m.lR,{children:"Fecha de Nacionalizaci\xf3n"}),(0,a.jsx)(m.MJ,{children:(0,a.jsx)(J.l,{date:r.value||void 0,onDateChange:r.onChange})}),(0,a.jsx)(m.C5,{})]})}}),(0,a.jsx)(m.zB,{control:S.control,name:"selectividad",render:e=>{let{field:r}=e;return(0,a.jsxs)(m.eI,{children:[(0,a.jsx)(m.lR,{children:"Selectividad"}),(0,a.jsxs)(k.l6,{onValueChange:r.onChange,value:r.value||void 0,children:[(0,a.jsx)(m.MJ,{children:(0,a.jsx)(k.bq,{children:(0,a.jsx)(k.yv,{placeholder:"Seleccionar..."})})}),(0,a.jsxs)(k.gC,{children:[(0,a.jsx)(k.eb,{value:"verde",children:"Verde"}),(0,a.jsx)(k.eb,{value:"amarillo",children:"Amarillo"}),(0,a.jsx)(k.eb,{value:"rojo",children:"Rojo"})]})]}),(0,a.jsx)(m.C5,{})]})}}),(0,a.jsx)(m.zB,{control:S.control,name:"fechaEnvioCliente",render:e=>{let{field:r}=e;return(0,a.jsxs)(m.eI,{className:"flex flex-col",children:[(0,a.jsx)(m.lR,{children:"Fecha Env\xedo a Cliente"}),(0,a.jsx)(m.MJ,{children:(0,a.jsx)(J.l,{date:r.value||void 0,onDateChange:r.onChange})}),(0,a.jsx)(m.C5,{})]})}}),(0,a.jsx)(m.zB,{control:S.control,name:"fechaDespacho",render:e=>{let{field:r}=e;return(0,a.jsxs)(m.eI,{className:"flex flex-col",children:[(0,a.jsx)(m.lR,{children:"Fecha Despacho"}),(0,a.jsx)(m.MJ,{children:(0,a.jsx)(J.l,{date:r.value||void 0,onDateChange:r.onChange})}),(0,a.jsx)(m.C5,{})]})}})]}),(0,a.jsx)(m.zB,{control:S.control,name:"observations",render:e=>{var r;let{field:n}=e;return(0,a.jsxs)(m.eI,{className:"pt-4 border-t",children:[(0,a.jsx)(m.lR,{children:"Observaciones"}),(0,a.jsx)(m.MJ,{children:(0,a.jsx)(j.T,{rows:3,...n,value:null!=(r=n.value)?r:""})}),(0,a.jsx)(m.C5,{})]})}}),(0,a.jsxs)("div",{className:"flex justify-end gap-2 pt-6",children:[(0,a.jsx)(x.$,{type:"button",variant:"outline",asChild:!0,children:(0,a.jsxs)(y(),{href:"/executive",children:[(0,a.jsx)(p.A,{className:"mr-2 h-4 w-4"})," Volver"]})}),(0,a.jsxs)(x.$,{type:"submit",disabled:b,children:[b&&(0,a.jsx)(v.A,{className:"mr-2 h-4 w-4 animate-spin"}),R?"Guardar Cambios":"Guardar Reporte"]})]})]})})})]}),(0,a.jsx)(P,{isOpen:E,onClose:()=>w(!1),control:S.control})]})}function V(){return(0,a.jsx)(b.G,{children:(0,a.jsx)("div",{className:"py-2 md:py-5",children:(0,a.jsx)(s.Suspense,{fallback:(0,a.jsx)("div",{className:"flex items-center justify-center p-8",children:(0,a.jsx)(v.A,{className:"h-12 w-12 animate-spin text-primary"})}),children:(0,a.jsx)(T,{})})})})}},35295:(e,r,n)=>{Promise.resolve().then(n.bind(n,4155))}},e=>{e.O(0,[2992,7138,4865,2130,2619,3326,5282,9351,3504,6505,3545,5479,5171,9817,4728,8441,1255,7358],()=>e(e.s=35295)),_N_E=e.O()}]);