(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[1863],{9891:(e,a,s)=>{"use strict";s.d(a,{d:()=>t});let t=new(s(65240)).EventEmitter},13406:(e,a,s)=>{"use strict";s.d(a,{Xi:()=>c,av:()=>d,j7:()=>o,tU:()=>n});var t=s(95155),r=s(12115),l=s(25667),i=s(64269);let n=l.bL,o=r.forwardRef((e,a)=>{let{className:s,...r}=e;return(0,t.jsx)(l.B8,{ref:a,className:(0,i.cn)("inline-flex h-10 items-center justify-center rounded-md bg-muted p-1 text-muted-foreground",s),...r})});o.displayName=l.B8.displayName;let c=r.forwardRef((e,a)=>{let{className:s,...r}=e;return(0,t.jsx)(l.l9,{ref:a,className:(0,i.cn)("inline-flex items-center justify-center whitespace-nowrap rounded-sm px-3 py-1.5 text-sm font-medium ring-offset-background transition-all focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2 disabled:pointer-events-none disabled:opacity-50 data-[state=active]:bg-background data-[state=active]:text-foreground data-[state=active]:shadow-sm",s),...r})});c.displayName=l.l9.displayName;let d=r.forwardRef((e,a)=>{let{className:s,...r}=e;return(0,t.jsx)(l.UC,{ref:a,className:(0,i.cn)("mt-2 ring-offset-background focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2",s),...r})});d.displayName=l.UC.displayName},13496:(e,a,s)=>{"use strict";s.d(a,{$m:()=>d,As:()=>c,nD:()=>o,ub:()=>u});var t=s(95155),r=s(12115),l=s(16083),i=s(59007),n=s(64269);let o=l.bL,c=r.forwardRef((e,a)=>{let{className:s,...r}=e;return(0,t.jsx)(l.q7,{ref:a,className:(0,n.cn)("border-b",s),...r})});c.displayName="AccordionItem";let d=r.forwardRef((e,a)=>{let{className:s,children:r,...o}=e;return(0,t.jsx)(l.Y9,{className:"flex",children:(0,t.jsxs)(l.l9,{ref:a,className:(0,n.cn)("flex flex-1 items-center justify-between py-4 font-medium transition-all hover:underline [&[data-state=open]>svg]:rotate-180",s),...o,children:[r,(0,t.jsx)(i.A,{className:"h-4 w-4 shrink-0 transition-transform duration-200"})]})})});d.displayName=l.l9.displayName;let u=r.forwardRef((e,a)=>{let{className:s,children:r,...i}=e;return(0,t.jsx)(l.UC,{ref:a,className:"overflow-hidden text-sm transition-all data-[state=closed]:animate-accordion-up data-[state=open]:animate-accordion-down",...i,children:(0,t.jsx)("div",{className:(0,n.cn)("pb-4 pt-0",s),children:r})})});u.displayName=l.UC.displayName},14774:(e,a,s)=>{Promise.resolve().then(s.bind(s,23210))},23210:(e,a,s)=>{"use strict";s.r(a),s.d(a,{default:()=>aA});var t=s(95155),r=s(12115),l=s(20063),i=s(52619),n=s.n(i),o=s(54901),c=s(35434),d=s(3998),u=s(86948),m=s(92033),x=s(87455),h=s(98039),p=s(88964),j=s(95738),f=s(44575),v=s(2165),b=s(90109),N=s(30848),g=s(13381),w=s(53489),A=s(21799),y=s(28127),C=s(50817),S=s(14585),D=s(19708),E=s(47691),k=s(33086),R=s(5282),I=s(65142),P=s(49205),z=s(22544),L=s(66942),M=s(15653),_=s(51834),F=s(41052),V=s(31120),T=s(44846),O=s(15894),B=s(17037);let q=M.z.object({declaracionAduanera:M.z.string().optional(),reciboDeCajaPagoInicial:M.z.string().optional(),pagoInicialRealizado:M.z.boolean().default(!1),montoPagoInicial:M.z.coerce.number().optional(),noLiquidacion:M.z.string().optional(),motivoRectificacion:M.z.string().min(1,"El motivo es requerido."),observaciones:M.z.string().optional()}).refine(e=>!e.pagoInicialRealizado||e.pagoInicialRealizado&&e.reciboDeCajaPagoInicial&&""!==e.reciboDeCajaPagoInicial.trim(),{message:"El recibo de caja es requerido si el pago inicial fue realizado.",path:["reciboDeCajaPagoInicial"]}).refine(e=>!e.pagoInicialRealizado||e.pagoInicialRealizado&&void 0!==e.montoPagoInicial&&e.montoPagoInicial>0,{message:"El monto debe ser mayor que cero si el pago inicial fue realizado.",path:["montoPagoInicial"]});function $(e){var a;let{isOpen:s,onClose:l,caseData:i}=e,{user:n}=(0,o.A)(),{toast:c}=(0,O.dj)(),[u,x]=(0,r.useState)(!1),h=(0,z.mN)({resolver:(0,L.u)(q),defaultValues:{declaracionAduanera:i.declaracionAduanera||"",reciboDeCajaPagoInicial:i.reciboDeCajaPagoInicial||"",pagoInicialRealizado:i.pagoInicialRealizado||!1,montoPagoInicial:null!=(a=i.montoPagoInicial)?a:0,noLiquidacion:i.noLiquidacion||"",motivoRectificacion:i.motivoRectificacion||"",observaciones:i.observaciones||""}});(0,r.useEffect)(()=>{var e;h.reset({declaracionAduanera:i.declaracionAduanera||"",reciboDeCajaPagoInicial:i.reciboDeCajaPagoInicial||"",pagoInicialRealizado:i.pagoInicialRealizado||!1,montoPagoInicial:null!=(e=i.montoPagoInicial)?e:0,noLiquidacion:i.noLiquidacion||"",motivoRectificacion:i.motivoRectificacion||"",observaciones:i.observaciones||""})},[i,h]);let p=h.watch("pagoInicialRealizado"),j=async e=>{if(!n||!n.displayName||!i.worksheetId)return void c({title:"Error",description:"Debe estar autenticado y el caso debe tener una hoja de trabajo asociada.",variant:"destructive"});x(!0);let a=(0,D.H9)(S.db,"AforoCases",i.id),s=(0,D.rJ)(S.db,"worksheets",i.worksheetId,"actualizaciones"),t=(0,D.wP)(S.db);try{let r={...e,incidentType:"Rectificacion",incidentReported:!0,incidentReason:e.motivoRectificacion,incidentStatus:"Pendiente",incidentReportedBy:n.displayName,incidentReportedAt:D.Dc.now()};t.update(a,r);let o={updatedAt:D.Dc.now(),updatedBy:n.displayName,field:"incident_report",oldValue:i.incidentReason||null,newValue:"reported",comment:"Incidencia reportada: ".concat(e.motivoRectificacion)};t.set((0,D.H9)(s),o),await t.commit(),c({title:"Incidencia Reportada",description:"La solicitud ha sido enviada al agente aduanero para su revisi\xf3n."}),l()}catch(e){console.error("Error reporting incident:",e),c({title:"Error",description:"No se pudo reportar la incidencia.",variant:"destructive"})}finally{x(!1)}};return s?(0,t.jsx)(_.lG,{open:s,onOpenChange:l,children:(0,t.jsxs)(_.Cf,{className:"max-w-2xl",children:[(0,t.jsxs)(_.c7,{children:[(0,t.jsx)(_.L3,{children:"Reportar Incidencia / Solicitud de Rectificaci\xf3n"}),(0,t.jsxs)(_.rr,{children:["Complete la informaci\xf3n para el caso NE: ",(0,t.jsx)("span",{className:"font-bold text-foreground",children:i.ne})]})]}),(0,t.jsx)(B.F,{className:"max-h-[70vh] pr-4",children:(0,t.jsx)(F.lV,{...h,children:(0,t.jsxs)("form",{onSubmit:h.handleSubmit(j),className:"space-y-4 py-4",children:[(0,t.jsxs)("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[(0,t.jsx)(F.zB,{control:h.control,name:"declaracionAduanera",render:e=>{let{field:a}=e;return(0,t.jsxs)(F.eI,{children:[(0,t.jsx)(F.lR,{children:"Declaraci\xf3n Aduanera"}),(0,t.jsx)(F.MJ,{children:(0,t.jsx)(I.p,{...a})}),(0,t.jsx)(F.C5,{})]})}}),(0,t.jsx)(F.zB,{control:h.control,name:"noLiquidacion",render:e=>{let{field:a}=e;return(0,t.jsxs)(F.eI,{children:[(0,t.jsx)(F.lR,{children:"No. de Liquidaci\xf3n"}),(0,t.jsx)(F.MJ,{children:(0,t.jsx)(I.p,{...a})}),(0,t.jsx)(F.C5,{})]})}}),(0,t.jsx)(F.zB,{control:h.control,name:"pagoInicialRealizado",render:e=>{let{field:a}=e;return(0,t.jsxs)(F.eI,{className:"flex flex-row items-center justify-between rounded-lg border p-3 shadow-sm col-span-1 md:col-span-2",children:[(0,t.jsx)("div",{className:"space-y-0.5",children:(0,t.jsx)(F.lR,{children:"\xbfPago Inicial Realizado?"})}),(0,t.jsx)(F.MJ,{children:(0,t.jsx)(T.d,{checked:a.value,onCheckedChange:a.onChange})})]})}}),p&&(0,t.jsxs)(t.Fragment,{children:[(0,t.jsx)(F.zB,{control:h.control,name:"reciboDeCajaPagoInicial",render:e=>{let{field:a}=e;return(0,t.jsxs)(F.eI,{children:[(0,t.jsx)(F.lR,{children:"Recibo de Caja Pago Inicial"}),(0,t.jsx)(F.MJ,{children:(0,t.jsx)(I.p,{...a})}),(0,t.jsx)(F.C5,{})]})}}),(0,t.jsx)(F.zB,{control:h.control,name:"montoPagoInicial",render:e=>{let{field:a}=e;return(0,t.jsxs)(F.eI,{children:[(0,t.jsx)(F.lR,{children:"Monto Pagado (USD)"}),(0,t.jsx)(F.MJ,{children:(0,t.jsx)(I.p,{type:"number",step:"0.01",...a})}),(0,t.jsx)(F.C5,{})]})}})]}),(0,t.jsx)("div",{className:"col-span-1 md:col-span-2",children:(0,t.jsx)(F.zB,{control:h.control,name:"motivoRectificacion",render:e=>{var a;let{field:s}=e;return(0,t.jsxs)(F.eI,{children:[(0,t.jsx)(F.lR,{children:"Motivo de la Rectificaci\xf3n"}),(0,t.jsx)(F.MJ,{children:(0,t.jsx)(V.T,{...s,rows:4,value:null!=(a=s.value)?a:""})}),(0,t.jsx)(F.C5,{})]})}})}),(0,t.jsx)("div",{className:"col-span-1 md:col-span-2",children:(0,t.jsx)(F.zB,{control:h.control,name:"observaciones",render:e=>{var a;let{field:s}=e;return(0,t.jsxs)(F.eI,{children:[(0,t.jsx)(F.lR,{children:"Observaciones"}),(0,t.jsx)(F.MJ,{children:(0,t.jsx)(V.T,{...s,rows:3,value:null!=(a=s.value)?a:""})}),(0,t.jsx)(F.C5,{})]})}})}),(0,t.jsx)("div",{className:"col-span-1 md:col-span-2",children:(0,t.jsxs)(F.eI,{children:[(0,t.jsx)(F.lR,{children:"Observaciones Contabilidad (No editable)"}),(0,t.jsx)(F.MJ,{children:(0,t.jsx)(V.T,{value:i.observacionesContabilidad||"",readOnly:!0,rows:3,className:"bg-muted/50 cursor-not-allowed"})})]})})]}),(0,t.jsxs)(_.Es,{className:"pt-4",children:[(0,t.jsx)(d.$,{type:"button",variant:"outline",onClick:l,children:"Cancelar"}),(0,t.jsxs)(d.$,{type:"submit",disabled:u,children:[u&&(0,t.jsx)(m.A,{className:"mr-2 h-4 w-4 animate-spin"}),"Enviar a Revisi\xf3n"]})]})]})})})]})}):null}var G=s(67421),H=s(27339),J=s(83012),U=s(73457),Z=s(11186),W=s(76444);let Q=M.z.object({valueDoubtNotificationDate:M.z.date({required_error:"La fecha de notificaci\xf3n es requerida."}),valueDoubtAmount:M.z.coerce.number().optional(),valueDoubtStatus:M.z.custom().optional(),valueDoubtExtensionRequested:M.z.boolean().optional(),valueDoubtLevanteRequested:M.z.boolean().optional(),valueDoubtAssignedToLegal:M.z.boolean().optional()});function X(e){var a,s;let{isOpen:l,onClose:i,caseData:n}=e,{user:c}=(0,o.A)(),{toast:u}=(0,O.dj)(),[x,h]=(0,r.useState)(!1),[p,j]=(0,r.useState)(null),f=(0,z.mN)({resolver:(0,L.u)(Q),defaultValues:{valueDoubtNotificationDate:null==(a=n.valueDoubtNotificationDate)?void 0:a.toDate(),valueDoubtAmount:null!=(s=n.valueDoubtAmount)?s:void 0,valueDoubtStatus:n.valueDoubtStatus||void 0,valueDoubtExtensionRequested:n.valueDoubtExtensionRequested||!1,valueDoubtLevanteRequested:n.valueDoubtLevanteRequested||!1,valueDoubtAssignedToLegal:n.valueDoubtAssignedToLegal||!1}}),v=f.watch("valueDoubtNotificationDate"),b=f.watch("valueDoubtExtensionRequested");(0,r.useEffect)(()=>{v?j((0,J.f)(v,b?30:10)):j(null)},[v,b]);let N=!n.hasValueDoubt,g=async e=>{if(!c||!c.displayName||!n.worksheetId)return void u({title:"Error",description:"Debe estar autenticado y el caso debe tener una hoja de trabajo asociada.",variant:"destructive"});h(!0);let a=(0,D.H9)(S.db,"AforoCases",n.id),s=(0,D.rJ)(S.db,"worksheets",n.worksheetId,"actualizaciones"),t=(0,D.wP)(S.db);try{let r=e.valueDoubtExtensionRequested?30:10,l=(0,J.f)(e.valueDoubtNotificationDate,r);if(!l){u({title:"Error",description:"No se pudo calcular la fecha de vencimiento.",variant:"destructive"}),h(!1);return}let o={valueDoubtNotificationDate:D.Dc.fromDate(e.valueDoubtNotificationDate),valueDoubtAmount:e.valueDoubtAmount||null,valueDoubtDueDate:D.Dc.fromDate(l),valueDoubtStatus:e.valueDoubtStatus||null,valueDoubtExtensionRequested:e.valueDoubtExtensionRequested||!1,valueDoubtLevanteRequested:e.valueDoubtLevanteRequested||!1,valueDoubtAssignedToLegal:e.valueDoubtAssignedToLegal||!1},d="";N?(o.hasValueDoubt=!0,o.incidentType="Duda de Valor",d="Reporte inicial de Duda de Valor con monto ".concat(e.valueDoubtAmount?"$".concat(e.valueDoubtAmount):"pendiente")):d="Actualizaci\xf3n de estado de Duda de Valor.",t.update(a,o);let m={updatedAt:D.Dc.now(),updatedBy:c.displayName,field:"value_doubt_report",oldValue:N?null:{status:n.valueDoubtStatus},newValue:o,comment:d};t.set((0,D.H9)(s),m),await t.commit(),u({title:"Duda de Valor ".concat(N?"Reportada":"Actualizada"),description:"El caso NE ".concat(n.ne," ha sido actualizado.")}),i()}catch(e){console.error("Error reporting/updating value doubt:",e),u({title:"Error",description:"No se pudo procesar la solicitud.",variant:"destructive"})}finally{h(!1)}};return l?(0,t.jsx)(_.lG,{open:l,onOpenChange:i,children:(0,t.jsxs)(_.Cf,{className:"sm:max-w-md",children:[(0,t.jsxs)(_.c7,{children:[(0,t.jsx)(_.L3,{children:"Duda de Valor"}),(0,t.jsxs)(_.rr,{children:["Gesti\xf3n del proceso para el caso NE: ",(0,t.jsx)("span",{className:"font-bold text-foreground",children:n.ne}),"."]})]}),(0,t.jsx)(F.lV,{...f,children:(0,t.jsxs)("form",{onSubmit:f.handleSubmit(g),className:"space-y-4 py-4",children:[(0,t.jsx)(F.zB,{control:f.control,name:"valueDoubtNotificationDate",render:e=>{let{field:a}=e;return(0,t.jsxs)(F.eI,{className:"flex flex-col",children:[(0,t.jsx)(F.lR,{children:"Fecha de Notificaci\xf3n"}),(0,t.jsx)(F.MJ,{children:(0,t.jsx)(H.l,{date:a.value,onDateChange:a.onChange})}),(0,t.jsx)(F.C5,{})]})}}),(0,t.jsx)(F.zB,{control:f.control,name:"valueDoubtAmount",render:e=>{var a;let{field:s}=e;return(0,t.jsxs)(F.eI,{children:[(0,t.jsx)(F.lR,{children:"Monto de la Preliquidaci\xf3n por Pagar (USD)"}),(0,t.jsx)(F.MJ,{children:(0,t.jsx)(I.p,{type:"number",step:"0.01",...s,value:null!=(a=s.value)?a:""})}),(0,t.jsx)(F.C5,{})]})}}),(0,t.jsxs)("div",{children:[(0,t.jsx)(W.J,{children:"Fecha de Vencimiento (calculada)"}),(0,t.jsx)(I.p,{readOnly:!0,value:p?p.toLocaleDateString("es-NI",{weekday:"long",year:"numeric",month:"long",day:"numeric"}):"Seleccione fecha de notificaci\xf3n",className:"bg-muted/50 cursor-not-allowed"})]}),!N&&(0,t.jsxs)("div",{className:"pt-4 mt-4 border-t space-y-4",children:[(0,t.jsx)(F.zB,{control:f.control,name:"valueDoubtStatus",render:e=>{let{field:a}=e;return(0,t.jsxs)(F.eI,{children:[(0,t.jsx)(F.lR,{children:"Estado del Proceso"}),(0,t.jsxs)(Z.l6,{onValueChange:a.onChange,defaultValue:a.value,children:[(0,t.jsx)(F.MJ,{children:(0,t.jsx)(Z.bq,{children:(0,t.jsx)(Z.yv,{placeholder:"Seleccionar estado..."})})}),(0,t.jsxs)(Z.gC,{children:[(0,t.jsx)(Z.eb,{value:"Proceso Administrativo",children:"Proceso Administrativo"}),(0,t.jsx)(Z.eb,{value:"Allanamiento",children:"Allanamiento"})]})]}),(0,t.jsx)(F.C5,{})]})}}),"Proceso Administrativo"===f.watch("valueDoubtStatus")&&(0,t.jsx)(F.zB,{control:f.control,name:"valueDoubtExtensionRequested",render:e=>{let{field:a}=e;return(0,t.jsxs)(F.eI,{className:"flex flex-row items-center justify-between rounded-lg border p-3 shadow-sm",children:[(0,t.jsx)("div",{className:"space-y-0.5",children:(0,t.jsx)(F.lR,{children:"\xbfSe solicit\xf3 ampliaci\xf3n de plazo?"})}),(0,t.jsx)(F.MJ,{children:(0,t.jsx)(U.S,{checked:a.value,onCheckedChange:a.onChange})})]})}}),(0,t.jsx)(F.zB,{control:f.control,name:"valueDoubtLevanteRequested",render:e=>{let{field:a}=e;return(0,t.jsxs)(F.eI,{className:"flex flex-row items-center justify-between rounded-lg border p-3 shadow-sm",children:[(0,t.jsx)("div",{className:"space-y-0.5",children:(0,t.jsx)(F.lR,{children:"\xbfSe solicit\xf3 levante?"})}),(0,t.jsx)(F.MJ,{children:(0,t.jsx)(U.S,{checked:a.value,onCheckedChange:a.onChange})})]})}}),(0,t.jsx)(F.zB,{control:f.control,name:"valueDoubtAssignedToLegal",render:e=>{let{field:a}=e;return(0,t.jsxs)(F.eI,{className:"flex flex-row items-center justify-between rounded-lg border p-3 shadow-sm",children:[(0,t.jsx)("div",{className:"space-y-0.5",children:(0,t.jsx)(F.lR,{children:"\xbfCaso asignado a Legal?"})}),(0,t.jsx)(F.MJ,{children:(0,t.jsx)(U.S,{checked:a.value,onCheckedChange:a.onChange})})]})}})]}),(0,t.jsxs)(_.Es,{className:"pt-4",children:[(0,t.jsx)(d.$,{type:"button",variant:"outline",onClick:i,children:"Cancelar"}),(0,t.jsxs)(d.$,{type:"submit",disabled:x,children:[x&&(0,t.jsx)(m.A,{className:"mr-2 h-4 w-4 animate-spin"}),N?"Guardar Reporte":"Actualizar Proceso"]})]})]})})]})}):null}var Y=s(77059),K=s(4246),ee=s(80160);let ea=async e=>{let a=new Date,s=(0,R.GP)(a,"dd/MM/yy HH:mm",{locale:ee.es}),t=function(e){let a=arguments.length>1&&void 0!==arguments[1]&&arguments[1];if(!e)return"N/A";let s=e.toDate?e.toDate():new Date(e);return!(s instanceof Date)||isNaN(s.getTime())?"Fecha Inv\xe1lida":(0,R.GP)(s,a?"dd/MM/yy HH:mm":"dd/MM/yy",{locale:ee.es})},r=["NE","REFERENCIA","ADUANA INGRESO","ADUANA DESPACHO","CONSIGNATARIO","PROVEEDOR","FACTURA","No. ADMI","FECHA ENVIO A CLIENTE","PERMISO REQUERIDO","ESTADO PERMISO","FECHA SOMETIDO","FECHA AUTORIZADO","PROVEEDOR TRANSPORTE","DECLARACION","FECHA NACIONALIZACION","SELECTIVIDAD","FECHA DESPACHO","OBSERVACIONES"],l=[];for(let a of e)if(a.documents&&a.documents.filter(e=>"FACTURA"===e.type).length>0)for(let e of a.documents.filter(e=>"FACTURA"===e.type)){var i;let s=null==(i=a.requiredPermits)?void 0:i.find(a=>a.facturaNumber===e.number);l.push([a.ne,a.reference||"N/A",a.entryCustoms,a.dispatchCustoms,a.consignee,a.proveedor||"N/A",e.number,e.noADMI||"N/A",t(a.fechaEnvioCliente,!1),(null==s?void 0:s.name)||"N/A",(null==s?void 0:s.status)||"N/A",t(null==s?void 0:s.tramiteDate,!1),t((null==s?void 0:s.status)==="Entregado"?s.estimatedDeliveryDate:null,!1),a.proveedorTransporte||"N/A",a.declaracionNumero||"N/A",t(a.fechaNacionalizacion,!1),a.selectividad||"N/A",t(a.fechaDespacho,!1),a.observations||""])}else l.push([a.ne,a.reference||"N/A",a.entryCustoms,a.dispatchCustoms,a.consignee,a.proveedor||"N/A","N/A","N/A",t(a.fechaEnvioCliente,!1),"N/A","N/A","N/A","N/A",a.proveedorTransporte||"N/A",a.declaracionNumero||"N/A",t(a.fechaNacionalizacion,!1),a.selectividad||"N/A",t(a.fechaDespacho,!1),a.observations||""]);let n=[["Reporte de Consignatarios Empresariales"],["Generado el: ".concat(s)],[],r,...l],o=K.Wp.aoa_to_sheet(n),c=r.map((e,a)=>({wch:Math.max(e.length,...l.map(e=>String(e[a]||"").length))+2}));o["!cols"]=c;let d=K.Wp.book_new();K.Wp.book_append_sheet(d,o,"Reporte Corporativo"),K._h(d,"Reporte_Corporativo_".concat(a.toISOString().split("T")[0],".xlsx"))};var es=s(26333),et=s(6259),er=s(82206),el=s(59321),ei=s(11929);let en=M.z.object({comment:M.z.string().min(1,"El comentario no puede estar vac\xedo.")});function eo(e){let{isOpen:a,onClose:s,caseData:l}=e,{user:i}=(0,o.A)(),{toast:n}=(0,O.dj)(),[c,u]=(0,r.useState)(!1),[x,h]=(0,r.useState)([]);(0,r.useEffect)(()=>{a&&l.executiveComments&&h([...l.executiveComments].reverse())},[a,l.executiveComments]);let p=(0,z.mN)({resolver:(0,L.u)(en),defaultValues:{comment:""}}),j=(null==i?void 0:i.role)==="ejecutivo"||(null==i?void 0:i.role)==="coordinadora"||(null==i?void 0:i.role)==="admin",f=async e=>{if(!i||!i.displayName||!l.worksheetId)return void n({title:"Error",description:"Debe estar autenticado y el caso debe tener una hoja de trabajo asociada.",variant:"destructive"});if(!j)return void n({title:"Permiso Denegado",description:"No tiene permisos para a\xf1adir un comentario.",variant:"destructive"});u(!0);let a=(0,D.H9)(S.db,"worksheets",l.worksheetId),s=(0,D.rJ)(a,"actualizaciones"),t=(0,D.wP)(S.db),r={id:(0,ei.A)(),author:i.displayName,text:e.comment,createdAt:D.Dc.now()};try{h(e=>[r,...e]),t.update(a,{executiveComments:(0,D.hq)(r)});let o={updatedAt:D.Dc.now(),updatedBy:i.displayName,field:"executiveComments",oldValue:"N/A",newValue:e.comment,comment:'Comentario ejecutivo a\xf1adido: "'.concat(e.comment,'"')};t.set((0,D.H9)(s),o),await t.commit(),n({title:"Comentario A\xf1adido",description:"Se ha guardado un nuevo comentario en el caso NE ".concat(l.ne,".")}),p.reset()}catch(e){console.error("Error adding executive comment:",e),h(e=>e.filter(e=>e.id!==r.id)),n({title:"Error",description:"No se pudo guardar el comentario.",variant:"destructive"})}finally{u(!1)}};return a?(0,t.jsx)(_.lG,{open:a,onOpenChange:s,children:(0,t.jsxs)(_.Cf,{className:"max-w-lg",children:[(0,t.jsxs)(_.c7,{children:[(0,t.jsx)(_.L3,{children:"Comentarios del Caso"}),(0,t.jsxs)(_.rr,{children:["Historial de comentarios y notas para el caso NE: ",(0,t.jsx)("span",{className:"font-bold text-foreground",children:l.ne}),"."]})]}),(0,t.jsx)(B.F,{className:"max-h-[40vh] my-4",children:(0,t.jsx)("div",{className:"space-y-4 pr-6",children:x.length>0?x.map(e=>{let a;return(0,t.jsxs)("div",{className:"p-3 border rounded-lg bg-secondary/50",children:[(0,t.jsx)("p",{className:"text-sm text-foreground",children:e.text}),(0,t.jsxs)("div",{className:"text-xs text-muted-foreground mt-2 text-right",children:[(0,t.jsxs)("span",{children:["- ",e.author]}),(0,t.jsxs)("span",{className:"ml-2",children:["(",(a=e.createdAt,(0,R.GP)(a.toDate(),"dd/MM/yy hh:mm a",{locale:ee.es})),")"]})]})]},e.id)}):(0,t.jsx)("p",{className:"text-sm text-muted-foreground text-center py-8",children:"No hay comentarios para este caso."})})}),(0,t.jsx)(F.lV,{...p,children:(0,t.jsxs)("form",{onSubmit:p.handleSubmit(f),className:"space-y-4 pt-4 border-t",children:[(0,t.jsx)(F.zB,{control:p.control,name:"comment",render:e=>{let{field:a}=e;return(0,t.jsxs)(F.eI,{children:[(0,t.jsx)(F.lR,{children:"Nuevo Comentario"}),(0,t.jsx)(F.MJ,{children:(0,t.jsx)(V.T,{...a,rows:3,disabled:!j||c,placeholder:j?"Escriba su comentario aqu\xed...":"No tiene permisos para comentar."})}),(0,t.jsx)(F.C5,{})]})}}),(0,t.jsxs)(_.Es,{className:"pt-4",children:[(0,t.jsx)(d.$,{type:"button",variant:"outline",onClick:s,children:"Cerrar"}),j&&(0,t.jsxs)(d.$,{type:"submit",disabled:c,children:[c&&(0,t.jsx)(m.A,{className:"mr-2 h-4 w-4 animate-spin"}),"Guardar Comentario"]})]})]})})]})}):null}var ec=s(60406),ed=s(9891),eu=s(86501);let em=M.z.object({reference:M.z.string().optional(),location:M.z.string().min(1,"La ubicaci\xf3n es requerida.")});function ex(e){let{isOpen:a,onClose:s,caseWithWorksheet:i}=e,{user:n}=(0,o.A)(),{toast:c}=(0,O.dj)(),u=(0,l.useRouter)(),[x,h]=(0,r.useState)(!1),[p,j]=(0,r.useState)(!1),[f,v]=(0,r.useState)(!1),[b,N]=(0,r.useState)(!0),g=(0,z.mN)({resolver:(0,L.u)(em),defaultValues:{reference:"",location:""}});(0,r.useEffect)(()=>{let e=async()=>{if(!a)return;N(!0);let e=i.ne.toUpperCase().trim(),s=(0,D.H9)(S.db,"examenesPrevios",e),t=(0,D.H9)(S.db,"solicitudesExamen",e);try{let[e,a]=await Promise.all([(0,D.x7)(s),(0,D.x7)(t)]),r=e.exists()||a.exists();j(r),r?v(!0):v(!1)}catch(e){console.error("Error checking for existing case:",e),j(!1)}finally{N(!1)}};if(a){var s;g.reset({reference:"",location:(null==(s=i.worksheet)?void 0:s.location)||""}),e()}},[a,i,g]);let w=(null==n?void 0:n.role)==="coordinadora"?"/assignments":"/executive",A=async(e,a)=>{if(!n||!n.email)return;let t=(0,D.H9)(S.db,"solicitudesExamen",e),r={ne:i.ne.toUpperCase().trim(),id:e,reference:a.reference||"",consignee:i.consignee,location:a.location,status:"pendiente",requestedBy:n.email,requestedAt:D.Dc.fromDate(new Date)};try{await (0,D.BN)(t,r),c({title:"Solicitud Enviada",description:"La solicitud para el examen NE: ".concat(e," ha sido creada.")}),u.push(w),s()}catch(a){let e=new eu.$({path:t.path,operation:"create",requestResourceData:r},a);ed.d.emit("permission-error",e)}};async function y(e){if(!n||!n.email)return void c({title:"Error de autenticaci\xf3n",variant:"destructive"});if(!i.worksheet)return void c({title:"Error",description:"No se encontr\xf3 la hoja de trabajo asociada.",variant:"destructive"});h(!0);let a=i.ne.toUpperCase().trim();if(f){let s=(0,D.P)((0,D.rJ)(S.db,"solicitudesExamen"),(0,D._M)("ne","==",a)),t=(0,D.P)((0,D.rJ)(S.db,"examenesPrevios"),(0,D._M)("ne","==",a));try{let[r,l]=await Promise.all([(0,D.d_)(s),(0,D.d_)(t)]),i=r.data().count,n=l.data().count,o="".concat(a,"-EXT").concat(i+n+1);await A(o,e)}catch(e){console.error("Error counting existing cases",e),c({title:"Error",description:"No se pudo contar los casos existentes para crear ID extraordinario.",variant:"destructive"})}finally{h(!1)}}else await A(a,e),h(!1)}return a?(0,t.jsx)(_.lG,{open:a,onOpenChange:s,children:(0,t.jsxs)(_.Cf,{className:"sm:max-w-md",children:[(0,t.jsxs)(_.c7,{children:[(0,t.jsx)(_.L3,{children:"Solicitud R\xe1pida de Previo"}),(0,t.jsxs)(_.rr,{children:["Creando una solicitud para el NE: ",(0,t.jsx)("span",{className:"font-bold text-foreground",children:i.ne}),"."]})]}),(0,t.jsx)("div",{className:"text-sm space-y-1 text-muted-foreground",children:(0,t.jsxs)("p",{children:[(0,t.jsx)("strong",{children:"Consignatario:"})," ",i.consignee]})}),(0,t.jsx)(F.lV,{...g,children:(0,t.jsxs)("form",{onSubmit:g.handleSubmit(y),className:"space-y-4 py-4",children:[(0,t.jsx)(F.zB,{control:g.control,name:"location",render:e=>{let{field:a}=e;return(0,t.jsxs)(F.eI,{children:[(0,t.jsx)(F.lR,{children:"Ubicaci\xf3n de la Mercanc\xeda"}),(0,t.jsx)(F.MJ,{children:(0,t.jsx)(I.p,{...a,disabled:x,placeholder:"Especifique la ubicaci\xf3n"})}),(0,t.jsx)(F.C5,{})]})}}),(0,t.jsx)(F.zB,{control:g.control,name:"reference",render:e=>{let{field:a}=e;return(0,t.jsxs)(F.eI,{children:[(0,t.jsx)(F.lR,{children:"Referencia (Contenedor, Gu\xeda, BL...)"}),(0,t.jsx)(F.MJ,{children:(0,t.jsx)(I.p,{...a,disabled:x,placeholder:"Ingrese la nueva referencia"})}),(0,t.jsx)(F.C5,{})]})}}),b?(0,t.jsxs)("div",{className:"flex items-center justify-center p-4",children:[(0,t.jsx)(m.A,{className:"mr-2 h-4 w-4 animate-spin"}),(0,t.jsx)("span",{className:"text-sm text-muted-foreground",children:"Verificando..."})]}):p&&(0,t.jsxs)("div",{className:"p-4 bg-amber-100 dark:bg-amber-900/30 border border-amber-300 dark:border-amber-700 rounded-lg",children:[(0,t.jsxs)("div",{className:"flex items-center gap-3",children:[(0,t.jsx)(ec.A,{className:"h-5 w-5 text-amber-600 dark:text-amber-400"}),(0,t.jsx)("p",{className:"text-sm font-semibold text-amber-800 dark:text-amber-300",children:"Ya existe un caso para este NE."})]}),(0,t.jsxs)("div",{className:"flex items-center space-x-2 mt-3 pl-2",children:[(0,t.jsx)(T.d,{id:"extra-case-mode",checked:f,onCheckedChange:v}),(0,t.jsx)(W.J,{htmlFor:"extra-case-mode",className:"text-sm font-medium",children:"Crear como Caso Extraordinario"})]})]}),(0,t.jsxs)(_.Es,{className:"pt-4",children:[(0,t.jsx)(d.$,{type:"button",variant:"outline",onClick:s,children:"Cancelar"}),(0,t.jsxs)(d.$,{type:"submit",disabled:x||b,children:[(x||b)&&(0,t.jsx)(m.A,{className:"mr-2 h-4 w-4 animate-spin"}),x?"Enviando...":"Enviar Solicitud"]})]})]})})]})}):null}var eh=s(11860);let ep=M.z.object({ne:M.z.string().optional(),reference:M.z.string().optional(),recipient:M.z.string().min(1,"Destinatario es requerido.")});function ej(e){let{isOpen:a,onClose:s,caseData:r}=e,{user:i}=(0,o.A)(),{toast:n}=(0,O.dj)(),{setInitialContextData:c,openAddProductModal:u,setIsMemorandumMode:m,initialContextData:x}=(0,eh.U)(),h=(0,l.useRouter)(),p=(0,z.mN)({resolver:(0,L.u)(ep),defaultValues:{ne:(null==r?void 0:r.ne)||(null==x?void 0:x.ne)||"",reference:"",recipient:"Contabilidad"}}),j=e=>{p.setValue("recipient",e,{shouldValidate:!0}),m("memorandum"===e.toLowerCase())},f=async e=>{if(!i||!i.email||!i.displayName)return void n({title:"Error",description:"Debe estar autenticado.",variant:"destructive"});c({ne:e.ne||"SOL-".concat((0,R.GP)(new Date,"ddMMyy-HHmmss")),reference:e.reference,manager:i.displayName,date:new Date,recipient:e.recipient,isMemorandum:"memorandum"===e.recipient.toLowerCase(),consignee:(null==r?void 0:r.consignee)||"",declaracionAduanera:(null==r?void 0:r.declaracionAduanera)||"",caseId:(null==r?void 0:r.id)||""}),h.push("/examinerPay"),s(),setTimeout(()=>{u()},100)};if(!a)return null;let b=!r;return(0,t.jsx)(_.lG,{open:a,onOpenChange:s,children:(0,t.jsxs)(_.Cf,{className:"sm:max-w-md",children:[(0,t.jsxs)(_.c7,{children:[(0,t.jsx)(_.L3,{children:"Iniciar Solicitud de Pago"}),(0,t.jsx)(_.rr,{children:b?"Creando una solicitud de pago general.":"Creando una solicitud para el NE: ".concat(r.ne,".")})]}),(0,t.jsx)(F.lV,{...p,children:(0,t.jsxs)("form",{onSubmit:p.handleSubmit(f),className:"space-y-4 py-4",children:[(0,t.jsx)(F.zB,{control:p.control,name:"ne",render:e=>{let{field:a}=e;return(0,t.jsxs)(F.eI,{children:[(0,t.jsx)(F.lR,{children:"N\xfamero de Entrada (NE)"}),(0,t.jsx)(F.MJ,{children:(0,t.jsx)(I.p,{...a,disabled:!b,placeholder:b?"ID \xfanico autogenerado":""})}),(0,t.jsx)(F.C5,{})]})}}),(0,t.jsx)(F.zB,{control:p.control,name:"recipient",render:e=>{let{field:a}=e;return(0,t.jsxs)(F.eI,{children:[(0,t.jsx)(F.lR,{children:"A:"}),(0,t.jsx)(F.MJ,{children:(0,t.jsx)(I.p,{placeholder:"Destinatario o Departamento",...a})}),(0,t.jsxs)("div",{className:"flex flex-wrap gap-2 mt-1",children:[(0,t.jsx)(d.$,{type:"button",variant:"outline",size:"sm",onClick:()=>j("Contabilidad"),className:"text-xs",children:"Contabilidad"}),(0,t.jsx)(d.$,{type:"button",variant:"outline",size:"sm",onClick:()=>j("Harol Ampie - Contabilidad"),className:"text-xs",children:"Harol Ampie"}),(0,t.jsx)(d.$,{type:"button",variant:"outline",size:"sm",onClick:()=>j("Jose Daniel Cerros - Contabilidad"),className:"text-xs",children:"Jose Daniel Cerros"}),(0,t.jsxs)(d.$,{type:"button",variant:"destructive",size:"sm",onClick:()=>j("Memorandum"),className:"text-xs",children:[(0,t.jsx)(v.A,{className:"mr-2 h-4 w-4"}),"Memorandum"]})]}),(0,t.jsx)(F.C5,{})]})}}),(0,t.jsx)(F.zB,{control:p.control,name:"reference",render:e=>{let{field:a}=e;return(0,t.jsxs)(F.eI,{children:[(0,t.jsx)(F.lR,{children:"Referencia (Contenedor, Gu\xeda, BL...)"}),(0,t.jsx)(F.MJ,{children:(0,t.jsx)(I.p,{...a,placeholder:"Ingrese la referencia"})}),(0,t.jsx)(F.C5,{})]})}}),(0,t.jsxs)(_.Es,{className:"pt-4",children:[(0,t.jsx)(d.$,{type:"button",variant:"outline",onClick:s,children:"Cancelar"}),(0,t.jsx)(d.$,{type:"submit",children:"Siguiente"})]})]})})]})})}var ef=s(50984),ev=s(78770),eb=s(26615),eN=s(36654),eg=s(72845),ew=s(11647);function eA(e){let{isOpen:a,onClose:s,caseData:l}=e,[i,n]=(0,r.useState)([]),[o,c]=(0,r.useState)(!0),[u,x]=(0,r.useState)(null);(0,r.useEffect)(()=>{if(!a)return;c(!0),n([]);let e=["SolicitudCheques","Memorandum"].map(e=>{let a=(0,D.P)((0,D.rJ)(S.db,e),(0,D._M)("examNe","==",l.ne),(0,D.My)("savedAt","desc"));return(0,D.aQ)(a,e=>{let a=e.docs.map(e=>{let a=e.data(),s=a.examDate instanceof D.Dc?a.examDate.toDate():void 0,t=a.savedAt instanceof D.Dc?a.savedAt.toDate():void 0;return{...a,solicitudId:e.id,examDate:s,savedAt:t}});n(e=>{let s=new Set(e.map(e=>e.solicitudId)),t=[...e,...a.filter(e=>!s.has(e.solicitudId))];return t.sort((e,a)=>{var s,t;return((null==(s=a.savedAt)?void 0:s.getTime())||0)-((null==(t=e.savedAt)?void 0:t.getTime())||0)}),t}),c(!1)},a=>{console.error("Error fetching payments from ".concat(e,":"),a),c(!1)})});return()=>e.forEach(e=>e())},[a,l.ne]);let h=()=>x(null);if(!a)return null;if(u){let e={ne:u.examNe,reference:u.examReference||void 0,manager:u.examManager,date:u.examDate||new Date,recipient:u.examRecipient,isMemorandum:u.isMemorandum};return(0,t.jsx)(_.lG,{open:!!u,onOpenChange:e=>!e&&h(),children:(0,t.jsx)(_.Cf,{className:"max-w-4xl p-0 h-[90vh] flex flex-col",children:(0,t.jsx)(B.F,{className:"flex-grow",children:(0,t.jsx)("div",{className:"p-6",children:(0,t.jsx)(eg.A,{solicitud:u,initialData:e,onBackToList:h,children:(0,t.jsx)(_.HM,{asChild:!0,children:(0,t.jsx)(d.$,{variant:"ghost",size:"icon",className:"absolute top-4 right-4",children:(0,t.jsx)(eb.A,{className:"h-4 w-4"})})})})})})})})}return(0,t.jsx)(_.lG,{open:a,onOpenChange:s,children:(0,t.jsxs)(_.Cf,{className:"max-w-2xl",children:[(0,t.jsxs)(_.c7,{children:[(0,t.jsx)(_.L3,{children:"Solicitudes de Pago para el Caso"}),(0,t.jsxs)(_.rr,{children:["Visualizando pagos para el NE: ",l.ne]})]}),(0,t.jsx)("div",{className:"mt-4 max-h-[60vh] overflow-y-auto",children:o?(0,t.jsx)("div",{className:"flex items-center justify-center p-8",children:(0,t.jsx)(m.A,{className:"h-8 w-8 animate-spin text-primary"})}):0===i.length?(0,t.jsx)("div",{className:"text-center text-muted-foreground p-8",children:"No se encontraron solicitudes de pago para este caso."}):(0,t.jsx)("div",{className:"space-y-3",children:i.map(e=>{var a;return(0,t.jsxs)("div",{className:"flex justify-between items-center p-3 border rounded-md hover:bg-muted/50",children:[(0,t.jsxs)("div",{children:[(0,t.jsx)("p",{className:"font-semibold",children:e.solicitudId}),(0,t.jsx)("p",{className:"text-sm text-muted-foreground",children:e.examDate?(0,R.GP)(e.examDate,"PPP",{locale:ee.es}):"Fecha no disponible"})]}),(0,t.jsxs)("div",{className:"flex items-center gap-4",children:["Pagado"===e.paymentStatus?(0,t.jsxs)(ew.E,{className:"bg-green-100 text-green-700 hover:bg-green-200",children:[(0,t.jsx)(ef.A,{className:"mr-2 h-4 w-4"})," Pagado"]}):(null==(a=e.paymentStatus)?void 0:a.startsWith("Error:"))?(0,t.jsxs)(ew.E,{variant:"destructive",children:[(0,t.jsx)(ev.A,{className:"mr-2 h-4 w-4"})," Error"]}):(0,t.jsx)(ew.E,{variant:"outline",children:"Pendiente"}),(0,t.jsxs)(d.$,{variant:"outline",size:"sm",onClick:()=>x(e),children:[(0,t.jsx)(eN.A,{className:"mr-2 h-4 w-4"})," Ver Detalle"]})]})]},e.solicitudId)})})}),(0,t.jsx)(_.Es,{children:(0,t.jsx)(d.$,{variant:"outline",onClick:s,children:"Cerrar"})})]})})}var ey=s(53764),eC=s(36204),eS=s(33173),eD=s(64269);let eE=r.createContext(null);function ek(){let e=r.useContext(eE);if(!e)throw Error("useCarousel must be used within a <Carousel />");return e}let eR=r.forwardRef((e,a)=>{let{orientation:s="horizontal",opts:l,setApi:i,plugins:n,className:o,children:c,...d}=e,[u,m]=(0,ey.A)({...l,axis:"horizontal"===s?"x":"y"},n),[x,h]=r.useState(!1),[p,j]=r.useState(!1),f=r.useCallback(e=>{e&&(h(e.canScrollPrev()),j(e.canScrollNext()))},[]),v=r.useCallback(()=>{null==m||m.scrollPrev()},[m]),b=r.useCallback(()=>{null==m||m.scrollNext()},[m]),N=r.useCallback(e=>{"ArrowLeft"===e.key?(e.preventDefault(),v()):"ArrowRight"===e.key&&(e.preventDefault(),b())},[v,b]);return r.useEffect(()=>{m&&i&&i(m)},[m,i]),r.useEffect(()=>{if(m)return f(m),m.on("reInit",f),m.on("select",f),()=>{null==m||m.off("select",f)}},[m,f]),(0,t.jsx)(eE.Provider,{value:{carouselRef:u,api:m,opts:l,orientation:s||((null==l?void 0:l.axis)==="y"?"vertical":"horizontal"),scrollPrev:v,scrollNext:b,canScrollPrev:x,canScrollNext:p},children:(0,t.jsx)("div",{ref:a,onKeyDownCapture:N,className:(0,eD.cn)("relative",o),role:"region","aria-roledescription":"carousel",...d,children:c})})});eR.displayName="Carousel";let eI=r.forwardRef((e,a)=>{let{className:s,...r}=e,{carouselRef:l,orientation:i}=ek();return(0,t.jsx)("div",{ref:l,className:"overflow-hidden",children:(0,t.jsx)("div",{ref:a,className:(0,eD.cn)("flex","horizontal"===i?"-ml-4":"-mt-4 flex-col",s),...r})})});eI.displayName="CarouselContent";let eP=r.forwardRef((e,a)=>{let{className:s,...r}=e,{orientation:l}=ek();return(0,t.jsx)("div",{ref:a,role:"group","aria-roledescription":"slide",className:(0,eD.cn)("min-w-0 shrink-0 grow-0 basis-full","horizontal"===l?"pl-4":"pt-4",s),...r})});eP.displayName="CarouselItem";let ez=r.forwardRef((e,a)=>{let{className:s,variant:r="outline",size:l="icon",...i}=e,{orientation:n,scrollPrev:o,canScrollPrev:c}=ek();return(0,t.jsxs)(d.$,{ref:a,variant:r,size:l,className:(0,eD.cn)("absolute h-8 w-8 rounded-full","horizontal"===n?"-left-12 top-1/2 -translate-y-1/2":"-top-12 left-1/2 -translate-x-1/2 rotate-90",s),disabled:!c,onClick:o,...i,children:[(0,t.jsx)(eC.A,{className:"h-4 w-4"}),(0,t.jsx)("span",{className:"sr-only",children:"Previous slide"})]})});ez.displayName="CarouselPrevious";let eL=r.forwardRef((e,a)=>{let{className:s,variant:r="outline",size:l="icon",...i}=e,{orientation:n,scrollNext:o,canScrollNext:c}=ek();return(0,t.jsxs)(d.$,{ref:a,variant:r,size:l,className:(0,eD.cn)("absolute h-8 w-8 rounded-full","horizontal"===n?"-right-12 top-1/2 -translate-y-1/2":"-bottom-12 left-1/2 -translate-x-1/2 rotate-90",s),disabled:!c,onClick:o,...i,children:[(0,t.jsx)(eS.A,{className:"h-4 w-4"}),(0,t.jsx)("span",{className:"sr-only",children:"Next slide"})]})});eL.displayName="CarouselNext";var eM=s(71700);function e_(){let[e,a]=(0,r.useState)([]),[s,l]=(0,r.useState)(!0),[i,n]=(0,r.useState)(),o=(0,r.useRef)((0,eM.A)({delay:4e3,stopOnInteraction:!1,stopOnMouseEnter:!0}));if((0,r.useEffect)(()=>{let e=(0,D.P)((0,D.rJ)(S.db,"avisos"),(0,D.My)("createdAt","desc")),s=(0,D.aQ)(e,e=>{a(e.docs.map(e=>({id:e.id,...e.data()}))),l(!1)},e=>{console.error("Error fetching announcements:",e),l(!1)});return()=>s()},[]),s)return(0,t.jsx)(u.Zp,{className:"w-full mx-auto custom-shadow",children:(0,t.jsx)(u.Wu,{className:"pt-6",children:(0,t.jsx)("div",{className:"animate-pulse flex space-x-4",children:(0,t.jsxs)("div",{className:"flex-1 space-y-3 py-1",children:[(0,t.jsx)("div",{className:"h-4 bg-muted rounded w-3/4"}),(0,t.jsxs)("div",{className:"space-y-2",children:[(0,t.jsx)("div",{className:"h-3 bg-muted rounded"}),(0,t.jsx)("div",{className:"h-3 bg-muted rounded w-5/6"})]})]})})})});if(0===e.length)return null;let c=e=>{let{ann:a}=e;return(0,t.jsxs)(u.Zp,{className:"h-full custom-shadow bg-card flex flex-col",children:[(0,t.jsx)(u.aR,{className:"pb-2 pt-4",children:(0,t.jsx)(u.ZB,{className:"text-base font-semibold",children:a.title})}),(0,t.jsx)(u.Wu,{className:"flex-grow py-2",children:(0,t.jsx)("p",{className:"text-sm text-card-foreground/80",children:a.content})}),a.linkUrl&&a.linkText&&(0,t.jsx)(u.wL,{className:"pt-2 pb-4",children:(0,t.jsx)(d.$,{asChild:!0,variant:"link",className:"p-0 h-auto text-sm",children:(0,t.jsx)("a",{href:a.linkUrl,target:"_blank",rel:"noopener noreferrer",children:a.linkText})})})]})};return e.length>0&&e.length<=3?(0,t.jsx)("div",{className:"grid grid-cols-1 md:grid-cols-".concat(e.length," gap-4"),children:e.map(e=>(0,t.jsx)(c,{ann:e},e.id))}):(0,t.jsxs)(eR,{setApi:n,plugins:[o.current],className:"w-full group/carousel",opts:{align:"start",loop:!0},children:[(0,t.jsx)(eI,{children:e.map(e=>(0,t.jsx)(eP,{className:"md:basis-1/2 lg:basis-1/3",children:(0,t.jsx)("div",{className:"p-1 h-full",children:(0,t.jsx)(c,{ann:e})})},e.id))}),(0,t.jsx)(ez,{className:"absolute left-2 top-1/2 -translate-y-1/2 z-10 h-8 w-8 rounded-full bg-background/50 text-foreground border-border/50 backdrop-blur-sm opacity-0 group-hover/carousel:opacity-100 transition-opacity hover:bg-background/75"}),(0,t.jsx)(eL,{className:"absolute right-2 top-1/2 -translate-y-1/2 z-10 h-8 w-8 rounded-full bg-background/50 text-foreground border-border/50 backdrop-blur-sm opacity-0 group-hover/carousel:opacity-100 transition-opacity hover:bg-background/75"})]})}var eF=s(63817),eV=s(27314),eT=s(72251);function eO(e){let{isOpen:a,onClose:s,caseData:l,assignableUsers:i,onAssign:n,title:c,description:u}=e,{user:m}=(0,o.A)(),[x,h]=(0,r.useState)(null),p=(null==m?void 0:m.role)==="admin"||(null==m?void 0:m.role)==="coordinadora"||(null==m?void 0:m.role)==="supervisor"||(null==m?void 0:m.role)==="ejecutivo";return(0,t.jsx)(_.lG,{open:a,onOpenChange:s,children:(0,t.jsxs)(_.Cf,{className:"sm:max-w-md",children:[(0,t.jsxs)(_.c7,{children:[(0,t.jsx)(_.L3,{children:c}),(0,t.jsx)(_.rr,{children:u})]}),(0,t.jsxs)(eF.uB,{className:"rounded-lg border shadow-md",children:[(0,t.jsx)(eF.G7,{placeholder:"Buscar usuario..."}),(0,t.jsxs)(eF.oI,{children:[(0,t.jsx)(eF.xL,{children:"No se encontraron usuarios."}),(0,t.jsx)(eF.L$,{children:i.map(e=>(0,t.jsxs)(eF.h_,{value:e.displayName||e.email||"",onSelect:()=>h(e),className:"flex items-center justify-between",children:[(0,t.jsxs)("div",{className:"flex items-center gap-2",children:[(0,t.jsx)(eV.A,{className:"h-4 w-4 text-muted-foreground"}),(0,t.jsxs)("div",{className:"flex flex-col",children:[(0,t.jsx)("span",{children:e.displayName||e.email}),(0,t.jsx)("span",{className:"text-xs text-muted-foreground",children:e.role})]})]}),(0,t.jsx)(eT.A,{className:(0,eD.cn)("h-4 w-4",(null==x?void 0:x.uid)===e.uid?"opacity-100":"opacity-0")})]},e.uid))})]})]}),(0,t.jsxs)(_.Es,{className:"pt-4",children:[(0,t.jsx)(d.$,{type:"button",variant:"outline",onClick:s,children:"Cancelar"}),(0,t.jsx)(d.$,{type:"button",onClick:()=>{x&&(n((null==l?void 0:l.id)||"",x.displayName||x.email||""),s())},disabled:!x||!p,children:"Confirmar Asignaci\xf3n"})]})]})})}let eB=M.z.object({resaNumber:M.z.string().min(1,"El n\xfamero de RESA es requerido."),resaNotificationDate:M.z.date({required_error:"La fecha de notificaci\xf3n es requerida."})});function eq(e){let{isOpen:a,onClose:s,caseData:l}=e,{user:i}=(0,o.A)(),{toast:n}=(0,O.dj)(),[c,u]=(0,r.useState)(!1),[x,h]=(0,r.useState)(null),p=(0,z.mN)({resolver:(0,L.u)(eB),defaultValues:{resaNumber:"",resaNotificationDate:void 0}});(0,r.useEffect)(()=>{let e=async()=>{var e,a;let s=null;if(l.worksheetId){let e=await (0,D.x7)((0,D.H9)(S.db,"worksheets",l.worksheetId));e.exists()&&(s=e.data())}p.reset({resaNumber:l.resaNumber||(null==s?void 0:s.resa)||"",resaNotificationDate:(null==(e=l.resaNotificationDate)?void 0:e.toDate())||(null==s||null==(a=s.resaNotificationDate)?void 0:a.toDate())||void 0})};a&&e()},[a,l,p]);let j=p.watch("resaNotificationDate");(0,r.useEffect)(()=>{j?h((0,J.f)(j,20)):h(null)},[j]);let f=async e=>{if(!i||!i.displayName||!l.worksheetId)return void n({title:"Error",description:"Debe estar autenticado y el caso debe tener una hoja de trabajo asociada.",variant:"destructive"});if(!x)return void n({title:"Error",description:"No se pudo calcular la fecha de vencimiento.",variant:"destructive"});u(!0);let a=(0,D.H9)(S.db,"AforoCases",l.id),t=(0,D.H9)(S.db,"worksheets",l.worksheetId),r=(0,D.rJ)(t,"actualizaciones"),o=(0,D.wP)(S.db);try{let c={resaNumber:e.resaNumber,resaNotificationDate:D.Dc.fromDate(e.resaNotificationDate),resaDueDate:D.Dc.fromDate(x)};o.update(t,c),o.update(a,c);let d={updatedAt:D.Dc.now(),updatedBy:i.displayName,field:"resa_notification",oldValue:{number:l.resaNumber||null,date:l.resaNotificationDate||null},newValue:{number:e.resaNumber,date:e.resaNotificationDate},comment:"RESA ".concat(e.resaNumber," notificada. Vence el ").concat(x.toLocaleDateString(),".")};o.set((0,D.H9)(r),d),await o.commit(),n({title:"RESA Notificada",description:"El caso NE ".concat(l.ne," ha sido actualizado con la informaci\xf3n de la RESA.")}),s()}catch(e){console.error("Error updating RESA notification:",e),n({title:"Error",description:"No se pudo procesar la notificaci\xf3n.",variant:"destructive"})}finally{u(!1)}};return a?(0,t.jsx)(_.lG,{open:a,onOpenChange:s,children:(0,t.jsxs)(_.Cf,{className:"sm:max-w-md",children:[(0,t.jsxs)(_.c7,{children:[(0,t.jsx)(_.L3,{children:"Notificar RESA"}),(0,t.jsxs)(_.rr,{children:["Ingrese los detalles de la RESA para el caso NE: ",(0,t.jsx)("span",{className:"font-bold text-foreground",children:l.ne}),"."]})]}),(0,t.jsx)(F.lV,{...p,children:(0,t.jsxs)("form",{onSubmit:p.handleSubmit(f),className:"space-y-4 py-4",children:[(0,t.jsx)(F.zB,{control:p.control,name:"resaNumber",render:e=>{let{field:a}=e;return(0,t.jsxs)(F.eI,{children:[(0,t.jsx)(F.lR,{children:"N\xfamero de RESA"}),(0,t.jsx)(F.MJ,{children:(0,t.jsx)(I.p,{...a,placeholder:"Ingrese el n\xfamero..."})}),(0,t.jsx)(F.C5,{})]})}}),(0,t.jsx)(F.zB,{control:p.control,name:"resaNotificationDate",render:e=>{let{field:a}=e;return(0,t.jsxs)(F.eI,{className:"flex flex-col",children:[(0,t.jsx)(F.lR,{children:"Fecha de Notificaci\xf3n"}),(0,t.jsx)(F.MJ,{children:(0,t.jsx)(H.l,{date:a.value,onDateChange:a.onChange})}),(0,t.jsx)(F.C5,{})]})}}),(0,t.jsxs)("div",{children:[(0,t.jsx)(W.J,{children:"Fecha de Vencimiento (calculada)"}),(0,t.jsx)(I.p,{readOnly:!0,value:x?x.toLocaleDateString("es-NI",{weekday:"long",year:"numeric",month:"long",day:"numeric"}):"Seleccione fecha de notificaci\xf3n",className:"bg-muted/50 cursor-not-allowed"})]}),(0,t.jsxs)(_.Es,{className:"pt-4",children:[(0,t.jsx)(d.$,{type:"button",variant:"outline",onClick:s,children:"Cancelar"}),(0,t.jsxs)(d.$,{type:"submit",disabled:c,children:[c&&(0,t.jsx)(m.A,{className:"mr-2 h-4 w-4 animate-spin"}),"Guardar Notificaci\xf3n"]})]})]})})]})}):null}var e$=s(44385),eG=s(13496),eH=s(68425),eJ=s(77187),eU=s(90576),eZ=s(15039),eW=s(59915),eQ=s(27500),eX=s(18527),eY=s(62593),eK=s(50276);function e0(e){let{className:a,date:s,onDateChange:l,disabled:i=!1}=e,[n,o]=r.useState(!1),[c,u]=r.useState(s);r.useEffect(()=>{u(s)},[s]);let m=c?(0,R.GP)(c,"HH:mm"):"00:00";return(0,t.jsx)("div",{className:(0,eD.cn)("grid gap-2",a),children:(0,t.jsxs)(es.AM,{open:n,onOpenChange:o,children:[(0,t.jsx)(es.Wv,{asChild:!0,children:(0,t.jsxs)(d.$,{variant:"outline",disabled:i,className:(0,eD.cn)("w-[180px] justify-start text-left font-normal",!s&&"text-muted-foreground"),children:[(0,t.jsx)(y.A,{className:"mr-2 h-4 w-4"}),s?(0,R.GP)(s,"dd/MM/yy HH:mm",{locale:ee.es}):(0,t.jsx)("span",{children:"Seleccione fecha y hora"})]})}),(0,t.jsxs)(es.hl,{className:"w-auto p-0",children:[(0,t.jsx)(eK.V,{mode:"single",selected:null!=c?c:void 0,onSelect:e=>{if(!e)return void u(null);let[a,s]=m.split(":").map(Number),t=new Date(e);isNaN(a)||isNaN(s)||t.setHours(a,s),u(t)},initialFocus:!0,locale:ee.es,disabled:i}),(0,t.jsxs)("div",{className:"p-3 border-t border-border",children:[(0,t.jsxs)("div",{className:"flex items-center gap-2",children:[(0,t.jsx)(eY.A,{className:"h-4 w-4 text-muted-foreground"}),(0,t.jsx)(I.p,{type:"time",value:m,onChange:e=>{let a=e.target.value,s=c?new Date(c):new Date,[t,r]=a.split(":").map(Number);isNaN(t)||isNaN(r)||(s.setHours(t,r),u(s))},className:"w-full",disabled:i})]}),(0,t.jsxs)("div",{className:"flex justify-between mt-3",children:[(0,t.jsx)(d.$,{variant:"ghost",size:"sm",onClick:()=>{u(new Date)},disabled:i,children:"Ahora"}),(0,t.jsx)(d.$,{size:"sm",onClick:()=>{l(c),o(!1)},disabled:i,children:"Aplicar"})]})]})]})]})})}var e1=s(46767),e2=s(11064),e4=s(19201),e5=s(80358),e3=s(5225);let e6=e=>{let{Icon:a,tooltipText:s,isComplete:r,pulse:l}=e;if(null===r)return null;let i=(0,eD.cn)("h-6 w-6 rounded-full flex items-center justify-center border",r?"bg-blue-500 text-white border-blue-600":"bg-gray-300 text-gray-600 border-gray-400",l&&"animate-pulse");return(0,t.jsxs)(e1.m_,{children:[(0,t.jsx)(e1.k$,{asChild:!0,children:(0,t.jsx)("div",{className:i,children:(0,t.jsx)(a,{className:"h-4 w-4"})})}),(0,t.jsx)(e1.ZI,{children:(0,t.jsx)("p",{children:s})})]})},e8=e=>{let{entregadoAforoAt:a,acuseLog:s}=e,r=null==s?void 0:s.updatedBy;return a?(0,t.jsxs)(e1.m_,{children:[(0,t.jsx)(e1.k$,{asChild:!0,children:(0,t.jsx)("div",{children:(0,t.jsx)(e4.A,{className:"h-5 w-5 text-blue-500"})})}),(0,t.jsx)(e1.ZI,{children:r?(0,t.jsxs)("p",{children:["Recibido por ",r]}):(0,t.jsx)("p",{children:"Acuse de recibido confirmado"})})]}):(0,t.jsxs)(e1.m_,{children:[(0,t.jsx)(e1.k$,{asChild:!0,children:(0,t.jsx)("div",{children:(0,t.jsx)(e2.A,{className:"h-5 w-5 text-gray-400"})})}),(0,t.jsx)(e1.ZI,{children:(0,t.jsx)("p",{children:"Acuse de recibido pendiente"})})]})},e9=e=>{let a,s,r,l,i,{worksheetType:n}=e;switch(n){case"anexo_5":a=null,s="5",r="Anexo 5",l="bg-cyan-500",i="text-white";break;case"anexo_7":a=null,s="7",r="Anexo 7",l="bg-purple-500",i="text-white";break;case"corporate_report":a=f.A,s=null,r="Reporte Corporativo",l="bg-gray-700",i="text-white";break;default:a=eJ.A,s=null,r="Hoja de Trabajo",l="bg-gray-300",i="text-gray-700"}let o=(0,eD.cn)("h-6 w-6 rounded-full flex items-center justify-center border",l,i);return(0,t.jsxs)(e1.m_,{children:[(0,t.jsx)(e1.k$,{asChild:!0,children:(0,t.jsx)("div",{className:o,children:a?(0,t.jsx)(a,{className:"h-4 w-4"}):(0,t.jsx)("span",{className:"text-xs font-bold",children:s})})}),(0,t.jsx)(e1.ZI,{children:(0,t.jsx)("p",{children:r})})]})};function e7(e){var a,s,r;let{caseData:l}=e,i=(null==(a=l.worksheet)?void 0:a.requiredPermits)&&l.worksheet.requiredPermits.length>0,n=!!i&&l.worksheet.requiredPermits.every(e=>"Entregado"===e.status),o=l.pagos&&l.pagos.length>0,c=!!o&&l.pagos.every(e=>"Pagado"===e.paymentStatus),d="Rectificacion"===l.incidentType,u=!!d&&"Aprobada"===l.incidentStatus,m=l.hasValueDoubt,x=!!m&&!!l.valueDoubtStatus,p=!!l.examenPrevio,j=!!p&&(null==(s=l.examenPrevio)?void 0:s.status)==="complete";return(0,t.jsx)(e1.Bc,{children:(0,t.jsxs)("div",{className:"flex items-center gap-1.5",children:[(0,t.jsx)(e8,{entregadoAforoAt:l.entregadoAforoAt,acuseLog:l.acuseLog}),(0,t.jsx)(e9,{worksheetType:null==(r=l.worksheet)?void 0:r.worksheetType}),(0,t.jsx)(e6,{Icon:e5.A,tooltipText:"Permisos",isComplete:i?n:null}),(0,t.jsx)(e6,{Icon:h.A,tooltipText:"Pagos",isComplete:o?c:null}),(0,t.jsx)(e6,{Icon:ec.A,tooltipText:"Incidencia",isComplete:d?u:null}),(0,t.jsx)(e6,{Icon:eZ.A,tooltipText:"Duda de Valor",isComplete:m?x:null}),(0,t.jsx)(e6,{Icon:e3.A,tooltipText:"Previo",isComplete:p?j:null})]})})}let ae=e=>{let{label:a,children:s}=e;return(0,t.jsxs)("div",{className:"flex justify-between items-center py-2 border-b border-border/50",children:[(0,t.jsx)("p",{className:"text-sm font-medium text-muted-foreground",children:a}),(0,t.jsx)("div",{className:"text-sm text-right text-foreground",children:s})]})},aa=e=>{var a;let{caseData:s,savingState:r,caseActions:l,onAutoSave:i,approvePreliquidation:n}=e,o=(s.facturaNumber?s.facturaNumber.split(";").map(e=>e.trim()):[])[0]||"N/A";return(0,t.jsxs)(u.Zp,{className:"w-full",children:[(0,t.jsx)(u.aR,{children:(0,t.jsxs)("div",{className:"flex justify-between items-start",children:[(0,t.jsxs)("div",{children:[(0,t.jsx)(u.ZB,{className:"font-bold text-lg text-primary",children:s.ne}),(0,t.jsx)("p",{className:"text-sm text-muted-foreground truncate max-w-[200px]",children:s.consignee})]}),(0,t.jsxs)(et.rI,{children:[(0,t.jsx)(et.ty,{asChild:!0,children:(0,t.jsxs)(d.$,{variant:"ghost",className:"h-8 w-8 p-0",children:[(0,t.jsx)("span",{className:"sr-only",children:"Abrir"}),(0,t.jsx)(eH.A,{className:"h-5 w-5"})]})}),(0,t.jsxs)(et.SQ,{align:"end",children:[(0,t.jsxs)(et._2,{onSelect:()=>l.handleViewWorksheet(s),disabled:!s.worksheetId,children:[(0,t.jsx)(eJ.A,{className:"mr-2 h-4 w-4"})," Ver Hoja de Trabajo"]}),(0,t.jsxs)(et._2,{onSelect:()=>l.handleSearchPrevio(s.ne),children:[(0,t.jsx)(b.A,{className:"mr-2 h-4 w-4"})," Buscar Previo"]}),(0,t.jsxs)(et._2,{onSelect:()=>l.setSelectedCaseForDocs(s),disabled:!s,children:[(0,t.jsx)(j.A,{className:"mr-2 h-4 w-4"})," Docs y Permisos"]}),(0,t.jsxs)(et._2,{onSelect:()=>l.setSelectedCaseForQuickRequest(s),disabled:!s.worksheet,children:[(0,t.jsx)(j.A,{className:"mr-2 h-4 w-4"})," Solicitar Previo"]}),(0,t.jsxs)(et._2,{onSelect:()=>l.setSelectedCaseForPayment(s),disabled:!s,children:[(0,t.jsx)(h.A,{className:"mr-2 h-4 w-4"})," Solicitud de Pago"]}),(0,t.jsxs)(et._2,{onSelect:()=>l.setSelectedCaseForPaymentList(s),disabled:!s,children:[(0,t.jsx)(h.A,{className:"mr-2 h-4 w-4 text-blue-500"})," Ver Pagos"]}),(0,t.jsxs)(et._2,{onSelect:()=>l.setSelectedCaseForResa(s),disabled:!s,children:[(0,t.jsx)(eU.A,{className:"mr-2 h-4 w-4 text-orange-500"})," Notificar RESA"]}),(0,t.jsx)(et.mB,{}),(0,t.jsxs)(et._2,{onSelect:()=>l.setSelectedCaseForIncident(s),disabled:!s,children:[(0,t.jsx)(ec.A,{className:"mr-2 h-4 w-4 text-amber-600"})," Reportar Incidencia"]}),(0,t.jsxs)(et._2,{onSelect:()=>l.setSelectedCaseForValueDoubt(s),disabled:!s,children:[(0,t.jsx)(eZ.A,{className:"mr-2 h-4 w-4 text-rose-600"})," Reportar Duda de Valor"]}),(0,t.jsx)(et.mB,{}),(0,t.jsxs)(et._2,{onSelect:()=>l.setSelectedCaseForHistory(s),disabled:!s,children:[(0,t.jsx)(eW.A,{className:"mr-2 h-4 w-4"})," Ver Bit\xe1cora"]}),s.incidentReported&&(0,t.jsxs)(et._2,{onSelect:()=>l.setSelectedIncidentForDetails(s),children:[(0,t.jsx)(eN.A,{className:"mr-2 h-4 w-4"})," Ver Incidencia"]}),(0,t.jsxs)(et._2,{onSelect:()=>l.setSelectedCaseForComment(s),children:[(0,t.jsx)(eQ.A,{className:"mr-2 h-4 w-4"})," A\xf1adir/Ver Comentarios"]})]})]})]})}),(0,t.jsxs)(u.Wu,{children:[(0,t.jsx)("div",{className:"flex justify-center items-center mb-4",children:(0,t.jsx)(e7,{caseData:s})}),(0,t.jsx)(eG.nD,{type:"single",collapsible:!0,className:"w-full",children:(0,t.jsxs)(eG.As,{value:"item-1",children:[(0,t.jsx)(eG.$m,{children:"Ver Detalles Completos"}),(0,t.jsx)(eG.ub,{children:(0,t.jsxs)("div",{className:"space-y-2 pt-2",children:[(0,t.jsx)(ae,{label:"Ejecutivo",children:s.executive}),(0,t.jsx)(ae,{label:"Factura",children:o}),(0,t.jsx)(ae,{label:"Estado Aforador",children:(0,t.jsx)(ew.E,{variant:(e=>{switch(e){case"En revisi\xf3n":return"default";case"Incompleto":case"Pendiente":return"destructive";case"En proceso":return"secondary";default:return"outline"}})(s.aforadorStatus),children:s.aforadorStatus||"Pendiente"})}),(0,t.jsx)(ae,{label:"Estado Revisor",children:(0,t.jsx)(ew.E,{variant:(e=>{switch(e){case"Aprobado":return"default";case"Rechazado":return"destructive";case"Revalidaci\xf3n Solicitada":return"secondary";default:return"outline"}})(s.revisorStatus),children:s.revisorStatus||"Pendiente"})}),(0,t.jsx)(ae,{label:"Preliquidaci\xf3n",children:"Aprobado"===s.revisorStatus&&"Aprobada"!==s.preliquidationStatus?(0,t.jsxs)(d.$,{size:"sm",onClick:()=>n(s.id),disabled:r[s.id],children:[(0,t.jsx)(eX.A,{className:"mr-2 h-4 w-4"})," Aprobar"]}):"Aprobada"===s.preliquidationStatus?(0,t.jsx)(ew.E,{variant:"default",className:"bg-green-600",children:"Aprobada"}):(0,t.jsx)(ew.E,{variant:"outline",children:"Pendiente"})}),(0,t.jsx)(ae,{label:"Estado Digitaci\xf3n",children:((e,a)=>"Tr\xe1mite Completo"===e?(0,t.jsx)(ew.E,{variant:"default",className:"bg-green-600",children:a||"Finalizado"}):e?(0,t.jsx)(ew.E,{variant:"En Proceso"===e?"secondary":"outline",children:e}):(0,t.jsx)(ew.E,{variant:"outline",children:"Pendiente"}))(s.digitacionStatus,s.declaracionAduanera)}),(0,t.jsx)(ae,{label:"Tipo Incidencia",children:(e=>{let a=[];return"Rectificacion"===e.incidentType&&a.push("Rectificaci\xf3n"),e.hasValueDoubt&&a.push("Duda de Valor"),a.length>0?a.join(" / "):"N/A"})(s)}),(0,t.jsx)(ae,{label:"Facturado",children:s.facturado?(0,t.jsx)(ew.E,{variant:"default",className:"bg-green-600",children:"Facturado"}):"No"}),(0,t.jsxs)("div",{className:"py-2",children:[(0,t.jsx)("p",{className:"text-sm font-medium text-muted-foreground mb-1",children:"Selectividad"}),(0,t.jsxs)(Z.l6,{value:s.selectividad||"",onValueChange:e=>i(s.id,"selectividad",e),disabled:r[s.id]||!s.declaracionAduanera,children:[(0,t.jsx)(Z.bq,{children:(0,t.jsx)(Z.yv,{placeholder:"Seleccionar..."})}),(0,t.jsxs)(Z.gC,{children:[(0,t.jsx)(Z.eb,{value:"VERDE",children:"VERDE"}),(0,t.jsx)(Z.eb,{value:"AMARILLO",children:"AMARILLO"}),(0,t.jsx)(Z.eb,{value:"ROJO",children:"ROJO"})]})]})]}),(0,t.jsxs)("div",{className:"py-2",children:[(0,t.jsx)("p",{className:"text-sm font-medium text-muted-foreground mb-1",children:"Fecha Despacho"}),(0,t.jsx)(e0,{date:null==(a=s.fechaDespacho)?void 0:a.toDate(),onDateChange:e=>i(s.id,"fechaDespacho",e?D.Dc.fromDate(e):null),disabled:r[s.id]||"VERDE"!==s.selectividad&&"ROJO"!==s.selectividad})]})]})})]})})]})]},s.id)};function as(e){let{cases:a,savingState:s,onAutoSave:r,approvePreliquidation:l,caseActions:i}=e;return(0,t.jsx)("div",{className:"space-y-4",children:a.map(e=>(0,t.jsx)(aa,{caseData:e,savingState:s,caseActions:i,onAutoSave:r,approvePreliquidation:l},e.id))})}var at=s(98053);function ar(e){let{isOpen:a,onClose:s,onSelectRectificacion:r,onSelectDudaValor:l}=e;return a?(0,t.jsx)(_.lG,{open:a,onOpenChange:s,children:(0,t.jsxs)(_.Cf,{className:"sm:max-w-md",children:[(0,t.jsxs)(_.c7,{children:[(0,t.jsx)(_.L3,{children:"Seleccionar Incidencia"}),(0,t.jsx)(_.rr,{children:"Este caso tiene m\xfaltiples incidencias reportadas. Por favor, seleccione cu\xe1l desea visualizar o editar."})]}),(0,t.jsxs)("div",{className:"flex flex-col gap-4 py-4",children:[(0,t.jsxs)(d.$,{onClick:r,variant:"secondary",size:"lg",className:"justify-start gap-3",children:[(0,t.jsx)(ec.A,{className:"h-5 w-5 text-amber-600"}),(0,t.jsx)("span",{children:"Ver/Editar Reporte de Rectificaci\xf3n"})]}),(0,t.jsxs)(d.$,{onClick:l,variant:"secondary",size:"lg",className:"justify-start gap-3",children:[(0,t.jsx)(eZ.A,{className:"h-5 w-5 text-rose-600"}),(0,t.jsx)("span",{children:"Ver/Editar Reporte de Duda de Valor"})]})]}),(0,t.jsx)(_.Es,{children:(0,t.jsx)(d.$,{type:"button",variant:"outline",onClick:s,children:"Cancelar"})})]})}):null}var al=s(13406),ai=s(29653),an=s(28068),ao=s(43371);let ac=e=>{if(!e)return"N/A";let a=(null==e?void 0:e.toDate)?e.toDate():(0,ao.a)(e);return(0,R.GP)(a,"dd/MM/yy HH:mm",{locale:ee.es})},ad=e=>{let{title:a,status:s,lastUpdate:r,icon:l}=e;return(0,t.jsxs)("div",{className:"flex items-start gap-4",children:[(0,t.jsxs)("div",{className:"flex flex-col items-center",children:[(0,t.jsx)("div",{className:"rounded-full bg-primary/10 text-primary p-2",children:l}),(0,t.jsx)("div",{className:"w-px h-12 bg-border mt-2"})]}),(0,t.jsxs)("div",{className:"flex-1 pb-12",children:[(0,t.jsx)("p",{className:"font-semibold text-foreground",children:a}),(0,t.jsxs)("div",{className:"flex items-center gap-2 mt-1",children:[(0,t.jsx)(ew.E,{variant:(e=>{let a=e.toLowerCase();return a.includes("aprobado")||a.includes("completo")||a.includes("tr\xe1mite completo")||a.includes("en revisi\xf3n")?"default":a.includes("rechazado")||a.includes("incompleto")?"destructive":a.includes("proceso")?"secondary":"outline"})(s),children:s}),r&&r.by&&(0,t.jsx)(e1.Bc,{children:(0,t.jsxs)(e1.m_,{children:[(0,t.jsx)(e1.k$,{asChild:!0,children:(0,t.jsxs)("p",{className:"text-xs text-muted-foreground cursor-help",children:["por ",r.by]})}),(0,t.jsx)(e1.ZI,{children:(0,t.jsxs)("p",{children:["Fecha: ",ac(r.at)]})})]})})]})]})]})};function au(e){let{isOpen:a,onClose:s,caseData:l}=e,[i,n]=(0,r.useState)(null),[o,c]=(0,r.useState)(!0);if((0,r.useEffect)(()=>{if(!a||!l.id)return;c(!0);let e=(0,D.H9)(S.db,"worksheets",l.id,"aforo","metadata"),s=(0,D.aQ)(e,e=>{e.exists()?n(e.data()):n(l),c(!1)},e=>{console.error("Error fetching aforo metadata:",e),n(l),c(!1)});return()=>s()},[a,l]),!a)return null;let u=(e,a,s)=>{let t=e||a,r=s[t]||eY.A;return{status:t,Icon:r}},x=u(null==i?void 0:i.aforadorStatus,"Pendiente ",{"En revisi\xf3n":ai.A,"Pendiente ":eY.A,Incompleto:an.A,"En proceso":ai.A}),h=u(null==i?void 0:i.revisorStatus,"Pendiente",{Aprobado:eX.A,Rechazado:an.A,Pendiente:eY.A,"Revalidaci\xf3n Solicitada":eY.A}),p=u(null==i?void 0:i.preliquidationStatus,"Pendiente",{Aprobada:eX.A,Pendiente:eY.A}),j=u(null==i?void 0:i.digitacionStatus,"Pendiente de Digitaci\xf3n",{"Tr\xe1mite Completo":eX.A,"Pendiente de Digitaci\xf3n":eY.A,"En Proceso":ai.A,Almacenado:eX.A});return(0,t.jsx)(_.lG,{open:a,onOpenChange:s,children:(0,t.jsxs)(_.Cf,{className:"max-w-md",children:[(0,t.jsxs)(_.c7,{children:[(0,t.jsx)(_.L3,{children:"L\xednea de Proceso del Caso"}),(0,t.jsxs)(_.rr,{children:["Seguimiento del estado para el NE: ",(0,t.jsx)("span",{className:"font-bold text-foreground",children:l.ne})]})]}),(0,t.jsx)("div",{className:"py-4 -mb-12",children:o?(0,t.jsx)("div",{className:"flex justify-center items-center h-48",children:(0,t.jsx)(m.A,{className:"h-8 w-8 animate-spin text-primary"})}):(0,t.jsxs)(t.Fragment,{children:[(0,t.jsx)(ad,{title:"1. Proceso de Aforo",status:x.status,lastUpdate:null==i?void 0:i.aforadorStatusLastUpdate,icon:(0,t.jsx)(x.Icon,{className:"h-5 w-5"})}),(0,t.jsx)(ad,{title:"2. Revisi\xf3n de Agente",status:h.status,lastUpdate:null==i?void 0:i.revisorStatusLastUpdate,icon:(0,t.jsx)(h.Icon,{className:"h-5 w-5"})}),(0,t.jsx)(ad,{title:"3. Preliquidaci\xf3n",status:p.status,lastUpdate:null==i?void 0:i.preliquidationStatusLastUpdate,icon:(0,t.jsx)(p.Icon,{className:"h-5 w-5"})}),(0,t.jsxs)("div",{className:"flex items-start gap-4",children:[(0,t.jsx)("div",{className:"flex flex-col items-center",children:(0,t.jsx)("div",{className:"rounded-full bg-primary/10 text-primary p-2",children:(0,t.jsx)(j.Icon,{className:"h-5 w-5"})})}),(0,t.jsxs)("div",{className:"flex-1",children:[(0,t.jsx)("p",{className:"font-semibold text-foreground",children:"4. Digitaci\xf3n"}),(0,t.jsxs)("div",{className:"flex items-center gap-2 mt-1",children:[(0,t.jsx)(ew.E,{variant:function(e){let a=e.toLowerCase();return a.includes("aprobado")||a.includes("completo")||a.includes("tr\xe1mite completo")||a.includes("almacenado")||a.includes("en revisi\xf3n")?"default":a.includes("rechazado")||a.includes("incompleto")?"destructive":a.includes("proceso")?"secondary":"outline"}(j.status),children:j.status}),(null==i?void 0:i.digitacionStatusLastUpdate)&&i.digitacionStatusLastUpdate.by&&(0,t.jsx)(e1.Bc,{children:(0,t.jsxs)(e1.m_,{children:[(0,t.jsx)(e1.k$,{asChild:!0,children:(0,t.jsxs)("p",{className:"text-xs text-muted-foreground cursor-help",children:["por ",i.digitacionStatusLastUpdate.by]})}),(0,t.jsx)(e1.ZI,{children:(0,t.jsxs)("p",{children:["Fecha: ",ac(i.digitacionStatusLastUpdate.at)]})})]})})]})]})]})]})}),(0,t.jsx)(_.Es,{children:(0,t.jsx)(d.$,{variant:"outline",onClick:s,children:"Cerrar"})})]})})}var am=s(87270),ax=s(48109),ah=s(63037),ap=s(81288),aj=s(66065),af=s(94979);function av(e){let{cases:a,savingState:s,onAutoSave:r,approvePreliquidation:l,caseActions:i,selectedRows:c,onSelectRow:u,onSelectAllRows:m,neFilter:x,setNeFilter:p,ejecutivoFilter:f,setEjecutivoFilter:v,consignatarioFilter:N,setConsignatarioFilter:g,facturaFilter:w,setFacturaFilter:A,selectividadFilter:y,setSelectividadFilter:C,incidentTypeFilter:S,setIncidentTypeFilter:E,handleSendToFacturacion:k}=e,{user:R}=(0,o.A)();return(0,t.jsx)("div",{className:"overflow-x-auto table-container rounded-lg border",children:(0,t.jsx)(e1.Bc,{children:(0,t.jsxs)(am.XI,{children:[(0,t.jsx)(am.A0,{children:(0,t.jsxs)(am.Hj,{children:[(0,t.jsx)(am.nd,{className:"w-12",children:(0,t.jsx)(U.S,{checked:c.length>0&&c.length===a.filter(e=>"Aprobado"===e.revisorStatus&&"Aprobada"!==e.preliquidationStatus).length,onCheckedChange:m,"aria-label":"Seleccionar todo para preliquidaci\xf3n"})}),(0,t.jsx)(am.nd,{children:"Acciones"}),(0,t.jsx)(am.nd,{children:(0,t.jsx)(I.p,{placeholder:"NE...",className:"h-8 text-xs",value:x,onChange:e=>p(e.target.value)})}),(0,t.jsx)(am.nd,{children:"Insignias"}),(0,t.jsx)(am.nd,{children:(0,t.jsx)(I.p,{placeholder:"Ejecutivo...",className:"h-8 text-xs",value:f,onChange:e=>v(e.target.value)})}),(0,t.jsx)(am.nd,{children:(0,t.jsx)(I.p,{placeholder:"Consignatario...",className:"h-8 text-xs",value:N,onChange:e=>g(e.target.value)})}),(0,t.jsx)(am.nd,{children:(0,t.jsx)(I.p,{placeholder:"Factura...",className:"h-8 text-xs",value:w,onChange:e=>A(e.target.value)})}),(0,t.jsx)(am.nd,{children:"Preliquidaci\xf3n"}),(0,t.jsx)(am.nd,{children:"Estado General"}),(0,t.jsx)(am.nd,{children:(0,t.jsx)(I.p,{placeholder:"Selectividad...",className:"h-8 text-xs",value:y,onChange:e=>C(e.target.value)})}),(0,t.jsx)(am.nd,{children:"Fecha Despacho"}),(0,t.jsx)(am.nd,{children:(0,t.jsx)(I.p,{placeholder:"Incidencia...",className:"h-8 text-xs",value:S,onChange:e=>E(e.target.value)})}),(0,t.jsx)(am.nd,{children:"Facturado"})]})}),(0,t.jsx)(am.BF,{children:a.map(e=>{var a,o,m,x,p,f;let v=(null==(a=e.worksheet)?void 0:a.worksheetType)==="corporate_report"?(null==(o=e.worksheet.documents)?void 0:o.filter(e=>"FACTURA"===e.type).map(e=>e.number))||[]:e.facturaNumber?e.facturaNumber.split(";").map(e=>e.trim()):[],N=v[0]||"",g=v.length>1?v.length-1:0,w="PSMT NICARAGUA, SOCIEDAD ANONIMA"===e.consignee.toUpperCase().trim(),A=e.resaDueDate?(0,ax.c)(e.resaDueDate.toDate(),new Date):null;return(0,t.jsxs)(am.Hj,{className:s[e.id]?"bg-amber-100":null!==A&&A<-15?"bg-red-200 hover:bg-red-200/80":"","data-state":c.includes(e.id)?"selected":void 0,children:[(0,t.jsx)(am.nA,{children:(0,t.jsx)(U.S,{checked:c.includes(e.id),onCheckedChange:()=>u(a=>a.includes(e.id)?a.filter(a=>a!==e.id):[...a,e.id]),"aria-label":"Seleccionar caso ".concat(e.ne)})}),(0,t.jsx)(am.nA,{children:(0,t.jsxs)("div",{className:"flex items-center gap-0.5",children:[(0,t.jsxs)(et.rI,{children:[(0,t.jsx)(et.ty,{asChild:!0,children:(0,t.jsx)(d.$,{variant:"ghost",size:"sm",children:"Ver"})}),(0,t.jsxs)(et.SQ,{children:[(0,t.jsxs)(et._2,{onSelect:()=>i.handleViewWorksheet(e),disabled:!e.worksheetId,children:[(0,t.jsx)(eJ.A,{className:"mr-2 h-4 w-4"})," Ver Hoja de Trabajo"]}),(0,t.jsxs)(et._2,{onSelect:()=>i.handleSearchPrevio(e.ne),children:[(0,t.jsx)(b.A,{className:"mr-2 h-4 w-4"})," Buscar Previo"]}),(0,t.jsx)(et._2,{asChild:!0,children:(0,t.jsxs)(n(),{href:"/managerpermisos?id=".concat(e.id),children:[(0,t.jsx)(j.A,{className:"mr-2 h-4 w-4"})," Docs y Permisos"]})}),(0,t.jsxs)(et._2,{onSelect:()=>i.setSelectedCaseForQuickRequest(e),disabled:!e.worksheet,children:[(0,t.jsx)(j.A,{className:"mr-2 h-4 w-4"})," Solicitar Previo"]}),(0,t.jsxs)(et._2,{onSelect:()=>i.setSelectedCaseForPayment(e),disabled:!e,children:[(0,t.jsx)(h.A,{className:"mr-2 h-4 w-4"})," Solicitud de Pago"]}),(0,t.jsxs)(et._2,{onSelect:()=>i.setSelectedCaseForPaymentList(e),disabled:!e,children:[(0,t.jsx)(h.A,{className:"mr-2 h-4 w-4 text-blue-500"})," Ver Pagos"]}),(0,t.jsxs)(et._2,{onSelect:()=>i.setSelectedCaseForResa(e),disabled:!e,children:[(0,t.jsx)(eU.A,{className:"mr-2 h-4 w-4 text-orange-500"})," Notificar RESA"]}),(0,t.jsx)(et.mB,{}),(0,t.jsxs)(et._2,{onSelect:()=>i.setSelectedCaseForIncident(e),disabled:!e,children:[(0,t.jsx)(ec.A,{className:"mr-2 h-4 w-4 text-amber-600"})," Reportar Incidencia"]}),(0,t.jsxs)(et._2,{onSelect:()=>i.setSelectedCaseForValueDoubt(e),disabled:!e,children:[(0,t.jsx)(eZ.A,{className:"mr-2 h-4 w-4 text-rose-600"})," Reportar Duda de Valor"]}),(0,t.jsx)(et.mB,{}),(0,t.jsxs)(et._2,{onSelect:()=>i.setSelectedCaseForHistory(e),disabled:!e,children:[(0,t.jsx)(eW.A,{className:"mr-2 h-4 w-4"})," Ver Bit\xe1cora"]}),e.incidentReported&&(0,t.jsxs)(et._2,{onSelect:()=>i.handleViewIncidents(e),children:[(0,t.jsx)(eN.A,{className:"mr-2 h-4 w-4"})," Ver Incidencia"]}),(null==R?void 0:R.role)==="admin"&&(0,t.jsxs)(et._2,{onClick:()=>i.setCaseToArchive(e),className:"text-destructive",children:[(0,t.jsx)(ah.A,{className:"mr-2 h-4 w-4"})," Archivar"]}),((null==R?void 0:R.role)==="admin"||(null==R?void 0:R.role)==="coordinadora")&&(null==(m=e.worksheet)?void 0:m.worksheetType)==="hoja_de_trabajo"&&(0,t.jsxs)(et._2,{onClick:()=>{i.setCaseToDuplicate(e),i.setDuplicateAndRetireModalOpen(!0)},className:"text-destructive",children:[(0,t.jsx)(ap.A,{className:"mr-2 h-4 w-4"})," Duplicar y Retirar"]})]})]}),(0,t.jsxs)(e1.m_,{children:[(0,t.jsx)(e1.k$,{asChild:!0,children:(0,t.jsx)(d.$,{variant:"ghost",size:"icon",className:"h-8 w-8",onClick:()=>i.setSelectedCaseForComment(e),children:(0,t.jsx)(eQ.A,{className:"h-4 w-4"})})}),(0,t.jsx)(e1.ZI,{children:(0,t.jsx)("p",{children:"A\xf1adir/Ver Comentarios"})})]})]})}),(0,t.jsx)(am.nA,{className:"font-medium",children:e.ne}),(0,t.jsx)(am.nA,{children:(0,t.jsx)(e7,{caseData:e})}),(0,t.jsx)(am.nA,{children:e.executive}),(0,t.jsx)(am.nA,{children:e.consignee.length>13?(0,t.jsxs)(e1.m_,{children:[(0,t.jsx)(e1.k$,{asChild:!0,children:(0,t.jsxs)("span",{className:"flex items-center gap-1 cursor-help",children:["".concat(e.consignee.substring(0,13),"..."),(0,t.jsx)(aj.A,{className:"h-4 w-4 text-muted-foreground"})]})}),(0,t.jsx)(e1.ZI,{children:(0,t.jsx)("p",{children:e.consignee})})]}):e.consignee}),(0,t.jsx)(am.nA,{children:(0,t.jsxs)("div",{className:"flex items-center gap-2",children:[(0,t.jsx)("span",{children:N}),g>0&&(0,t.jsxs)(e1.m_,{children:[(0,t.jsx)(e1.k$,{asChild:!0,children:(0,t.jsxs)(ew.E,{variant:"secondary",className:"cursor-pointer",children:["+",g]})}),(0,t.jsx)(e1.ZI,{children:(0,t.jsx)("ul",{className:"list-disc list-inside",children:v.slice(1).map((e,a)=>(0,t.jsx)("li",{children:e},a))})})]})]})}),(0,t.jsx)(am.nA,{children:(0,t.jsx)("div",{className:"flex items-center",children:"Aprobado"===e.revisorStatus&&"Aprobada"!==e.preliquidationStatus?(0,t.jsxs)(d.$,{size:"sm",onClick:()=>l(e.id),disabled:s[e.id],children:[(0,t.jsx)(eX.A,{className:"mr-2 h-4 w-4"})," Aprobar"]}):"Aprobada"===e.preliquidationStatus?(0,t.jsx)(ew.E,{variant:"default",className:"bg-green-600",children:"Aprobada"}):(0,t.jsx)(ew.E,{variant:"outline",children:"Pendiente"})})}),(0,t.jsx)(am.nA,{children:(0,t.jsxs)("div",{className:"flex items-center group relative",children:[(p=e.digitacionStatus,f=e.declaracionAduanera,"Tr\xe1mite Completo"===p?(0,t.jsx)(ew.E,{variant:"default",className:"bg-green-600",children:f||"Finalizado"}):p?(0,t.jsx)(ew.E,{variant:"En Proceso"===p?"secondary":"outline",children:p}):(0,t.jsx)(ew.E,{variant:"outline",children:"Pendiente"})),i.setSelectedCaseForProcess&&(0,t.jsx)(d.$,{variant:"ghost",size:"icon",className:"h-6 w-6 opacity-0 group-hover:opacity-100 transition-opacity",onClick:()=>i.setSelectedCaseForProcess(e),children:(0,t.jsx)(eN.A,{className:"h-4 w-4"})})]})}),(0,t.jsx)(am.nA,{children:(0,t.jsxs)("div",{className:"flex items-center gap-2",children:[(0,t.jsxs)(Z.l6,{value:e.selectividad||"",onValueChange:a=>r(e.id,"selectividad",a),disabled:s[e.id]||!e.declaracionAduanera,children:[(0,t.jsx)(Z.bq,{className:"w-[120px]",children:(0,t.jsx)(Z.yv,{placeholder:"Seleccionar..."})}),(0,t.jsxs)(Z.gC,{children:[(0,t.jsx)(Z.eb,{value:"VERDE",children:"VERDE"}),(0,t.jsx)(Z.eb,{value:"AMARILLO",children:"AMARILLO"}),(0,t.jsx)(Z.eb,{value:"ROJO",children:"ROJO"})]})]}),"AMARILLO"===e.selectividad&&(0,t.jsxs)(e1.m_,{children:[(0,t.jsx)(e1.k$,{children:(0,t.jsx)(ew.E,{variant:"secondary",className:"cursor-help",children:(0,t.jsx)(aj.A,{className:"h-4 w-4"})})}),(0,t.jsx)(e1.ZI,{children:(0,t.jsx)("p",{children:"CONSULTA DE VALORES"})})]})]})}),(0,t.jsx)(am.nA,{children:(0,t.jsx)(e1.Bc,{children:(0,t.jsxs)(e1.m_,{children:[(0,t.jsx)(e1.k$,{asChild:!0,children:(0,t.jsx)("div",{children:(0,t.jsx)(e0,{date:null==(x=e.fechaDespacho)?void 0:x.toDate(),onDateChange:a=>r(e.id,"fechaDespacho",a?D.Dc.fromDate(a):null),disabled:s[e.id]||"VERDE"!==e.selectividad&&"ROJO"!==e.selectividad})})}),"VERDE"!==e.selectividad&&"ROJO"!==e.selectividad&&(0,t.jsx)(e1.ZI,{children:(0,t.jsx)("p",{children:"Debe seleccionar un estado de selectividad (Verde o Rojo) antes de registrar el despacho."})})]})})}),(0,t.jsx)(am.nA,{children:(e=>{let a=[];return"Rectificacion"===e.incidentType&&a.push("Rectificaci\xf3n"),e.hasValueDoubt&&a.push("Duda de Valor"),a.length>0?a.join(" / "):"N/A"})(e)}),(0,t.jsx)(am.nA,{children:(0,t.jsx)("div",{className:"flex items-center justify-center",children:w?(0,t.jsxs)(d.$,{size:"sm",variant:"outline",onClick:()=>k(e.id),disabled:s[e.id]||!e.fechaDespacho||"Facturado"===e.facturacionStatus,children:[(0,t.jsx)(af.A,{className:"mr-2 h-4 w-4"}),"Enviado a Facturacion"===e.facturacionStatus?"Re-enviar":"Enviar"]}):(0,t.jsx)(T.d,{checked:!!e.facturado,onCheckedChange:a=>r(e.id,"facturado",a),disabled:s[e.id]})})})]},e.id)})})]})})})}let ab=[{value:0,label:"Enero"},{value:1,label:"Febrero"},{value:2,label:"Marzo"},{value:3,label:"Abril"},{value:4,label:"Mayo"},{value:5,label:"Junio"},{value:6,label:"Julio"},{value:7,label:"Agosto"},{value:8,label:"Septiembre"},{value:9,label:"Octubre"},{value:10,label:"Noviembre"},{value:11,label:"Diciembre"}],aN=new Date().getFullYear(),ag=Array.from({length:5},(e,a)=>aN-a);function aw(){let{user:e,loading:a}=(0,o.A)(),s=(0,l.useRouter)(),i=(0,l.useSearchParams)(),{toast:z}=(0,O.dj)(),L=(0,e$.a)(),{openAddProductModal:M,setInitialContextData:_,setIsMemorandumMode:F,caseToAssignAforador:V,setCaseToAssignAforador:T}=(0,eh.U)(),[B,q]=(0,r.useState)([]),[H,J]=(0,r.useState)(!0),[W,Q]=(0,r.useState)(!1),[K,ee]=(0,r.useState)([]),[ei,en]=(0,r.useState)(null),[ec,ed]=(0,r.useState)(null),[eu,em]=(0,r.useState)(null),[ep,ef]=(0,r.useState)(null),[ev,eb]=(0,r.useState)(null),[eN,eg]=(0,r.useState)(null),[ew,ey]=(0,r.useState)(null),[eC,eS]=(0,r.useState)(null),[eD,eE]=(0,r.useState)(null),[ek,eR]=(0,r.useState)(null),[eI,eP]=(0,r.useState)(!1),[ez,eL]=(0,r.useState)(null),[eM,eF]=(0,r.useState)(null),[eV,eT]=(0,r.useState)(null),[eB,eG]=(0,r.useState)(!1),[eH,eJ]=(0,r.useState)(""),[eU,eZ]=(0,r.useState)(!1),[eW,eQ]=(0,r.useState)(null),[eX,eY]=(0,r.useState)(""),[eK,e0]=(0,r.useState)(""),[e1,e2]=(0,r.useState)(""),[e4,e5]=(0,r.useState)({}),[e3,e6]=(0,r.useState)({facturado:!1,noFacturado:!0}),[e8,e9]=(0,r.useState)({conAcuse:!1,sinAcuse:!0}),[e7,ae]=(0,r.useState)("range"),[aa,ai]=(0,r.useState)(),[an,ao]=(0,r.useState)(new Date().getMonth()),[ac,ad]=(0,r.useState)(aN),am=i.get("tab")||"worksheets",[ax,ah]=(0,r.useState)(null),ap=e=>{s.push("/executive?tab=".concat(e),{scroll:!1}),aM(1),ah(null)},[aj,af]=(0,r.useState)({searchTerm:"",facturado:!1,noFacturado:!0,conAcuse:!1,sinAcuse:!0,dateFilterType:"range",dateRange:void 0,isSearchActive:!1}),[aw,aA]=(0,r.useState)(""),[ay,aC]=(0,r.useState)(""),[aS,aD]=(0,r.useState)(""),[aE,ak]=(0,r.useState)(""),[aR,aI]=(0,r.useState)(""),[aP,az]=(0,r.useState)(""),[aL,aM]=(0,r.useState)(1),[a_]=(0,r.useState)(15),[aF,aV]=(0,r.useState)([]);(0,r.useEffect)(()=>{a||e||s.push("/")},[e,a,s]);let aT=(0,r.useCallback)(async()=>{let a;if(!e)return()=>{};if(J(!0),e.role&&["admin","supervisor","coordinadora"].includes(e.role))a=(0,D.P)((0,D.rJ)(S.db,"AforoCases"));else if(e.role&&["ejecutivo"].includes(e.role)&&e.visibilityGroup&&e.visibilityGroup.length>0){var s;let t=Array.from(new Set([e.displayName,...(null==(s=e.visibilityGroup)?void 0:s.map(e=>e.displayName))||[]])).filter(Boolean);a=t.length>0?(0,D.P)((0,D.rJ)(S.db,"AforoCases"),(0,D._M)("executive","in",t)):(0,D.P)((0,D.rJ)(S.db,"AforoCases"),(0,D._M)("executive","==",e.displayName))}else{if(!e.displayName)return q([]),J(!1),()=>{};a=(0,D.P)((0,D.rJ)(S.db,"AforoCases"),(0,D._M)("executive","==",e.displayName))}let t=(0,D.aQ)(a,async e=>{let a=e.docs.map(e=>({id:e.id,...e.data()})),[s,t,r,l]=await Promise.all([(0,D.GG)((0,D.rJ)(S.db,"worksheets")),(0,D.GG)((0,D.rJ)(S.db,"examenesPrevios")),(0,D.GG)((0,D.P)((0,D.rJ)(S.db,"SolicitudCheques"),(0,D.My)("savedAt","desc"))),(0,D.GG)((0,D.P)((0,D.rJ)(S.db,"Memorandum"),(0,D.My)("savedAt","desc")))]),i=new Map(s.docs.map(e=>[e.id,{id:e.id,...e.data()}])),n=new Map(t.docs.map(e=>[e.id,e.data()])),o=new Map;[...r.docs,...l.docs].forEach(e=>{let a=e.data();if(a.examNe){let s=a.examNe;o.has(s)||o.set(s,[]),o.get(s).push({solicitudId:e.id,...a})}});let c=a.map(async e=>{if(!e.worksheetId)return{...e,worksheet:null,acuseLog:null};let a=(0,D.rJ)(S.db,"worksheets",e.worksheetId,"actualizaciones"),s=(0,D.P)(a,(0,D._M)("newValue","==","worksheet_received"),(0,D.My)("updatedAt","desc")),t=await (0,D.GG)(s),r=t.empty?null:t.docs[0].data();return{...e,worksheet:i.get(e.worksheetId||"")||null,examenPrevio:n.get(e.id)||null,pagos:o.get(e.ne)||[],acuseLog:r}});q(await Promise.all(c)),J(!1)},e=>{console.error("Error fetching aforo cases:",e),z({title:"Error de Carga",description:"No se pudieron cargar los datos de los casos.",variant:"destructive"}),J(!1)});return()=>t()},[e,z]);(0,r.useEffect)(()=>{let e;return aT().then(a=>{a&&(e=a)}),(async()=>{let e=(0,D.P)((0,D.rJ)(S.db,"users"),(0,D._M)("role","in",["aforador","coordinadora"]));ee((await (0,D.GG)(e)).docs.map(e=>({uid:e.id,...e.data()})))})(),()=>{e&&e()}},[aT]);let aO=async(a,s)=>{if(!e||!e.displayName)return void z({title:"Error",description:"Debe estar autenticado.",variant:"destructive"});let t=(0,D.H9)(S.db,"AforoCases",a);try{await (0,D.mZ)(t,{aforador:s,assignmentDate:D.Dc.now(),aforadorStatusLastUpdate:{by:e.displayName,at:D.Dc.now()}}),z({title:"Aforador Asignado",description:"".concat(s," ha sido asignado al caso.")}),T(null)}catch(e){console.error("Error assigning aforador:",e),z({title:"Error",description:"No se pudo asignar el aforador.",variant:"destructive"})}},aB=(0,r.useCallback)(async function(a,s,t){let r=arguments.length>3&&void 0!==arguments[3]&&arguments[3];if(!e||!e.displayName)return void z({title:"No autenticado",variant:"destructive"});let l=B.find(e=>e.id===a);if(!l||!l.worksheetId)return;let i=l[s];e5(e=>({...e,[a]:!0}));let n=(0,D.H9)(S.db,"worksheets",l.worksheetId),o=(0,D.rJ)(n,"actualizaciones"),c=(0,D.wP)(S.db);try{let l={[s]:t};"facturado"===s&&!0===t&&(l.facturadoAt=D.Dc.now()),s.toLowerCase().includes("status")&&(l["".concat(s,"LastUpdate")]={by:e.displayName,at:D.Dc.now()}),c.update((0,D.H9)(S.db,"AforoCases",a),l);let n={updatedAt:D.Dc.now(),updatedBy:e.displayName,field:s,oldValue:null!=i?i:null,newValue:t};c.set((0,D.H9)(o),n),await c.commit(),r||z({title:"Guardado Autom\xe1tico",description:"El campo se ha actualizado."})}catch(e){console.error("Error updating case:",e),z({title:"Error",description:"No se pudo guardar el cambio.",variant:"destructive"})}finally{e5(e=>({...e,[a]:!1}))}},[e,B,z]),aq=async()=>{if(0===aH.length)return void z({title:"No hay datos",description:"No hay casos en la tabla para exportar.",variant:"secondary"});Q(!0);try{if("corporate"===am)await ea(aH.map(e=>e.worksheet).filter(e=>null!==e));else{let e=[];for(let a of aJ){if(!a.worksheetId)continue;let s=(0,D.P)((0,D.rJ)(S.db,"worksheets",a.worksheetId,"actualizaciones"),(0,D.My)("updatedAt","asc"));(await (0,D.GG)(s)).forEach(s=>{e.push({...s.data(),caseNe:a.ne})})}await (0,Y.qf)(aJ,e)}}catch(e){console.error("Error exporting data: ",e),z({title:"Error de Exportaci\xf3n",description:"No se pudieron obtener todos los detalles para el reporte.",variant:"destructive"})}finally{Q(!1)}},a$=async e=>{if(!e.worksheetId)return void z({title:"Error",description:"Este caso no tiene una hoja de trabajo asociada.",variant:"destructive"});let a=(0,D.H9)(S.db,"worksheets",e.worksheetId),s=await (0,D.x7)(a);s.exists()?eb({id:s.id,...s.data()}):z({title:"Error",description:"No se pudo encontrar la hoja de trabajo.",variant:"destructive"})},aG=async a=>{if(!e||!e.displayName)return;e5(e=>({...e,[a]:!0}));let s=(0,D.H9)(S.db,"AforoCases",a);try{await (0,D.mZ)(s,{facturacionStatus:"Enviado a Facturacion",enviadoAFacturacionAt:D.Dc.now(),facturadorAsignado:"Alvaro Gonzalez",facturadorAsignadoAt:D.Dc.now()}),z({title:"Enviado a Facturaci\xf3n",description:"El caso ha sido remitido al m\xf3dulo de facturaci\xf3n y asignado a Alvaro Gonzalez."})}catch(e){z({title:"Error",description:"No se pudo enviar el caso a facturaci\xf3n.",variant:"destructive"})}finally{e5(e=>({...e,[a]:!1}))}},aH=(0,r.useMemo)(()=>{let e,a=B.slice().sort((e,a)=>{var s,t,r,l;return(null!=(r=null==(s=a.createdAt)?void 0:s.toMillis())?r:0)-(null!=(l=null==(t=e.createdAt)?void 0:t.toMillis())?l:0)}).filter(e=>!e.isArchived);if(e="worksheets"===am?a.filter(e=>{var a,s;return(null==(a=e.worksheet)?void 0:a.worksheetType)==="hoja_de_trabajo"||(null==(s=e.worksheet)?void 0:s.worksheetType)===void 0}):"anexos"===am?a.filter(e=>{var a,s;return(null==(a=e.worksheet)?void 0:a.worksheetType)==="anexo_5"||(null==(s=e.worksheet)?void 0:s.worksheetType)==="anexo_7"}):a.filter(e=>{var a;return(null==(a=e.worksheet)?void 0:a.worksheetType)==="corporate_report"}),!aj.isSearchActive)return ah(null),e.slice(0,15);{var s;let t=e;if(aj.searchTerm&&(t=t.filter(e=>e.ne.toLowerCase().includes(aj.searchTerm.toLowerCase())||e.consignee.toLowerCase().includes(aj.searchTerm.toLowerCase()))),aj.noFacturado&&!aj.facturado?t=t.filter(e=>!e.facturado):aj.facturado&&!aj.noFacturado&&(t=t.filter(e=>!0===e.facturado)),aj.conAcuse&&!aj.sinAcuse?t=t.filter(e=>e.entregadoAforoAt):aj.sinAcuse&&!aj.conAcuse&&(t=t.filter(e=>!e.entregadoAforoAt)),null==(s=aj.dateRange)?void 0:s.from){let e=(0,E.o)(aj.dateRange.from),a=aj.dateRange.to?(0,k.D)(aj.dateRange.to):(0,k.D)(aj.dateRange.from);t=t.filter(s=>{var t;let r=null==(t=s.createdAt)?void 0:t.toDate();return r&&r>=e&&r<=a})}if(aw&&(t=t.filter(e=>e.ne.toLowerCase().includes(aw.toLowerCase()))),ay&&(t=t.filter(e=>e.executive.toLowerCase().includes(ay.toLowerCase()))),aS&&(t=t.filter(e=>e.consignee.toLowerCase().includes(aS.toLowerCase()))),aE){let e=aE.toLowerCase();t=t.filter(a=>{var s,t;return((null==(s=a.worksheet)?void 0:s.worksheetType)==="corporate_report"?(null==(t=a.worksheet.documents)?void 0:t.filter(e=>"FACTURA"===e.type).map(e=>e.number))||[]:a.facturaNumber?a.facturaNumber.split(";").map(e=>e.trim()):[]).some(a=>a.toLowerCase().includes(e))})}if(aR&&(t=t.filter(e=>(e.selectividad||"N/A").toLowerCase().includes(aR.toLowerCase()))),aP&&(t=t.filter(e=>(e=>{let a=[];return"Rectificacion"===e.incidentType&&a.push("Rectificaci\xf3n"),e.hasValueDoubt&&a.push("Duda de Valor"),a.length>0?a.join(" / "):"N/A"})(e).toLowerCase().includes(aP.toLowerCase()))),0===t.length&&aj.searchTerm){let e=aj.searchTerm.toLowerCase();for(let s of["worksheets","anexos","corporate"].filter(e=>e!==am)){if(("worksheets"===s?a.filter(a=>{var s,t;return((null==(s=a.worksheet)?void 0:s.worksheetType)==="hoja_de_trabajo"||(null==(t=a.worksheet)?void 0:t.worksheetType)===void 0)&&(a.ne.toLowerCase().includes(e)||a.consignee.toLowerCase().includes(e))}):"anexos"===s?a.filter(a=>{var s,t;return((null==(s=a.worksheet)?void 0:s.worksheetType)==="anexo_5"||(null==(t=a.worksheet)?void 0:t.worksheetType)==="anexo_7")&&(a.ne.toLowerCase().includes(e)||a.consignee.toLowerCase().includes(e))}):a.filter(a=>{var s;return(null==(s=a.worksheet)?void 0:s.worksheetType)==="corporate_report"&&(a.ne.toLowerCase().includes(e)||a.consignee.toLowerCase().includes(e))})).length>0){ah({foundIn:s,label:"worksheets"===s?"Hojas de Trabajo":"anexos"===s?"Anexos":"Reportes Corporativos"});break}ah(null)}}else ah(null);return t}},[B,aj,am,aw,ay,aS,aE,aR,aP,e8]);aH.length;let aJ=aj.isSearchActive?aH.slice((aL-1)*a_,aL*a_):aH,aU=e=>{aB(e,"preliquidationStatus","Aprobada")},aZ=()=>{let e=aH.filter(e=>"Aprobado"===e.revisorStatus&&"Aprobada"!==e.preliquidationStatus).map(e=>e.id);aF.length===e.length?aV([]):aV(e)};if((null==e?void 0:e.displayName)&&e.displayName.split(" ")[0],a||!e)return(0,t.jsx)("div",{className:"min-h-screen flex items-center justify-center bg-background",children:(0,t.jsx)(m.A,{className:"h-12 w-12 animate-spin text-primary"})});if(ep)return(0,t.jsx)(c.G,{children:(0,t.jsx)("div",{className:"py-2 md:py-5",children:(0,t.jsx)(G.h,{caseData:ep,onClose:()=>ef(null)})})});if(ev)return(0,t.jsx)(c.G,{children:(0,t.jsx)("div",{className:"py-2 md:py-5",children:(0,t.jsx)(el.v,{worksheet:ev,aforoCase:B.find(e=>e.worksheetId===ev.id),onClose:()=>eb(null)})})});let aW={handleViewWorksheet:a$,setSelectedCaseForQuickRequest:ey,setSelectedCaseForPayment:eS,setSelectedCaseForPaymentList:eE,setSelectedCaseForResa:eR,setSelectedCaseForIncident:ed,setSelectedCaseForValueDoubt:em,setSelectedCaseForHistory:en,setSelectedIncidentForDetails:ef,setSelectedCaseForComment:eg,handleSearchPrevio:e=>{s.push("/database?ne=".concat(e))},setCaseToArchive:eF,setCaseToDuplicate:eQ,setDuplicateAndRetireModalOpen:eZ,setSelectedCaseForProcess:eT},aQ=()=>H?(0,t.jsx)("div",{className:"flex justify-center items-center py-10",children:(0,t.jsx)(m.A,{className:"h-8 w-8 animate-spin text-primary"})}):0===aH.length&&aj.isSearchActive?(0,t.jsxs)("div",{className:"text-center py-10",children:[(0,t.jsx)("p",{className:"text-muted-foreground",children:"No se encontraron casos con los filtros actuales."}),ax&&(0,t.jsxs)("div",{className:"mt-4 p-4 bg-blue-100 dark:bg-blue-900/30 border border-blue-300 dark:border-blue-700 rounded-md",children:[(0,t.jsxs)("p",{className:"text-sm text-blue-800 dark:text-blue-200",children:["Se encontr\xf3 una coincidencia en la pesta\xf1a de ",(0,t.jsx)("span",{className:"font-semibold",children:ax.label}),"."]}),(0,t.jsxs)(d.$,{onClick:()=>ap(ax.foundIn),className:"mt-2",size:"sm",children:["Ir a ",ax.label]})]})]}):0!==aH.length||aj.isSearchActive?L?(0,t.jsx)(as,{cases:aJ,savingState:e4,onAutoSave:aB,approvePreliquidation:aU,caseActions:aW}):(0,t.jsx)(av,{cases:aJ,savingState:e4,onAutoSave:aB,approvePreliquidation:aU,caseActions:aW,selectedRows:aF,onSelectRow:aV,onSelectAllRows:aZ,neFilter:aw,setNeFilter:aA,ejecutivoFilter:ay,setEjecutivoFilter:aC,consignatarioFilter:aS,setConsignatarioFilter:aD,facturaFilter:aE,setFacturaFilter:ak,selectividadFilter:aR,setSelectividadFilter:aI,incidentTypeFilter:aP,setIncidentTypeFilter:az,handleSendToFacturacion:aG}):(0,t.jsx)("p",{className:"text-muted-foreground text-center py-10",children:"No hay casos recientes para mostrar. Use la b\xfasqueda para encontrar casos m\xe1s antiguos."});return(0,t.jsxs)(t.Fragment,{children:[(0,t.jsx)(c.G,{children:(0,t.jsxs)("div",{className:"py-2 md:py-5 space-y-6",children:[(0,t.jsx)(e_,{}),(0,t.jsx)(al.tU,{defaultValue:am,className:"w-full",onValueChange:ap,children:(0,t.jsxs)(u.Zp,{children:[(0,t.jsxs)(u.aR,{children:[(0,t.jsxs)("div",{className:"flex flex-col sm:flex-row justify-between sm:items-center gap-4",children:[(0,t.jsxs)("div",{children:[(0,t.jsxs)(u.ZB,{className:"flex items-center gap-2 text-2xl",children:[(0,t.jsx)(x.A,{})," Panel Ejecutivo"]}),(0,t.jsx)(u.BT,{children:"Seguimiento de operaciones, desde la hoja de trabajo hasta la facturaci\xf3n."})]}),(0,t.jsxs)("div",{className:"flex flex-col sm:flex-row items-center gap-3",children:[(0,t.jsxs)(at.Lt,{children:[(0,t.jsx)(at.tv,{asChild:!0,children:(0,t.jsxs)(d.$,{size:"lg",variant:"secondary",className:"h-12 text-md",children:[(0,t.jsx)(h.A,{className:"mr-2 h-5 w-5"})," Solicitud de Pago General"]})}),(0,t.jsxs)(at.EO,{children:[(0,t.jsxs)(at.wd,{children:[(0,t.jsx)(at.r7,{children:"\xbfEst\xe1 seguro?"}),(0,t.jsx)(at.$v,{children:"Esta acci\xf3n iniciar\xe1 una solicitud de pago no vinculada a un N\xfamero de Entrada (NE) espec\xedfico. Se generar\xe1 un ID \xfanico en su lugar."})]}),(0,t.jsxs)(at.ck,{children:[(0,t.jsx)(at.Zr,{children:"Cancelar"}),(0,t.jsx)(at.Rx,{onClick:()=>{_({ne:"SOL-".concat((0,R.GP)(new Date,"ddMMyy-HHmmss")),manager:(null==e?void 0:e.displayName)||"Usuario Desconocido",date:new Date,recipient:"",isMemorandum:!1}),eP(!0)},children:"S\xed, continuar"})]})]})]}),(0,t.jsxs)(et.rI,{children:[(0,t.jsx)(et.ty,{asChild:!0,children:(0,t.jsxs)(d.$,{size:"lg",variant:"default",className:"h-12 text-md",children:[(0,t.jsx)(p.A,{className:"mr-2 h-5 w-5"}),"Crear Registro"]})}),(0,t.jsxs)(et.SQ,{children:[(0,t.jsx)(et.lp,{children:"Tipo de Documento"}),(0,t.jsx)(et.mB,{}),(0,t.jsx)(et._2,{asChild:!0,children:(0,t.jsxs)(n(),{href:"/executive/worksheet",children:[(0,t.jsx)(j.A,{className:"mr-2 h-4 w-4"})," Hoja de Trabajo"]})}),(0,t.jsx)(et._2,{asChild:!0,children:(0,t.jsxs)(n(),{href:"/executive/corporate-report",children:[(0,t.jsx)(f.A,{className:"mr-2 h-4 w-4"})," Reporte Consignatario"]})}),(0,t.jsx)(et._2,{asChild:!0,children:(0,t.jsxs)(n(),{href:"/executive/anexos?type=anexo_5",children:[(0,t.jsx)(v.A,{className:"mr-2 h-4 w-4"})," Anexo 5"]})}),(0,t.jsx)(et._2,{asChild:!0,children:(0,t.jsxs)(n(),{href:"/executive/anexos?type=anexo_7",children:[(0,t.jsx)(v.A,{className:"mr-2 h-4 w-4"})," Anexo 7"]})})]})]})]})]}),(0,t.jsx)("div",{className:"border-t pt-4 mt-2",children:(0,t.jsxs)(al.j7,{children:[(0,t.jsx)(al.Xi,{value:"worksheets",children:"Hojas de Trabajo"}),(0,t.jsx)(al.Xi,{value:"anexos",children:"Anexos"}),(0,t.jsx)(al.Xi,{value:"corporate",children:"Reportes Corporativos"})]})})]}),(0,t.jsxs)(u.Wu,{children:[(0,t.jsxs)("div",{className:"flex flex-col gap-4",children:[(0,t.jsxs)("div",{className:"flex flex-wrap items-center justify-between gap-4",children:[(0,t.jsxs)("div",{className:"relative w-full sm:max-w-xs",children:[(0,t.jsx)(b.A,{className:"absolute left-3 top-1/2 -translate-y-1/2 h-5 w-5 text-muted-foreground"}),(0,t.jsx)(I.p,{placeholder:"Buscar por NE o Consignatario...",className:"pl-10",value:e1,onChange:e=>e2(e.target.value)})]}),(0,t.jsxs)("div",{className:"flex items-center flex-wrap gap-4",children:[(0,t.jsxs)(es.AM,{children:[(0,t.jsx)(es.Wv,{asChild:!0,children:(0,t.jsxs)(d.$,{variant:"outline",className:"w-[200px] justify-start",children:[(0,t.jsx)(N.A,{className:"mr-2 h-4 w-4"})," Filtrar Visibilidad"]})}),(0,t.jsxs)(es.hl,{className:"w-56 p-2",align:"end",children:[(0,t.jsxs)("div",{className:"grid gap-2",children:[(0,t.jsxs)("label",{className:"flex items-center gap-2 text-sm font-normal",children:[(0,t.jsx)(U.S,{checked:e3.noFacturado,onCheckedChange:e=>e6(a=>({...a,noFacturado:!!e}))}),"No Facturados"]}),(0,t.jsxs)("label",{className:"flex items-center gap-2 text-sm font-normal",children:[(0,t.jsx)(U.S,{checked:e3.facturado,onCheckedChange:e=>e6(a=>({...a,facturado:!!e}))}),"Facturados"]})]}),(0,t.jsxs)("div",{className:"grid gap-2 mt-2 pt-2 border-t",children:[(0,t.jsxs)("label",{className:"flex items-center gap-2 text-sm font-normal",children:[(0,t.jsx)(U.S,{checked:e8.sinAcuse,onCheckedChange:e=>e9(a=>({...a,sinAcuse:!!e}))}),"Sin Acuse"]}),(0,t.jsxs)("label",{className:"flex items-center gap-2 text-sm font-normal",children:[(0,t.jsx)(U.S,{checked:e8.conAcuse,onCheckedChange:e=>e9(a=>({...a,conAcuse:!!e}))}),"Con Acuse"]})]})]})]}),(0,t.jsxs)(d.$,{onClick:()=>{let e;if("range"===e7)e=aa;else if("month"===e7)e={from:new Date(ac,an,1),to:new Date(ac,an+1,0)};else if("today"===e7){let a=new Date;e={from:a,to:a}}af({searchTerm:e1,...e3,...e8,dateFilterType:e7,dateRange:e,isSearchActive:!0}),aM(1)},children:[(0,t.jsx)(b.A,{className:"mr-2 h-4 w-4"})," Buscar"]}),(0,t.jsx)(d.$,{variant:"outline",onClick:()=>{e2(""),e6({facturado:!1,noFacturado:!0}),e9({conAcuse:!1,sinAcuse:!0}),ai(void 0),aA(""),aC(""),aD(""),ak(""),aI(""),az(""),af({searchTerm:"",facturado:!1,noFacturado:!0,conAcuse:!1,sinAcuse:!0,dateFilterType:"range",dateRange:void 0,isSearchActive:!1}),aM(1),ah(null)},children:"Limpiar Filtros"}),(0,t.jsxs)(d.$,{variant:"outline",onClick:aT,children:[(0,t.jsx)(g.A,{className:"mr-2 h-4 w-4"})," Actualizar"]}),(0,t.jsxs)(d.$,{onClick:aq,disabled:0===B.length||W,children:[W?(0,t.jsx)(m.A,{className:"mr-2 h-4 w-4 animate-spin"}):(0,t.jsx)(w.A,{className:"mr-2 h-4 w-4"}),W?"Exportando...":"Exportar"]})]})]}),(0,t.jsxs)("div",{className:"flex flex-wrap items-center gap-4",children:[(0,t.jsxs)("div",{className:"flex flex-wrap items-center gap-2",children:[(0,t.jsxs)(d.$,{variant:"range"===e7?"default":"ghost",size:"sm",onClick:()=>ae("range"),children:[(0,t.jsx)(A.A,{className:"mr-2 h-4 w-4"})," Rango"]}),(0,t.jsxs)(d.$,{variant:"month"===e7?"default":"ghost",size:"sm",onClick:()=>ae("month"),children:[(0,t.jsx)(y.A,{className:"mr-2 h-4 w-4"})," Mes"]}),(0,t.jsxs)(d.$,{variant:"today"===e7?"default":"ghost",size:"sm",onClick:()=>ae("today"),children:[(0,t.jsx)(C.A,{className:"mr-2 h-4 w-4"})," Hoy"]})]}),"range"===e7&&(0,t.jsx)(er.S,{date:aa,onDateChange:ai}),"month"===e7&&(0,t.jsxs)("div",{className:"flex gap-2",children:[(0,t.jsxs)(Z.l6,{value:String(an),onValueChange:e=>ao(Number(e)),children:[(0,t.jsx)(Z.bq,{className:"w-[180px]",children:(0,t.jsx)(Z.yv,{})}),(0,t.jsx)(Z.gC,{children:ab.map(e=>(0,t.jsx)(Z.eb,{value:String(e.value),children:e.label},e.value))})]}),(0,t.jsxs)(Z.l6,{value:String(ac),onValueChange:e=>ad(Number(e)),children:[(0,t.jsx)(Z.bq,{className:"w-[120px]",children:(0,t.jsx)(Z.yv,{})}),(0,t.jsx)(Z.gC,{children:ag.map(e=>(0,t.jsx)(Z.eb,{value:String(e),children:e},e))})]})]})]})]}),(0,t.jsx)(al.av,{value:"worksheets",className:"mt-6",children:aQ()}),(0,t.jsx)(al.av,{value:"anexos",className:"mt-6",children:aQ()}),(0,t.jsx)(al.av,{value:"corporate",className:"mt-6",children:aQ()})]})]})})]})}),ei&&(0,t.jsx)(P.p,{isOpen:!!ei,onClose:()=>en(null),caseData:ei}),ec&&(0,t.jsx)($,{isOpen:!!ec,onClose:()=>ed(null),caseData:ec}),eu&&(0,t.jsx)(X,{isOpen:!!eu,onClose:()=>em(null),caseData:eu}),eN&&(0,t.jsx)(eo,{isOpen:!!eN,onClose:()=>eg(null),caseData:eN}),ew&&(0,t.jsx)(ex,{isOpen:!!ew,onClose:()=>ey(null),caseWithWorksheet:ew}),eC&&(0,t.jsx)(ej,{isOpen:!!eC,onClose:()=>eS(null),caseData:eC}),eI&&(0,t.jsx)(ej,{isOpen:eI,onClose:()=>eP(!1),caseData:null}),eD&&(0,t.jsx)(eA,{isOpen:!!eD,onClose:()=>eE(null),caseData:eD}),ek&&(0,t.jsx)(eq,{isOpen:!!ek,onClose:()=>eR(null),caseData:ek}),V&&(0,t.jsx)(eO,{isOpen:!!V,onClose:()=>T(null),caseData:V,assignableUsers:K,onAssign:aO,title:"Asignar Aforador (PSMT)",description:"Como el consignatario es PSMT, debe asignar un aforador para el caso NE: ".concat(V.ne,".")}),ez&&(0,t.jsx)(ar,{isOpen:!!ez,onClose:()=>eL(null),onSelectRectificacion:()=>{ef(ez),eL(null)},onSelectDudaValor:()=>{em(ez),eL(null)}}),eV&&(0,t.jsx)(au,{isOpen:!!eV,onClose:()=>eT(null),caseData:eV})]})}function aA(){return(0,t.jsx)(r.Suspense,{fallback:(0,t.jsx)("div",{className:"min-h-screen flex items-center justify-center bg-background",children:(0,t.jsx)(m.A,{className:"h-12 w-12 animate-spin text-primary"})}),children:(0,t.jsx)(aw,{})})}},27339:(e,a,s)=>{"use strict";s.d(a,{l:()=>m});var t=s(95155),r=s(12115),l=s(5282),i=s(80160),n=s(28127),o=s(64269),c=s(3998),d=s(50276),u=s(26333);function m(e){let{className:a,date:s,onDateChange:m,disabled:x=!1}=e,[h,p]=r.useState(!1),[j,f]=r.useState(s);return r.useEffect(()=>{f(s)},[s]),(0,t.jsx)("div",{className:(0,o.cn)("grid gap-2",a),children:(0,t.jsxs)(u.AM,{open:h,onOpenChange:p,children:[(0,t.jsx)(u.Wv,{asChild:!0,children:(0,t.jsxs)(c.$,{variant:"outline",disabled:x,className:(0,o.cn)("w-[180px] justify-start text-left font-normal",!j&&"text-muted-foreground"),children:[(0,t.jsx)(n.A,{className:"mr-2 h-4 w-4"}),j?(0,l.GP)(j,"dd/MM/yy",{locale:i.es}):(0,t.jsx)("span",{children:"Seleccione fecha"})]})}),(0,t.jsx)(u.hl,{className:"w-auto p-0",children:(0,t.jsx)(d.V,{mode:"single",selected:null!=j?j:void 0,onSelect:e=>{f(e),m(e),p(!1)},initialFocus:!0,locale:i.es,disabled:x})})]})})}},44846:(e,a,s)=>{"use strict";s.d(a,{d:()=>n});var t=s(95155),r=s(12115),l=s(27599),i=s(64269);let n=r.forwardRef((e,a)=>{let{className:s,...r}=e;return(0,t.jsx)(l.bL,{className:(0,i.cn)("peer inline-flex h-6 w-11 shrink-0 cursor-pointer items-center rounded-full border-2 border-transparent transition-colors focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2 focus-visible:ring-offset-background disabled:cursor-not-allowed disabled:opacity-50 data-[state=checked]:bg-primary data-[state=unchecked]:bg-input",s),...r,ref:a,children:(0,t.jsx)(l.zi,{className:(0,i.cn)("pointer-events-none block h-5 w-5 rounded-full bg-background shadow-lg ring-0 transition-transform data-[state=checked]:translate-x-5 data-[state=unchecked]:translate-x-0")})})});n.displayName=l.bL.displayName},49205:(e,a,s)=>{"use strict";s.d(a,{p:()=>g});var t=s(95155),r=s(12115),l=s(14585),i=s(19708),n=s(3998),o=s(51834),c=s(17037),d=s(18527),u=s(28068),m=s(54550),x=s(12036),h=s(59915),p=s(92033),j=s(27314),f=s(28127),v=s(5282),b=s(80160),N=s(64269);function g(e){let{isOpen:a,onClose:s,caseData:g}=e,[w,A]=(0,r.useState)([]),[y,C]=(0,r.useState)(!0);(0,r.useEffect)(()=>{if(!a||!(null==g?void 0:g.worksheetId))return void A([]);C(!0);let e=(0,i.rJ)(l.db,"worksheets",g.worksheetId,"actualizaciones"),s=(0,i.P)(e,(0,i.My)("updatedAt","desc")),t=(0,i.aQ)(s,e=>{let a=[];e.forEach(e=>{a.push(e.data())}),A(a),C(!1)},e=>{console.error("Error fetching case history: ",e),C(!1)});return()=>t()},[a,g]);let S=e=>{if(!e)return"N/A";let a=(null==e?void 0:e.toDate)?e.toDate():e;return(0,v.GP)(a,"dd/MM/yy HH:mm",{locale:b.es})},D=e=>e instanceof i.Dc?S(e):"boolean"==typeof e?e?"S\xed":"No":null==e||""===e?(0,t.jsx)("i",{className:"text-muted-foreground",children:"vac\xedo"}):String(e);return a?(0,t.jsx)(o.lG,{open:a,onOpenChange:s,children:(0,t.jsxs)(o.Cf,{className:"max-w-xl",children:[(0,t.jsxs)(o.c7,{children:[(0,t.jsxs)(o.L3,{className:"flex items-center gap-2",children:[(0,t.jsx)(h.A,{})," Bit\xe1cora de Cambios"]}),(0,t.jsxs)(o.rr,{children:["Historial de actualizaciones para el caso NE: ",(0,t.jsx)("span",{className:"font-bold text-foreground",children:null==g?void 0:g.ne})]})]}),(0,t.jsx)(c.F,{className:"h-[60vh] -mx-6 px-6",children:(0,t.jsxs)("div",{className:"space-y-6 py-4",children:[y&&(0,t.jsx)("div",{className:"flex justify-center items-center py-8",children:(0,t.jsx)(p.A,{className:"h-8 w-8 animate-spin text-primary"})}),!y&&0===w.length&&(0,t.jsx)("div",{className:"text-center text-muted-foreground py-8",children:"No hay historial de cambios para este caso."}),!y&&w.map((e,a)=>(0,t.jsxs)("div",{className:"p-4 border rounded-lg bg-card shadow-sm relative",children:[(0,t.jsxs)("div",{className:"flex flex-col sm:flex-row justify-between items-start text-xs text-muted-foreground mb-3 border-b pb-2",children:[(0,t.jsxs)("div",{className:"flex items-center gap-2",children:[(0,t.jsx)(j.A,{className:"h-3 w-3"}),(0,t.jsx)("span",{className:"font-medium",children:e.updatedBy})]}),(0,t.jsxs)("div",{className:"flex items-center gap-2",children:[(0,t.jsx)(f.A,{className:"h-3 w-3"}),(0,t.jsx)("span",{className:"mt-1 sm:mt-0",children:S(e.updatedAt)})]})]}),(e=>{if("creation"===e.field)return(0,t.jsxs)("div",{className:"pl-4 border-l-2 border-blue-500",children:[(0,t.jsx)("div",{className:"flex items-center gap-2 font-semibold text-blue-500",children:(0,t.jsx)("p",{children:"Caso Creado"})}),(0,t.jsxs)("div",{className:"mt-2 text-sm italic bg-muted/50 p-2 rounded-md whitespace-pre-wrap",children:['"',e.comment,'"']})]});if("status_change"===e.field){let a,s,r;switch(e.newValue){case"Aprobado":a=d.A,s="Caso Aprobado",r="text-green-500";break;case"Rechazado":a=u.A,s="Caso Rechazado",r="text-destructive";break;case"Revalidaci\xf3n Solicitada":a=m.A,s="Revalidaci\xf3n Solicitada",r="text-amber-500";break;default:a=x.A,s="Cambio de Estado",r="text-foreground"}return(0,t.jsxs)("div",{className:(0,N.cn)("pl-4 border-l-2",r.replace("text-","border-")),children:[(0,t.jsxs)("div",{className:"flex items-center gap-2 font-semibold ".concat(r),children:[(0,t.jsx)(a,{className:"h-4 w-4"}),(0,t.jsx)("p",{children:s})]}),e.comment&&(0,t.jsxs)("div",{className:"mt-2 text-sm italic bg-muted/50 p-2 rounded-md whitespace-pre-wrap",children:['"',e.comment,'"']})]})}return(0,t.jsxs)("div",{className:"text-sm",children:[(0,t.jsxs)("p",{className:"font-medium text-muted-foreground",children:["Campo actualizado: ",(0,t.jsx)("code",{className:"bg-primary/10 text-primary px-2 py-1 rounded-sm",children:e.field})]}),(0,t.jsxs)("div",{className:"mt-1 grid grid-cols-[auto_1fr] gap-x-2 items-center",children:[(0,t.jsx)("span",{className:"text-destructive/80",children:"De:"})," ",(0,t.jsx)("span",{className:"text-destructive/80",children:D(e.oldValue)}),(0,t.jsx)("span",{className:"text-green-600",children:"A:"})," ",(0,t.jsx)("span",{className:"text-green-600 font-semibold",children:D(e.newValue)})]})]})})(e)]},a))]})}),(0,t.jsx)(o.Es,{children:(0,t.jsx)(n.$,{variant:"outline",onClick:s,children:"Cerrar"})})]})}):null}},63817:(e,a,s)=>{"use strict";s.d(a,{G7:()=>c,L$:()=>m,h_:()=>x,oI:()=>d,uB:()=>o,xL:()=>u});var t=s(95155),r=s(12115),l=s(41808),i=s(90109),n=s(64269);s(51834);let o=r.forwardRef((e,a)=>{let{className:s,...r}=e;return(0,t.jsx)(l.uB,{ref:a,className:(0,n.cn)("flex h-full w-full flex-col overflow-hidden rounded-md bg-popover text-popover-foreground",s),...r})});o.displayName=l.uB.displayName;let c=r.forwardRef((e,a)=>{let{className:s,...r}=e;return(0,t.jsxs)("div",{className:"flex items-center border-b px-3","cmdk-input-wrapper":"",children:[(0,t.jsx)(i.A,{className:"mr-2 h-4 w-4 shrink-0 opacity-50"}),(0,t.jsx)(l.uB.Input,{ref:a,className:(0,n.cn)("flex h-11 w-full rounded-md bg-transparent py-3 text-sm outline-none placeholder:text-muted-foreground disabled:cursor-not-allowed disabled:opacity-50",s),...r})]})});c.displayName=l.uB.Input.displayName;let d=r.forwardRef((e,a)=>{let{className:s,...r}=e;return(0,t.jsx)(l.uB.List,{ref:a,className:(0,n.cn)("max-h-[300px] overflow-y-auto overflow-x-hidden",s),...r})});d.displayName=l.uB.List.displayName;let u=r.forwardRef((e,a)=>(0,t.jsx)(l.uB.Empty,{ref:a,className:"py-6 text-center text-sm",...e}));u.displayName=l.uB.Empty.displayName;let m=r.forwardRef((e,a)=>{let{className:s,...r}=e;return(0,t.jsx)(l.uB.Group,{ref:a,className:(0,n.cn)("overflow-hidden p-1 text-foreground [&_[cmdk-group-heading]]:px-2 [&_[cmdk-group-heading]]:py-1.5 [&_[cmdk-group-heading]]:text-xs [&_[cmdk-group-heading]]:font-medium [&_[cmdk-group-heading]]:text-muted-foreground",s),...r})});m.displayName=l.uB.Group.displayName,r.forwardRef((e,a)=>{let{className:s,...r}=e;return(0,t.jsx)(l.uB.Separator,{ref:a,className:(0,n.cn)("-mx-1 h-px bg-border",s),...r})}).displayName=l.uB.Separator.displayName;let x=r.forwardRef((e,a)=>{let{className:s,...r}=e;return(0,t.jsx)(l.uB.Item,{ref:a,className:(0,n.cn)("relative flex cursor-default select-none items-center rounded-sm px-2 py-1.5 text-sm outline-none aria-selected:bg-accent aria-selected:text-accent-foreground data-[disabled='true']:pointer-events-none data-[disabled='true']:opacity-50",s),...r})});x.displayName=l.uB.Item.displayName},83012:(e,a,s)=>{"use strict";function t(e,a){let s=new Date(e),t=0;for(;t<a;)s.setDate(s.getDate()+1),0!==s.getDay()&&t++;return s}s.d(a,{f:()=>t})},86501:(e,a,s)=>{"use strict";s.d(a,{$:()=>t});class t extends Error{constructor(e,a){super("Firestore Permission Denied: You do not have permission to perform the '".concat(e.operation,"' operation on the path '").concat(e.path,"'.")),this.name="FirestorePermissionError",this.context=e,this.originalError=a,Object.setPrototypeOf(this,new.target.prototype)}}}},e=>{e.O(0,[2992,7138,3524,4865,2130,3744,5282,9351,3504,6505,1042,5372,4754,5479,5171,9817,9321,7686,6190,7115,8441,1255,7358],()=>e(e.s=14774)),_N_E=e.O()}]);