(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[2244],{11860:(e,s,a)=>{"use strict";a.d(s,{AppProvider:()=>x,I:()=>u,U:()=>p});var r=a(95155),n=a(12115),t=a(11929),l=a(54901),i=a(19708),o=a(14585),c=a(15894),d=a(5282),u=function(e){return e[e.WELCOME=0]="WELCOME",e[e.INITIAL_INFO=1]="INITIAL_INFO",e[e.PRODUCT_LIST=2]="PRODUCT_LIST",e[e.PREVIEW=3]="PREVIEW",e[e.SUCCESS=4]="SUCCESS",e[e.INITIAL_DATA=1]="INITIAL_DATA",e[e.SOLICITUD_LIST=2]="SOLICITUD_LIST",e}({});let m=(0,n.createContext)(void 0),x=e=>{let{children:s}=e,[a,u]=(0,n.useState)(null),[x,p]=(0,n.useState)([]),[h,j]=(0,n.useState)(0),[g,f]=(0,n.useState)(null),[v,b]=(0,n.useState)(!1),[N,y]=(0,n.useState)(!1),[C,w]=(0,n.useState)(null),[E,A]=(0,n.useState)(!1),[k,I]=(0,n.useState)([]),[S,z]=(0,n.useState)(null),[P,R]=(0,n.useState)([]),[D,M]=(0,n.useState)(null),[U,B]=(0,n.useState)(!1),[q,T]=(0,n.useState)(null),[F,O]=(0,n.useState)(null),{user:_}=(0,l.A)(),{toast:L}=(0,c.dj)(),[G,$]=(0,n.useState)(_),J=(0,n.useCallback)(()=>{u(null),p([]),j(0),f(null),b(!1),y(!1),w(null),A(!1),I([]),z(null),R([]),M(null),B(!1),T(null),O(null)},[]);(0,n.useEffect)(()=>{((null==_?void 0:_.uid)!==(null==G?void 0:G.uid)||_&&!G||!_&&G)&&(J(),$(_))},[_,G,J]);let V=(0,n.useCallback)(e=>{z(e)},[]),W=(0,n.useCallback)(e=>{if(!(null==S?void 0:S.ne)){console.error("No se puede generar ID de solicitud: falta el NE en el contexto inicial."),L({title:"Error Interno",description:"No se pudo generar un ID para la solicitud porque falta el NE.",variant:"destructive"});return}let s=new Date,a=(0,d.GP)(s,"ddMMyy-HHmmss"),r="".concat(S.ne,"-").concat(a),n={...e,id:r};R(e=>[...e,n])},[S,L]),H=(0,n.useCallback)(e=>{R(s=>s.map(s=>s.id===e.id?e:s))},[]),Z=(0,n.useCallback)(e=>{R(s=>s.filter(s=>s.id!==e))},[]),X=(0,n.useCallback)(e=>{M(e||null),b(!0)},[]),K=(0,n.useCallback)(async(e,s)=>{if(E&&(null==a?void 0:a.ne)&&(null==_?void 0:_.email))try{let r=(0,i.rJ)(o.db,"examenesRecuperados"),n={examNe:a.ne,action:e,changedBy:_.email,changedAt:i.Dc.fromDate(new Date),details:s};await (0,i.gS)(r,n)}catch(e){console.error("Error writing audit log:",e),L({title:"Error de Auditor\xeda",description:"No se pudo registrar el cambio en la bit\xe1cora de recuperaci\xf3n.",variant:"destructive"})}},[E,null==a?void 0:a.ne,null==_?void 0:_.email,L]),Q=(0,n.useCallback)(async(e,s)=>{if(!(null==e?void 0:e.ne)||!(null==_?void 0:_.email))return void console.log("Soft save prerequisites not met.",{ne:null==e?void 0:e.ne,user:null==_?void 0:_.email});let a=(0,i.H9)(o.db,"examenesPrevios",e.ne.toUpperCase()),r={...e,products:s,savedBy:_.email,status:"incomplete",lastUpdated:i.Dc.fromDate(new Date)};try{let n=await (0,i.x7)(a);1!==s.length||n.exists()&&n.data().createdAt||(r.createdAt=i.Dc.fromDate(new Date)),r.savedAt=i.Dc.fromDate(new Date),await (0,i.BN)(a,r,{merge:!0}),console.log("Soft save successful for NE: ".concat(e.ne))}catch(e){console.error("Error during soft save:",e),L({title:"Error de Autoguardado",description:"No se pudo guardar el progreso. Revisa tu conexi\xf3n.",variant:"destructive"})}},[_,L]),Y=(0,n.useCallback)(function(e){let s=arguments.length>1&&void 0!==arguments[1]&&arguments[1];u(e),s&&A(!0)},[]),ee=(0,n.useCallback)(e=>{p(e)},[]),es=(0,n.useCallback)(e=>{let s={...e,id:(0,t.A)(),productTimestampSaveAt:i.Dc.fromDate(new Date)};p(e=>{let r=[...e,s];return Q(a,r),r}),K("product_added",{productId:s.id,newData:s})},[a,Q,K]),ea=(0,n.useCallback)(e=>{let s;p(r=>{s=r.find(s=>s.id===e.id);let n=r.map(s=>s.id===e.id?e:s);return Q(a,n),n}),K("product_updated",{productId:e.id,previousData:s,newData:e}),f(null)},[a,Q,K]),er=(0,n.useCallback)(e=>{let s;p(r=>{s=r.find(s=>s.id===e);let n=r.filter(s=>s.id!==e);return Q(a,n),n}),s&&K("product_deleted",{productId:e,previousData:s})},[a,Q,K]),en=(0,n.useCallback)(e=>{j(e)},[]),et=(0,n.useCallback)(e=>{f(e)},[]),el=(0,n.useCallback)(e=>{2===h?f(e):2===h&&M(e),b(!0)},[h]),ei=(0,n.useCallback)(()=>{b(!1),f(null),M(null)},[]),eo=(0,n.useCallback)(e=>{w(e),y(!0)},[]),ec=(0,n.useCallback)(()=>{y(!1),w(null)},[]),ed=(0,n.useCallback)(e=>{I(s=>s.includes(e)?s.filter(s=>s!==e):[...s,e])},[]),eu=(0,n.useCallback)(()=>{k.length===x.length?I([]):I(x.map(e=>e.id))},[x,k.length]),em=(0,n.useCallback)(()=>{let e=[];p(s=>{let r=s.filter(s=>!k.includes(s.id)||(e.push(s),!1));return Q(a,r),r}),e.forEach(e=>{K("product_deleted",{productId:e.id,previousData:e})}),I([]),L({title:"Productos eliminados",description:"".concat(e.length," productos han sido eliminados de la lista.")})},[k,Q,a,K,L]);return(0,r.jsx)(m.Provider,{value:{examData:a,products:x,currentStep:h,editingProduct:g,isAddProductModalOpen:v,isProductDetailModalOpen:N,productToView:C,selectedProducts:k,setExamData:Y,setProducts:ee,addProduct:es,updateProduct:ea,deleteProduct:er,setCurrentStep:en,setEditingProduct:et,openAddProductModal:el,closeAddProductModal:ei,openProductDetailModal:eo,closeProductDetailModal:ec,resetApp:J,softSaveExam:Q,toggleProductSelection:ed,toggleSelectAllProducts:eu,deleteSelectedProducts:em,initialContextData:S,setInitialContextData:V,solicitudes:P,addSolicitud:W,updateSolicitud:H,deleteSolicitud:Z,editingSolicitud:D,openSolicitudModal:X,isMemorandumMode:U,setIsMemorandumMode:B,solicitudToViewInline:q,setSolicitudToViewInline:T,caseToAssignAforador:F,setCaseToAssignAforador:O},children:s})},p=()=>{let e=(0,n.useContext)(m);if(void 0===e)throw Error("useAppContext must be used within an AppProvider");return e}},31120:(e,s,a)=>{"use strict";a.d(s,{T:()=>l});var r=a(95155),n=a(12115),t=a(64269);let l=n.forwardRef((e,s)=>{let{className:a,...n}=e;return(0,r.jsx)("textarea",{className:(0,t.cn)("flex min-h-[80px] w-full rounded-md border border-input bg-background px-3 py-2 text-sm ring-offset-background placeholder:text-muted-foreground focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2 disabled:cursor-not-allowed disabled:opacity-50",a),ref:s,...n})});l.displayName="Textarea"},51834:(e,s,a)=>{"use strict";a.d(s,{Cf:()=>u,Es:()=>x,HM:()=>c,L3:()=>p,c7:()=>m,lG:()=>i,rr:()=>h});var r=a(95155),n=a(12115),t=a(89511),l=a(64269);let i=t.bL;t.l9;let o=t.ZL,c=t.bm,d=n.forwardRef((e,s)=>{let{className:a,...n}=e;return(0,r.jsx)(t.hJ,{ref:s,className:(0,l.cn)("fixed inset-0 z-50 bg-black/80 data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0",a),...n})});d.displayName=t.hJ.displayName;let u=n.forwardRef((e,s)=>{let{className:a,children:n,...i}=e;return(0,r.jsxs)(o,{children:[(0,r.jsx)(d,{}),(0,r.jsxs)(t.UC,{ref:s,className:(0,l.cn)("fixed left-[50%] top-[50%] z-50 grid w-full max-w-lg translate-x-[-50%] translate-y-[-50%] gap-4 border bg-background p-6 shadow-lg duration-200 data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0 data-[state=closed]:zoom-out-95 data-[state=open]:zoom-in-95 data-[state=closed]:slide-out-to-left-1/2 data-[state=closed]:slide-out-to-top-[48%] data-[state=open]:slide-in-from-left-1/2 data-[state=open]:slide-in-from-top-[48%] sm:rounded-lg",a),...i,children:[n,(0,r.jsx)(t.bm,{className:"absolute right-4 top-4 rounded-sm opacity-70 ring-offset-background transition-opacity hover:opacity-100 focus:outline-none focus:ring-2 focus:ring-ring focus:ring-offset-2 disabled:pointer-events-none data-[state=open]:bg-accent data-[state=open]:text-muted-foreground",children:(0,r.jsx)("span",{className:"sr-only",children:"Close"})})]})]})});u.displayName=t.UC.displayName;let m=e=>{let{className:s,...a}=e;return(0,r.jsx)("div",{className:(0,l.cn)("flex flex-col space-y-1.5 text-center sm:text-left",s),...a})};m.displayName="DialogHeader";let x=e=>{let{className:s,...a}=e;return(0,r.jsx)("div",{className:(0,l.cn)("flex flex-col-reverse sm:flex-row sm:justify-end sm:space-x-2",s),...a})};x.displayName="DialogFooter";let p=n.forwardRef((e,s)=>{let{className:a,...n}=e;return(0,r.jsx)(t.hE,{ref:s,className:(0,l.cn)("text-lg font-semibold leading-none tracking-tight",a),...n})});p.displayName=t.hE.displayName;let h=n.forwardRef((e,s)=>{let{className:a,...n}=e;return(0,r.jsx)(t.VY,{ref:s,className:(0,l.cn)("text-sm text-muted-foreground",a),...n})});h.displayName=t.VY.displayName},65142:(e,s,a)=>{"use strict";a.d(s,{p:()=>l});var r=a(95155),n=a(12115),t=a(64269);let l=n.forwardRef((e,s)=>{let{className:a,type:n,...l}=e;return(0,r.jsx)("input",{type:n,className:(0,t.cn)("flex h-10 w-full rounded-md border border-input bg-background px-3 py-2 text-base ring-offset-background file:border-0 file:bg-transparent file:text-sm file:font-medium file:text-foreground placeholder:text-muted-foreground focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2 disabled:cursor-not-allowed disabled:opacity-50 md:text-sm","aria-[invalid=true]:border-destructive aria-[invalid=true]:ring-destructive",a),ref:s,...l})});l.displayName="Input"},67829:(e,s,a)=>{Promise.resolve().then(a.bind(a,74807))},73457:(e,s,a)=>{"use strict";a.d(s,{S:()=>o});var r=a(95155),n=a(12115),t=a(38162),l=a(72251),i=a(64269);let o=n.forwardRef((e,s)=>{let{className:a,...n}=e;return(0,r.jsx)(t.bL,{ref:s,className:(0,i.cn)("peer h-4 w-4 shrink-0 rounded-sm border border-primary ring-offset-background focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2 disabled:cursor-not-allowed disabled:opacity-50 data-[state=checked]:bg-primary data-[state=checked]:text-primary-foreground",a),...n,children:(0,r.jsx)(t.C1,{className:(0,i.cn)("flex items-center justify-center text-current"),children:(0,r.jsx)(l.A,{className:"h-4 w-4"})})})});o.displayName=t.bL.displayName},74807:(e,s,a)=>{"use strict";a.r(s),a.d(s,{default:()=>ez});var r=a(95155),n=a(12115),t=a(20063),l=a(54901),i=a(11860),o=a(35434),c=a(22544),d=a(66942),u=a(3998),m=a(65142),x=a(41052),p=a(86948),h=a(15653);let j=h.z.object({ne:h.z.string().min(1,"NE es requerido."),reference:h.z.string().optional(),manager:h.z.string().min(1,"Nombre del Gestor es requerido."),location:h.z.string().min(1,"Ubicaci\xf3n es requerida."),consignee:h.z.string().min(1,"Consignatario es requerido.")}),g=h.z.object({id:h.z.string().optional(),itemNumber:h.z.string().optional(),weight:h.z.string().optional(),description:h.z.string().min(1,"Descripci\xf3n es requerida."),brand:h.z.string().optional(),model:h.z.string().optional(),unitMeasure:h.z.string().optional(),serial:h.z.string().optional(),origin:h.z.string().optional(),numberPackages:h.z.string().min(1,"Numeraci\xf3n de Bultos es requerida."),quantityPackages:h.z.coerce.number({required_error:"Cantidad de Bultos es requerida.",invalid_type_error:"Debe ser un n\xfamero."}).min(0,"Cantidad de bultos debe ser positiva."),quantityUnits:h.z.coerce.number({required_error:"Cantidad de Unidades es requerida.",invalid_type_error:"Debe ser un n\xfamero."}).min(0,"Cantidad de unidades debe ser positiva."),packagingCondition:h.z.string().optional(),observation:h.z.string().optional(),isConform:h.z.boolean().default(!1),isExcess:h.z.boolean().default(!1),isMissing:h.z.boolean().default(!1),isFault:h.z.boolean().default(!1),productTimestampSaveAt:h.z.custom().optional()});var f=a(36204),v=a(92033),b=a(15894),N=a(19708),y=a(14585);function C(){let{setExamData:e,setCurrentStep:s,examData:a,softSaveExam:t}=(0,i.U)(),{user:o}=(0,l.A)(),{toast:h}=(0,b.dj)(),[g,C]=(0,n.useState)(!1),w=(null==a?void 0:a.manager)||((null==o?void 0:o.email)?function(e){if(!e)return"";try{return e.substring(0,e.lastIndexOf("@")).split(/[._-]/).map(e=>e.charAt(0).toUpperCase()+e.slice(1).toLowerCase()).join(" ")}catch(e){return console.error("Error extracting name from email:",e),""}}(o.email):""),E=(0,c.mN)({resolver:(0,d.u)(j),defaultValues:{ne:(null==a?void 0:a.ne)||"",reference:(null==a?void 0:a.reference)||"",consignee:(null==a?void 0:a.consignee)||"",manager:w||"",location:(null==a?void 0:a.location)||""}});async function A(r){C(!0);let n=r.ne.toUpperCase().trim();if(!(null==a?void 0:a.ne)){let e=(0,N.H9)(y.db,"examenesPrevios",n);if((await (0,N.x7)(e)).exists()){h({title:"NE Duplicado",description:"El examen NE: ".concat(n," ya existe. Si desea continuarlo, use la funci\xf3n de recuperar."),variant:"destructive"}),C(!1);return}}let l={...r,ne:n};e(l);try{await t(l,[]),h({title:"Informaci\xf3n Guardada",description:"La informaci\xf3n inicial del examen ha sido guardada. Ahora puede a\xf1adir productos."}),s(i.I.PRODUCT_LIST)}catch(e){h({title:"Error al Guardar",description:"No se pudo guardar la informaci\xf3n inicial. Por favor, int\xe9ntelo de nuevo.",variant:"destructive"}),console.error("Failed to soft save initial info:",e)}finally{C(!1)}}return(0,r.jsxs)(p.Zp,{className:"w-full max-w-3xl mx-auto custom-shadow",children:[(0,r.jsx)(p.aR,{children:(0,r.jsx)(p.ZB,{className:"text-2xl font-semibold text-gray-800",children:(null==a?void 0:a.ne)?"Continuando Examen: ".concat(a.ne):"Nuevo Examen"})}),(0,r.jsx)(p.Wu,{children:(0,r.jsx)(x.lV,{...E,children:(0,r.jsxs)("form",{onSubmit:E.handleSubmit(A),className:"space-y-6",children:[(0,r.jsxs)("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-6",children:[(0,r.jsx)(x.zB,{control:E.control,name:"ne",render:e=>{var s;let{field:n}=e;return(0,r.jsxs)(x.eI,{children:[(0,r.jsx)(x.lR,{children:"NE (Seguimiento NX1) *"}),(0,r.jsx)(x.MJ,{children:(0,r.jsx)(m.p,{placeholder:"Ej: NX1-12345",...n,value:null!=(s=n.value)?s:"",disabled:!!(null==a?void 0:a.ne)})}),(0,r.jsx)(x.C5,{})]})}}),(0,r.jsx)(x.zB,{control:E.control,name:"reference",render:e=>{var s;let{field:a}=e;return(0,r.jsxs)(x.eI,{children:[(0,r.jsx)(x.lR,{children:"Referencia (Contenedor, Gu\xeda, BL, Factura...)"}),(0,r.jsx)(x.MJ,{children:(0,r.jsx)(m.p,{placeholder:"Ej: MSKU1234567",...a,value:null!=(s=a.value)?s:""})}),(0,r.jsx)(x.C5,{})]})}}),(0,r.jsx)(x.zB,{control:E.control,name:"consignee",render:e=>{var s;let{field:a}=e;return(0,r.jsxs)(x.eI,{children:[(0,r.jsx)(x.lR,{children:"Consignatario *"}),(0,r.jsx)(x.MJ,{children:(0,r.jsx)(m.p,{placeholder:"Nombre del consignatario",...a,value:null!=(s=a.value)?s:""})}),(0,r.jsx)(x.C5,{})]})}}),(0,r.jsx)(x.zB,{control:E.control,name:"manager",render:e=>{var s;let{field:a}=e;return(0,r.jsxs)(x.eI,{children:[(0,r.jsx)(x.lR,{children:"Nombre del Gestor *"}),(0,r.jsx)(x.MJ,{children:(0,r.jsx)(m.p,{placeholder:"Nombre completo del gestor",...a,value:null!=(s=a.value)?s:""})}),(0,r.jsx)(x.C5,{})]})}}),(0,r.jsx)(x.zB,{control:E.control,name:"location",render:e=>{var s;let{field:a}=e;return(0,r.jsxs)(x.eI,{children:[(0,r.jsx)(x.lR,{children:"Ubicaci\xf3n de la Mercanc\xeda *"}),(0,r.jsx)(x.MJ,{children:(0,r.jsx)(m.p,{placeholder:"Ej: Almac\xe9n Central, Bodega 5",...a,value:null!=(s=a.value)?s:""})}),(0,r.jsx)(x.C5,{})]})}})]}),(0,r.jsxs)("div",{className:"flex justify-between items-center pt-2",children:[(0,r.jsxs)(u.$,{type:"button",variant:"ghost",onClick:()=>s(i.I.WELCOME),children:[(0,r.jsx)(f.A,{className:"mr-2 h-4 w-4"})," Volver"]}),(0,r.jsxs)(u.$,{type:"submit",className:"btn-primary px-6 py-3",disabled:g,children:[g&&(0,r.jsx)(v.A,{className:"mr-2 h-4 w-4 animate-spin"}),g?"Guardando...":"Guardar y Continuar"]})]})]})})})]})}var w=a(87270),E=a(11647),A=a(20146),k=a(36654),I=a(44749),S=a(13630),z=a(6259),P=a(73457),R=a(98053);function D(){let{products:e,openAddProductModal:s,deleteProduct:a,openProductDetailModal:n,selectedProducts:t,toggleProductSelection:l,toggleSelectAllProducts:o}=(0,i.U)();if(0===e.length)return(0,r.jsx)("div",{className:"text-center py-8 text-gray-500",children:'No hay productos a\xf1adidos. Haga clic en "A\xf1adir Nuevo" para comenzar.'});let c=e.length>0&&t.length===e.length;return(0,r.jsx)("div",{className:"overflow-x-auto table-container rounded-lg border",children:(0,r.jsxs)(w.XI,{children:[(0,r.jsx)(w.A0,{className:"bg-gray-50",children:(0,r.jsxs)(w.Hj,{children:[(0,r.jsx)(w.nd,{className:"px-4 py-3",children:(0,r.jsx)(P.S,{checked:c,onCheckedChange:o,"aria-label":"Seleccionar todo"})}),(0,r.jsx)(w.nd,{className:"px-4 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"No. BULTOS"}),(0,r.jsx)(w.nd,{className:"px-4 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Item"}),(0,r.jsx)(w.nd,{className:"px-4 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Descripci\xf3n"}),(0,r.jsx)(w.nd,{className:"px-4 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Marca"}),(0,r.jsx)(w.nd,{className:"px-4 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Cantidad"}),(0,r.jsx)(w.nd,{className:"px-4 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider min-w-[150px]",children:"Estado"}),(0,r.jsx)(w.nd,{className:"px-4 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Acciones"})]})}),(0,r.jsx)(w.BF,{className:"bg-white divide-y divide-gray-200",children:e.map(e=>(0,r.jsxs)(w.Hj,{className:(e=>{let s=0;if(e.isConform&&s++,e.isExcess&&s++,e.isMissing&&s++,e.isFault&&s++,s>1)return"hover:bg-muted/50";if(1===s){if(e.isExcess)return"bg-red-50 hover:bg-red-100";if(e.isConform)return"bg-green-50 hover:bg-green-100";if(e.isMissing)return"bg-yellow-50 hover:bg-yellow-100";if(e.isFault)return"bg-gray-50 hover:bg-gray-100"}return"hover:bg-muted/50"})(e),"data-state":t.includes(e.id)?"selected":void 0,children:[(0,r.jsx)(w.nA,{className:"px-4 py-3",children:(0,r.jsx)(P.S,{checked:t.includes(e.id),onCheckedChange:()=>l(e.id),"aria-label":"Seleccionar producto ".concat(e.itemNumber||e.description)})}),(0,r.jsx)(w.nA,{className:"px-4 py-3 whitespace-nowrap text-sm text-gray-500",children:e.numberPackages||"N/A"}),(0,r.jsx)(w.nA,{className:"px-4 py-3 whitespace-nowrap text-sm font-medium text-gray-900",children:e.itemNumber||"N/A"}),(0,r.jsx)(w.nA,{className:"px-4 py-3 text-sm text-gray-500 max-w-xs truncate",children:e.description||"N/A"}),(0,r.jsx)(w.nA,{className:"px-4 py-3 text-sm text-gray-500",children:e.brand||"N/A"}),(0,r.jsx)(w.nA,{className:"px-4 py-3 text-sm text-gray-500",children:"".concat(e.quantityUnits||0," unid. / ").concat(e.quantityPackages||0," bultos")}),(0,r.jsx)(w.nA,{className:"px-4 py-3 text-sm text-gray-500",children:(e=>{let s=[];return(e.isConform&&s.push((0,r.jsx)(E.E,{variant:"default",className:"bg-green-100 text-green-800 whitespace-nowrap",children:"Conforme"},"conform")),e.isExcess&&s.push((0,r.jsx)(E.E,{variant:"destructive",className:"bg-red-100 text-red-800 whitespace-nowrap",children:"Excedente"},"excess")),e.isMissing&&s.push((0,r.jsx)(E.E,{variant:"secondary",className:"bg-yellow-100 text-yellow-800 whitespace-nowrap",children:"Faltante"},"missing")),e.isFault&&s.push((0,r.jsx)(E.E,{variant:"outline",className:"bg-gray-100 text-gray-800 whitespace-nowrap",children:"Aver\xeda"},"fault")),0===s.length)?(0,r.jsx)(E.E,{variant:"outline",children:"Sin Estado"}):(0,r.jsx)("div",{className:"flex flex-wrap gap-1",children:s})})(e)}),(0,r.jsx)(w.nA,{className:"px-4 py-3 whitespace-nowrap text-sm font-medium",children:(0,r.jsxs)(z.rI,{children:[(0,r.jsx)(z.ty,{asChild:!0,children:(0,r.jsxs)(u.$,{variant:"ghost",className:"h-8 w-8 p-0",children:[(0,r.jsx)("span",{className:"sr-only",children:"Abrir men\xfa"}),(0,r.jsx)(A.A,{className:"h-4 w-4"})]})}),(0,r.jsxs)(z.SQ,{align:"end",children:[(0,r.jsxs)(z._2,{onClick:()=>n(e),children:[(0,r.jsx)(k.A,{className:"mr-2 h-4 w-4"})," Ver"]}),(0,r.jsxs)(z._2,{onClick:()=>s(e),children:[(0,r.jsx)(I.A,{className:"mr-2 h-4 w-4"})," Editar"]}),(0,r.jsxs)(R.Lt,{children:[(0,r.jsx)(R.tv,{asChild:!0,children:(0,r.jsxs)("button",{className:"relative flex cursor-default select-none items-center rounded-sm px-2 py-1.5 text-sm outline-none transition-colors focus:bg-accent focus:text-accent-foreground data-[disabled]:pointer-events-none data-[disabled]:opacity-50 w-full text-destructive focus:bg-destructive/10",children:[(0,r.jsx)(S.A,{className:"mr-2 h-4 w-4"})," Eliminar"]})}),(0,r.jsxs)(R.EO,{children:[(0,r.jsxs)(R.wd,{children:[(0,r.jsx)(R.r7,{children:"\xbfEst\xe1 seguro de eliminar este producto?"}),(0,r.jsx)(R.$v,{children:"Esta acci\xf3n no se puede deshacer."})]}),(0,r.jsxs)(R.ck,{children:[(0,r.jsx)(R.Zr,{children:"Cancelar"}),(0,r.jsx)(R.Rx,{onClick:()=>a(e.id),children:"S\xed, eliminar"})]})]})]})]})]})})]},e.id))})]})})}var M=a(31120),U=a(51834),B=a(17037),q=a(64269);let T=e=>{let{label:s,id:a,checked:n,onChange:t,name:l,value:i,disabled:o,labelClassName:c,containerClassName:d,...u}=e,m=a||"custom-checkbox-".concat(l,"-").concat(i||Math.random().toString(36).substring(7));return(0,r.jsxs)("label",{htmlFor:m,className:(0,q.cn)("custom-checkbox-label",d),children:[(0,r.jsx)("input",{type:"checkbox",id:m,name:l,checked:n,onChange:t,value:i,disabled:o,className:"custom-checkbox-input",...u}),(0,r.jsx)("span",{className:"custom-checkbox-checkmark"}),(0,r.jsx)("span",{className:(0,q.cn)("text-sm text-foreground ml-2",c),children:s})]})};var F=a(26615),O=a(44381),_=a(92129),L=a(5225),G=a(21255),$=a(27237),J=a(86067),V=a(39075),W=a(55666),H=a(22823),Z=a(91719),X=a(12158),K=a(19201),Q=a(27500);let Y=()=>(0,r.jsx)("span",{className:"text-destructive ml-1",children:"*"});function ee(){let{isAddProductModalOpen:e,closeAddProductModal:s,addProduct:a,updateProduct:t,editingProduct:l}=(0,i.U)(),o=(0,c.mN)({resolver:(0,d.u)(g),defaultValues:{itemNumber:"",weight:"",description:"",brand:"",model:"",unitMeasure:"",serial:"",origin:"",numberPackages:"",quantityPackages:void 0,quantityUnits:void 0,packagingCondition:"",observation:"",isConform:!1,isExcess:!1,isMissing:!1,isFault:!1}});return((0,n.useEffect)(()=>{if(e)if(l){var s,a,r,n,t,i,c,d,u,m,x;o.reset({id:l.id,itemNumber:null!=(s=l.itemNumber)?s:"",weight:null!=(a=l.weight)?a:"",description:null!=(r=l.description)?r:"",brand:null!=(n=l.brand)?n:"",model:null!=(t=l.model)?t:"",unitMeasure:null!=(i=l.unitMeasure)?i:"",serial:null!=(c=l.serial)?c:"",origin:null!=(d=l.origin)?d:"",numberPackages:null!=(u=l.numberPackages)?u:"",quantityPackages:void 0!==l.quantityPackages?Number(l.quantityPackages):void 0,quantityUnits:void 0!==l.quantityUnits?Number(l.quantityUnits):void 0,packagingCondition:null!=(m=l.packagingCondition)?m:"",observation:null!=(x=l.observation)?x:"",isConform:l.isConform,isExcess:l.isExcess,isMissing:l.isMissing,isFault:l.isFault,productTimestampSaveAt:l.productTimestampSaveAt})}else o.reset({itemNumber:"",weight:"",description:"",brand:"",model:"",unitMeasure:"",serial:"",origin:"",numberPackages:"",quantityPackages:void 0,quantityUnits:void 0,packagingCondition:"",observation:"",isConform:!1,isExcess:!1,isMissing:!1,isFault:!1})},[l,o,e]),e)?(0,r.jsx)(U.lG,{open:e,onOpenChange:e=>!e&&s(),children:(0,r.jsx)(U.Cf,{className:"max-w-3xl w-full p-0",children:(0,r.jsx)(B.F,{className:"max-h-[85vh]",children:(0,r.jsxs)("div",{className:"p-6",children:[(0,r.jsxs)(U.c7,{className:"mb-4",children:[(0,r.jsx)(U.L3,{className:"text-xl font-semibold text-foreground",children:l?"Editar Producto":"A\xf1adir Producto"}),(0,r.jsx)("button",{onClick:s,className:"absolute right-4 top-4 rounded-sm opacity-70 ring-offset-background transition-opacity hover:opacity-100 focus:outline-none focus:ring-2 focus:ring-ring focus:ring-offset-2 disabled:pointer-events-none data-[state=open]:bg-accent data-[state=open]:text-muted-foreground","aria-label":"Cerrar",children:(0,r.jsx)(F.A,{className:"h-6 w-6 text-muted-foreground"})})]}),(0,r.jsx)(x.lV,{...o,children:(0,r.jsxs)("form",{onSubmit:o.handleSubmit(function(e){let r={...e,quantityPackages:void 0!==e.quantityPackages?Number(e.quantityPackages):void 0,quantityUnits:void 0!==e.quantityUnits?Number(e.quantityUnits):void 0};l&&l.id?t({...r,id:l.id,productTimestampSaveAt:l.productTimestampSaveAt}):a(r),s()}),className:"space-y-4",children:[(0,r.jsxs)("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[(0,r.jsx)(x.zB,{control:o.control,name:"itemNumber",render:e=>{var s;let{field:a}=e;return(0,r.jsxs)(x.eI,{children:[(0,r.jsxs)(x.lR,{className:"flex items-center",children:[(0,r.jsx)(O.A,{className:"mr-2 h-4 w-4 text-primary"}),"N\xfamero de Item"]}),(0,r.jsx)(x.MJ,{children:(0,r.jsx)(m.p,{...a,value:null!=(s=a.value)?s:""})}),(0,r.jsx)(x.C5,{})]})}}),(0,r.jsx)(x.zB,{control:o.control,name:"weight",render:e=>{var s;let{field:a}=e;return(0,r.jsxs)(x.eI,{children:[(0,r.jsxs)(x.lR,{className:"flex items-center",children:[(0,r.jsx)(_.A,{className:"mr-2 h-4 w-4 text-primary"}),"Peso"]}),(0,r.jsx)(x.MJ,{children:(0,r.jsx)(m.p,{...a,value:null!=(s=a.value)?s:""})}),(0,r.jsx)(x.C5,{})]})}}),(0,r.jsx)("div",{className:"md:col-span-2",children:(0,r.jsx)(x.zB,{control:o.control,name:"description",render:e=>{var s;let{field:a}=e;return(0,r.jsxs)(x.eI,{children:[(0,r.jsxs)(x.lR,{className:"flex items-center",children:[(0,r.jsx)(L.A,{className:"mr-2 h-4 w-4 text-primary"}),"Descripci\xf3n",(0,r.jsx)(Y,{})]}),(0,r.jsx)(x.MJ,{children:(0,r.jsx)(M.T,{rows:2,...a,value:null!=(s=a.value)?s:""})}),(0,r.jsx)(x.C5,{})]})}})}),(0,r.jsx)(x.zB,{control:o.control,name:"brand",render:e=>{var s;let{field:a}=e;return(0,r.jsxs)(x.eI,{children:[(0,r.jsxs)(x.lR,{className:"flex items-center",children:[(0,r.jsx)(G.A,{className:"mr-2 h-4 w-4 text-primary"}),"Marca"]}),(0,r.jsx)(x.MJ,{children:(0,r.jsx)(m.p,{...a,value:null!=(s=a.value)?s:""})}),(0,r.jsx)(x.C5,{})]})}}),(0,r.jsx)(x.zB,{control:o.control,name:"model",render:e=>{var s;let{field:a}=e;return(0,r.jsxs)(x.eI,{children:[(0,r.jsxs)(x.lR,{className:"flex items-center",children:[(0,r.jsx)($.A,{className:"mr-2 h-4 w-4 text-primary"}),"Modelo"]}),(0,r.jsx)(x.MJ,{children:(0,r.jsx)(m.p,{...a,value:null!=(s=a.value)?s:""})}),(0,r.jsx)(x.C5,{})]})}}),(0,r.jsx)(x.zB,{control:o.control,name:"unitMeasure",render:e=>{var s;let{field:a}=e;return(0,r.jsxs)(x.eI,{children:[(0,r.jsxs)(x.lR,{className:"flex items-center",children:[(0,r.jsx)(J.A,{className:"mr-2 h-4 w-4 text-primary"}),"Unidad de Medida"]}),(0,r.jsx)(x.MJ,{children:(0,r.jsx)(m.p,{...a,value:null!=(s=a.value)?s:""})}),(0,r.jsx)(x.C5,{})]})}}),(0,r.jsx)(x.zB,{control:o.control,name:"serial",render:e=>{var s;let{field:a}=e;return(0,r.jsxs)(x.eI,{children:[(0,r.jsxs)(x.lR,{className:"flex items-center",children:[(0,r.jsx)(V.A,{className:"mr-2 h-4 w-4 text-primary"}),"Serie"]}),(0,r.jsx)(x.MJ,{children:(0,r.jsx)(m.p,{...a,value:null!=(s=a.value)?s:""})}),(0,r.jsx)(x.C5,{})]})}}),(0,r.jsx)(x.zB,{control:o.control,name:"origin",render:e=>{var s;let{field:a}=e;return(0,r.jsxs)(x.eI,{children:[(0,r.jsxs)(x.lR,{className:"flex items-center",children:[(0,r.jsx)(W.A,{className:"mr-2 h-4 w-4 text-primary"}),"Origen"]}),(0,r.jsx)(x.MJ,{children:(0,r.jsx)(m.p,{...a,value:null!=(s=a.value)?s:""})}),(0,r.jsx)(x.C5,{})]})}}),(0,r.jsx)(x.zB,{control:o.control,name:"numberPackages",render:e=>{var s;let{field:a}=e;return(0,r.jsxs)(x.eI,{children:[(0,r.jsxs)(x.lR,{className:"flex items-center",children:[(0,r.jsx)(H.A,{className:"mr-2 h-4 w-4 text-primary"}),"Numeraci\xf3n de Bultos",(0,r.jsx)(Y,{})]}),(0,r.jsx)(x.MJ,{children:(0,r.jsx)(m.p,{...a,value:null!=(s=a.value)?s:""})}),(0,r.jsx)(x.C5,{})]})}}),(0,r.jsx)(x.zB,{control:o.control,name:"quantityPackages",render:e=>{var s;let{field:a}=e;return(0,r.jsxs)(x.eI,{children:[(0,r.jsxs)(x.lR,{className:"flex items-center",children:[(0,r.jsx)(Z.A,{className:"mr-2 h-4 w-4 text-primary"}),"Cantidad de Bultos",(0,r.jsx)(Y,{})]}),(0,r.jsx)(x.MJ,{children:(0,r.jsx)(m.p,{type:"number",min:"0",...a,onChange:e=>a.onChange(""===e.target.value?void 0:+e.target.value),value:null!=(s=a.value)?s:""})}),(0,r.jsx)(x.C5,{})]})}}),(0,r.jsx)(x.zB,{control:o.control,name:"quantityUnits",render:e=>{var s;let{field:a}=e;return(0,r.jsxs)(x.eI,{children:[(0,r.jsxs)(x.lR,{className:"flex items-center",children:[(0,r.jsx)(X.A,{className:"mr-2 h-4 w-4 text-primary"}),"Cantidad de Unidades",(0,r.jsx)(Y,{})]}),(0,r.jsx)(x.MJ,{children:(0,r.jsx)(m.p,{type:"number",min:"0",...a,onChange:e=>a.onChange(""===e.target.value?void 0:+e.target.value),value:null!=(s=a.value)?s:""})}),(0,r.jsx)(x.C5,{})]})}}),(0,r.jsx)(x.zB,{control:o.control,name:"packagingCondition",render:e=>{var s;let{field:a}=e;return(0,r.jsxs)(x.eI,{children:[(0,r.jsxs)(x.lR,{className:"flex items-center",children:[(0,r.jsx)(K.A,{className:"mr-2 h-4 w-4 text-primary"}),"Estado de Mercanc\xeda (Nueva, Usada, Otros)"]}),(0,r.jsx)(x.MJ,{children:(0,r.jsx)(m.p,{...a,value:null!=(s=a.value)?s:""})}),(0,r.jsx)(x.C5,{})]})}}),(0,r.jsx)("div",{className:"md:col-span-2",children:(0,r.jsx)(x.zB,{control:o.control,name:"observation",render:e=>{var s;let{field:a}=e;return(0,r.jsxs)(x.eI,{children:[(0,r.jsxs)(x.lR,{className:"flex items-center",children:[(0,r.jsx)(Q.A,{className:"mr-2 h-4 w-4 text-primary"}),"Observaci\xf3n"]}),(0,r.jsx)(x.MJ,{children:(0,r.jsx)(M.T,{rows:2,...a,value:null!=(s=a.value)?s:""})}),(0,r.jsx)(x.C5,{})]})}})})]}),(0,r.jsxs)("div",{className:"flex flex-col sm:flex-row flex-wrap gap-x-6 gap-y-3 mt-4",children:[(0,r.jsx)(c.xI,{control:o.control,name:"isConform",render:e=>{let{field:s}=e;return(0,r.jsx)(T,{label:"Conforme a factura",checked:s.value,onChange:s.onChange,name:s.name})}}),(0,r.jsx)(c.xI,{control:o.control,name:"isExcess",render:e=>{let{field:s}=e;return(0,r.jsx)(T,{label:"Notificar excedente",checked:s.value,onChange:s.onChange,name:s.name})}}),(0,r.jsx)(c.xI,{control:o.control,name:"isMissing",render:e=>{let{field:s}=e;return(0,r.jsx)(T,{label:"Notificar faltante",checked:s.value,onChange:s.onChange,name:s.name})}}),(0,r.jsx)(c.xI,{control:o.control,name:"isFault",render:e=>{let{field:s}=e;return(0,r.jsx)(T,{label:"Notificar Aver\xeda",checked:s.value,onChange:s.onChange,name:s.name})}})]}),(0,r.jsxs)(U.Es,{className:"pt-4 gap-3",children:[(0,r.jsx)(u.$,{type:"button",variant:"outline",onClick:s,children:"Cancelar"}),(0,r.jsx)(u.$,{type:"submit",className:"btn-primary",children:l?"Guardar Cambios":"Guardar Producto"})]})]})})]})})})}):null}var es=a(58772),ea=a(22452),er=a(18527),en=a(75004);function et(){let{productToView:e,isProductDetailModalOpen:s,closeProductDetailModal:a}=(0,i.U)();if(!s||!e)return null;let n=e=>{let{label:s,value:a,icon:n}=e;return(0,r.jsxs)("div",{children:[(0,r.jsxs)("div",{className:"flex items-center text-sm font-medium text-muted-foreground",children:[n&&(0,r.jsx)("span",{className:"mr-2",children:n}),s]}),(0,r.jsx)("p",{className:"text-base text-foreground pl-6",children:String(null!=a?a:"N/A")})]})};return(0,r.jsx)(U.lG,{open:s,onOpenChange:e=>!e&&a(),children:(0,r.jsx)(U.Cf,{className:"max-w-2xl w-full p-0",children:(0,r.jsx)(B.F,{className:"max-h-[85vh]",children:(0,r.jsxs)("div",{className:"p-6",children:[(0,r.jsxs)(U.c7,{className:"mb-4",children:[(0,r.jsx)(U.L3,{className:"text-lg md:text-xl font-semibold text-gray-800",children:"Detalles del Producto"}),(0,r.jsx)("button",{onClick:a,className:"absolute right-4 top-4 rounded-sm opacity-70 ring-offset-background transition-opacity hover:opacity-100 focus:outline-none focus:ring-2 focus:ring-ring focus:ring-offset-2 disabled:pointer-events-none data-[state=open]:bg-accent data-[state=open]:text-muted-foreground","aria-label":"Cerrar",children:(0,r.jsx)(F.A,{className:"h-6 w-6"})})]}),(0,r.jsx)("div",{className:"space-y-4",children:(0,r.jsxs)("div",{className:"grid grid-cols-1 sm:grid-cols-2 gap-x-6 gap-y-4",children:[(0,r.jsx)(n,{label:"N\xfamero de Item",value:e.itemNumber,icon:(0,r.jsx)(O.A,{size:16})}),(0,r.jsx)(n,{label:"Peso",value:e.weight,icon:(0,r.jsx)(_.A,{size:16})}),(0,r.jsx)(n,{label:"Marca",value:e.brand,icon:(0,r.jsx)(G.A,{size:16})}),(0,r.jsx)(n,{label:"Modelo",value:e.model,icon:(0,r.jsx)($.A,{size:16})}),(0,r.jsx)(n,{label:"Unidad de Medida",value:e.unitMeasure,icon:(0,r.jsx)(J.A,{size:16})}),(0,r.jsx)(n,{label:"Serie",value:e.serial,icon:(0,r.jsx)(V.A,{size:16})}),(0,r.jsx)(n,{label:"Origen",value:e.origin,icon:(0,r.jsx)(W.A,{size:16})}),(0,r.jsx)(n,{label:"Numeraci\xf3n de Bultos",value:e.numberPackages,icon:(0,r.jsx)(H.A,{size:16})}),(0,r.jsx)(n,{label:"Cantidad de Bultos",value:e.quantityPackages,icon:(0,r.jsx)(Z.A,{size:16})}),(0,r.jsx)(n,{label:"Cantidad de Unidades",value:e.quantityUnits,icon:(0,r.jsx)(X.A,{size:16})}),(0,r.jsx)(n,{label:"Condici\xf3n Embalaje",value:e.packagingCondition,icon:(0,r.jsx)(K.A,{size:16})}),(0,r.jsx)("div",{className:"sm:col-span-2",children:(0,r.jsx)(n,{label:"Descripci\xf3n",value:e.description,icon:(0,r.jsx)(L.A,{size:16})})}),(0,r.jsx)("div",{className:"sm:col-span-2",children:(0,r.jsx)(n,{label:"Observaci\xf3n",value:e.observation,icon:(0,r.jsx)(Q.A,{size:16})})}),(0,r.jsxs)("div",{className:"sm:col-span-2 pt-2 border-t",children:[(0,r.jsxs)("div",{className:"flex items-center text-sm font-medium text-muted-foreground",children:[(0,r.jsx)(en.A,{size:16,className:"mr-2"}),"Estado General del Producto"]}),(0,r.jsxs)("div",{className:"flex flex-wrap gap-2 mt-1 pl-6",children:[e.isConform&&(0,r.jsx)(E.E,{className:"bg-green-100 text-green-800",children:"Conforme"}),e.isExcess&&(0,r.jsx)(E.E,{className:"bg-red-100 text-red-800",children:"Excedente"}),e.isMissing&&(0,r.jsx)(E.E,{className:"bg-yellow-100 text-yellow-800",children:"Faltante"}),e.isFault&&(0,r.jsx)(E.E,{className:"bg-gray-100 text-gray-800",children:"Aver\xeda"}),!e.isConform&&!e.isExcess&&!e.isMissing&&!e.isFault&&(0,r.jsx)(E.E,{variant:"outline",children:"Sin especificar"})]})]})]})}),(0,r.jsx)(U.Es,{className:"mt-6",children:(0,r.jsx)(u.$,{variant:"outline",onClick:a,children:"Cerrar"})})]})})})})}var el=a(4246),ei=a(11929);function eo(){let{examData:e,setCurrentStep:s,openAddProductModal:a,products:t,addProduct:l,setProducts:o,selectedProducts:c,deleteSelectedProducts:d}=(0,i.U)(),{toast:m}=(0,b.dj)(),x=n.useRef(null);return e?(0,r.jsxs)(p.Zp,{className:"w-full max-w-5xl mx-auto custom-shadow",children:[(0,r.jsx)(p.aR,{children:(0,r.jsxs)("div",{className:"flex flex-col md:flex-row md:justify-between md:items-start gap-4",children:[(0,r.jsxs)("div",{children:[(0,r.jsx)(p.ZB,{className:"text-xl md:text-2xl font-semibold text-gray-800",children:"EXAMEN PREVIO"}),(0,r.jsx)("p",{className:"text-sm text-muted-foreground mt-1",children:"A\xf1ada o importe los productos para el examen."})]}),(0,r.jsxs)("div",{className:"flex flex-col sm:flex-row gap-3",children:[(0,r.jsx)("input",{type:"file",ref:x,onChange:e=>{var s;let a=null==(s=e.target.files)?void 0:s[0];if(!a)return;let r=new FileReader;r.onload=e=>{try{var s;let a=new Uint8Array(null==(s=e.target)?void 0:s.result),r=el.LF(a,{type:"array"}),n=r.SheetNames[0],l=r.Sheets[n],i=el.Wp.sheet_to_json(l),c={Item:"itemNumber",Peso:"weight",Descripcion:"description",Marca:"brand",Modelo:"model","Unidad Medida":"unitMeasure",Serie:"serial",Origen:"origin","Numeracion Bultos":"numberPackages","Cantidad Bultos":"quantityPackages","Cantidad Unidades":"quantityUnits","Condicion Embalaje":"packagingCondition",Observacion:"observation",Conforme:"isConform",Excedente:"isExcess",Faltante:"isMissing",Averia:"isFault"},d=i.map((e,s)=>{let a={id:(0,ei.A)(),productTimestampSaveAt:N.Dc.now()};for(let s in c)if(void 0!==e[s]){let r=c[s],n=e[s];["isConform","isExcess","isMissing","isFault"].includes(r)&&(n="si"===String(n).trim().toLowerCase()),a[r]=n}if(!a.description||!a.numberPackages||void 0===a.quantityPackages||void 0===a.quantityUnits)throw Error("Fila ".concat(s+2,": Faltan datos requeridos (Descripci\xf3n, Numeraci\xf3n de Bultos, Cantidades)."));return a});o([...t,...d]),m({title:"Importaci\xf3n Exitosa",description:"".concat(d.length," productos han sido a\xf1adidos a la lista.")})}catch(e){console.error("Error al importar el archivo: ",e),m({title:"Error de Importaci\xf3n",description:e.message||"Hubo un problema al leer el archivo Excel. Aseg\xfarese de que el formato y los encabezados son correctos.",variant:"destructive"})}finally{x.current&&(x.current.value="")}},r.readAsArrayBuffer(a)},className:"hidden",accept:".xlsx, .xls"}),(0,r.jsxs)(u.$,{onClick:()=>{var e;return null==(e=x.current)?void 0:e.click()},variant:"outline",children:[(0,r.jsx)(es.A,{className:"mr-2 h-5 w-5"})," Importar desde Excel"]}),(0,r.jsxs)(u.$,{onClick:()=>a(),className:"btn-primary",children:[(0,r.jsx)(ea.A,{className:"mr-2 h-5 w-5"})," A\xf1adir Nuevo Producto"]})]})]})}),(0,r.jsxs)(p.Wu,{children:[(0,r.jsxs)("div",{className:"mb-6 p-4 bg-blue-50 border border-blue-200 rounded-md shadow",children:[(0,r.jsxs)("div",{className:"grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-3 gap-3 text-sm",children:[(0,r.jsxs)("div",{children:[(0,r.jsx)("span",{className:"font-semibold",children:"NE:"})," ",e.ne]}),(0,r.jsxs)("div",{children:[(0,r.jsx)("span",{className:"font-semibold",children:"Referencia:"})," ",e.reference||"N/A"]}),(0,r.jsxs)("div",{children:[(0,r.jsx)("span",{className:"font-semibold",children:"Consignatario:"})," ",e.consignee]}),(0,r.jsxs)("div",{children:[(0,r.jsx)("span",{className:"font-semibold",children:"Gestor:"})," ",e.manager]}),(0,r.jsxs)("div",{children:[(0,r.jsx)("span",{className:"font-semibold",children:"Ubicaci\xf3n:"})," ",e.location]})]}),(0,r.jsx)("div",{className:"mt-3",children:(0,r.jsxs)(u.$,{variant:"link",onClick:()=>s(i.I.INITIAL_INFO),className:"text-primary p-0 h-auto",children:[(0,r.jsx)(f.A,{className:"mr-1 h-4 w-4"})," Regresar para modificar"]})})]}),(0,r.jsxs)("div",{className:"flex justify-between items-center mb-4",children:[(0,r.jsxs)("div",{className:"flex items-center gap-4",children:[(0,r.jsxs)("h3",{className:"text-lg font-medium",children:["Productos A\xf1adidos: ",t.length]}),c.length>0&&(0,r.jsxs)(R.Lt,{children:[(0,r.jsx)(R.tv,{asChild:!0,children:(0,r.jsxs)(u.$,{variant:"destructive",size:"sm",children:[(0,r.jsx)(S.A,{className:"mr-2 h-4 w-4"})," Eliminar (",c.length,")"]})}),(0,r.jsxs)(R.EO,{children:[(0,r.jsxs)(R.wd,{children:[(0,r.jsx)(R.r7,{children:"\xbfEst\xe1 seguro de eliminar los productos seleccionados?"}),(0,r.jsxs)(R.$v,{children:["Esta acci\xf3n no se puede deshacer. Se eliminar\xe1n ",c.length," productos de la lista."]})]}),(0,r.jsxs)(R.ck,{children:[(0,r.jsx)(R.Zr,{children:"Cancelar"}),(0,r.jsx)(R.Rx,{onClick:d,children:"S\xed, eliminar"})]})]})]})]}),(0,r.jsxs)(u.$,{onClick:()=>{if(0===t.length)return void m({title:"No hay productos",description:"Debe agregar al menos un producto antes de finalizar.",variant:"destructive"});s(i.I.PREVIEW)},className:"btn-secondary",children:[(0,r.jsx)(er.A,{className:"mr-2 h-5 w-5"})," Finalizar y Previsualizar"]})]}),(0,r.jsx)(D,{})]}),(0,r.jsx)(ee,{}),(0,r.jsx)(et,{})]}):(0,r.jsxs)("div",{className:"text-center py-10",children:[(0,r.jsx)("p",{children:"Error: Datos del examen no encontrados."}),(0,r.jsx)(u.$,{onClick:()=>s(i.I.WELCOME),children:"Volver al inicio"})]})}var ec=a(77059),ed=a(53489),eu=a(72251);let em=e=>{let s,{label:a,value:n,icon:t}=e;return s="boolean"==typeof n?n?"S\xed":"No":String(null!=n?n:"N/A"),(0,r.jsxs)("div",{children:[(0,r.jsxs)("div",{className:"flex items-center",children:[t&&(0,r.jsx)("span",{className:"mr-2 text-primary",children:t}),(0,r.jsx)("p",{className:"text-xs font-medium text-gray-500",children:a})]}),(0,r.jsx)("p",{className:"text-sm text-foreground ml-6",children:s})]})};function ex(){let{examData:e,products:s,setCurrentStep:a}=(0,i.U)();return e?(0,r.jsxs)(p.Zp,{className:"w-full max-w-5xl mx-auto custom-shadow",children:[(0,r.jsxs)(p.aR,{children:[(0,r.jsx)(p.ZB,{className:"text-xl md:text-2xl font-semibold text-foreground",children:"Vista Previa del Examen"}),(0,r.jsx)(p.BT,{className:"text-muted-foreground",children:"Revise la informaci\xf3n antes de confirmar."})]}),(0,r.jsxs)(p.Wu,{className:"space-y-6",children:[(0,r.jsxs)("div",{children:[(0,r.jsx)("h4",{className:"text-lg font-medium mb-2 text-foreground",children:"Informaci\xf3n General"}),(0,r.jsxs)("div",{className:"grid grid-cols-1 sm:grid-cols-2 gap-x-6 gap-y-2 bg-secondary/30 p-4 rounded-md shadow-sm text-sm",children:[(0,r.jsxs)("div",{children:[(0,r.jsx)("span",{className:"font-semibold text-foreground/80",children:"NE:"})," ",e.ne]}),(0,r.jsxs)("div",{children:[(0,r.jsx)("span",{className:"font-semibold text-foreground/80",children:"Referencia:"})," ",e.reference||"N/A"]}),(0,r.jsxs)("div",{children:[(0,r.jsx)("span",{className:"font-semibold text-foreground/80",children:"Consignatario:"})," ",e.consignee]}),(0,r.jsxs)("div",{children:[(0,r.jsx)("span",{className:"font-semibold text-foreground/80",children:"Gestor:"})," ",e.manager]}),(0,r.jsxs)("div",{children:[(0,r.jsx)("span",{className:"font-semibold text-foreground/80",children:"Ubicaci\xf3n:"})," ",e.location]})]})]}),(0,r.jsxs)("div",{children:[(0,r.jsxs)("h4",{className:"text-lg font-medium mb-3 text-foreground",children:["Productos (",s.length,")"]}),s.length>0?(0,r.jsx)("div",{className:"space-y-6",children:s.map((e,s)=>(0,r.jsxs)("div",{className:"p-4 border border-border bg-card rounded-lg shadow",children:[(0,r.jsxs)("h5",{className:"text-md font-semibold mb-3 text-primary",children:["Producto ",s+1,e.itemNumber&&(0,r.jsxs)("span",{className:"text-sm font-normal text-muted-foreground",children:[" (Item: ",e.itemNumber,")"]})]}),(0,r.jsxs)("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-x-6 gap-y-4",children:[(0,r.jsx)(em,{label:"N\xfamero de Item",value:e.itemNumber,icon:(0,r.jsx)(O.A,{size:16})}),(0,r.jsx)(em,{label:"Peso",value:e.weight,icon:(0,r.jsx)(_.A,{size:16})}),(0,r.jsx)(em,{label:"Marca",value:e.brand,icon:(0,r.jsx)(G.A,{size:16})}),(0,r.jsx)(em,{label:"Modelo",value:e.model,icon:(0,r.jsx)($.A,{size:16})}),(0,r.jsx)(em,{label:"Unidad de Medida",value:e.unitMeasure,icon:(0,r.jsx)(J.A,{size:16})}),(0,r.jsx)(em,{label:"Serie",value:e.serial,icon:(0,r.jsx)(V.A,{size:16})}),(0,r.jsx)(em,{label:"Origen",value:e.origin,icon:(0,r.jsx)(W.A,{size:16})}),(0,r.jsx)(em,{label:"Numeraci\xf3n de Bultos",value:e.numberPackages,icon:(0,r.jsx)(H.A,{size:16})}),(0,r.jsx)(em,{label:"Cantidad de Bultos",value:e.quantityPackages,icon:(0,r.jsx)(Z.A,{size:16})}),(0,r.jsx)(em,{label:"Cantidad de Unidades",value:e.quantityUnits,icon:(0,r.jsx)(X.A,{size:16})}),(0,r.jsx)(em,{label:"Estado de Mercanc\xeda (Condici\xf3n)",value:e.packagingCondition,icon:(0,r.jsx)(K.A,{size:16})}),(0,r.jsx)("div",{className:"md:col-span-2 lg:col-span-3",children:(0,r.jsx)(em,{label:"Descripci\xf3n",value:e.description,icon:(0,r.jsx)(L.A,{size:16})})}),(0,r.jsx)("div",{className:"md:col-span-2 lg:col-span-3",children:(0,r.jsx)(em,{label:"Observaci\xf3n",value:e.observation,icon:(0,r.jsx)(Q.A,{size:16})})}),(0,r.jsx)("div",{className:"md:col-span-full pt-2 mt-2 border-t border-border",children:(0,r.jsx)(em,{label:"Estado General del Producto",value:(e=>{let s=[];return(e.isConform&&s.push("Conforme a factura"),e.isExcess&&s.push("Excedente"),e.isMissing&&s.push("Faltante"),e.isFault&&s.push("Aver\xeda"),0===s.length)?"Sin estado espec\xedfico":s.join(", ")})(e),icon:(0,r.jsx)(en.A,{size:16})})})]})]},e.id))}):(0,r.jsx)("p",{className:"text-muted-foreground",children:"No hay productos para mostrar."})]}),(0,r.jsxs)("div",{className:"flex flex-col sm:flex-row justify-between items-center gap-4 pt-6 border-t border-border mt-6",children:[(0,r.jsxs)(u.$,{variant:"outline",onClick:()=>a(i.I.PRODUCT_LIST),className:"hover:bg-accent/50",children:[(0,r.jsx)(f.A,{className:"mr-2 h-4 w-4"})," Volver a Productos"]}),(0,r.jsxs)("div",{className:"flex flex-col sm:flex-row gap-3",children:[(0,r.jsxs)(u.$,{variant:"outline",onClick:()=>{e&&(0,ec.j5)(e,s)},className:"hover:bg-accent/50",children:[(0,r.jsx)(ed.A,{className:"mr-2 h-4 w-4"})," Descargar TXT"]}),(0,r.jsxs)(u.$,{variant:"outline",onClick:()=>{e&&(0,ec.qb)({...e,products:s})},className:"hover:bg-accent/50",children:[(0,r.jsx)(ed.A,{className:"mr-2 h-4 w-4"})," Descargar Excel"]}),(0,r.jsxs)(u.$,{onClick:()=>{a(i.I.SUCCESS)},className:"btn-primary",children:[(0,r.jsx)(eu.A,{className:"mr-2 h-4 w-4"})," Confirmar Examen"]})]})]})]})]}):(0,r.jsx)("div",{className:"text-center p-10",children:"Error: No se encontraron datos del examen."})}var ep=a(73180),eh=a(76140),ej=a(8595),eg=a(52619),ef=a.n(eg);function ev(){let{currentStep:e,setCurrentStep:s,resetApp:a,examData:o,products:c}=(0,i.U)(),{user:d}=(0,l.A)(),{toast:m}=(0,b.dj)(),x=(0,t.useRouter)(),[p,h]=(0,n.useState)(!1),j=async()=>{if(!o||!d||!d.email)return void m({title:"Error al guardar",description:"Faltan datos del examen o informaci\xf3n del usuario.",variant:"destructive"});if(!o.ne)return void m({title:"Error al guardar",description:"El n\xfamero NE (Seguimiento NX1) es requerido para guardar.",variant:"destructive"});try{let e=(0,N.H9)(y.db,"examenesPrevios",o.ne.toUpperCase()),s=c.map(e=>{let s={...e};for(let e in s)void 0===s[e]&&(s[e]=null);return s}),a={...o,products:s,savedBy:d.email,status:"complete",lock:"on",lastUpdated:N.Dc.fromDate(new Date),savedAt:N.Dc.fromDate(new Date),completedAt:N.Dc.fromDate(new Date)};await (0,N.BN)(e,a,{merge:!0}),m({title:"Examen Finalizado y Guardado",description:"El examen NE: ".concat(o.ne," ha sido guardado en la base de datos.")}),(0,ec.qb)({...o,products:c}),h(!0)}catch(e){console.error("Error saving document to Firestore: ",e),m({title:"Error al Guardar en BD",description:"No se pudo guardar el examen en la base de datos. ".concat(e.message),variant:"destructive"})}};if(e!==i.I.SUCCESS)return null;let g=(null==o?void 0:o.manager)||"Gestor",f=(null==o?void 0:o.ne)||"N/A";return(0,r.jsxs)(r.Fragment,{children:[(0,r.jsx)(U.lG,{open:e===i.I.SUCCESS&&!p,onOpenChange:()=>{},children:(0,r.jsxs)(U.Cf,{className:"sm:max-w-md",children:[(0,r.jsxs)(U.c7,{className:"items-center text-center",children:[(0,r.jsx)(er.A,{className:"h-16 w-16 text-green-500 mb-4"}),(0,r.jsx)(U.L3,{className:"text-xl font-semibold text-foreground",children:"\xa1Operaci\xf3n Exitosa!"})]}),(0,r.jsx)(U.rr,{asChild:!0,children:(0,r.jsxs)("div",{className:"text-center text-muted-foreground space-y-3",children:[(0,r.jsx)("div",{children:"El examen previo ha sido registrado correctamente."}),(0,r.jsxs)("div",{children:["Se notific\xf3 a: ",(0,r.jsx)("br",{}),(0,r.jsx)("span",{className:"font-medium",children:"gerencia@aconic.com"}),",",(0,r.jsx)("br",{}),(0,r.jsx)("span",{className:"font-medium",children:"asuntos.juridicos@aconic.com"}),",",(0,r.jsx)("br",{}),(0,r.jsx)("span",{className:"font-medium",children:"coordinacion@aconic.com"}),"."]}),(null==o?void 0:o.manager)&&(0,r.jsxs)("div",{children:["Gracias por tu desempe\xf1o, ",o.manager,"."]}),(0,r.jsx)("div",{children:(0,r.jsx)(ef(),{href:"https://aconisani-my.sharepoint.com/:f:/g/personal/asuntos_juridicos_aconic_com_ni/Emrpj4Ss8bhDifpuYc8U_bwBj9r29FGcXxzfxu4PSh2tEQ?e=FhIPTt",target:"_blank",className:"text-primary underline hover:text-primary/80",children:"A\xf1adir im\xe1genes del predio aqu\xed"})})]})}),(0,r.jsxs)("div",{className:"mt-6 flex flex-col space-y-3 items-center",children:[(0,r.jsxs)("div",{className:"flex flex-col sm:flex-row gap-3 w-full",children:[(0,r.jsxs)(u.$,{onClick:j,variant:"default",className:"btn-primary w-full","aria-label":"Finalizar y Guardar en Base de Datos",children:[(0,r.jsx)(ep.A,{className:"h-5 w-5 mr-2"})," Finalizar y Guardar"]}),(0,r.jsxs)(u.$,{onClick:()=>s(i.I.PREVIEW),variant:"outline",className:"w-full",children:[(0,r.jsx)(eh.A,{className:"mr-2 h-4 w-4"})," Revisar Examen"]})]}),(0,r.jsxs)(R.Lt,{children:[(0,r.jsx)(R.tv,{asChild:!0,children:(0,r.jsxs)(u.$,{className:"btn-secondary w-full",children:[(0,r.jsx)(ej.A,{className:"mr-2 h-4 w-4"})," Volver al Inicio"]})}),(0,r.jsxs)(R.EO,{children:[(0,r.jsxs)(R.wd,{children:[(0,r.jsx)(R.r7,{children:"\xbfEst\xe1 seguro?"}),(0,r.jsx)(R.$v,{children:"Est\xe1 a punto de volver al inicio. Se borrar\xe1 toda la informaci\xf3n del examen actual que no haya sido guardada en la base de datos."})]}),(0,r.jsxs)(R.ck,{children:[(0,r.jsx)(R.Zr,{children:"Cancelar"}),(0,r.jsx)(R.Rx,{onClick:()=>{a(),x.push("/")},children:"S\xed, volver al inicio"})]})]})]})]})]})}),(0,r.jsx)(R.Lt,{open:p,onOpenChange:h,children:(0,r.jsxs)(R.EO,{children:[(0,r.jsxs)(R.wd,{children:[(0,r.jsx)(R.r7,{children:"Instrucci\xf3n General 021"}),(0,r.jsxs)(R.$v,{children:["Estimado/a ",g,", la plataforma ha descargado autom\xe1ticamente el Excel del Examen Previo ",(0,r.jsx)("span",{className:"font-bold text-foreground",children:f}),".",(0,r.jsx)("br",{}),(0,r.jsx)("br",{}),"Como nuevo requisito de Gerencia, favor enviar el archivo a trav\xe9s de WhatsApp."]})]}),(0,r.jsxs)(R.ck,{children:[(0,r.jsx)(R.Rx,{onClick:()=>h(!1),children:"Confirmar"}),(0,r.jsx)(u.$,{asChild:!0,className:"bg-green-500 hover:bg-green-600",children:(0,r.jsxs)("a",{href:"https://wa.me/+50583956505",target:"_blank",rel:"noopener noreferrer",children:[(0,r.jsx)(Q.A,{className:"mr-2 h-4 w-4"}),"Enviar por WhatsApp"]})})]})]})})]})}var eb=a(13381),eN=a(90109),ey=a(87455),eC=a(86126),ew=a(5282),eE=a(80160);function eA(){let{setCurrentStep:e,setExamData:s,setProducts:a,resetApp:t}=(0,i.U)(),{user:o}=(0,l.A)(),[c,d]=(0,n.useState)(!1),[x,h]=(0,n.useState)(""),[j,g]=(0,n.useState)(!1),[f,C]=(0,n.useState)(null),[w,E]=(0,n.useState)([]),[A,k]=(0,n.useState)(!0),{toast:I}=(0,b.dj)();(0,n.useEffect)(()=>{(async()=>{if(!(null==o?void 0:o.displayName))return k(!1);k(!0);try{let e=(0,N.P)((0,N.rJ)(y.db,"examenesPrevios"),(0,N._M)("assignedTo","==",o.displayName),(0,N._M)("status","==","incomplete")),s=(await (0,N.GG)(e)).docs.map(e=>({id:e.id,...e.data()}));s.sort((e,s)=>{var a,r,n,t;return(null!=(n=null==(a=e.assignedAt)?void 0:a.toMillis())?n:0)-(null!=(t=null==(r=s.assignedAt)?void 0:r.toMillis())?t:0)}),E(s)}catch(e){console.error("Error fetching assigned exams:",e),I({title:"Error al Cargar Asignaciones",description:"No se pudieron cargar los previos asignados. Verifique las reglas de Firestore.",variant:"destructive"})}finally{k(!1)}})()},[o,I]);let S=async r=>{if(!r.id)return void I({title:"Error",description:"El examen seleccionado no tiene un ID v\xe1lido.",variant:"destructive"});g(!0);try{var n;let t=(0,N.H9)(y.db,"examenesPrevios",r.id);(null==(n=(await (0,N.x7)(t)).data())?void 0:n.createdAt)||await (0,N.mZ)(t,{createdAt:(0,N.O5)()}),s({ne:r.ne,reference:r.reference,consignee:r.consignee,location:r.location,manager:r.manager},!0),a(r.products||[]),I({title:"Examen Iniciado",description:"Comenzando trabajo en el examen ".concat(r.ne,".")}),e(i.I.PRODUCT_LIST)}catch(e){console.error("Error starting assigned exam:",e),I({title:"Error",description:"No se pudo iniciar el examen asignado.",variant:"destructive"})}finally{g(!1)}},z=async()=>{if(!x.trim())return void C("Por favor, ingrese un NE para recuperar.");g(!0),C(null);try{let r=(0,N.H9)(y.db,"examenesPrevios",x.trim().toUpperCase()),n=await (0,N.x7)(r);if(n.exists()){let r=n.data();if("complete"===r.status){let e="Este previo ya se encuentra finalizado y no puede ser modificado.";C(e),I({title:"Recuperaci\xf3n No Permitida",description:e,variant:"destructive"}),g(!1);return}s({ne:r.ne,reference:r.reference,consignee:r.consignee,location:r.location,manager:r.manager},!0),a(r.products||[]),I({title:"Examen Recuperado",description:"Se carg\xf3 el progreso del examen ".concat(r.ne,".")}),e(i.I.PRODUCT_LIST)}else C("No se encontr\xf3 ning\xfan examen para el NE: ".concat(x)),I({title:"Error de Recuperaci\xf3n",description:"No se encontr\xf3 un examen para el NE: ".concat(x),variant:"destructive"})}catch(e){console.error("Error recovering exam:",e),C("Ocurri\xf3 un error al intentar recuperar el examen."),I({title:"Error de Servidor",description:"No se pudo comunicar con la base de datos.",variant:"destructive"})}finally{g(!1)}},P=(null==o?void 0:o.displayName)?o.displayName.split(" ")[0]:"Gestor";return(0,r.jsxs)("div",{className:"w-full max-w-4xl mx-auto space-y-6",children:[(0,r.jsxs)(p.Zp,{className:"custom-shadow",children:[(0,r.jsxs)(p.aR,{className:"text-center",children:[(0,r.jsxs)(p.ZB,{className:"text-2xl font-semibold",children:["Bienvenido, ",P]}),(0,r.jsx)(p.BT,{children:"\xbfQu\xe9 desea hacer hoy?"})]}),(0,r.jsxs)(p.Wu,{className:"space-y-6",children:[(0,r.jsx)("div",{className:"flex flex-col sm:flex-row gap-4 justify-center",children:(0,r.jsxs)(u.$,{onClick:()=>d(!c),size:"lg",variant:"outline",className:"h-20 text-lg",children:[(0,r.jsx)(eb.A,{className:"mr-3 h-6 w-6"}),c?"Ocultar Recuperaci\xf3n":"Continuar/Recuperar Examen"]})}),c&&(0,r.jsxs)("div",{className:"p-4 border rounded-md bg-secondary/30",children:[(0,r.jsx)("h3",{className:"font-semibold text-center mb-3",children:"Recuperar Examen no Finalizado"}),(0,r.jsxs)("div",{className:"flex flex-col sm:flex-row items-center gap-3",children:[(0,r.jsx)(m.p,{type:"text",placeholder:"Ingrese NE a recuperar",value:x,onChange:e=>h(e.target.value),className:"flex-grow","aria-label":"NE a recuperar",onKeyDown:e=>"Enter"===e.key&&z()}),(0,r.jsxs)(u.$,{onClick:z,className:"btn-primary w-full sm:w-auto",disabled:j,children:[j?(0,r.jsx)(v.A,{className:"mr-2 h-4 w-4 animate-spin"}):(0,r.jsx)(eN.A,{className:"mr-2 h-4 w-4"}),j?"Buscando...":"Recuperar"]})]}),f&&(0,r.jsx)("p",{className:"text-destructive text-sm mt-2 text-center",children:f})]})]})]}),(0,r.jsxs)(p.Zp,{className:"custom-shadow",children:[(0,r.jsxs)(p.aR,{children:[(0,r.jsxs)(p.ZB,{className:"text-xl flex items-center gap-2",children:[(0,r.jsx)(ey.A,{})," Mis Asignaciones"]}),(0,r.jsx)(p.BT,{children:"Estos son los ex\xe1menes previos que se le han asignado para su gesti\xf3n."})]}),(0,r.jsxs)(p.Wu,{children:[A&&(0,r.jsxs)("div",{className:"flex items-center justify-center p-4",children:[(0,r.jsx)(v.A,{className:"h-6 w-6 animate-spin text-primary"}),(0,r.jsx)("p",{className:"ml-2 text-muted-foreground",children:"Cargando asignaciones..."})]}),!A&&0===w.length&&(0,r.jsx)("div",{className:"text-center py-6 px-4 bg-secondary/30 rounded-lg",children:(0,r.jsx)("p",{className:"text-muted-foreground",children:"No tiene ex\xe1menes previos asignados pendientes."})}),!A&&w.length>0&&(0,r.jsx)("div",{className:"space-y-3",children:w.map(e=>{var s;return(0,r.jsxs)("div",{className:"flex flex-col sm:flex-row items-center justify-between p-3 border rounded-lg bg-card hover:bg-muted/50 transition-colors",children:[(0,r.jsxs)("div",{className:"flex-1 mb-2 sm:mb-0",children:[(0,r.jsx)("p",{className:"font-bold text-primary",children:e.ne}),(0,r.jsx)("p",{className:"text-sm text-foreground",children:e.consignee}),(0,r.jsxs)("p",{className:"text-xs text-muted-foreground",children:["Asignado por ",e.requestedBy," el ",(s=e.assignedAt)?(0,ew.GP)(s.toDate(),"dd/MM/yy HH:mm",{locale:eE.es}):"N/A"]})]}),(0,r.jsxs)(u.$,{size:"sm",onClick:()=>S(e),disabled:j,children:[(0,r.jsx)(eC.A,{className:"mr-2 h-4 w-4"})," Empezar Previo"]})]},e.id)})})]})]})]})}var ek=a(76444),eI=a(27314);function eS(e){let{isOpen:s}=e,{updateUserProfile:a}=(0,l.A)(),[t,i]=(0,n.useState)(""),[o,c]=(0,n.useState)(!1),{toast:d}=(0,b.dj)(),x=async e=>{if(e.preventDefault(),!t.trim())return void d({title:"Nombre no v\xe1lido",description:"Por favor, ingresa un nombre.",variant:"destructive"});c(!0);try{await a(t.trim()),d({title:"\xa1Bienvenido!",description:"Tu nombre ha sido guardado."})}catch(e){d({title:"Error",description:"No se pudo guardar tu nombre.",variant:"destructive"})}finally{c(!1)}};return s?(0,r.jsx)(U.lG,{open:s,onOpenChange:()=>{},children:(0,r.jsxs)(U.Cf,{className:"sm:max-w-md glass-effect text-foreground border-border/30",onPointerDownOutside:e=>e.preventDefault(),onEscapeKeyDown:e=>e.preventDefault(),children:[(0,r.jsx)(U.c7,{children:(0,r.jsx)(U.L3,{className:"text-2xl font-bold text-foreground",children:"\xa1Bienvenido a CustomsEX-p!"})}),(0,r.jsx)(U.rr,{className:"text-muted-foreground",children:"Parece que es tu primera vez aqu\xed. Por favor, ingresa tu nombre completo para continuar."}),(0,r.jsxs)("form",{onSubmit:x,className:"space-y-6 py-4",children:[(0,r.jsxs)("div",{children:[(0,r.jsxs)(ek.J,{htmlFor:"displayName",className:"flex items-center text-sm font-medium text-foreground mb-1",children:[(0,r.jsx)(eI.A,{className:"mr-2 h-4 w-4 text-primary"}),'Nombre y Apellido (Ej. "John Doe")']}),(0,r.jsx)(m.p,{id:"displayName",type:"text",value:t,onChange:e=>i(e.target.value),required:!0,className:"w-full px-4 py-3 text-foreground placeholder:text-muted-foreground border-input bg-background rounded-md focus:outline-none focus:ring-2 focus:ring-primary",placeholder:"Ej: John Doe"})]}),(0,r.jsx)(U.Es,{children:(0,r.jsx)(u.$,{type:"submit",className:"btn-primary text-primary-foreground px-8 py-3 rounded-md font-medium w-full",disabled:o,children:o?(0,r.jsx)(v.A,{className:"animate-spin"}):"Guardar y Continuar"})})]})]})}):null}function ez(){let{user:e,loading:s,isProfileComplete:a}=(0,l.A)(),{currentStep:c}=(0,i.U)(),d=(0,t.useRouter)(),[u,m]=(0,n.useState)(!1);return((0,n.useEffect)(()=>{!s&&e?"calificador"===e.role?d.push("/databasePay"):e.role&&!["gestor","admin"].includes(e.role)&&d.push("/"):s||e||d.push("/")},[e,s,d]),(0,n.useEffect)(()=>{s||!e||a||"admin"===e.role?m(!1):m(!0)},[e,s,a]),(0,n.useEffect)(()=>{let e=e=>{c>i.I.WELCOME&&c<i.I.SUCCESS&&(e.preventDefault(),e.returnValue="")};return window.addEventListener("beforeunload",e),()=>{window.removeEventListener("beforeunload",e)}},[c]),s||e&&!a&&"admin"!==e.role||!e||e.role&&!["gestor","admin","calificador"].includes(e.role))?(0,r.jsxs)("div",{className:"min-h-screen flex items-center justify-center bg-background",children:[(0,r.jsx)(v.A,{className:"h-12 w-12 animate-spin text-primary"}),(0,r.jsx)("p",{className:"ml-4 text-lg",children:"Cargando perfil..."}),(0,r.jsx)(eS,{isOpen:u})]}):e?(0,r.jsxs)(o.G,{children:[(0,r.jsx)(eS,{isOpen:u}),(0,r.jsx)("div",{className:"py-2 md:py-5",children:(()=>{switch(c){case i.I.WELCOME:return(0,r.jsx)(eA,{});case i.I.INITIAL_INFO:return(0,r.jsx)(C,{});case i.I.PRODUCT_LIST:return(0,r.jsx)(eo,{});case i.I.PREVIEW:return(0,r.jsx)(ex,{});case i.I.SUCCESS:return(0,r.jsxs)(r.Fragment,{children:[" ",(0,r.jsx)(ex,{})," ",(0,r.jsx)(ev,{})," "]});default:return(0,r.jsx)(eA,{})}})()}),c===i.I.SUCCESS&&(0,r.jsx)(ev,{})]}):(0,r.jsx)("div",{className:"min-h-screen flex items-center justify-center bg-background",children:(0,r.jsx)("p",{className:"text-lg",children:"Redirigiendo a inicio de sesi\xf3n..."})})}},76444:(e,s,a)=>{"use strict";a.d(s,{J:()=>c});var r=a(95155),n=a(12115),t=a(10489),l=a(83101),i=a(64269);let o=(0,l.F)("text-sm font-medium leading-none peer-disabled:cursor-not-allowed peer-disabled:opacity-70"),c=n.forwardRef((e,s)=>{let{className:a,...n}=e;return(0,r.jsx)(t.b,{ref:s,className:(0,i.cn)(o(),a),...n})});c.displayName=t.b.displayName},87270:(e,s,a)=>{"use strict";a.d(s,{A0:()=>i,BF:()=>o,Hj:()=>c,XI:()=>l,nA:()=>u,nd:()=>d});var r=a(95155),n=a(12115),t=a(64269);let l=n.forwardRef((e,s)=>{let{className:a,...n}=e;return(0,r.jsx)("div",{className:"relative w-full overflow-auto",children:(0,r.jsx)("table",{ref:s,className:(0,t.cn)("w-full caption-bottom text-sm",a),...n})})});l.displayName="Table";let i=n.forwardRef((e,s)=>{let{className:a,...n}=e;return(0,r.jsx)("thead",{ref:s,className:(0,t.cn)("[&_tr]:border-b",a),...n})});i.displayName="TableHeader";let o=n.forwardRef((e,s)=>{let{className:a,...n}=e;return(0,r.jsx)("tbody",{ref:s,className:(0,t.cn)("[&_tr:last-child]:border-0",a),...n})});o.displayName="TableBody",n.forwardRef((e,s)=>{let{className:a,...n}=e;return(0,r.jsx)("tfoot",{ref:s,className:(0,t.cn)("border-t bg-muted/50 font-medium [&>tr]:last:border-b-0",a),...n})}).displayName="TableFooter";let c=n.forwardRef((e,s)=>{let{className:a,...n}=e;return(0,r.jsx)("tr",{ref:s,className:(0,t.cn)("border-b transition-colors hover:bg-muted/50 data-[state=selected]:bg-muted",a),...n})});c.displayName="TableRow";let d=n.forwardRef((e,s)=>{let{className:a,...n}=e;return(0,r.jsx)("th",{ref:s,className:(0,t.cn)("h-12 px-4 text-left align-middle font-medium text-muted-foreground [&:has([role=checkbox])]:pr-0",a),...n})});d.displayName="TableHead";let u=n.forwardRef((e,s)=>{let{className:a,...n}=e;return(0,r.jsx)("td",{ref:s,className:(0,t.cn)("p-4 align-middle [&:has([role=checkbox])]:pr-0",a),...n})});u.displayName="TableCell",n.forwardRef((e,s)=>{let{className:a,...n}=e;return(0,r.jsx)("caption",{ref:s,className:(0,t.cn)("mt-4 text-sm text-muted-foreground",a),...n})}).displayName="TableCaption"}},e=>{e.O(0,[2992,7138,3524,4865,2130,3744,5282,3504,1621,8472,5479,5171,7115,8441,1255,7358],()=>e(e.s=67829)),_N_E=e.O()}]);