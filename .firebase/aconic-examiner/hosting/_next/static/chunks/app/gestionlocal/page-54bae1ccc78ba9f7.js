(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[8561],{9691:(e,a,s)=>{"use strict";s.d(a,{j:()=>l});var r=s(95155),t=s(51834),i=s(17037),n=s(59321);function l(e){let{isOpen:a,onClose:s,worksheet:l}=e;return a&&l?(0,r.jsx)(t.lG,{open:a,onOpenChange:s,children:(0,r.jsx)(t.Cf,{className:"max-w-4xl p-0 h-[90vh] flex flex-col",children:(0,r.jsx)(i.F,{className:"flex-grow",children:(0,r.jsx)("div",{className:"p-6",children:(0,r.jsx)(n.v,{worksheet:l,onClose:s})})})})}):null}},11186:(e,a,s)=>{"use strict";s.d(a,{bq:()=>m,eb:()=>f,gC:()=>x,l6:()=>c,yv:()=>u});var r=s(95155),t=s(12115),i=s(47887),n=s(59007),l=s(42614),o=s(72251),d=s(64269);let c=i.bL;i.YJ;let u=i.WT,m=t.forwardRef((e,a)=>{let{className:s,children:t,...l}=e;return(0,r.jsxs)(i.l9,{ref:a,className:(0,d.cn)("flex h-10 w-full items-center justify-between rounded-md border border-input bg-background px-3 py-2 text-sm ring-offset-background placeholder:text-muted-foreground focus:outline-none focus:ring-2 focus:ring-ring focus:ring-offset-2 disabled:cursor-not-allowed disabled:opacity-50 [&>span]:line-clamp-1",s),...l,children:[t,(0,r.jsx)(i.In,{asChild:!0,children:(0,r.jsx)(n.A,{className:"h-4 w-4 opacity-50"})})]})});m.displayName=i.l9.displayName;let p=t.forwardRef((e,a)=>{let{className:s,...t}=e;return(0,r.jsx)(i.PP,{ref:a,className:(0,d.cn)("flex cursor-default items-center justify-center py-1",s),...t,children:(0,r.jsx)(l.A,{className:"h-4 w-4"})})});p.displayName=i.PP.displayName;let h=t.forwardRef((e,a)=>{let{className:s,...t}=e;return(0,r.jsx)(i.wn,{ref:a,className:(0,d.cn)("flex cursor-default items-center justify-center py-1",s),...t,children:(0,r.jsx)(n.A,{className:"h-4 w-4"})})});h.displayName=i.wn.displayName;let x=t.forwardRef((e,a)=>{let{className:s,children:t,position:n="popper",...l}=e;return(0,r.jsx)(i.ZL,{children:(0,r.jsxs)(i.UC,{ref:a,className:(0,d.cn)("relative z-50 max-h-96 min-w-[8rem] overflow-hidden rounded-md border bg-popover text-popover-foreground shadow-md data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0 data-[state=closed]:zoom-out-95 data-[state=open]:zoom-in-95 data-[side=bottom]:slide-in-from-top-2 data-[side=left]:slide-in-from-right-2 data-[side=right]:slide-in-from-left-2 data-[side=top]:slide-in-from-bottom-2","popper"===n&&"data-[side=bottom]:translate-y-1 data-[side=left]:-translate-x-1 data-[side=right]:translate-x-1 data-[side=top]:-translate-y-1",s),position:n,...l,children:[(0,r.jsx)(p,{}),(0,r.jsx)(i.LM,{className:(0,d.cn)("p-1","popper"===n&&"h-[var(--radix-select-trigger-height)] w-full min-w-[var(--radix-select-trigger-width)]"),children:t}),(0,r.jsx)(h,{})]})})});x.displayName=i.UC.displayName,t.forwardRef((e,a)=>{let{className:s,...t}=e;return(0,r.jsx)(i.JU,{ref:a,className:(0,d.cn)("py-1.5 pl-8 pr-2 text-sm font-semibold",s),...t})}).displayName=i.JU.displayName;let f=t.forwardRef((e,a)=>{let{className:s,children:t,...n}=e;return(0,r.jsxs)(i.q7,{ref:a,className:(0,d.cn)("relative flex w-full cursor-default select-none items-center rounded-sm py-1.5 pl-8 pr-2 text-sm outline-none focus:bg-accent focus:text-accent-foreground data-[disabled]:pointer-events-none data-[disabled]:opacity-50",s),...n,children:[(0,r.jsx)("span",{className:"absolute left-2 flex h-3.5 w-3.5 items-center justify-center",children:(0,r.jsx)(i.VF,{children:(0,r.jsx)(o.A,{className:"h-4 w-4"})})}),(0,r.jsx)(i.p4,{children:t})]})});f.displayName=i.q7.displayName,t.forwardRef((e,a)=>{let{className:s,...t}=e;return(0,r.jsx)(i.wv,{ref:a,className:(0,d.cn)("-mx-1 my-1 h-px bg-muted",s),...t})}).displayName=i.wv.displayName},31120:(e,a,s)=>{"use strict";s.d(a,{T:()=>n});var r=s(95155),t=s(12115),i=s(64269);let n=t.forwardRef((e,a)=>{let{className:s,...t}=e;return(0,r.jsx)("textarea",{className:(0,i.cn)("flex min-h-[80px] w-full rounded-md border border-input bg-background px-3 py-2 text-sm ring-offset-background placeholder:text-muted-foreground focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2 disabled:cursor-not-allowed disabled:opacity-50",s),ref:a,...t})});n.displayName="Textarea"},31994:(e,a,s)=>{Promise.resolve().then(s.bind(s,87606))},32383:()=>{},41052:(e,a,s)=>{"use strict";s.d(a,{C5:()=>j,MJ:()=>f,eI:()=>h,lR:()=>x,lV:()=>d,zB:()=>u});var r=s(95155),t=s(12115),i=s(32467),n=s(22544),l=s(64269),o=s(76444);let d=n.Op,c=t.createContext({}),u=e=>{let{...a}=e;return(0,r.jsx)(c.Provider,{value:{name:a.name},children:(0,r.jsx)(n.xI,{...a})})},m=()=>{let e=t.useContext(c),a=t.useContext(p),{getFieldState:s,formState:r}=(0,n.xW)(),i=s(e.name,r);if(!e)throw Error("useFormField should be used within <FormField>");let{id:l}=a;return{id:l,name:e.name,formItemId:"".concat(l,"-form-item"),formDescriptionId:"".concat(l,"-form-item-description"),formMessageId:"".concat(l,"-form-item-message"),...i}},p=t.createContext({}),h=t.forwardRef((e,a)=>{let{className:s,...i}=e,n=t.useId();return(0,r.jsx)(p.Provider,{value:{id:n},children:(0,r.jsx)("div",{ref:a,className:(0,l.cn)("space-y-2",s),...i})})});h.displayName="FormItem";let x=t.forwardRef((e,a)=>{let{className:s,...t}=e,{error:i,formItemId:n}=m();return(0,r.jsx)(o.J,{ref:a,className:(0,l.cn)(i&&"text-destructive",s),htmlFor:n,...t})});x.displayName="FormLabel";let f=t.forwardRef((e,a)=>{let{...s}=e,{error:t,formItemId:n,formDescriptionId:l,formMessageId:o}=m();return(0,r.jsx)(i.DX,{ref:a,id:n,"aria-describedby":t?"".concat(l," ").concat(o):"".concat(l),"aria-invalid":!!t,...s})});f.displayName="FormControl",t.forwardRef((e,a)=>{let{className:s,...t}=e,{formDescriptionId:i}=m();return(0,r.jsx)("p",{ref:a,id:i,className:(0,l.cn)("text-sm text-muted-foreground",s),...t})}).displayName="FormDescription";let j=t.forwardRef((e,a)=>{var s;let{className:t,children:i,...n}=e,{error:o,formMessageId:d}=m(),c=o?String(null!=(s=null==o?void 0:o.message)?s:""):i;return c?(0,r.jsx)("p",{ref:a,id:d,className:(0,l.cn)("text-sm font-medium text-destructive",t),...n,children:c}):null});j.displayName="FormMessage"},44846:(e,a,s)=>{"use strict";s.d(a,{d:()=>l});var r=s(95155),t=s(12115),i=s(27599),n=s(64269);let l=t.forwardRef((e,a)=>{let{className:s,...t}=e;return(0,r.jsx)(i.bL,{className:(0,n.cn)("peer inline-flex h-6 w-11 shrink-0 cursor-pointer items-center rounded-full border-2 border-transparent transition-colors focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2 focus-visible:ring-offset-background disabled:cursor-not-allowed disabled:opacity-50 data-[state=checked]:bg-primary data-[state=unchecked]:bg-input",s),...t,ref:a,children:(0,r.jsx)(i.zi,{className:(0,n.cn)("pointer-events-none block h-5 w-5 rounded-full bg-background shadow-lg ring-0 transition-transform data-[state=checked]:translate-x-5 data-[state=unchecked]:translate-x-0")})})});l.displayName=i.bL.displayName},63817:(e,a,s)=>{"use strict";s.d(a,{G7:()=>d,L$:()=>m,h_:()=>p,oI:()=>c,uB:()=>o,xL:()=>u});var r=s(95155),t=s(12115),i=s(41808),n=s(90109),l=s(64269);s(51834);let o=t.forwardRef((e,a)=>{let{className:s,...t}=e;return(0,r.jsx)(i.uB,{ref:a,className:(0,l.cn)("flex h-full w-full flex-col overflow-hidden rounded-md bg-popover text-popover-foreground",s),...t})});o.displayName=i.uB.displayName;let d=t.forwardRef((e,a)=>{let{className:s,...t}=e;return(0,r.jsxs)("div",{className:"flex items-center border-b px-3","cmdk-input-wrapper":"",children:[(0,r.jsx)(n.A,{className:"mr-2 h-4 w-4 shrink-0 opacity-50"}),(0,r.jsx)(i.uB.Input,{ref:a,className:(0,l.cn)("flex h-11 w-full rounded-md bg-transparent py-3 text-sm outline-none placeholder:text-muted-foreground disabled:cursor-not-allowed disabled:opacity-50",s),...t})]})});d.displayName=i.uB.Input.displayName;let c=t.forwardRef((e,a)=>{let{className:s,...t}=e;return(0,r.jsx)(i.uB.List,{ref:a,className:(0,l.cn)("max-h-[300px] overflow-y-auto overflow-x-hidden",s),...t})});c.displayName=i.uB.List.displayName;let u=t.forwardRef((e,a)=>(0,r.jsx)(i.uB.Empty,{ref:a,className:"py-6 text-center text-sm",...e}));u.displayName=i.uB.Empty.displayName;let m=t.forwardRef((e,a)=>{let{className:s,...t}=e;return(0,r.jsx)(i.uB.Group,{ref:a,className:(0,l.cn)("overflow-hidden p-1 text-foreground [&_[cmdk-group-heading]]:px-2 [&_[cmdk-group-heading]]:py-1.5 [&_[cmdk-group-heading]]:text-xs [&_[cmdk-group-heading]]:font-medium [&_[cmdk-group-heading]]:text-muted-foreground",s),...t})});m.displayName=i.uB.Group.displayName,t.forwardRef((e,a)=>{let{className:s,...t}=e;return(0,r.jsx)(i.uB.Separator,{ref:a,className:(0,l.cn)("-mx-1 h-px bg-border",s),...t})}).displayName=i.uB.Separator.displayName;let p=t.forwardRef((e,a)=>{let{className:s,...t}=e;return(0,r.jsx)(i.uB.Item,{ref:a,className:(0,l.cn)("relative flex cursor-default select-none items-center rounded-sm px-2 py-1.5 text-sm outline-none aria-selected:bg-accent aria-selected:text-accent-foreground data-[disabled='true']:pointer-events-none data-[disabled='true']:opacity-50",s),...t})});p.displayName=i.uB.Item.displayName},73457:(e,a,s)=>{"use strict";s.d(a,{S:()=>o});var r=s(95155),t=s(12115),i=s(38162),n=s(72251),l=s(64269);let o=t.forwardRef((e,a)=>{let{className:s,...t}=e;return(0,r.jsx)(i.bL,{ref:a,className:(0,l.cn)("peer h-4 w-4 shrink-0 rounded-sm border border-primary ring-offset-background focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2 disabled:cursor-not-allowed disabled:opacity-50 data-[state=checked]:bg-primary data-[state=checked]:text-primary-foreground",s),...t,children:(0,r.jsx)(i.C1,{className:(0,l.cn)("flex items-center justify-center text-current"),children:(0,r.jsx)(n.A,{className:"h-4 w-4"})})})});o.displayName=i.bL.displayName},76444:(e,a,s)=>{"use strict";s.d(a,{J:()=>d});var r=s(95155),t=s(12115),i=s(10489),n=s(83101),l=s(64269);let o=(0,n.F)("text-sm font-medium leading-none peer-disabled:cursor-not-allowed peer-disabled:opacity-70"),d=t.forwardRef((e,a)=>{let{className:s,...t}=e;return(0,r.jsx)(i.b,{ref:a,className:(0,l.cn)(o(),s),...t})});d.displayName=i.b.displayName},83686:()=>{},87606:(e,a,s)=>{"use strict";s.r(a),s.d(a,{default:()=>et});var r=s(95155),t=s(12115),i=s(54901),n=s(14585),l=s(19708),o=s(35434),d=s(86948),c=s(3998),u=s(92033),m=s(53489),p=s(87455),h=s(65142),x=s(87270),f=s(73457),j=s(6259),g=s(58772),v=s(82274),N=s(20146),y=s(36654),w=s(5351),b=s(27500),A=s(54550),C=s(88964),k=s(59971),E=s(5282),S=s(11647),R=s(11186),P=s(15894),D=s(51834),O=s(98053),_=s(4246),z=s(76444),M=s(44846),L=s(22544),I=s(66942),$=s(15653),T=s(41052),F=s(73180);let B=$.z.object({declaracionAduanera:$.z.string().min(1,"El n\xfamero de declaraci\xf3n es requerido.")});function G(e){let{isOpen:a,onClose:s,caseData:o}=e,{user:d}=(0,i.A)(),{toast:m}=(0,P.dj)(),[p,x]=(0,t.useState)(!1),f=(0,L.mN)({resolver:(0,I.u)(B),defaultValues:{declaracionAduanera:o.declaracionAduanera||""}}),j=(null==d?void 0:d.role)==="digitador"||(null==d?void 0:d.role)==="admin"||(null==d?void 0:d.role)==="coordinadora"||(null==d?void 0:d.roleTitle)==="supervisor",g=async e=>{if(!d||!d.displayName)return void m({title:"Error",description:"Debe estar autenticado.",variant:"destructive"});if(!j)return void m({title:"Permiso Denegado",description:"No tiene permisos para completar este tr\xe1mite.",variant:"destructive"});x(!0);let a=(0,l.H9)(n.db,"AforoCases",o.id),r=(0,l.rJ)(a,"actualizaciones"),t="Tr\xe1mite Completo";try{await (0,l.mZ)(a,{declaracionAduanera:e.declaracionAduanera,digitacionStatus:t,digitacionStatusLastUpdate:{by:d.displayName,at:l.Dc.now()}});let i={updatedAt:l.Dc.now(),updatedBy:d.displayName,field:"digitacionStatus",oldValue:o.digitacionStatus||"Almacenado",newValue:t,comment:"Tr\xe1mite completado con declaraci\xf3n No. ".concat(e.declaracionAduanera)};await (0,l.gS)(r,i),m({title:"Tr\xe1mite Completo",description:"El caso NE ".concat(o.ne," ha sido marcado como completado.")}),s()}catch(e){console.error("Error completing digitization:",e),m({title:"Error",description:"No se pudo completar el tr\xe1mite.",variant:"destructive"})}finally{x(!1)}};return a?(0,r.jsx)(D.lG,{open:a,onOpenChange:s,children:(0,r.jsxs)(D.Cf,{className:"sm:max-w-md",children:[(0,r.jsxs)(D.c7,{children:[(0,r.jsx)(D.L3,{children:"Completar Tr\xe1mite de Digitaci\xf3n"}),(0,r.jsxs)(D.rr,{children:["Ingrese el n\xfamero de declaraci\xf3n aduanera para finalizar el caso NE: ",(0,r.jsx)("span",{className:"font-bold text-foreground",children:o.ne}),"."]})]}),(0,r.jsx)(T.lV,{...f,children:(0,r.jsxs)("form",{onSubmit:f.handleSubmit(g),className:"space-y-4 py-4",children:[(0,r.jsx)(T.zB,{control:f.control,name:"declaracionAduanera",render:e=>{let{field:a}=e;return(0,r.jsxs)(T.eI,{children:[(0,r.jsx)(T.lR,{children:"N\xfamero de Declaraci\xf3n Aduanera"}),(0,r.jsx)(T.MJ,{children:(0,r.jsx)(h.p,{...a,disabled:!j||p,placeholder:"Ingrese el n\xfamero..."})}),(0,r.jsx)(T.C5,{})]})}}),(0,r.jsxs)(D.Es,{className:"pt-4",children:[(0,r.jsx)(c.$,{type:"button",variant:"outline",onClick:s,children:"Cancelar"}),j&&(0,r.jsxs)(c.$,{type:"submit",variant:"destructive",disabled:p,children:[p?(0,r.jsx)(u.A,{className:"mr-2 h-4 w-4 animate-spin"}):(0,r.jsx)(F.A,{className:"mr-2 h-4 w-4"}),"Guardar y Completar"]})]})]})})]})}):null}function J(e){var a,s,o,d;let{worksheets:p,setWorksheets:E,selectedRows:L,setSelectedRows:I,onAssign:$,onComment:T,onView:F,isLoading:B,onRefresh:J}=e,{toast:H}=(0,P.dj)(),{user:V}=(0,i.A)(),[U,W]=(0,t.useState)(1),[Z,q]=(0,t.useState)(30),[Q,Y]=(0,t.useState)({isOpen:!1,type:"aforador"}),[X,K]=(0,t.useState)(!1),ee=(0,t.useRef)(null),[ea,es]=(0,t.useState)(!1),[er,et]=(0,t.useState)(!1),[ei,en]=(0,t.useState)({isOpen:!1,success:[],skipped:[]}),[el,eo]=(0,t.useState)(null),[ed,ec]=(0,t.useState)({isOpen:!1}),[eu,em]=(0,t.useState)(""),ep=(0,t.useMemo)(()=>er?p.filter(e=>{let a=e.aforo;return!a||"Tr\xe1mite Completo"!==a.digitadorStatus}):p,[p,er]),eh=Math.ceil(ep.length/Z),ex=(0,t.useMemo)(()=>{let e=(U-1)*Z;return ep.slice(e,e+Z)},[ep,U,Z]),ef=async(e,a)=>{if(!V||!V.displayName||0===L.length)return;if("digitadorStatus"===e&&"Tr\xe1mite Completo"===a){es(!0),Y({isOpen:!1,type:"aforador"});return}let s=(0,l.wP)(n.db);L.forEach(r=>{let t=(0,l.H9)(n.db,"worksheets",r,"aforo","metadata");s.set(t,{[e]:a,["".concat(e,"LastUpdate")]:{by:V.displayName,at:l.Dc.now()}},{merge:!0})});try{await s.commit(),H({title:"Actualizaci\xf3n Masiva Exitosa",description:"".concat(L.length," registros actualizados.")}),J(),I([])}catch(e){console.error("Bulk update error:",e),H({title:"Error",description:"No se pudo completar la acci\xf3n masiva.",variant:"destructive"})}Y({isOpen:!1,type:"aforador"})},ej=async(e,a,s)=>{if(!V||!V.displayName)return void H({title:"Error",description:"Debe estar autenticado.",variant:"destructive"});if("aforador"===s&&"En revisi\xf3n"===a){ec({isOpen:!0,worksheet:p.find(a=>a.id===e),newStatus:a}),Y({isOpen:!1,type:"aforador"});return}if("digitador"===s&&"Completar Tr\xe1mite"===a){eo(p.find(a=>a.id===e)||null),Y({isOpen:!1,type:"aforador"});return}let r=(0,l.H9)(n.db,"worksheets",e,"aforo","metadata");try{let e="aforador"===s?"aforadorStatus":"digitadorStatus",t={[e]:a,["".concat(e,"LastUpdate")]:{by:V.displayName,at:l.Dc.now()}};await (0,l.wP)(n.db).set(r,t,{merge:!0}).commit(),H({title:"Estado Actualizado",description:"El estado del ".concat(s,' ha sido actualizado a "').concat(a,'".')}),J(),Y({isOpen:!1,type:"aforador"})}catch(e){console.error(e),H({title:"Error",description:"No se pudo actualizar el estado.",variant:"destructive"})}},eg=async e=>{if(!V||!V.displayName)return;let a=(0,l.H9)(n.db,"worksheets",e,"aforo","metadata");try{let e={revisorStatus:"Revalidaci\xf3n Solicitada",revisorStatusLastUpdate:{by:V.displayName,at:l.Dc.now()}};await (0,l.wP)(n.db).set(a,e,{merge:!0}).commit(),H({title:"Solicitud Enviada",description:"Se ha solicitado la revalidaci\xf3n al revisor."}),J()}catch(e){console.error(e),H({title:"Error",description:"No se pudo solicitar la revalidaci\xf3n.",variant:"destructive"})}},ev=function(){let e,a=arguments.length>0&&void 0!==arguments[0]&&arguments[0];e=a&&L.length>0?L.map(e=>({NE:e,"Declaracion Aduanera":""})):[{NE:"","Declaracion Aduanera":""}];let s=_.Wp.json_to_sheet(e),r=_.Wp.book_new();_.Wp.book_append_sheet(r,s,"Declaraciones"),_._h(r,"plantilla_declaraciones.xlsx")},eN=async function(e){var a;let s=arguments.length>1&&void 0!==arguments[1]&&arguments[1],r=null==(a=e.target.files)?void 0:a[0];if(!r)return;K(!0),H({title:"Importando...",description:"Procesando el archivo Excel."});let t=new FileReader;t.onload=async e=>{try{var a;let r=new Uint8Array(null==(a=e.target)?void 0:a.result),t=_.LF(r,{type:"array"}),i=t.SheetNames[0],o=t.Sheets[i],d=_.Wp.sheet_to_json(o),c=(0,l.wP)(n.db),u=0,m=new Set(s?L:d.map(e=>String(e.NE).trim().toUpperCase()));for(let e of d){let a=String(e.NE).trim().toUpperCase(),r=String(e["Declaracion Aduanera"]||"").trim();if(a&&r&&m.has(a)){let e=(0,l.H9)(n.db,"worksheets",a,"aforo","metadata"),t={declaracionAduanera:r};s&&(t.digitadorStatus="Tr\xe1mite Completo",t.digitadorStatusLastUpdate={by:null==V?void 0:V.displayName,at:l.Dc.now()}),c.set(e,t,{merge:!0}),u++}}u>0?(await c.commit(),J(),H({title:"Importaci\xf3n Completa",description:"".concat(u," declaraciones han sido actualizadas.")}),s&&(es(!1),I([]))):H({title:"Sin Cambios",description:"No se encontraron NEs coincidentes en el archivo para actualizar."})}catch(e){H({title:"Error de Importaci\xf3n",description:e.message||"Hubo un problema al leer el archivo Excel.",variant:"destructive"})}finally{K(!1),ee.current&&(ee.current.value="")}},t.readAsArrayBuffer(r)},ey=async()=>{if(!V||!V.displayName||0===L.length)return;setIsLoading(!0);let e=(0,l.wP)(n.db);L.forEach(a=>{let s=(0,l.H9)(n.db,"worksheets",a,"aforo","metadata");e.set(s,{entregadoAforoAt:l.Dc.now()},{merge:!0})});try{await e.commit(),H({title:"Acuse Masivo Exitoso",description:"".concat(L.length," caso(s) han sido actualizados.")}),J(),I([])}catch(e){console.error("Error with bulk acknowledge:",e),H({title:"Error",description:"No se pudo registrar el acuse masivo.",variant:"destructive"})}finally{setIsLoading(!1)}},ew=async()=>{if(!ed.worksheet||!(null==V?void 0:V.displayName))return;let e=(0,l.wP)(n.db),a=(0,l.H9)(n.db,"worksheets",ed.worksheet.id,"aforo","metadata"),s={totalPosiciones:Number(eu)};ed.newStatus&&(s.aforadorStatus=ed.newStatus,s.aforadorStatusLastUpdate={by:V.displayName,at:l.Dc.now()}),e.set(a,s,{merge:!0});try{await e.commit(),H({title:"\xc9xito",description:"Las posiciones y el estado han sido guardados."}),ec({isOpen:!1}),em(""),J()}catch(e){H({title:"Error",description:"No se pudieron guardar los datos.",variant:"destructive"})}};return(0,r.jsxs)(r.Fragment,{children:[(0,r.jsxs)("div",{className:"flex items-center justify-between gap-2 p-2",children:[(0,r.jsxs)("div",{className:"flex items-center gap-2 flex-wrap",children:[(0,r.jsxs)(c.$,{variant:"outline",size:"sm",onClick:()=>{var e;return null==(e=ee.current)?void 0:e.click()},disabled:X,children:[X?(0,r.jsx)(u.A,{className:"mr-2 h-4 w-4 animate-spin"}):(0,r.jsx)(g.A,{className:"mr-2 h-4 w-4"})," Importar Declaraciones"]}),(0,r.jsxs)(c.$,{onClick:()=>ev(!1),variant:"outline",size:"sm",children:[(0,r.jsx)(m.A,{className:"mr-2 h-4 w-4"})," Plantilla"]}),(0,r.jsx)("input",{type:"file",ref:ee,onChange:e=>eN(e,!1),className:"hidden",accept:".xlsx, .xls"}),(0,r.jsxs)(c.$,{variant:"secondary",size:"sm",onClick:()=>es(!0),disabled:0===L.length,children:["Completar Digitaci\xf3n (",L.length,")"]}),(0,r.jsxs)(c.$,{variant:"outline",size:"sm",onClick:()=>Y({isOpen:!0,type:"bulk-aforador"}),disabled:0===L.length,children:["Asignar Estatus Aforador (",L.length,")"]}),(0,r.jsxs)(c.$,{variant:"outline",size:"sm",onClick:ey,disabled:0===L.length||B,children:[(0,r.jsx)(v.A,{className:"mr-2 h-4 w-4"})," Enviar Acuse (",L.length,")"]})]}),(0,r.jsxs)("div",{className:"flex items-center space-x-2",children:[(0,r.jsx)(M.d,{id:"pending-filter",checked:er,onCheckedChange:et}),(0,r.jsx)(z.J,{htmlFor:"pending-filter",children:"Solo Pendientes"})]})]}),(0,r.jsx)("div",{className:"overflow-x-auto table-container rounded-lg border",children:(0,r.jsxs)(x.XI,{children:[(0,r.jsx)(x.A0,{children:(0,r.jsxs)(x.Hj,{children:[(0,r.jsx)(x.nd,{className:"w-12",children:(0,r.jsx)(f.S,{checked:L.length>0&&L.length===ex.length,onCheckedChange:()=>{L.length===ex.length?I([]):I(ex.map(e=>e.id))}})}),(0,r.jsx)(x.nd,{children:"Acciones"}),(0,r.jsx)(x.nd,{children:"NE"}),(0,r.jsx)(x.nd,{children:"Consignatario"}),(0,r.jsx)(x.nd,{children:"Aforador"}),(0,r.jsx)(x.nd,{children:"Estado Aforador"}),(0,r.jsx)(x.nd,{children:"Posiciones"}),(0,r.jsx)(x.nd,{children:"Revisor"}),(0,r.jsx)(x.nd,{children:"Estado Revisor"}),(0,r.jsx)(x.nd,{children:"Digitador"}),(0,r.jsx)(x.nd,{children:"Estado Digitador"}),(0,r.jsx)(x.nd,{children:"Declaraci\xf3n"})]})}),(0,r.jsx)(x.BF,{children:ex.map(e=>{let a=e.aforo;return(0,r.jsxs)(x.Hj,{"data-state":L.includes(e.id)?"selected":void 0,children:[(0,r.jsx)(x.nA,{children:(0,r.jsx)(f.S,{checked:L.includes(e.id),onCheckedChange:()=>{var a;return a=e.id,void I(e=>e.includes(a)?e.filter(e=>e!==a):[...e,a])}})}),(0,r.jsx)(x.nA,{children:(0,r.jsxs)(j.rI,{children:[(0,r.jsx)(j.ty,{asChild:!0,children:(0,r.jsx)(c.$,{variant:"ghost",className:"h-8 w-8 p-0",children:(0,r.jsx)(N.A,{className:"h-4 w-4"})})}),(0,r.jsxs)(j.SQ,{align:"end",children:[(0,r.jsxs)(j._2,{onClick:()=>F(e),children:[(0,r.jsx)(y.A,{className:"mr-2 h-4 w-4"})," Ver Hoja de Trabajo"]}),(0,r.jsxs)(j._2,{onClick:()=>$(e,"aforador"),children:[(0,r.jsx)(w.A,{className:"mr-2 h-4 w-4"})," Asignar Aforador"]}),(0,r.jsxs)(j._2,{onClick:()=>$(e,"revisor"),children:[(0,r.jsx)(w.A,{className:"mr-2 h-4 w-4"})," Asignar Revisor"]}),(0,r.jsxs)(j._2,{onClick:()=>$(e,"digitador"),children:[(0,r.jsx)(w.A,{className:"mr-2 h-4 w-4"})," Asignar Digitador"]}),(0,r.jsxs)(j._2,{onClick:()=>T(e),children:[(0,r.jsx)(b.A,{className:"mr-2 h-4 w-4"})," Ver/A\xf1adir Comentarios"]}),(0,r.jsxs)(j._2,{onClick:()=>eg(e.id),disabled:!a||"Rechazado"!==a.revisorStatus,children:[(0,r.jsx)(A.A,{className:"mr-2 h-4 w-4"}),"Solicitar Revalidaci\xf3n"]})]})]})}),(0,r.jsx)(x.nA,{children:e.ne}),(0,r.jsx)(x.nA,{children:e.consignee}),(0,r.jsx)(x.nA,{children:(0,r.jsxs)("div",{className:"flex items-center gap-1",children:[(0,r.jsx)(S.E,{variant:"secondary",children:(null==a?void 0:a.aforador)||"N/A"}),(0,r.jsx)(c.$,{variant:"ghost",size:"icon",className:"h-6 w-6",onClick:()=>$(e,"aforador"),children:(0,r.jsx)(C.A,{className:"h-3 w-3"})})]})}),(0,r.jsx)(x.nA,{children:(0,r.jsxs)("div",{className:"flex items-center gap-1",children:[(0,r.jsx)(S.E,{variant:(null==a?void 0:a.aforadorStatus)==="En revisi\xf3n"?"default":"outline",children:(null==a?void 0:a.aforadorStatus)||"Pendiente"}),(0,r.jsx)(c.$,{variant:"ghost",size:"icon",className:"h-6 w-6",onClick:()=>Y({isOpen:!0,worksheet:e,type:"aforador"}),children:(0,r.jsx)(C.A,{className:"h-3 w-3"})})]})}),(0,r.jsx)(x.nA,{children:(0,r.jsxs)("div",{className:"flex items-center gap-1",children:[(0,r.jsx)(S.E,{variant:"outline",children:(null==a?void 0:a.totalPosiciones)||0}),(0,r.jsx)(c.$,{variant:"ghost",size:"icon",className:"h-6 w-6",onClick:()=>{em((null==a?void 0:a.totalPosiciones)||""),ec({isOpen:!0,worksheet:e})},children:(0,r.jsx)(C.A,{className:"h-3 w-3"})})]})}),(0,r.jsx)(x.nA,{children:(0,r.jsxs)("div",{className:"flex items-center gap-1",children:[(0,r.jsx)(S.E,{variant:"secondary",children:(null==a?void 0:a.revisor)||"N/A"}),(0,r.jsx)(c.$,{variant:"ghost",size:"icon",className:"h-6 w-6",onClick:()=>$(e,"revisor"),children:(0,r.jsx)(C.A,{className:"h-3 w-3"})})]})}),(0,r.jsx)(x.nA,{children:(0,r.jsx)(S.E,{variant:(null==a?void 0:a.revisorStatus)==="Aprobado"?"default":(null==a?void 0:a.revisorStatus)==="Rechazado"?"destructive":"outline",children:(null==a?void 0:a.revisorStatus)||"Pendiente"})}),(0,r.jsx)(x.nA,{children:(0,r.jsxs)("div",{className:"flex items-center gap-1",children:[(0,r.jsx)(S.E,{variant:"secondary",children:(null==a?void 0:a.digitador)||"N/A"}),(0,r.jsx)(c.$,{variant:"ghost",size:"icon",className:"h-6 w-6",onClick:()=>$(e,"digitador"),children:(0,r.jsx)(C.A,{className:"h-3 w-3"})})]})}),(0,r.jsx)(x.nA,{children:(0,r.jsxs)("div",{className:"flex items-center gap-1",children:[(0,r.jsx)(S.E,{variant:(null==a?void 0:a.digitadorStatus)==="Tr\xe1mite Completo"?"default":"outline",children:(null==a?void 0:a.digitadorStatus)||"Pendiente"}),(0,r.jsx)(c.$,{variant:"ghost",size:"icon",className:"h-6 w-6",onClick:()=>Y({isOpen:!0,worksheet:e,type:"digitador"}),children:(0,r.jsx)(C.A,{className:"h-3 w-3"})})]})}),(0,r.jsx)(x.nA,{children:(null==a?void 0:a.declaracionAduanera)?(0,r.jsx)(S.E,{variant:"default",children:a.declaracionAduanera}):"N/A"})]},e.id)})})]})}),(0,r.jsxs)("div",{className:"flex items-center justify-between space-x-2 py-4",children:[(0,r.jsxs)("div",{className:"text-sm text-muted-foreground",children:[L.length," de ",ep.length," fila(s) seleccionadas."]}),(0,r.jsxs)("div",{className:"flex items-center gap-2",children:[(0,r.jsx)("span",{className:"text-sm",children:"Filas por p\xe1gina:"}),(0,r.jsxs)(R.l6,{value:String(Z),onValueChange:e=>{"all"===e?q(ep.length):q(Number(e)),W(1)},children:[(0,r.jsx)(R.bq,{className:"w-24 h-8",children:(0,r.jsx)(R.yv,{})}),(0,r.jsxs)(R.gC,{children:[(0,r.jsx)(R.eb,{value:"30",children:"30"}),(0,r.jsx)(R.eb,{value:"40",children:"40"}),(0,r.jsx)(R.eb,{value:"50",children:"50"}),(0,r.jsx)(R.eb,{value:"all",children:"Todos"})]})]})]}),(0,r.jsxs)("div",{className:"flex items-center space-x-2",children:[(0,r.jsxs)("span",{className:"text-sm",children:["P\xe1gina ",U," de ",eh]}),(0,r.jsx)(c.$,{variant:"outline",size:"sm",onClick:()=>W(e=>Math.max(e-1,1)),disabled:1===U,children:"Anterior"}),(0,r.jsx)(c.$,{variant:"outline",size:"sm",onClick:()=>W(e=>Math.min(e+1,eh)),disabled:U===eh,children:"Siguiente"})]})]}),(0,r.jsx)(D.lG,{open:Q.isOpen,onOpenChange:()=>Y({isOpen:!1,worksheet:void 0,type:"aforador"}),children:(0,r.jsxs)(D.Cf,{children:[(0,r.jsxs)(D.c7,{children:[(0,r.jsxs)(D.L3,{children:["Cambiar Estado de ",(null==(a=Q.type)?void 0:a.includes("aforador"))?"Aforador":"Digitador"," ",(null==(s=Q.type)?void 0:s.includes("bulk"))?"Masivo":""]}),(0,r.jsx)(D.rr,{children:Q.worksheet?"Seleccione el nuevo estado para el NE: ".concat(Q.worksheet.ne):"Seleccione el estatus a aplicar a los ".concat(L.length," casos seleccionados.")})]}),(0,r.jsxs)(R.l6,{onValueChange:e=>{Q.worksheet?ej(Q.worksheet.id,e,Q.type):Q.type&&ef(Q.type.split("-")[1],e)},children:[(0,r.jsx)(R.bq,{children:(0,r.jsx)(R.yv,{placeholder:"Seleccionar estado..."})}),(0,r.jsx)(R.gC,{children:(null==(o=Q.type)?void 0:o.includes("aforador"))?(0,r.jsxs)(r.Fragment,{children:[(0,r.jsx)(R.eb,{value:"Pendiente",children:"Pendiente"}),(0,r.jsx)(R.eb,{value:"En proceso",children:"En proceso"}),(0,r.jsx)(R.eb,{value:"Incompleto",children:"Incompleto"}),(0,r.jsx)(R.eb,{value:"En revisi\xf3n",children:"En revisi\xf3n"})]}):(0,r.jsxs)(r.Fragment,{children:[(0,r.jsx)(R.eb,{value:"Pendiente de Digitaci\xf3n",children:"Pendiente de Digitaci\xf3n"}),(0,r.jsx)(R.eb,{value:"En Proceso",children:"En Proceso"}),(0,r.jsx)(R.eb,{value:"Almacenado",children:"Almacenado"}),(0,r.jsx)(R.eb,{value:"Completar Tr\xe1mite",children:"Completar Tr\xe1mite"})]})})]}),(0,r.jsx)(D.Es,{children:(0,r.jsx)(c.$,{variant:"outline",onClick:()=>Y({isOpen:!1,type:"aforador"}),children:"Cancelar"})})]})}),(0,r.jsx)(D.lG,{open:ed.isOpen,onOpenChange:()=>ec({isOpen:!1}),children:(0,r.jsxs)(D.Cf,{children:[(0,r.jsxs)(D.c7,{children:[(0,r.jsx)(D.L3,{children:"Ingresar Total de Posiciones"}),(0,r.jsxs)(D.rr,{children:["Para marcar el caso NE: ",(0,r.jsx)("span",{className:"font-bold",children:null==(d=ed.worksheet)?void 0:d.ne}),' como "En revisi\xf3n", debe ingresar el total de posiciones.']})]}),(0,r.jsxs)("div",{className:"py-4 space-y-2",children:[(0,r.jsx)(z.J,{htmlFor:"positions-input",children:"Total de Posiciones"}),(0,r.jsx)(h.p,{id:"positions-input",type:"number",value:eu,onChange:e=>em(e.target.value),placeholder:"Ingrese el n\xfamero de posiciones"})]}),(0,r.jsxs)(D.Es,{children:[(0,r.jsx)(c.$,{variant:"outline",onClick:()=>ec({isOpen:!1}),children:"Cancelar"}),(0,r.jsx)(c.$,{onClick:ew,disabled:!eu,children:"Guardar y Actualizar Estado"})]})]})}),el&&(0,r.jsx)(G,{isOpen:!!el,onClose:()=>eo(null),caseData:{id:el.id,ne:el.ne},onRefresh:J}),(0,r.jsx)(D.lG,{open:ea,onOpenChange:es,children:(0,r.jsxs)(D.Cf,{children:[(0,r.jsxs)(D.c7,{children:[(0,r.jsx)(D.L3,{children:"Completar Tr\xe1mite Masivo"}),(0,r.jsxs)(D.rr,{children:["Descargue la plantilla, llene los n\xfameros de declaraci\xf3n para los ",L.length," casos seleccionados y s\xfabala para finalizar."]})]}),(0,r.jsxs)("div",{className:"flex flex-col gap-4 py-4",children:[(0,r.jsxs)(c.$,{onClick:()=>ev(!0),variant:"secondary",children:[(0,r.jsx)(m.A,{className:"mr-2 h-4 w-4"})," Descargar Plantilla con NEs"]}),(0,r.jsxs)(c.$,{onClick:()=>{var e;return null==(e=ee.current)?void 0:e.click()},disabled:X,children:[X?(0,r.jsx)(u.A,{className:"mr-2 h-4 w-4 animate-spin"}):(0,r.jsx)(k.A,{className:"mr-2 h-4 w-4"}),"Subir Plantilla Completada"]}),(0,r.jsx)("input",{type:"file",ref:ee,onChange:e=>eN(e,!0),className:"hidden",accept:".xlsx, .xls"})]}),(0,r.jsx)(D.Es,{children:(0,r.jsx)(c.$,{variant:"outline",onClick:()=>es(!1),children:"Cancelar"})})]})}),(0,r.jsx)(O.Lt,{open:ei.isOpen,onOpenChange:e=>en(a=>({...a,isOpen:e})),children:(0,r.jsxs)(O.EO,{children:[(0,r.jsxs)(O.wd,{children:[(0,r.jsx)(D.L3,{children:"Resultado de la Operaci\xf3n Masiva"}),(0,r.jsx)(O.$v,{children:(0,r.jsxs)("div",{className:"space-y-4 max-h-60 overflow-y-auto",children:[ei.success.length>0&&(0,r.jsxs)("div",{children:[(0,r.jsx)("p",{className:"font-semibold text-green-600",children:"Casos completados exitosamente:"}),(0,r.jsx)("ul",{className:"list-disc list-inside text-sm text-muted-foreground",children:ei.success.map(e=>(0,r.jsx)("li",{children:e},e))})]}),ei.skipped.length>0&&(0,r.jsxs)("div",{children:[(0,r.jsx)("p",{className:"font-semibold text-amber-600",children:"Casos omitidos (sin declaraci\xf3n aduanera):"}),(0,r.jsx)("ul",{className:"list-disc list-inside text-sm text-muted-foreground",children:ei.skipped.map(e=>(0,r.jsx)("li",{children:e},e))})]})]})})]}),(0,r.jsx)(O.ck,{children:(0,r.jsx)(O.Rx,{onClick:()=>en({isOpen:!1,success:[],skipped:[]}),children:"Entendido"})})]})})]})}var H=s(63817),V=s(72251),U=s(64269);function W(e){let{isOpen:a,onClose:s,worksheet:o,type:d,selectedWorksheetIds:m,setWorksheets:p}=e,{user:h}=(0,i.A)(),{toast:x}=(0,P.dj)(),[f,j]=(0,t.useState)(null),[g,v]=(0,t.useState)([]),[N,y]=(0,t.useState)(!1);(0,t.useEffect)(()=>{a&&(async()=>{let e=[];try{if(d.includes("revisor")){let a=(0,l.P)((0,l.rJ)(n.db,"users"),(0,l._M)("roleTitle","==","agente aduanero")),s=(0,l.P)((0,l.rJ)(n.db,"users"),(0,l._M)("role","==","supervisor"),(0,l._M)("roleTitle","==","PSMT")),[r,t]=await Promise.all([(0,l.GG)(a),(0,l.GG)(s)]),i=new Map;r.forEach(e=>{i.set(e.id,{uid:e.id,...e.data()})}),t.forEach(e=>{i.set(e.id,{uid:e.id,...e.data()})}),e=Array.from(i.values())}else{let a;if((a=d.includes("aforador")||d.includes("digitador")?["aforador","supervisor","coordinadora"]:[]).length>0){let s=(0,l.P)((0,l.rJ)(n.db,"users"),(0,l._M)("role","in",a));e=(await (0,l.GG)(s)).docs.map(e=>({uid:e.id,...e.data()}))}}v(e)}catch(e){console.error("Error fetching users for assignment:",e),x({title:"Error",description:"No se pudieron cargar los usuarios para asignar.",variant:"destructive"})}})()},[a,d,x]);let w=async()=>{let e;if(!f||!(null==h?void 0:h.displayName))return;y(!0);let a=(0,l.wP)(n.db);e=d.includes("aforador")?"aforador":d.includes("revisor")?"revisor":"digitador";let r=l.Dc.now(),t=f.displayName||f.email,i=o?[o.id]:m||[];if(0===i.length){x({title:"Error",description:"No se seleccionaron hojas de trabajo.",variant:"destructive"}),y(!1);return}i.forEach(s=>{let i=(0,l.H9)(n.db,"worksheets/".concat(s,"/aforo/metadata")),o={[e]:t,["".concat(e,"AssignedAt")]:r,["".concat(e,"AssignedBy")]:h.displayName};a.set(i,o,{merge:!0})});try{await a.commit(),x({title:"Asignaci\xf3n Exitosa",description:"".concat(t," ha sido asignado como ").concat(e," a ").concat(i.length," hoja(s) de trabajo.")}),p&&p(a=>a.map(a=>{if(i.includes(a.id)){let s={...a.aforo,[e]:t};return{...a,aforo:s}}return a})),s()}catch(e){console.error(e),x({title:"Error",description:"No se pudo completar la asignaci\xf3n.",variant:"destructive"})}finally{y(!1)}},b="Asignar ".concat(d.includes("aforador")?"Aforador":d.includes("revisor")?"Revisor":"Digitador").concat(d.includes("bulk")?" Masivamente":""),A=o?"Seleccione un usuario para el NE: ".concat(o.ne):"Seleccione un usuario para ".concat((null==m?void 0:m.length)||0," hoja(s) de trabajo.");return(0,r.jsx)(D.lG,{open:a,onOpenChange:s,children:(0,r.jsxs)(D.Cf,{className:"sm:max-w-md",children:[(0,r.jsxs)(D.c7,{children:[(0,r.jsx)(D.L3,{children:b}),(0,r.jsx)(D.rr,{children:A})]}),(0,r.jsxs)(H.uB,{className:"rounded-lg border shadow-sm",children:[(0,r.jsx)(H.G7,{placeholder:"Buscar usuario..."}),(0,r.jsxs)(H.oI,{children:[(0,r.jsx)(H.xL,{children:"No se encontraron usuarios."}),(0,r.jsx)(H.L$,{children:g.map(e=>(0,r.jsxs)(H.h_,{value:e.displayName||e.email||"",onSelect:()=>j(e),children:[(0,r.jsx)(V.A,{className:(0,U.cn)("mr-2 h-4 w-4",(null==f?void 0:f.uid)===e.uid?"opacity-100":"opacity-0")}),e.displayName||e.email]},e.uid))})]})]}),(0,r.jsxs)(D.Es,{children:[(0,r.jsx)(c.$,{variant:"outline",onClick:s,children:"Cancelar"}),(0,r.jsxs)(c.$,{onClick:w,disabled:!f||N,children:[N&&(0,r.jsx)(u.A,{className:"mr-2 h-4 w-4 animate-spin"}),"Confirmar Asignaci\xf3n"]})]})]})})}var Z=s(31120),q=s(94979),Q=s(17037),Y=s(80160);function X(e){let{isOpen:a,onClose:s,worksheet:o}=e,{user:d}=(0,i.A)(),{toast:m}=(0,P.dj)(),[p,h]=(0,t.useState)([]),[x,f]=(0,t.useState)(""),[j,g]=(0,t.useState)(!0),[v,N]=(0,t.useState)(!1);(0,t.useEffect)(()=>{if(!a)return;g(!0);let e=(0,l.rJ)(n.db,"worksheets/".concat(o.id,"/aforoComments")),s=(0,l.P)(e,(0,l.My)("createdAt","desc")),r=(0,l.aQ)(s,e=>{h(e.docs.map(e=>({id:e.id,...e.data()}))),g(!1)},e=>{console.error("Error fetching comments:",e),g(!1)});return()=>r()},[a,o.id]);let y=async()=>{if(!x.trim()||!(null==d?void 0:d.displayName))return;N(!0);let e=(0,l.rJ)(n.db,"worksheets/".concat(o.id,"/aforoComments"));try{await (0,l.gS)(e,{text:x.trim(),author:d.displayName,createdAt:(0,l.O5)()}),f("")}catch(e){m({title:"Error",description:"No se pudo guardar el comentario.",variant:"destructive"})}finally{N(!1)}},w=(null==d?void 0:d.role)==="admin"||(null==d?void 0:d.role)==="coordinadora"||(null==d?void 0:d.role)==="supervisor";return(0,r.jsx)(D.lG,{open:a,onOpenChange:s,children:(0,r.jsxs)(D.Cf,{className:"max-w-lg",children:[(0,r.jsxs)(D.c7,{children:[(0,r.jsx)(D.L3,{children:"Comentarios de Aforo"}),(0,r.jsxs)(D.rr,{children:["Comentarios para la hoja de trabajo: ",o.ne]})]}),(0,r.jsx)(Q.F,{className:"h-72 my-4",children:(0,r.jsxs)("div",{className:"space-y-4 pr-6",children:[j&&(0,r.jsx)("div",{className:"text-center",children:(0,r.jsx)(u.A,{className:"h-6 w-6 animate-spin"})}),!j&&0===p.length&&(0,r.jsx)("p",{className:"text-center text-muted-foreground",children:"No hay comentarios."}),p.map(e=>{var a;return(0,r.jsxs)("div",{className:"p-3 border rounded-lg bg-secondary/50",children:[(0,r.jsx)("p",{className:"text-sm",children:e.text}),(0,r.jsxs)("p",{className:"text-xs text-muted-foreground text-right mt-2",children:["- ",e.author,", ",(a=e.createdAt)?(0,E.GP)(a.toDate(),"dd/MM/yy hh:mm a",{locale:Y.es}):"Justo ahora"]})]},e.id)})]})}),w&&(0,r.jsxs)("div",{className:"space-y-2 pt-4 border-t",children:[(0,r.jsx)(Z.T,{placeholder:"A\xf1adir un nuevo comentario...",value:x,onChange:e=>f(e.target.value),disabled:v}),(0,r.jsxs)(c.$,{onClick:y,disabled:v||!x.trim(),className:"w-full",children:[v?(0,r.jsx)(u.A,{className:"mr-2 h-4 w-4 animate-spin"}):(0,r.jsx)(q.A,{className:"mr-2 h-4 w-4"}),"Enviar"]})]}),(0,r.jsx)(D.Es,{children:(0,r.jsx)(c.$,{variant:"outline",onClick:s,children:"Cerrar"})})]})})}var K=s(9691);let ee=function(e){let a=!(arguments.length>1)||void 0===arguments[1]||arguments[1];if(!e)return"N/A";let s=e.toDate?e.toDate():new Date(e);return s instanceof Date&&!isNaN(s.getTime())?(0,E.GP)(s,a?"dd/MM/yy HH:mm":"dd/MM/yy",{locale:Y.es}):"Fecha Inv\xe1lida"},ea=e=>e instanceof l.Dc?ee(e):"boolean"==typeof e?e?"S\xed":"No":null==e||""===e?"vac\xedo":"object"==typeof e?JSON.stringify(e):String(e),es=(e,a,s,r)=>{let t=[[s],[r],[],e,...a],i=_.Wp.aoa_to_sheet(t),n=e.map((e,s)=>({wch:Math.max(e.length,...a.map(e=>String(e[s]||"").length))+2}));return i["!cols"]=n,i};async function er(e,a){let s=new Date,r=(0,E.GP)(s,"dd/MM/yy HH:mm",{locale:Y.es}),t=es(["NE","Consignatario","Mercanc\xeda","Modelo (Patr\xf3n)","Aforador","Fecha Asignaci\xf3n","Total Posiciones","Entregado a Aforo","Revisor Asignado","Estado Revisor","Observaci\xf3n Revisor","Estado Aforador","Estado Digitaci\xf3n","Digitador Asignado","Fecha Asign. Digitador","Declaraci\xf3n Aduanera","Incidencia Reportada","Motivo Incidencia","Estado Incidencia"],e.map(e=>[e.ne,e.consignee,e.merchandise,e.declarationPattern,e.aforador,ee(e.assignmentDate),e.totalPosiciones||"N/A",ee(e.entregadoAforoAt),e.revisorAsignado||"N/A",e.revisorStatus||"N/A",e.observacionRevisor||"",e.aforadorStatus||"N/A",e.digitacionStatus||"N/A",e.digitadorAsignado||"N/A",ee(e.digitadorAsignadoAt),e.declaracionAduanera||"N/A",e.incidentReported?"S\xed":"No",e.incidentReason||"N/A",e.incidentStatus||"N/A"]),"Reporte Aforo Casos - Customs Reports","Generado el: ".concat(r));a.sort((e,a)=>e.caseNe<a.caseNe?-1:e.caseNe>a.caseNe?1:(e.updatedAt instanceof Date?e.updatedAt.getTime():e.updatedAt.toMillis())-(a.updatedAt instanceof Date?a.updatedAt.getTime():a.updatedAt.toMillis()));let i=es(["NE del Caso","Fecha de Actualizaci\xf3n","Actualizado Por","Campo Modificado","Valor Anterior","Valor Nuevo","Comentario"],a.map(e=>[e.caseNe,ee(e.updatedAt),e.updatedBy,e.field,ea(e.oldValue),ea(e.newValue),e.comment||""]),"Bit\xe1cora de Cambios - Customs Reports","Generado el: ".concat(r)),n=_.Wp.book_new();_.Wp.book_append_sheet(n,t,"Reporte Aforo Casos"),_.Wp.book_append_sheet(n,i,"Bit\xe1cora de Cambios"),_._h(n,"Reporte_Aforo_".concat(s.toISOString().split("T")[0],".xlsx"))}function et(){let{user:e,loading:a}=(0,i.A)(),{toast:s}=(0,P.dj)(),[x,f]=(0,t.useState)([]),[j,g]=(0,t.useState)(!0),[v,N]=(0,t.useState)(""),[y,w]=(0,t.useState)(""),[b,A]=(0,t.useState)(null),[C,k]=(0,t.useState)(null),[E,S]=(0,t.useState)(null),[R,D]=(0,t.useState)([]),[O,_]=(0,t.useState)(!1),z=(0,t.useCallback)(()=>{if(!e)return;g(!0);let a=(0,l.P)((0,l.rJ)(n.db,"worksheets"),(0,l._M)("worksheetType","in",["hoja_de_trabajo",null]),(0,l.My)("createdAt","desc"));return(0,l.aQ)(a,async e=>{let a=e.docs.map(async e=>{let a={id:e.id,...e.data()},s=(0,l.H9)(n.db,"worksheets/".concat(e.id,"/aforo/metadata")),r=await (0,l.x7)(s);return r.exists()&&(a.aforo=r.data()),a});f(await Promise.all(a)),g(!1)},e=>{console.error("Error fetching worksheets:",e),s({title:"Error",description:"No se pudieron cargar las hojas de trabajo.",variant:"destructive"}),g(!1)})},[e,s]);(0,t.useEffect)(()=>{let e=z();return()=>{e&&e()}},[z]);let M=async()=>{if(0===L.length)return void s({title:"No hay datos",description:"No hay casos en la tabla para exportar.",variant:"secondary"});_(!0);let e=L.map(e=>({id:e.id,ne:e.ne,consignee:e.consignee,merchandise:e.description,declarationPattern:e.patternRegime,...e.aforo||{}})),a=[];for(let e of L){let s=(0,l.P)((0,l.rJ)(n.db,"worksheets",e.id,"actualizaciones"),(0,l.My)("updatedAt","asc"));(await (0,l.GG)(s)).forEach(s=>{a.push({...s.data(),caseNe:e.ne})})}try{await er(e,a)}catch(e){console.error("Error exporting:",e),s({title:"Error de Exportaci\xf3n",description:"No se pudo generar el archivo Excel.",variant:"destructive"})}finally{_(!1)}},L=(0,t.useMemo)(()=>x.filter(e=>{let a=!v||e.ne.toLowerCase().includes(v.toLowerCase()),s=!y||e.consignee.toLowerCase().includes(y.toLowerCase());return a&&s}),[x,v,y]);return(0,r.jsxs)(o.G,{children:[(0,r.jsx)("div",{className:"py-2 md:py-5",children:(0,r.jsxs)(d.Zp,{className:"w-full max-w-screen-2xl mx-auto custom-shadow",children:[(0,r.jsxs)(d.aR,{children:[(0,r.jsx)(d.ZB,{children:"Gesti\xf3n Local de Aforo"}),(0,r.jsx)(d.BT,{children:"Nueva vista optimizada para la asignaci\xf3n y seguimiento de aforos sobre hojas de trabajo."}),(0,r.jsxs)("div",{className:"flex flex-col sm:flex-row gap-4 pt-4 border-t",children:[(0,r.jsx)(h.p,{placeholder:"Filtrar por NE...",value:v,onChange:e=>N(e.target.value),className:"max-w-xs"}),(0,r.jsx)(h.p,{placeholder:"Filtrar por Consignatario...",value:y,onChange:e=>w(e.target.value),className:"max-w-xs"}),(0,r.jsxs)("div",{className:"flex gap-2 flex-wrap",children:[(0,r.jsxs)(c.$,{variant:"outline",onClick:()=>A({isOpen:!0,type:"bulk-aforador"}),disabled:0===R.length,children:["Asignar Aforador (",R.length,")"]}),(0,r.jsxs)(c.$,{variant:"outline",onClick:()=>A({isOpen:!0,type:"bulk-revisor"}),disabled:0===R.length,children:["Asignar Revisor (",R.length,")"]}),(0,r.jsxs)(c.$,{variant:"outline",onClick:()=>A({isOpen:!0,type:"bulk-digitador"}),disabled:0===R.length,children:["Asignar Digitador (",R.length,")"]}),(0,r.jsxs)(c.$,{onClick:M,variant:"outline",disabled:O,children:[O?(0,r.jsx)(u.A,{className:"mr-2 h-4 w-4 animate-spin"}):(0,r.jsx)(m.A,{className:"mr-2 h-4 w-4"}),"Exportar"]})]})]})]}),(0,r.jsx)(d.Wu,{children:j?(0,r.jsx)("div",{className:"flex justify-center items-center py-10",children:(0,r.jsx)(u.A,{className:"h-8 w-8 animate-spin"})}):0===L.length?(0,r.jsxs)("div",{className:"text-center py-10",children:[(0,r.jsx)(p.A,{className:"mx-auto h-12 w-12 text-muted-foreground"}),(0,r.jsx)("h3",{className:"mt-2 text-lg font-medium",children:"No hay hojas de trabajo"}),(0,r.jsx)("p",{className:"text-muted-foreground",children:"No se encontraron hojas de trabajo con los filtros actuales."})]}):(0,r.jsx)(J,{worksheets:L,setWorksheets:f,selectedRows:R,setSelectedRows:D,onAssign:(e,a)=>A({isOpen:!0,type:a,worksheet:e}),onComment:e=>k({isOpen:!0,worksheet:e}),onView:e=>S({isOpen:!0,worksheet:e}),isLoading:j,onRefresh:z})})]})}),b&&(0,r.jsx)(W,{isOpen:b.isOpen,onClose:()=>A(null),worksheet:b.worksheet,type:b.type,selectedWorksheetIds:R,setWorksheets:f}),C&&(0,r.jsx)(X,{isOpen:C.isOpen,onClose:()=>k(null),worksheet:C.worksheet}),E&&(0,r.jsx)(K.j,{isOpen:E.isOpen,onClose:()=>S(null),worksheet:E.worksheet})]})}},98053:(e,a,s)=>{"use strict";s.d(a,{$v:()=>f,EO:()=>m,Lt:()=>o,Rx:()=>j,Zr:()=>g,ck:()=>h,r7:()=>x,tv:()=>d,wd:()=>p});var r=s(95155),t=s(12115),i=s(35646),n=s(64269),l=s(3998);let o=i.bL,d=i.l9,c=i.ZL,u=t.forwardRef((e,a)=>{let{className:s,...t}=e;return(0,r.jsx)(i.hJ,{className:(0,n.cn)("fixed inset-0 z-50 bg-black/80  data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0",s),...t,ref:a})});u.displayName=i.hJ.displayName;let m=t.forwardRef((e,a)=>{let{className:s,...t}=e;return(0,r.jsxs)(c,{children:[(0,r.jsx)(u,{}),(0,r.jsx)(i.UC,{ref:a,className:(0,n.cn)("fixed left-[50%] top-[50%] z-50 grid w-full max-w-lg translate-x-[-50%] translate-y-[-50%] gap-4 border bg-background p-6 shadow-lg duration-200 data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0 data-[state=closed]:zoom-out-95 data-[state=open]:zoom-in-95 data-[state=closed]:slide-out-to-left-1/2 data-[state=closed]:slide-out-to-top-[48%] data-[state=open]:slide-in-from-left-1/2 data-[state=open]:slide-in-from-top-[48%] sm:rounded-lg",s),...t})]})});m.displayName=i.UC.displayName;let p=e=>{let{className:a,...s}=e;return(0,r.jsx)("div",{className:(0,n.cn)("flex flex-col space-y-2 text-center sm:text-left",a),...s})};p.displayName="AlertDialogHeader";let h=e=>{let{className:a,...s}=e;return(0,r.jsx)("div",{className:(0,n.cn)("flex flex-col-reverse sm:flex-row sm:justify-end sm:space-x-2",a),...s})};h.displayName="AlertDialogFooter";let x=t.forwardRef((e,a)=>{let{className:s,...t}=e;return(0,r.jsx)(i.hE,{ref:a,className:(0,n.cn)("text-lg font-semibold",s),...t})});x.displayName=i.hE.displayName;let f=t.forwardRef((e,a)=>{let{className:s,...t}=e;return(0,r.jsx)(i.VY,{ref:a,className:(0,n.cn)("text-sm text-muted-foreground",s),...t})});f.displayName=i.VY.displayName;let j=t.forwardRef((e,a)=>{let{className:s,...t}=e;return(0,r.jsx)(i.rc,{ref:a,className:(0,n.cn)((0,l.r)(),s),...t})});j.displayName=i.rc.displayName;let g=t.forwardRef((e,a)=>{let{className:s,...t}=e;return(0,r.jsx)(i.ZD,{ref:a,className:(0,n.cn)((0,l.r)({variant:"outline"}),"mt-2 sm:mt-0",s),...t})});g.displayName=i.ZD.displayName}},e=>{e.O(0,[2992,7138,3524,4865,2130,2619,3326,5282,9351,3504,7566,5479,5171,9817,9321,8441,1255,7358],()=>e(e.s=31994)),_N_E=e.O()}]);