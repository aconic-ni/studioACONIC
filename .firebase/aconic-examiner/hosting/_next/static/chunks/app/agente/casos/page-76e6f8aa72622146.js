(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[8479],{6713:(e,a,s)=>{"use strict";s.d(a,{A:()=>t});let t=(0,s(14294).A)("Link",[["path",{d:"M10 13a5 5 0 0 0 7.54.54l3-3a5 5 0 0 0-7.07-7.07l-1.72 1.71",key:"1cjeqo"}],["path",{d:"M14 11a5 5 0 0 0-7.54-.54l-3 3a5 5 0 0 0 7.07 7.07l1.71-1.71",key:"19qd67"}]])},8614:(e,a,s)=>{"use strict";s.r(a),s.d(a,{default:()=>ee});var t=s(95155),r=s(12115),l=s(14585),i=s(19708),n=s(54901),d=s(35434),c=s(92033),o=s(24820),h=s(21799),u=s(28127),m=s(50817),x=s(90109),p=s(87455),j=s(77187),v=s(60406),y=s(59915),f=s(87270),b=s(73457),g=s(86948),N=s(3998),A=s(11647),k=s(47691),w=s(33086),C=s(90231),S=s(79894),M=s(22544),E=s(66942),q=s(15653),P=s(51834),z=s(41052),R=s(31120),D=s(15894);let H=q.z.object({comment:q.z.string().min(1,"La observaci\xf3n es requerida para rechazar.")});function V(e){let{isOpen:a,onClose:s,caseData:d}=e,{user:o}=(0,n.A)(),{toast:h}=(0,D.dj)(),[u,m]=(0,r.useState)(!1),x=(0,M.mN)({resolver:(0,E.u)(H),defaultValues:{comment:""}});(0,r.useEffect)(()=>{a&&x.reset({comment:d.observacionRevisor||""})},[a,d,x]);let p=(null==o?void 0:o.roleTitle)==="agente aduanero"||(null==o?void 0:o.role)==="admin"||(null==o?void 0:o.role)==="supervisor",j=async function(e){let a=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"";if(!o||!o.displayName)return void h({title:"Error",description:"Debe estar autenticado.",variant:"destructive"});if("Rechazado"===e&&!a.trim())return void x.setError("comment",{message:"La observaci\xf3n es requerida para rechazar."});m(!0);let t=(0,i.H9)(l.db,"AforoCases",d.id),r=(0,i.rJ)(t,"actualizaciones");try{await (0,i.mZ)(t,{revisorStatus:e,observacionRevisor:a,revisorStatusLastUpdate:{by:o.displayName,at:i.Dc.now()}});let l={updatedAt:i.Dc.now(),updatedBy:o.displayName,field:"status_change",oldValue:d.revisorStatus||"Pendiente",newValue:e,comment:a};await (0,i.gS)(r,l),h({title:"Caso ".concat(e),description:"El estado del caso ha sido actualizado."}),s()}catch(e){console.error("Error updating case status:",e),h({title:"Error",description:"No se pudo actualizar el estado del caso.",variant:"destructive"})}finally{m(!1)}};return a?(0,t.jsx)(P.lG,{open:a,onOpenChange:s,children:(0,t.jsxs)(P.Cf,{className:"sm:max-w-md",children:[(0,t.jsxs)(P.c7,{children:[(0,t.jsx)(P.L3,{children:"Observaciones del Revisor"}),(0,t.jsxs)(P.rr,{children:["Revisi\xf3n para el caso NE: ",(0,t.jsx)("span",{className:"font-bold text-foreground",children:d.ne})]})]}),(0,t.jsx)(z.lV,{...x,children:(0,t.jsxs)("form",{className:"space-y-4 py-4",children:[(0,t.jsxs)("div",{className:"space-y-2",children:[(0,t.jsx)("p",{className:"text-sm font-medium",children:"Estado Actual"}),(0,t.jsx)(A.E,{variant:"Rechazado"===d.revisorStatus?"destructive":"secondary",children:d.revisorStatus||"Pendiente"})]}),(0,t.jsx)(z.zB,{control:x.control,name:"comment",render:e=>{var a;let{field:s}=e;return(0,t.jsxs)(z.eI,{children:[(0,t.jsx)(z.lR,{children:"Observaci\xf3n"}),(0,t.jsx)(z.MJ,{children:(0,t.jsx)(R.T,{...s,rows:5,value:null!=(a=s.value)?a:"",disabled:!p||u,placeholder:p?"A\xf1ada sus observaciones aqu\xed...":"Sin observaciones."})}),(0,t.jsx)(z.C5,{})]})}}),p?(0,t.jsxs)(P.Es,{className:"pt-4 gap-2 sm:gap-0",children:[(0,t.jsxs)(N.$,{type:"button",variant:"destructive",onClick:()=>{j("Rechazado",x.getValues("comment"))},disabled:u,children:[u?(0,t.jsx)(c.A,{className:"mr-2 h-4 w-4 animate-spin"}):null," Rechazar"]}),(0,t.jsxs)(N.$,{type:"button",variant:"default",onClick:()=>{j("Aprobado",x.getValues("comment"))},disabled:u,children:[u?(0,t.jsx)(c.A,{className:"mr-2 h-4 w-4 animate-spin"}):null," Aprobar"]})]}):(0,t.jsx)(P.Es,{className:"pt-4",children:(0,t.jsx)(N.$,{type:"button",variant:"outline",onClick:s,children:"Cerrar"})})]})})]})}):null}var F=s(65142),I=s(82206),L=s(11186),_=s(6259),B=s(67421),$=s(49205),O=s(44385),Z=s(13496),T=s(18527),G=s(28068),J=s(62593);let W=e=>{let{label:a,children:s}=e;return(0,t.jsxs)("div",{className:"flex justify-between items-start py-2 border-b border-border/50",children:[(0,t.jsx)("p",{className:"text-sm font-medium text-muted-foreground",children:a}),(0,t.jsx)("div",{className:"text-sm text-right text-foreground",children:s})]})},U=e=>{let{caseItem:a,caseActions:s}=e,r="Pendiente"===a.revisorStatus||!a.revisorStatus;return(0,t.jsxs)(g.Zp,{className:"w-full",children:[(0,t.jsx)(g.aR,{children:(0,t.jsxs)("div",{className:"flex justify-between items-start",children:[(0,t.jsxs)("div",{children:[(0,t.jsx)(g.ZB,{className:"font-bold text-lg text-primary",children:a.ne}),(0,t.jsx)("p",{className:"text-sm text-muted-foreground truncate max-w-[200px]",children:a.consignee})]}),(0,t.jsxs)(A.E,{variant:(e=>{switch(e){case"Aprobado":return"default";case"Rechazado":return"destructive";case"Revalidaci\xf3n Solicitada":return"secondary";default:return"outline"}})(a.revisorStatus),className:"flex items-center gap-1",children:[(e=>{switch(e){case"Aprobado":return(0,t.jsx)(T.A,{className:"h-4 w-4 text-green-500"});case"Rechazado":return(0,t.jsx)(G.A,{className:"h-4 w-4 text-red-500"});default:return(0,t.jsx)(J.A,{className:"h-4 w-4 text-gray-500"})}})(a.revisorStatus),a.revisorStatus||"Pendiente"]})]})}),(0,t.jsxs)(g.Wu,{children:[(0,t.jsxs)("div",{className:"space-y-2 mb-4",children:[(0,t.jsx)(W,{label:"Aforador",children:a.aforador||"N/A"}),(0,t.jsx)(W,{label:"Modelo",children:a.declarationPattern}),(0,t.jsx)(W,{label:"Posiciones",children:a.totalPosiciones||"N/A"})]}),(0,t.jsx)(Z.nD,{type:"single",collapsible:!0,className:"w-full",children:(0,t.jsxs)(Z.As,{value:"item-1",children:[(0,t.jsx)(Z.$m,{children:"M\xe1s Detalles"}),(0,t.jsx)(Z.ub,{children:(0,t.jsxs)("div",{className:"space-y-2 pt-2",children:[(0,t.jsx)(W,{label:"Estado Preliquidaci\xf3n",children:"Aprobada"===a.preliquidationStatus?(0,t.jsx)(A.E,{variant:"default",className:"bg-green-600",children:"Aprobada"}):(0,t.jsx)(A.E,{variant:"outline",children:"Pendiente"})}),(0,t.jsx)(W,{label:"Digitador",children:a.digitadorAsignado||"N/A"}),(0,t.jsx)(W,{label:"Estado Digitaci\xf3n",children:(e=>e?(0,t.jsx)(A.E,{variant:"En Proceso"===e?"secondary":"outline",children:e}):(0,t.jsx)(A.E,{variant:"outline",children:"Pendiente"}))(a.digitacionStatus)})]})})]})})]}),(0,t.jsxs)(g.wL,{className:"flex justify-between gap-2",children:[(0,t.jsxs)(_.rI,{children:[(0,t.jsx)(_.ty,{asChild:!0,children:(0,t.jsx)(N.$,{variant:"outline",size:"sm",children:"Ver..."})}),(0,t.jsxs)(_.SQ,{children:[(0,t.jsxs)(_._2,{onSelect:()=>s.handleViewWorksheet(a),children:[(0,t.jsx)(j.A,{className:"mr-2 h-4 w-4"})," Hoja de Trabajo"]}),a.incidentReported&&(0,t.jsxs)(_._2,{onSelect:()=>s.setIncidentToView(a),children:[(0,t.jsx)(v.A,{className:"mr-2 h-4 w-4"})," Incidencia"]}),(0,t.jsxs)(_._2,{onSelect:()=>s.openActionModal(a,"history"),children:[(0,t.jsx)(y.A,{className:"mr-2 h-4 w-4"})," Bit\xe1cora"]})]})]}),(0,t.jsxs)("div",{className:"flex gap-2",children:[(0,t.jsx)(N.$,{size:"sm",variant:"destructive",onClick:()=>s.openActionModal(a,"observation"),disabled:!r,children:"Rechazar"}),(0,t.jsx)(N.$,{size:"sm",onClick:()=>s.openActionModal(a,"observation"),disabled:!r,children:"Aprobar"})]})]})]},a.id)};var Q=s(9691);let X=[{value:0,label:"Enero"},{value:1,label:"Febrero"},{value:2,label:"Marzo"},{value:3,label:"Abril"},{value:4,label:"Mayo"},{value:5,label:"Junio"},{value:6,label:"Julio"},{value:7,label:"Agosto"},{value:8,label:"Septiembre"},{value:9,label:"Octubre"},{value:10,label:"Noviembre"},{value:11,label:"Diciembre"}],Y=new Date().getFullYear(),K=Array.from({length:5},(e,a)=>Y-a);function ee(){let{user:e,loading:a}=(0,n.A)(),s=(0,O.a)(),[M,E]=(0,r.useState)([]),[q,P]=(0,r.useState)([]),[z,R]=(0,r.useState)(!0),[H,Z]=(0,r.useState)(null),[T,G]=(0,r.useState)(!1),[J,W]=(0,r.useState)(!1),[ee,ea]=(0,r.useState)(null),[es,et]=(0,r.useState)(null),{toast:er}=(0,D.dj)(),[el,ei]=(0,r.useState)(!1),[en,ed]=(0,r.useState)(""),[ec,eo]=(0,r.useState)("Pendiente"),[eh,eu]=(0,r.useState)("range"),[em,ex]=(0,r.useState)(),[ep,ej]=(0,r.useState)(new Date().getMonth()),[ev,ey]=(0,r.useState)(Y),[ef,eb]=(0,r.useState)([]),eg=(0,r.useCallback)(async()=>{if(!e||"agente aduanero"!==e.roleTitle&&"supervisor"!==e.role)return void R(!1);R(!0);try{let a=(0,i.P)((0,i.rJ)(l.db,"AforoCases"),(0,i._M)("revisorAsignado","==",e.displayName),(0,i.My)("createdAt","desc")),s=(await (0,i.GG)(a)).docs.map(e=>({id:e.id,...e.data()}));E(s)}catch(e){console.error("Error fetching assigned cases:",e)}finally{R(!1)}},[e]);(0,r.useEffect)(()=>{eg()},[eg]);let eN=(0,r.useCallback)(()=>{let e,a,s=[...M];en&&(s=s.filter(e=>e.ne.toLowerCase().includes(en.toLowerCase()))),"todos"!==ec&&(s=s.filter(e=>(e.revisorStatus||"Pendiente")===ec));let t=s;if("range"===eh&&(null==em?void 0:em.from))e=(0,k.o)(em.from),a=em.to?(0,w.D)(em.to):(0,w.D)(em.from);else if("month"===eh)e=(0,C.w)(new Date(ev,ep)),a=(0,S.p)(new Date(ev,ep));else if("today"===eh){let s=new Date;e=(0,k.o)(s),a=(0,w.D)(s)}e&&a&&(t=s.filter(s=>{var t;let r=null==(t=s.assignmentDate)?void 0:t.toDate();return r&&r>=e&&r<=a})),P(t)},[M,en,ec,eh,em,ep,ev]);(0,r.useEffect)(()=>{eN()},[M,eN]);let eA=async()=>{if(0===ef.length||!(null==e?void 0:e.displayName))return;ei(!0);let a=(0,i.wP)(l.db),s="Aprobado",t="Aprobado masivamente por agente aduanero.";ef.forEach(r=>{let n=(0,i.H9)(l.db,"AforoCases",r),d=M.find(e=>e.id===r);a.update(n,{revisorStatus:s,observacionRevisor:t,revisorStatusLastUpdate:{by:e.displayName,at:i.Dc.now()}});let c=(0,i.rJ)(n,"actualizaciones"),o={updatedAt:i.Dc.now(),updatedBy:e.displayName,field:"status_change",oldValue:(null==d?void 0:d.revisorStatus)||"Pendiente",newValue:s,comment:t};a.set((0,i.H9)(c),o)});try{await a.commit(),er({title:"\xc9xito",description:"".concat(ef.length," casos han sido aprobados.")}),eb([]),eg()}catch(e){console.error("Error bulk approving cases:",e),er({title:"Error",description:"No se pudieron aprobar los casos seleccionados.",variant:"destructive"})}finally{ei(!1)}},ek=(e,a)=>{Z(e),"observation"===a&&G(!0),"history"===a&&W(!0)},ew=async e=>{if(!e.worksheetId)return void er({title:"Sin Hoja de Trabajo",description:"Este caso no tiene una hoja de trabajo asociada.",variant:"destructive"});try{let a=(0,i.H9)(l.db,"worksheets",e.worksheetId),s=await (0,i.x7)(a);s.exists()?ea({id:s.id,...s.data()}):er({title:"Error",description:"No se pudo encontrar la hoja de trabajo.",variant:"destructive"})}catch(e){er({title:"Error",description:"Ocurri\xf3 un error al cargar la hoja de trabajo.",variant:"destructive"})}};if(a||!e)return(0,t.jsx)("div",{className:"min-h-screen flex items-center justify-center bg-background",children:(0,t.jsx)(c.A,{className:"h-12 w-12 animate-spin text-primary"})});if(es)return(0,t.jsx)(d.G,{children:(0,t.jsx)("div",{className:"py-2 md:py-5",children:(0,t.jsx)(B.h,{caseData:es,onClose:()=>et(null)})})});let eC={openActionModal:ek,handleViewWorksheet:ew,setIncidentToView:et};return(0,t.jsxs)(d.G,{children:[(0,t.jsx)("div",{className:"py-2 md:py-5",children:(0,t.jsxs)(g.Zp,{className:"w-full max-w-screen-2xl mx-auto custom-shadow",children:[(0,t.jsxs)(g.aR,{children:[(0,t.jsxs)("div",{className:"flex justify-between items-center",children:[(0,t.jsx)(g.ZB,{children:"Mis Casos Asignados"}),(0,t.jsxs)(N.$,{onClick:eA,disabled:0===ef.length||el,children:[el&&(0,t.jsx)(c.A,{className:"mr-2 h-4 w-4 animate-spin"}),(0,t.jsx)(o.A,{className:"mr-2 h-4 w-4"})," Aprobar Seleccionados (",ef.length,")"]})]}),(0,t.jsx)(g.BT,{children:"Aqu\xed se listan los casos de aforo que requieren su revisi\xf3n y aprobaci\xf3n."}),(0,t.jsxs)("div",{className:"border-t pt-4 mt-2 space-y-4",children:[(0,t.jsxs)("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-4",children:[(0,t.jsx)(F.p,{placeholder:"Buscar por NE...",value:en,onChange:e=>ed(e.target.value)}),(0,t.jsxs)(L.l6,{value:ec,onValueChange:e=>eo(e),children:[(0,t.jsx)(L.bq,{children:(0,t.jsx)(L.yv,{})}),(0,t.jsxs)(L.gC,{children:[(0,t.jsx)(L.eb,{value:"todos",children:"Todos los Estados"}),(0,t.jsx)(L.eb,{value:"Pendiente",children:"Pendientes"}),(0,t.jsx)(L.eb,{value:"Aprobado",children:"Aprobados"}),(0,t.jsx)(L.eb,{value:"Rechazado",children:"Rechazados"})]})]}),(0,t.jsxs)(L.l6,{value:eh,onValueChange:e=>eu(e),children:[(0,t.jsx)(L.bq,{children:(0,t.jsx)(L.yv,{})}),(0,t.jsxs)(L.gC,{children:[(0,t.jsxs)(L.eb,{value:"range",children:[(0,t.jsx)(h.A,{className:"mr-2 h-4 w-4 inline"}),"Rango de Fechas"]}),(0,t.jsxs)(L.eb,{value:"month",children:[(0,t.jsx)(u.A,{className:"mr-2 h-4 w-4 inline"}),"Mes Espec\xedfico"]}),(0,t.jsxs)(L.eb,{value:"today",children:[(0,t.jsx)(m.A,{className:"mr-2 h-4 w-4 inline"}),"Hoy"]})]})]})]}),(0,t.jsxs)("div",{className:"flex flex-wrap items-center gap-4",children:["range"===eh&&(0,t.jsx)(I.S,{date:em,onDateChange:ex}),"month"===eh&&(0,t.jsxs)("div",{className:"flex gap-2",children:[(0,t.jsxs)(L.l6,{value:String(ep),onValueChange:e=>ej(Number(e)),children:[(0,t.jsx)(L.bq,{className:"w-[180px]",children:(0,t.jsx)(L.yv,{})}),(0,t.jsx)(L.gC,{children:X.map(e=>(0,t.jsx)(L.eb,{value:String(e.value),children:e.label},e.value))})]}),(0,t.jsxs)(L.l6,{value:String(ev),onValueChange:e=>ey(Number(e)),children:[(0,t.jsx)(L.bq,{className:"w-[120px]",children:(0,t.jsx)(L.yv,{})}),(0,t.jsx)(L.gC,{children:K.map(e=>(0,t.jsx)(L.eb,{value:String(e),children:e},e))})]})]}),(0,t.jsxs)(N.$,{onClick:()=>{eN()},children:[(0,t.jsx)(x.A,{className:"mr-2 h-4 w-4"})," Buscar"]}),(0,t.jsx)(N.$,{variant:"outline",onClick:()=>{ed(""),eo("Pendiente"),eu("range"),ex(void 0),P(M.filter(e=>"Pendiente"===(e.revisorStatus||"Pendiente"))),eb([])},children:"Limpiar Filtros"})]})]})]}),(0,t.jsx)(g.Wu,{children:z?(0,t.jsx)("div",{className:"flex justify-center items-center py-10",children:(0,t.jsx)(c.A,{className:"h-8 w-8 animate-spin text-primary"})}):0===q.length?(0,t.jsxs)("div",{className:"text-center py-10 px-6 bg-secondary/30 rounded-lg",children:[(0,t.jsx)(p.A,{className:"mx-auto h-12 w-12 text-muted-foreground"}),(0,t.jsx)("h3",{className:"mt-4 text-lg font-medium text-foreground",children:"No se encontraron casos"}),(0,t.jsx)("p",{className:"mt-1 text-muted-foreground",children:"No hay casos que coincidan con los filtros actuales."})]}):s?(0,t.jsx)("div",{className:"space-y-4",children:q.map(e=>(0,t.jsx)(U,{caseItem:e,caseActions:eC},e.id))}):(0,t.jsx)("div",{className:"overflow-x-auto table-container rounded-lg border",children:(0,t.jsxs)(f.XI,{children:[(0,t.jsx)(f.A0,{children:(0,t.jsxs)(f.Hj,{children:[(0,t.jsx)(f.nd,{className:"w-12",children:(0,t.jsx)(b.S,{checked:ef.length>0&&ef.length===q.filter(e=>"Pendiente"===e.revisorStatus).length,onCheckedChange:()=>{ef.length===q.filter(e=>"Pendiente"===e.revisorStatus).length?eb([]):eb(q.filter(e=>"Pendiente"===e.revisorStatus).map(e=>e.id))}})}),(0,t.jsx)(f.nd,{children:"Acciones"}),(0,t.jsx)(f.nd,{children:"NE"}),(0,t.jsx)(f.nd,{children:"Consignatario"}),(0,t.jsx)(f.nd,{children:"Aforador"}),(0,t.jsx)(f.nd,{children:"Estado Revisor"}),(0,t.jsx)(f.nd,{children:"Modelo"}),(0,t.jsx)(f.nd,{children:"Posiciones"}),(0,t.jsx)(f.nd,{children:"Estado Preliquidaci\xf3n"}),(0,t.jsx)(f.nd,{children:"Digitador"}),(0,t.jsx)(f.nd,{children:"Estado Digitaci\xf3n"})]})}),(0,t.jsx)(f.BF,{children:q.map(e=>{var a;return(0,t.jsxs)(f.Hj,{"data-state":ef.includes(e.id)?"selected":void 0,children:[(0,t.jsx)(f.nA,{children:(0,t.jsx)(b.S,{checked:ef.includes(e.id),onCheckedChange:()=>eb(a=>a.includes(e.id)?a.filter(a=>a!==e.id):[...a,e.id]),disabled:"Pendiente"!==e.revisorStatus})}),(0,t.jsx)(f.nA,{children:(0,t.jsxs)("div",{className:"flex items-center gap-1",children:[(0,t.jsxs)(_.rI,{children:[(0,t.jsx)(_.ty,{asChild:!0,children:(0,t.jsx)(N.$,{variant:"ghost",size:"sm",children:"Ver"})}),(0,t.jsxs)(_.SQ,{children:[(0,t.jsxs)(_._2,{onSelect:()=>ew(e),children:[(0,t.jsx)(j.A,{className:"mr-2 h-4 w-4"})," Hoja de Trabajo"]}),e.incidentReported&&(0,t.jsxs)(_._2,{onSelect:()=>et(e),children:[(0,t.jsx)(v.A,{className:"mr-2 h-4 w-4"})," Incidencia"]}),(0,t.jsxs)(_._2,{onSelect:()=>ek(e,"history"),children:[(0,t.jsx)(y.A,{className:"mr-2 h-4 w-4"})," Bit\xe1cora"]})]})]}),(0,t.jsx)(N.$,{size:"sm",variant:"default",onClick:()=>ek(e,"observation"),children:"Gestionar"})]})}),(0,t.jsx)(f.nA,{className:"font-medium",children:e.ne}),(0,t.jsx)(f.nA,{children:e.consignee}),(0,t.jsx)(f.nA,{children:e.aforador||"N/A"}),(0,t.jsx)(f.nA,{children:(0,t.jsx)(A.E,{variant:(e=>{switch(e){case"Aprobado":return"default";case"Rechazado":return"destructive";case"Revalidaci\xf3n Solicitada":return"secondary";default:return"outline"}})(e.revisorStatus),children:e.revisorStatus||"Pendiente"})}),(0,t.jsx)(f.nA,{children:e.declarationPattern}),(0,t.jsx)(f.nA,{children:e.totalPosiciones||"N/A"}),(0,t.jsx)(f.nA,{children:"Aprobada"===e.preliquidationStatus?(0,t.jsx)(A.E,{variant:"default",className:"bg-green-600",children:"Aprobada"}):(0,t.jsx)(A.E,{variant:"outline",children:"Pendiente"})}),(0,t.jsx)(f.nA,{children:e.digitadorAsignado||"N/A"}),(0,t.jsx)(f.nA,{children:(a=e.digitacionStatus)?(0,t.jsx)(A.E,{variant:"En Proceso"===a?"secondary":"outline",children:a}):(0,t.jsx)(A.E,{variant:"outline",children:"Pendiente"})})]},e.id)})})]})})})]})}),H&&(0,t.jsxs)(t.Fragment,{children:[(0,t.jsx)(V,{isOpen:T,onClose:()=>{G(!1),eg()},caseData:H}),(0,t.jsx)($.p,{isOpen:J,onClose:()=>{W(!1)},caseData:H})]}),ee&&(0,t.jsx)(Q.j,{isOpen:!!ee,onClose:()=>ea(null),worksheet:ee})]})}},9691:(e,a,s)=>{"use strict";s.d(a,{j:()=>n});var t=s(95155),r=s(51834),l=s(17037),i=s(59321);function n(e){let{isOpen:a,onClose:s,worksheet:n}=e;return a&&n?(0,t.jsx)(r.lG,{open:a,onOpenChange:s,children:(0,t.jsx)(r.Cf,{className:"max-w-4xl p-0 h-[90vh] flex flex-col",children:(0,t.jsx)(l.F,{className:"flex-grow",children:(0,t.jsx)("div",{className:"p-6",children:(0,t.jsx)(i.v,{worksheet:n,onClose:s})})})})}):null}},10639:(e,a,s)=>{"use strict";s.d(a,{A:()=>t});let t=(0,s(14294).A)("MapPin",[["path",{d:"M20 10c0 4.993-5.539 10.193-7.399 11.799a1 1 0 0 1-1.202 0C9.539 20.193 4 14.993 4 10a8 8 0 0 1 16 0",key:"1r0f0z"}],["circle",{cx:"12",cy:"10",r:"3",key:"ilqhr7"}]])},12036:(e,a,s)=>{"use strict";s.d(a,{A:()=>t});let t=(0,s(14294).A)("Pen",[["path",{d:"M21.174 6.812a1 1 0 0 0-3.986-3.987L3.842 16.174a2 2 0 0 0-.5.83l-1.321 4.352a.5.5 0 0 0 .623.622l4.353-1.32a2 2 0 0 0 .83-.497z",key:"1a8usu"}]])},13141:(e,a,s)=>{"use strict";s.d(a,{A:()=>t});let t=(0,s(14294).A)("Plane",[["path",{d:"M17.8 19.2 16 11l3.5-3.5C21 6 21.5 4 21 3c-1-.5-3 0-4.5 1.5L13 8 4.8 6.2c-.5-.1-.9.1-1.1.5l-.3.5c-.2.5-.1 1 .3 1.3L9 12l-2 3H4l-1 1 3 2 2 3 1-1v-3l3-2 3.5 5.3c.3.4.8.5 1.3.3l.5-.2c.4-.3.6-.7.5-1.2z",key:"1v9wt8"}]])},13496:(e,a,s)=>{"use strict";s.d(a,{$m:()=>o,As:()=>c,nD:()=>d,ub:()=>h});var t=s(95155),r=s(12115),l=s(16083),i=s(59007),n=s(64269);let d=l.bL,c=r.forwardRef((e,a)=>{let{className:s,...r}=e;return(0,t.jsx)(l.q7,{ref:a,className:(0,n.cn)("border-b",s),...r})});c.displayName="AccordionItem";let o=r.forwardRef((e,a)=>{let{className:s,children:r,...d}=e;return(0,t.jsx)(l.Y9,{className:"flex",children:(0,t.jsxs)(l.l9,{ref:a,className:(0,n.cn)("flex flex-1 items-center justify-between py-4 font-medium transition-all hover:underline [&[data-state=open]>svg]:rotate-180",s),...d,children:[r,(0,t.jsx)(i.A,{className:"h-4 w-4 shrink-0 transition-transform duration-200"})]})})});o.displayName=l.l9.displayName;let h=r.forwardRef((e,a)=>{let{className:s,children:r,...i}=e;return(0,t.jsx)(l.UC,{ref:a,className:"overflow-hidden text-sm transition-all data-[state=closed]:animate-accordion-up data-[state=open]:animate-accordion-down",...i,children:(0,t.jsx)("div",{className:(0,n.cn)("pb-4 pt-0",s),children:r})})});h.displayName=l.UC.displayName},16473:(e,a,s)=>{"use strict";s.d(a,{A:()=>t});let t=(0,s(14294).A)("FileKey",[["path",{d:"M15 2H6a2 2 0 0 0-2 2v16a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V7Z",key:"1rqfz7"}],["circle",{cx:"10",cy:"16",r:"2",key:"4ckbqe"}],["path",{d:"m16 10-4.5 4.5",key:"7p3ebg"}],["path",{d:"m15 11 1 1",key:"1bsyx3"}]])},21799:(e,a,s)=>{"use strict";s.d(a,{A:()=>t});let t=(0,s(14294).A)("CalendarRange",[["rect",{width:"18",height:"18",x:"3",y:"4",rx:"2",key:"1hopcy"}],["path",{d:"M16 2v4",key:"4m81vk"}],["path",{d:"M3 10h18",key:"8toen8"}],["path",{d:"M8 2v4",key:"1cmpym"}],["path",{d:"M17 14h-6",key:"bkmgh3"}],["path",{d:"M13 18H7",key:"bb0bb7"}],["path",{d:"M7 14h.01",key:"1qa3f1"}],["path",{d:"M17 18h.01",key:"1bdyru"}]])},22637:(e,a,s)=>{"use strict";s.d(a,{A:()=>t});let t=(0,s(14294).A)("FileSymlink",[["path",{d:"m10 18 3-3-3-3",key:"18f6ys"}],["path",{d:"M14 2v4a2 2 0 0 0 2 2h4",key:"tnqrlb"}],["path",{d:"M4 11V4a2 2 0 0 1 2-2h9l5 5v13a2 2 0 0 1-2 2H6a2 2 0 0 1-2-2v-3a2 2 0 0 1 2-2h7",key:"50q2rw"}]])},33086:(e,a,s)=>{"use strict";s.d(a,{D:()=>r});var t=s(43371);function r(e){let a=(0,t.a)(e);return a.setHours(23,59,59,999),a}},40671:(e,a,s)=>{"use strict";s.d(a,{A:()=>t});let t=(0,s(14294).A)("DollarSign",[["line",{x1:"12",x2:"12",y1:"2",y2:"22",key:"7eqyqh"}],["path",{d:"M17 5H9.5a3.5 3.5 0 0 0 0 7h5a3.5 3.5 0 0 1 0 7H6",key:"1b0p4s"}]])},41052:(e,a,s)=>{"use strict";s.d(a,{C5:()=>v,MJ:()=>j,eI:()=>x,lR:()=>p,lV:()=>c,zB:()=>h});var t=s(95155),r=s(12115),l=s(32467),i=s(22544),n=s(64269),d=s(76444);let c=i.Op,o=r.createContext({}),h=e=>{let{...a}=e;return(0,t.jsx)(o.Provider,{value:{name:a.name},children:(0,t.jsx)(i.xI,{...a})})},u=()=>{let e=r.useContext(o),a=r.useContext(m),{getFieldState:s,formState:t}=(0,i.xW)(),l=s(e.name,t);if(!e)throw Error("useFormField should be used within <FormField>");let{id:n}=a;return{id:n,name:e.name,formItemId:"".concat(n,"-form-item"),formDescriptionId:"".concat(n,"-form-item-description"),formMessageId:"".concat(n,"-form-item-message"),...l}},m=r.createContext({}),x=r.forwardRef((e,a)=>{let{className:s,...l}=e,i=r.useId();return(0,t.jsx)(m.Provider,{value:{id:i},children:(0,t.jsx)("div",{ref:a,className:(0,n.cn)("space-y-2",s),...l})})});x.displayName="FormItem";let p=r.forwardRef((e,a)=>{let{className:s,...r}=e,{error:l,formItemId:i}=u();return(0,t.jsx)(d.J,{ref:a,className:(0,n.cn)(l&&"text-destructive",s),htmlFor:i,...r})});p.displayName="FormLabel";let j=r.forwardRef((e,a)=>{let{...s}=e,{error:r,formItemId:i,formDescriptionId:n,formMessageId:d}=u();return(0,t.jsx)(l.DX,{ref:a,id:i,"aria-describedby":r?"".concat(n," ").concat(d):"".concat(n),"aria-invalid":!!r,...s})});j.displayName="FormControl",r.forwardRef((e,a)=>{let{className:s,...r}=e,{formDescriptionId:l}=u();return(0,t.jsx)("p",{ref:a,id:l,className:(0,n.cn)("text-sm text-muted-foreground",s),...r})}).displayName="FormDescription";let v=r.forwardRef((e,a)=>{var s;let{className:r,children:l,...i}=e,{error:d,formMessageId:c}=u(),o=d?String(null!=(s=null==d?void 0:d.message)?s:""):l;return o?(0,t.jsx)("p",{ref:a,id:c,className:(0,n.cn)("text-sm font-medium text-destructive",r),...i,children:o}):null});v.displayName="FormMessage"},49205:(e,a,s)=>{"use strict";s.d(a,{p:()=>g});var t=s(95155),r=s(12115),l=s(14585),i=s(19708),n=s(3998),d=s(51834),c=s(17037),o=s(18527),h=s(28068),u=s(54550),m=s(12036),x=s(59915),p=s(92033),j=s(27314),v=s(28127),y=s(5282),f=s(80160),b=s(64269);function g(e){let{isOpen:a,onClose:s,caseData:g}=e,[N,A]=(0,r.useState)([]),[k,w]=(0,r.useState)(!0);(0,r.useEffect)(()=>{if(!a||!(null==g?void 0:g.id))return void A([]);w(!0);let e=(0,i.rJ)(l.db,"AforoCases",g.id,"actualizaciones"),s=(0,i.P)(e,(0,i.My)("updatedAt","desc")),t=(0,i.aQ)(s,e=>{let a=[];e.forEach(e=>{a.push(e.data())}),A(a),w(!1)},e=>{console.error("Error fetching case history: ",e),w(!1)});return()=>t()},[a,g]);let C=e=>{if(!e)return"N/A";let a=(null==e?void 0:e.toDate)?e.toDate():e;return(0,y.GP)(a,"dd/MM/yy HH:mm",{locale:f.es})},S=e=>e instanceof i.Dc?C(e):"boolean"==typeof e?e?"S\xed":"No":null==e||""===e?(0,t.jsx)("i",{className:"text-muted-foreground",children:"vac\xedo"}):String(e);return a?(0,t.jsx)(d.lG,{open:a,onOpenChange:s,children:(0,t.jsxs)(d.Cf,{className:"max-w-xl",children:[(0,t.jsxs)(d.c7,{children:[(0,t.jsxs)(d.L3,{className:"flex items-center gap-2",children:[(0,t.jsx)(x.A,{})," Bit\xe1cora de Cambios"]}),(0,t.jsxs)(d.rr,{children:["Historial de actualizaciones para el caso NE: ",(0,t.jsx)("span",{className:"font-bold text-foreground",children:null==g?void 0:g.ne})]})]}),(0,t.jsx)(c.F,{className:"h-[60vh] -mx-6 px-6",children:(0,t.jsxs)("div",{className:"space-y-6 py-4",children:[k&&(0,t.jsx)("div",{className:"flex justify-center items-center py-8",children:(0,t.jsx)(p.A,{className:"h-8 w-8 animate-spin text-primary"})}),!k&&0===N.length&&(0,t.jsx)("div",{className:"text-center text-muted-foreground py-8",children:"No hay historial de cambios para este caso."}),!k&&N.map((e,a)=>(0,t.jsxs)("div",{className:"p-4 border rounded-lg bg-card shadow-sm relative",children:[(0,t.jsxs)("div",{className:"flex flex-col sm:flex-row justify-between items-start text-xs text-muted-foreground mb-3 border-b pb-2",children:[(0,t.jsxs)("div",{className:"flex items-center gap-2",children:[(0,t.jsx)(j.A,{className:"h-3 w-3"}),(0,t.jsx)("span",{className:"font-medium",children:e.updatedBy})]}),(0,t.jsxs)("div",{className:"flex items-center gap-2",children:[(0,t.jsx)(v.A,{className:"h-3 w-3"}),(0,t.jsx)("span",{className:"mt-1 sm:mt-0",children:C(e.updatedAt)})]})]}),(e=>{if("creation"===e.field)return(0,t.jsxs)("div",{className:"pl-4 border-l-2 border-blue-500",children:[(0,t.jsx)("div",{className:"flex items-center gap-2 font-semibold text-blue-500",children:(0,t.jsx)("p",{children:"Caso Creado"})}),(0,t.jsxs)("div",{className:"mt-2 text-sm italic bg-muted/50 p-2 rounded-md whitespace-pre-wrap",children:['"',e.comment,'"']})]});if("status_change"===e.field){let a,s,r;switch(e.newValue){case"Aprobado":a=o.A,s="Caso Aprobado",r="text-green-500";break;case"Rechazado":a=h.A,s="Caso Rechazado",r="text-destructive";break;case"Revalidaci\xf3n Solicitada":a=u.A,s="Revalidaci\xf3n Solicitada",r="text-amber-500";break;default:a=m.A,s="Cambio de Estado",r="text-foreground"}return(0,t.jsxs)("div",{className:(0,b.cn)("pl-4 border-l-2",r.replace("text-","border-")),children:[(0,t.jsxs)("div",{className:"flex items-center gap-2 font-semibold ".concat(r),children:[(0,t.jsx)(a,{className:"h-4 w-4"}),(0,t.jsx)("p",{children:s})]}),e.comment&&(0,t.jsxs)("div",{className:"mt-2 text-sm italic bg-muted/50 p-2 rounded-md whitespace-pre-wrap",children:['"',e.comment,'"']})]})}return(0,t.jsxs)("div",{className:"text-sm",children:[(0,t.jsxs)("p",{className:"font-medium text-muted-foreground",children:["Campo actualizado: ",(0,t.jsx)("code",{className:"bg-primary/10 text-primary px-2 py-1 rounded-sm",children:e.field})]}),(0,t.jsxs)("div",{className:"mt-1 grid grid-cols-[auto_1fr] gap-x-2 items-center",children:[(0,t.jsx)("span",{className:"text-destructive/80",children:"De:"})," ",(0,t.jsx)("span",{className:"text-destructive/80",children:S(e.oldValue)}),(0,t.jsx)("span",{className:"text-green-600",children:"A:"})," ",(0,t.jsx)("span",{className:"text-green-600 font-semibold",children:S(e.newValue)})]})]})})(e)]},a))]})}),(0,t.jsx)(d.Es,{children:(0,t.jsx)(n.$,{variant:"outline",onClick:s,children:"Cerrar"})})]})}):null}},54550:(e,a,s)=>{"use strict";s.d(a,{A:()=>t});let t=(0,s(14294).A)("Repeat",[["path",{d:"m17 2 4 4-4 4",key:"nntrym"}],["path",{d:"M3 11v-1a4 4 0 0 1 4-4h14",key:"84bu3i"}],["path",{d:"m7 22-4-4 4-4",key:"1wqhfi"}],["path",{d:"M21 13v1a4 4 0 0 1-4 4H3",key:"1rx37r"}]])},54715:(e,a,s)=>{"use strict";s.d(a,{A:()=>t});let t=(0,s(14294).A)("Receipt",[["path",{d:"M4 2v20l2-1 2 1 2-1 2 1 2-1 2 1 2-1 2 1V2l-2 1-2-1-2 1-2-1-2 1-2-1-2 1Z",key:"q3az6g"}],["path",{d:"M16 8h-6a2 2 0 1 0 0 4h4a2 2 0 1 1 0 4H8",key:"1h4pet"}],["path",{d:"M12 17.5v-11",key:"1jc1ny"}]])},57325:(e,a,s)=>{"use strict";s.d(a,{A:()=>t});let t=(0,s(14294).A)("FileBadge",[["path",{d:"M12 22h6a2 2 0 0 0 2-2V7l-5-5H6a2 2 0 0 0-2 2v3",key:"12ixgl"}],["path",{d:"M14 2v4a2 2 0 0 0 2 2h4",key:"tnqrlb"}],["path",{d:"M5 17a3 3 0 1 0 0-6 3 3 0 0 0 0 6Z",key:"u0c8gj"}],["path",{d:"M7 16.5 8 22l-3-1-3 1 1-5.5",key:"5gm2nr"}]])},59915:(e,a,s)=>{"use strict";s.d(a,{A:()=>t});let t=(0,s(14294).A)("History",[["path",{d:"M3 12a9 9 0 1 0 9-9 9.75 9.75 0 0 0-6.74 2.74L3 8",key:"1357e3"}],["path",{d:"M3 3v5h5",key:"1xhq8a"}],["path",{d:"M12 7v5l4 2",key:"1fdv2h"}]])},62593:(e,a,s)=>{"use strict";s.d(a,{A:()=>t});let t=(0,s(14294).A)("Clock",[["circle",{cx:"12",cy:"12",r:"10",key:"1mglay"}],["polyline",{points:"12 6 12 12 16 14",key:"68esgv"}]])},74421:(e,a,s)=>{"use strict";s.d(a,{A:()=>t});let t=(0,s(14294).A)("ListChecks",[["path",{d:"m3 17 2 2 4-4",key:"1jhpwq"}],["path",{d:"m3 7 2 2 4-4",key:"1obspn"}],["path",{d:"M13 6h8",key:"15sg57"}],["path",{d:"M13 12h8",key:"h98zly"}],["path",{d:"M13 18h8",key:"oe0vm4"}]])},74666:(e,a,s)=>{"use strict";s.d(a,{A:()=>t});let t=(0,s(14294).A)("FileX",[["path",{d:"M15 2H6a2 2 0 0 0-2 2v16a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V7Z",key:"1rqfz7"}],["path",{d:"M14 2v4a2 2 0 0 0 2 2h4",key:"tnqrlb"}],["path",{d:"m14.5 12.5-5 5",key:"b62r18"}],["path",{d:"m9.5 12.5 5 5",key:"1rk7el"}]])},75022:(e,a,s)=>{Promise.resolve().then(s.bind(s,8614))},75968:(e,a,s)=>{"use strict";s.d(a,{A:()=>t});let t=(0,s(14294).A)("Anchor",[["path",{d:"M12 22V8",key:"qkxhtm"}],["path",{d:"M5 12H2a10 10 0 0 0 20 0h-3",key:"1hv3nh"}],["circle",{cx:"12",cy:"5",r:"3",key:"rqqgnr"}]])},87455:(e,a,s)=>{"use strict";s.d(a,{A:()=>t});let t=(0,s(14294).A)("Inbox",[["polyline",{points:"22 12 16 12 14 15 10 15 8 12 2 12",key:"o97t9d"}],["path",{d:"M5.45 5.11 2 12v6a2 2 0 0 0 2 2h16a2 2 0 0 0 2-2v-6l-3.45-6.89A2 2 0 0 0 16.76 4H7.24a2 2 0 0 0-1.79 1.11z",key:"oot6mr"}]])},88964:(e,a,s)=>{"use strict";s.d(a,{A:()=>t});let t=(0,s(14294).A)("SquarePen",[["path",{d:"M12 3H5a2 2 0 0 0-2 2v14a2 2 0 0 0 2 2h14a2 2 0 0 0 2-2v-7",key:"1m0v6g"}],["path",{d:"M18.375 2.625a1 1 0 0 1 3 3l-9.013 9.014a2 2 0 0 1-.853.505l-2.873.84a.5.5 0 0 1-.62-.62l.84-2.873a2 2 0 0 1 .506-.852z",key:"ohrbg2"}]])},91719:(e,a,s)=>{"use strict";s.d(a,{A:()=>t});let t=(0,s(14294).A)("Package",[["path",{d:"M11 21.73a2 2 0 0 0 2 0l7-4A2 2 0 0 0 21 16V8a2 2 0 0 0-1-1.73l-7-4a2 2 0 0 0-2 0l-7 4A2 2 0 0 0 3 8v8a2 2 0 0 0 1 1.73z",key:"1a0edw"}],["path",{d:"M12 22V12",key:"d0xqtd"}],["polyline",{points:"3.29 7 12 12 20.71 7",key:"ousv84"}],["path",{d:"m7.5 4.27 9 5.15",key:"1c824w"}]])},92129:(e,a,s)=>{"use strict";s.d(a,{A:()=>t});let t=(0,s(14294).A)("Weight",[["circle",{cx:"12",cy:"5",r:"3",key:"rqqgnr"}],["path",{d:"M6.5 8a2 2 0 0 0-1.905 1.46L2.1 18.5A2 2 0 0 0 4 21h16a2 2 0 0 0 1.925-2.54L19.4 9.5A2 2 0 0 0 17.48 8Z",key:"56o5sh"}]])},92322:(e,a,s)=>{"use strict";s.d(a,{A:()=>t});let t=(0,s(14294).A)("FileCheck",[["path",{d:"M15 2H6a2 2 0 0 0-2 2v16a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V7Z",key:"1rqfz7"}],["path",{d:"M14 2v4a2 2 0 0 0 2 2h4",key:"tnqrlb"}],["path",{d:"m9 15 2 2 4-4",key:"1grp1n"}]])},94908:(e,a,s)=>{"use strict";s.d(a,{A:()=>t});let t=(0,s(14294).A)("Truck",[["path",{d:"M14 18V6a2 2 0 0 0-2-2H4a2 2 0 0 0-2 2v11a1 1 0 0 0 1 1h2",key:"wrbu53"}],["path",{d:"M15 18H9",key:"1lyqi6"}],["path",{d:"M19 18h2a1 1 0 0 0 1-1v-3.65a1 1 0 0 0-.22-.624l-3.48-4.35A1 1 0 0 0 17.52 8H14",key:"lysw3i"}],["circle",{cx:"17",cy:"18",r:"2",key:"332jqn"}],["circle",{cx:"7",cy:"18",r:"2",key:"19iecd"}]])}},e=>{e.O(0,[2992,7138,4865,9255,3744,5282,9351,3504,6505,4221,5479,5171,2228,7913,6190,8441,1255,7358],()=>e(e.s=75022)),_N_E=e.O()}]);