(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[9025],{9691:(e,s,a)=>{"use strict";a.d(s,{j:()=>t});var n=a(95155),r=a(51834),i=a(17037),l=a(59321);function t(e){let{isOpen:s,onClose:a,worksheet:t}=e;return s&&t?(0,n.jsx)(r.lG,{open:s,onOpenChange:a,children:(0,n.jsx)(r.Cf,{className:"max-w-4xl p-0 h-[90vh] flex flex-col",children:(0,n.jsx)(i.F,{className:"flex-grow",children:(0,n.jsx)("div",{className:"p-6",children:(0,n.jsx)(l.v,{worksheet:t,onClose:a})})})})}):null}},73674:(e,s,a)=>{Promise.resolve().then(a.bind(a,76257))},76257:(e,s,a)=>{"use strict";a.r(s),a.d(s,{default:()=>R});var n=a(95155),r=a(12115),i=a(20063),l=a(54901),t=a(35434),o=a(92033),d=a(90109),c=a(85584),h=a(74421),x=a(76251),u=a(86948),m=a(3998),j=a(14585),p=a(19708),f=a(15894),N=a(87270),v=a(65142),g=a(5282),w=a(80160),A=a(36654),y=a(73180),b=a(9691);function C(e){let{cases:s,onRefresh:a}=e,{user:i}=(0,l.A)(),{toast:t}=(0,f.dj)(),[d,c]=(0,r.useState)({}),[h,x]=(0,r.useState)({}),[u,C]=(0,r.useState)(null),E=async e=>{let s=e.id,n=d[s];if(!n||isNaN(Number(n)))return void t({title:"Valor inv\xe1lido",description:"Por favor, ingrese un n\xfamero v\xe1lido para las posiciones.",variant:"destructive"});if(!i||!i.displayName)return void t({title:"Error",description:"Debe estar autenticado.",variant:"destructive"});x(e=>({...e,[s]:!0}));let r=(0,p.H9)(j.db,"worksheets",s,"aforo","metadata"),l=(0,p.rJ)(j.db,"worksheets",s,"actualizaciones"),o=(0,p.wP)(j.db);try{var c;let s={totalPosiciones:Number(n),aforadorStatus:"En revisi\xf3n",aforadorStatusLastUpdate:{by:i.displayName,at:p.Dc.now()}};o.set(r,s,{merge:!0}),o.set((0,p.H9)(l),{updatedAt:p.Dc.now(),updatedBy:i.displayName,field:"totalPosiciones",oldValue:(null==(c=e.aforo)?void 0:c.totalPosiciones)||null,newValue:Number(n),comment:"Total de posiciones actualizado por aforador."}),await o.commit(),t({title:"Guardado",description:"Total de posiciones para el NE ".concat(e.ne,' guardado y estado actualizado a "En revisi\xf3n".')}),a()}catch(e){console.error("Error saving positions:",e),t({title:"Error",description:"No se pudo guardar la informaci\xf3n.",variant:"destructive"})}finally{x(e=>({...e,[s]:!1}))}};return 0===s.length?(0,n.jsx)("p",{className:"text-center text-muted-foreground p-4",children:"No tiene casos asignados pendientes."}):(0,n.jsxs)(n.Fragment,{children:[(0,n.jsx)("div",{className:"overflow-x-auto table-container rounded-lg border",children:(0,n.jsxs)(N.XI,{children:[(0,n.jsx)(N.A0,{children:(0,n.jsxs)(N.Hj,{children:[(0,n.jsx)(N.nd,{children:"Acciones"}),(0,n.jsx)(N.nd,{children:"NE"}),(0,n.jsx)(N.nd,{children:"Consignatario"}),(0,n.jsx)(N.nd,{children:"Modelo (Patr\xf3n)"}),(0,n.jsx)(N.nd,{children:"Fecha Asignaci\xf3n"}),(0,n.jsx)(N.nd,{children:"Total Posiciones"})]})}),(0,n.jsx)(N.BF,{children:s.map(e=>{let s=e.aforo;return(0,n.jsxs)(N.Hj,{children:[(0,n.jsx)(N.nA,{children:(0,n.jsxs)(m.$,{variant:"outline",size:"sm",onClick:()=>C(e.worksheet),children:[(0,n.jsx)(A.A,{className:"mr-2 h-4 w-4"})," Ver Hoja"]})}),(0,n.jsx)(N.nA,{className:"font-medium",children:e.ne}),(0,n.jsx)(N.nA,{children:e.consignee}),(0,n.jsx)(N.nA,{children:(null==s?void 0:s.declarationPattern)||"N/A"}),(0,n.jsx)(N.nA,{children:e.assignmentDate?(0,g.GP)(e.assignmentDate.toDate(),"dd/MM/yyyy HH:mm",{locale:w.es}):"N/A"}),(0,n.jsx)(N.nA,{children:(null==s?void 0:s.aforadorStatus)==="En revisi\xf3n"?(0,n.jsx)("span",{className:"font-semibold text-green-600",children:s.totalPosiciones}):(0,n.jsxs)("div",{className:"flex items-center gap-2",children:[(0,n.jsx)(v.p,{type:"number",placeholder:"Ingrese posiciones",defaultValue:(null==s?void 0:s.totalPosiciones)||"",onChange:s=>{var a,n;return a=e.id,n=s.target.value,void c(e=>({...e,[a]:n}))},disabled:h[e.id],className:"w-40"}),(0,n.jsxs)(m.$,{size:"sm",onClick:()=>E(e),disabled:h[e.id]||!d[e.id],children:[h[e.id]?(0,n.jsx)(o.A,{className:"mr-2 h-4 w-4 animate-spin"}):(0,n.jsx)(y.A,{className:"mr-2 h-4 w-4"}),"Guardar"]})]})})]},e.id)})})]})}),u&&(0,n.jsx)(b.j,{isOpen:!!u,onClose:()=>C(null),worksheet:u})]})}var E=a(51834),k=a(17037),P=a(15239);function H(e){let{isOpen:s,onClose:a,completedCases:i,aforadorName:l}=e,t=(0,r.useRef)(null);return s?(0,n.jsx)(E.lG,{open:s,onOpenChange:a,children:(0,n.jsxs)(E.Cf,{className:"max-w-2xl",children:[(0,n.jsxs)(E.c7,{children:[(0,n.jsx)(E.L3,{children:"Resumen Diario de Aforo"}),(0,n.jsx)(E.rr,{children:'Casos marcados como "En revisi\xf3n" el d\xeda de hoy.'})]}),(0,n.jsxs)("div",{ref:t,children:[(0,n.jsxs)("div",{className:"my-4 text-center hidden print:block",children:[(0,n.jsx)(P.default,{src:"/AconicExaminer/imagenes/HEADERSEXA.svg",alt:"Examen Header",width:700,height:80,className:"w-full h-auto mb-4",priority:!0}),(0,n.jsxs)("h2",{className:"font-bold",children:["Resumen de Aforos - ",(0,g.GP)(new Date,"PPP",{locale:w.es})]}),(0,n.jsxs)("p",{children:["Aforador: ",l]})]}),(0,n.jsx)(k.F,{className:"max-h-96",children:(0,n.jsxs)(N.XI,{children:[(0,n.jsx)(N.A0,{children:(0,n.jsxs)(N.Hj,{children:[(0,n.jsx)(N.nd,{children:"NE"}),(0,n.jsx)(N.nd,{children:"Consignatario"}),(0,n.jsx)(N.nd,{className:"text-right",children:"Total Posiciones"})]})}),(0,n.jsx)(N.BF,{children:i.length>0?i.map(e=>{var s;return(0,n.jsxs)(N.Hj,{children:[(0,n.jsx)(N.nA,{children:e.ne}),(0,n.jsx)(N.nA,{children:e.consignee}),(0,n.jsx)(N.nA,{className:"text-right",children:(null==(s=e.aforo)?void 0:s.totalPosiciones)||"N/A"})]},e.id)}):(0,n.jsx)(N.Hj,{children:(0,n.jsx)(N.nA,{colSpan:3,className:"text-center text-muted-foreground",children:"No ha completado ning\xfan caso hoy."})})})]})})]}),(0,n.jsxs)(E.Es,{children:[(0,n.jsx)(m.$,{variant:"outline",onClick:a,children:"Cerrar"}),(0,n.jsxs)(m.$,{onClick:()=>{let e=t.current;if(e){let s=window.open("","_blank","height=600,width=800");s&&(s.document.write("<html><head><title>Resumen Diario de Aforo</title>"),s.document.write("<style>@media print { body { -webkit-print-color-adjust: exact; } table { width: 100%; border-collapse: collapse; } th, td { border: 1px solid black; padding: 8px; text-align: left; } th { background-color: #f2f2f2; } img { max-width: 100%; height: auto; } .no-print { display: none; } }</style>"),s.document.write("</head><body>"),s.document.write(e.innerHTML),s.document.write("</body></html>"),s.document.close(),s.focus(),s.print())}},disabled:0===i.length,children:[(0,n.jsx)(x.A,{className:"mr-2 h-4 w-4"})," Imprimir"]})]})]})}):null}var D=a(52619),S=a.n(D);function R(){let{user:e,loading:s}=(0,l.A)(),a=(0,i.useRouter)(),{toast:N}=(0,f.dj)(),[v,g]=(0,r.useState)([]),[w,A]=(0,r.useState)(!0),[y,b]=(0,r.useState)(!1);(0,r.useEffect)(()=>{s||e||a.push("/")},[e,s,a]);let E=(0,r.useCallback)(()=>{if(!(null==e?void 0:e.displayName))return;A(!0);let s=(0,p.P)((0,p.rJ)(j.db,"worksheets"),(0,p._M)("aforador","==",e.displayName),(0,p.My)("createdAt","desc"));return(0,p.aQ)(s,e=>{g(e.docs.map(e=>({id:e.id,...e.data(),worksheet:{id:e.id,...e.data()}}))),A(!1)},e=>{console.error("Error fetching aforador cases:",e),N({title:"Error",description:"No se pudieron cargar los casos asignados.",variant:"destructive"}),A(!1)})},[null==e?void 0:e.displayName,N]);(0,r.useEffect)(()=>{let e=E();return()=>{e&&e()}},[E]);let k=(null==e?void 0:e.displayName)?e.displayName.split(" ")[0]:"Aforador",P=(0,r.useMemo)(()=>{let e=new Date;return e.setHours(0,0,0,0),v.filter(s=>{var a;let n=s.aforo;return(null==n?void 0:n.aforadorStatus)==="En revisi\xf3n"&&(null==n||null==(a=n.aforadorStatusLastUpdate)?void 0:a.at.toDate())>=e})},[v]);return s||!e?(0,n.jsx)("div",{className:"min-h-screen flex items-center justify-center bg-background",children:(0,n.jsx)(o.A,{className:"h-12 w-12 animate-spin text-primary"})}):(0,n.jsxs)(n.Fragment,{children:[(0,n.jsx)(t.G,{children:(0,n.jsxs)("div",{className:"py-2 md:py-5 space-y-6",children:[(0,n.jsx)(u.Zp,{className:"w-full mx-auto custom-shadow",children:(0,n.jsx)(u.aR,{children:(0,n.jsxs)("div",{className:"flex flex-col sm:flex-row justify-between sm:items-center gap-4",children:[(0,n.jsxs)("div",{children:[(0,n.jsx)(u.ZB,{className:"text-2xl",children:"Panel de Aforador"}),(0,n.jsxs)(u.BT,{children:["Bienvenido, ",k,". Aqu\xed est\xe1n sus casos asignados."]})]}),(0,n.jsxs)("div",{className:"flex flex-wrap gap-2",children:[(0,n.jsx)(m.$,{asChild:!0,variant:"outline",children:(0,n.jsxs)(S(),{href:"/database",children:[(0,n.jsx)(d.A,{className:"mr-2 h-4 w-4"})," Buscar Previo"]})}),(0,n.jsx)(m.$,{asChild:!0,variant:"outline",children:(0,n.jsxs)(S(),{href:"/reports",children:[(0,n.jsx)(c.A,{className:"mr-2 h-4 w-4"})," Reportes de Previos"]})})]})]})})}),(0,n.jsxs)(u.Zp,{className:"w-full mx-auto custom-shadow",children:[(0,n.jsxs)(u.aR,{children:[(0,n.jsxs)("div",{className:"flex justify-between items-center",children:[(0,n.jsxs)(u.ZB,{className:"text-xl flex items-center gap-2",children:[(0,n.jsx)(h.A,{})," Mis Casos Asignados"]}),(0,n.jsxs)(m.$,{onClick:()=>b(!0),variant:"secondary",children:[(0,n.jsx)(x.A,{className:"mr-2 h-4 w-4"})," Resumen Diario"]})]}),(0,n.jsx)(u.BT,{children:"Casos que requieren su atenci\xf3n para el ingreso del total de posiciones."})]}),(0,n.jsx)(u.Wu,{children:w?(0,n.jsx)("div",{className:"flex justify-center items-center py-10",children:(0,n.jsx)(o.A,{className:"h-8 w-8 animate-spin text-primary"})}):(0,n.jsx)(C,{cases:v,onRefresh:E})})]})]})}),(0,n.jsx)(H,{isOpen:y,onClose:()=>b(!1),completedCases:P,aforadorName:e.displayName||"N/A"})]})}}},e=>{e.O(0,[2992,7138,4865,2130,3744,5282,7211,5479,5171,9817,9321,8441,1255,7358],()=>e(e.s=73674)),_N_E=e.O()}]);